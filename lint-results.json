
> orbitcrm-app@0.1.0 lint
> eslint --format json

[{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/.tmp/check_db.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":58},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":3,"column":16,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":3,"endColumn":33}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nconst { createClient } = require('@supabase/supabase-js');\nconst dotenv = require('dotenv');\ndotenv.config({ path: '.env.local' });\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseKey) {\n    console.error('Missing Supabase environment variables');\n    process.exit(1);\n}\n\nconst supabase = createClient(supabaseUrl, supabaseKey);\n\nasync function checkData() {\n    console.log('\\nChecking users and their tenant_id...');\n    const { data: profiles, error: pError } = await supabase\n        .from('profiles')\n        .select('id, email, tenant_id, role');\n\n    if (pError) {\n        console.error('Error fetching profiles:', pError.message);\n    } else {\n        // Mask IDs for brevity but show enough to compare\n        console.table(profiles.map(p => ({\n            ...p,\n            id: p.id.substring(0, 8) + '...',\n            tenant_id: p.tenant_id ? p.tenant_id.substring(0, 8) + '...' : 'NULL'\n        })));\n    }\n\n    console.log('\\nChecking organization count...');\n    const { data: orgs, error: oError } = await supabase\n        .from('organizations')\n        .select('id, name');\n\n    if (oError) {\n        console.error('Error fetching organizations:', oError.message);\n    } else {\n        console.log(`Total organizations: ${orgs.length}`);\n        console.table(orgs.map(o => ({\n            ...o,\n            id: o.id.substring(0, 8) + '...'\n        })));\n    }\n\n    console.log('\\nChecking contacts count per tenant...');\n    const { data: contactCounts, error: cError } = await supabase\n        .from('contacts')\n        .select('tenant_id');\n\n    if (cError) {\n        console.error('Error fetching contacts:', cError.message);\n    } else {\n        const counts = contactCounts.reduce((acc, c) => {\n            acc[c.tenant_id] = (acc[c.tenant_id] || 0) + 1;\n            return acc;\n        }, {});\n        console.log('Contact counts per tenant:', counts);\n    }\n}\n\ncheckData();\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/next.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/scripts/check_contacts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/scripts/fix_admin_org.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/activity/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[991,994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[991,994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Button } from '@/components/ui/button'\nimport { getOrganizationActivity, EventType } from '@/lib/activity-log'\nimport { formatDistanceToNow, format } from 'date-fns'\nimport {\n    UserPlus,\n    Edit,\n    Trash2,\n    Mail,\n    Phone,\n    FileText,\n    CheckCircle,\n    Clock,\n    Tag,\n    Loader2,\n    Activity,\n    DollarSign,\n    Upload,\n    Download,\n    Eye,\n    AlertCircle,\n    RefreshCw,\n    ArrowLeft,\n} from 'lucide-react'\nimport Link from 'next/link'\n\ninterface ActivityEntry {\n    id: string\n    tenant_id: string\n    user_id: string\n    event_type: EventType\n    entity_type: string\n    entity_id: string\n    entity_name?: string\n    description?: string\n    metadata?: Record<string, any>\n    created_at: string\n    user_name?: string\n    user_avatar?: string\n}\n\nconst EVENT_ICONS: Record<EventType, React.ReactNode> = {\n    created: <UserPlus className=\"h-4 w-4 text-green-600\" />,\n    updated: <Edit className=\"h-4 w-4 text-blue-600\" />,\n    deleted: <Trash2 className=\"h-4 w-4 text-red-600\" />,\n    viewed: <Eye className=\"h-4 w-4 text-slate-500\" />,\n    emailed: <Mail className=\"h-4 w-4 text-purple-600\" />,\n    called: <Phone className=\"h-4 w-4 text-indigo-600\" />,\n    noted: <FileText className=\"h-4 w-4 text-amber-600\" />,\n    tagged: <Tag className=\"h-4 w-4 text-pink-600\" />,\n    status_changed: <Activity className=\"h-4 w-4 text-orange-600\" />,\n    assigned: <UserPlus className=\"h-4 w-4 text-teal-600\" />,\n    completed: <CheckCircle className=\"h-4 w-4 text-green-600\" />,\n    invoiced: <DollarSign className=\"h-4 w-4 text-emerald-600\" />,\n    paid: <DollarSign className=\"h-4 w-4 text-green-600\" />,\n    uploaded: <Upload className=\"h-4 w-4 text-blue-500\" />,\n    downloaded: <Download className=\"h-4 w-4 text-slate-500\" />,\n}\n\nconst EVENT_LABELS: Record<EventType, string> = {\n    created: 'Created',\n    updated: 'Updated',\n    deleted: 'Deleted',\n    viewed: 'Viewed',\n    emailed: 'Emailed',\n    called: 'Called',\n    noted: 'Note Added',\n    tagged: 'Tagged',\n    status_changed: 'Status Changed',\n    assigned: 'Assigned',\n    completed: 'Completed',\n    invoiced: 'Invoiced',\n    paid: 'Paid',\n    uploaded: 'Uploaded',\n    downloaded: 'Downloaded',\n}\n\nconst ENTITY_COLORS: Record<string, string> = {\n    contact: 'bg-[#3D4A67]/10 text-[#3D4A67]',\n    project: 'bg-[#9EAE8E]/10 text-[#9EAE8E]',\n    task: 'bg-[#E9B949]/10 text-[#E9B949]',\n    invoice: 'bg-[#D1855C]/10 text-[#D1855C]',\n    document: 'bg-blue-100 text-blue-700',\n    note: 'bg-purple-100 text-purple-700',\n}\n\nconst ENTITY_LINKS: Record<string, (id: string) => string> = {\n    contact: (id) => `/contacts/${id}`,\n    project: (id) => `/projects/${id}`,\n    task: (id) => `/tasks/${id}`,\n    invoice: (id) => `/invoices/${id}`,\n}\n\nexport default function ActivityPage() {\n    const [activities, setActivities] = useState<ActivityEntry[]>([])\n    const [isLoading, setIsLoading] = useState(true)\n    const [eventFilter, setEventFilter] = useState<EventType | 'all'>('all')\n    const [entityFilter, setEntityFilter] = useState<string>('all')\n\n    useEffect(() => {\n        loadActivities()\n    }, [])\n\n    async function loadActivities() {\n        setIsLoading(true)\n        try {\n            const data = await getOrganizationActivity(100) // Fetch more for filtering\n            setActivities(data as ActivityEntry[])\n        } catch (error) {\n            console.error('Failed to load activities:', error)\n        } finally {\n            setIsLoading(false)\n        }\n    }\n\n    const filteredActivities = activities.filter(a => {\n        if (eventFilter !== 'all' && a.event_type !== eventFilter) return false\n        if (entityFilter !== 'all' && a.entity_type !== entityFilter) return false\n        return true\n    })\n\n    const linkableActivity = (activity: ActivityEntry) => {\n        const entityType = activity.entity_type\n        if (ENTITY_LINKS[entityType]) {\n            return ENTITY_LINKS[entityType](activity.entity_id)\n        }\n        return null\n    }\n\n    // Get unique entity types for filter\n    const entityTypes = Array.from(new Set(activities.map(a => a.entity_type)))\n\n    return (\n        <div className=\"space-y-6 max-w-5xl\">\n            {/* Header */}\n            <div className=\"flex items-start justify-between\">\n                <div>\n                    <div className=\"flex items-center gap-3 mb-2\">\n                        <Link href=\"/dashboard\">\n                            <Button variant=\"ghost\" size=\"sm\" className=\"text-slate-600 hover:text-slate-900\">\n                                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                                Back\n                            </Button>\n                        </Link>\n                    </div>\n                    <h1 className=\"text-3xl font-bold text-[#3D4A67]\">Activity Dashboard</h1>\n                    <p className=\"text-slate-600 mt-1\">\n                        Complete timeline of all organization activities\n                    </p>\n                </div>\n                <Button\n                    onClick={loadActivities}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    disabled={isLoading}\n                    className=\"border-slate-300\"\n                >\n                    <RefreshCw className={`h-4 w-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />\n                    Refresh\n                </Button>\n            </div>\n\n            {/* Filters */}\n            <Card className=\"border-slate-200 bg-white\">\n                <CardContent className=\"pt-6\">\n                    <div className=\"flex flex-wrap gap-4\">\n                        <div className=\"flex-1 min-w-[200px]\">\n                            <label className=\"text-sm font-medium text-slate-700 mb-2 block\">\n                                Event Type\n                            </label>\n                            <Select\n                                value={eventFilter}\n                                onValueChange={(v) => setEventFilter(v as EventType | 'all')}\n                            >\n                                <SelectTrigger className=\"w-full\">\n                                    <SelectValue placeholder=\"All events\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"all\">All Events</SelectItem>\n                                    <SelectItem value=\"created\">Created</SelectItem>\n                                    <SelectItem value=\"updated\">Updated</SelectItem>\n                                    <SelectItem value=\"deleted\">Deleted</SelectItem>\n                                    <SelectItem value=\"status_changed\">Status Changed</SelectItem>\n                                    <SelectItem value=\"emailed\">Emailed</SelectItem>\n                                    <SelectItem value=\"called\">Called</SelectItem>\n                                    <SelectItem value=\"noted\">Notes</SelectItem>\n                                    <SelectItem value=\"invoiced\">Invoiced</SelectItem>\n                                    <SelectItem value=\"paid\">Paid</SelectItem>\n                                    <SelectItem value=\"completed\">Completed</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n\n                        <div className=\"flex-1 min-w-[200px]\">\n                            <label className=\"text-sm font-medium text-slate-700 mb-2 block\">\n                                Entity Type\n                            </label>\n                            <Select value={entityFilter} onValueChange={setEntityFilter}>\n                                <SelectTrigger className=\"w-full\">\n                                    <SelectValue placeholder=\"All entities\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"all\">All Entities</SelectItem>\n                                    {entityTypes.map(type => (\n                                        <SelectItem key={type} value={type}>\n                                            {type.charAt(0).toUpperCase() + type.slice(1)}s\n                                        </SelectItem>\n                                    ))}\n                                </SelectContent>\n                            </Select>\n                        </div>\n\n                        <div className=\"flex items-end\">\n                            <div className=\"text-sm text-slate-600\">\n                                <div className=\"font-medium\">{filteredActivities.length}</div>\n                                <div className=\"text-xs\">Activities</div>\n                            </div>\n                        </div>\n                    </div>\n                </CardContent>\n            </Card>\n\n            {/* Activity Timeline */}\n            <Card className=\"border-slate-200 bg-white\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">Activity Timeline</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    {isLoading ? (\n                        <div className=\"flex items-center justify-center py-12\">\n                            <Loader2 className=\"h-8 w-8 animate-spin text-slate-400\" />\n                            <span className=\"ml-2 text-slate-500\">Loading activities...</span>\n                        </div>\n                    ) : filteredActivities.length === 0 ? (\n                        <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                            <AlertCircle className=\"h-12 w-12 text-slate-300 mb-3\" />\n                            <p className=\"text-slate-500 text-sm\">No activities found</p>\n                            <p className=\"text-slate-400 text-xs mt-1\">\n                                Try adjusting your filters or create some activity\n                            </p>\n                        </div>\n                    ) : (\n                        <div className=\"relative\">\n                            {/* Timeline line */}\n                            <div className=\"absolute left-5 top-0 bottom-0 w-0.5 bg-slate-200\" />\n\n                            {/* Activity items */}\n                            <div className=\"space-y-6\">\n                                {filteredActivities.map((activity) => {\n                                    const link = linkableActivity(activity)\n                                    const content = (\n                                        <div className=\"relative pl-12\">\n                                            {/* Icon */}\n                                            <div className=\"absolute left-0 top-0 flex h-10 w-10 items-center justify-center rounded-full bg-white border-2 border-slate-200\">\n                                                {EVENT_ICONS[activity.event_type] || (\n                                                    <Activity className=\"h-4 w-4 text-slate-400\" />\n                                                )}\n                                            </div>\n\n                                            {/* Content */}\n                                            <div className=\"flex-1 bg-slate-50 rounded-lg p-4 hover:bg-slate-100 transition-colors\">\n                                                <div className=\"flex items-start justify-between gap-3 mb-2\">\n                                                    <div className=\"flex items-center gap-2 flex-wrap\">\n                                                        {activity.user_name && (\n                                                            <span className=\"text-sm font-medium text-slate-900\">\n                                                                {activity.user_name}\n                                                            </span>\n                                                        )}\n                                                        <Badge\n                                                            variant=\"secondary\"\n                                                            className={`text-xs ${ENTITY_COLORS[activity.entity_type] || 'bg-slate-100 text-slate-700'}`}\n                                                        >\n                                                            {activity.entity_type}\n                                                        </Badge>\n                                                        <Badge variant=\"outline\" className=\"text-xs\">\n                                                            {EVENT_LABELS[activity.event_type]}\n                                                        </Badge>\n                                                    </div>\n                                                    <div className=\"flex flex-col items-end gap-0.5 shrink-0\">\n                                                        <div className=\"flex items-center gap-1 text-xs text-slate-500\">\n                                                            <Clock className=\"h-3 w-3\" />\n                                                            {formatDistanceToNow(new Date(activity.created_at), { addSuffix: true })}\n                                                        </div>\n                                                        <div className=\"text-xs text-slate-400\">\n                                                            {format(new Date(activity.created_at), 'MMM d, h:mm a')}\n                                                        </div>\n                                                    </div>\n                                                </div>\n\n                                                <p className=\"text-sm text-slate-700 mb-1\">\n                                                    {activity.description || `${EVENT_LABELS[activity.event_type]} ${activity.entity_type}`}\n                                                </p>\n\n                                                {activity.entity_name && (\n                                                    <p className=\"text-sm text-slate-600 font-medium\">\n                                                        {activity.entity_name}\n                                                    </p>\n                                                )}\n\n                                                {activity.metadata && Object.keys(activity.metadata).length > 0 && (\n                                                    <div className=\"mt-2 pt-2 border-t border-slate-200 text-xs text-slate-600 space-y-1\">\n                                                        {activity.metadata.subject && (\n                                                            <div>Subject: {activity.metadata.subject}</div>\n                                                        )}\n                                                        {activity.metadata.duration && (\n                                                            <div>Duration: {activity.metadata.duration} minutes</div>\n                                                        )}\n                                                        {activity.metadata.amount && (\n                                                            <div>\n                                                                Amount: {activity.metadata.currency} {activity.metadata.amount}\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                )}\n                                            </div>\n                                        </div>\n                                    )\n\n                                    return link ? (\n                                        <Link key={activity.id} href={link}>\n                                            {content}\n                                        </Link>\n                                    ) : (\n                                        <div key={activity.id}>{content}</div>\n                                    )\n                                })}\n                            </div>\n                        </div>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/chat/page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/chat/page.tsx:42:13\n  40 |     useEffect(() => {\n  41 |         if (activeConversation) {\n> 42 |             setSelectedModel(activeConversation.model || 'gpt-4o-mini')\n     |             ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  43 |         }\n  44 |     }, [activeConversation])\n  45 |","line":42,"column":13,"nodeType":null,"endLine":42,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2461,2464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2461,2464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activeConversation'. Either include it or remove the dependency array.","line":81,"column":8,"nodeType":"ArrayExpression","endLine":81,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [activeConversation, activeConversationId, setMessages]","fix":{"range":[2528,2563],"text":"[activeConversation, activeConversationId, setMessages]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useRef, useEffect } from 'react'\nimport { useChat } from '@ai-sdk/react'\nimport { useChatStore } from '@/stores/chat-store'\nimport { Card, CardContent } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\"\nimport { AVAILABLE_MODELS } from '@/types/chat'\nimport { cn } from '@/lib/utils'\nimport { Plus, Send, Bot, X, MessageSquare, Loader2 } from 'lucide-react'\n\nexport default function ChatPage() {\n    const {\n        conversations,\n        activeConversationId,\n        createConversation,\n        deleteConversation,\n        setActiveConversation,\n        addMessage,\n        getConversation,\n        fetchConversations,\n        updateConversationModel,\n        isLoading: isLoadingConversations\n    } = useChatStore()\n\n    const [selectedModel, setSelectedModel] = useState('gpt-4o-mini')\n    const messagesEndRef = useRef<HTMLDivElement>(null)\n\n    const activeConversation = activeConversationId ? getConversation(activeConversationId) : null\n\n    // Sync selected model with active conversation\n    useEffect(() => {\n        if (activeConversation) {\n            setSelectedModel(activeConversation.model || 'gpt-4o-mini')\n        }\n    }, [activeConversation])\n\n    // Use the Vercel AI SDK's useChat hook for streaming\n    const { messages, input, handleInputChange, handleSubmit, isLoading, setMessages } = useChat({\n        api: '/api/chat',\n        body: {\n            model: selectedModel,\n            conversationId: activeConversationId,\n        },\n        onFinish: async (message) => {\n            // Save assistant message to Supabase\n            if (activeConversationId) {\n                await addMessage(activeConversationId, {\n                    role: 'assistant',\n                    content: message.content,\n                })\n            }\n        },\n    })\n\n    // Fetch conversations on mount\n    useEffect(() => {\n        fetchConversations()\n    }, [fetchConversations])\n\n    // Sync messages with active conversation\n    useEffect(() => {\n        if (activeConversation) {\n            const chatMessages = activeConversation.messages.map(msg => ({\n                id: msg.id,\n                role: msg.role,\n                content: msg.content,\n            }))\n            setMessages(chatMessages as any)\n        } else {\n            setMessages([])\n        }\n    }, [activeConversationId, setMessages])\n\n    const scrollToBottom = () => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" })\n    }\n\n    useEffect(() => {\n        scrollToBottom()\n    }, [messages])\n\n    const handleChatSubmit = async (e: React.FormEvent) => {\n        e.preventDefault()\n        if (!input.trim() || isLoading) return\n\n        let conversationId = activeConversationId\n        if (!conversationId) {\n            const newConv = await createConversation({ model: selectedModel })\n            if (!newConv) return\n            conversationId = newConv.id\n        }\n\n        // Save user message to Supabase\n        await addMessage(conversationId, {\n            role: 'user',\n            content: input,\n        })\n\n        // Let useChat handle the API call and streaming\n        handleSubmit(e)\n    }\n\n    const handleModelChange = async (newModel: string) => {\n        setSelectedModel(newModel)\n        if (activeConversationId) {\n            await updateConversationModel(activeConversationId, newModel)\n        }\n    }\n\n    return (\n        <div className=\"flex h-[calc(100vh-4rem)] flex-col\">\n            <div className=\"flex items-center justify-between border-b border-slate-200 pb-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-[#3D4A67]\">AI Chat</h1>\n                    <p className=\"text-slate-600\">Your intelligent CRM assistant</p>\n                </div>\n                <Button\n                    className=\"bg-[#D1855C] hover:bg-[#B1653C] text-white gap-2\"\n                    onClick={() => { createConversation() }}\n                >\n                    <Plus className=\"h-4 w-4\" />\n                    New Chat\n                </Button>\n            </div>\n\n            <div className=\"flex flex-1 gap-4 pt-4 overflow-hidden\">\n                {/* Conversations List */}\n                <Card className=\"w-64 flex-shrink-0 border-slate-200 bg-white shadow-sm overflow-hidden\">\n                    <CardContent className=\"p-4 h-full overflow-y-auto\">\n                        <h3 className=\"mb-4 font-semibold text-[#3D4A67] flex items-center gap-2\">\n                            <MessageSquare className=\"h-4 w-4\" />\n                            Conversations\n                        </h3>\n                        {isLoadingConversations ? (\n                            <div className=\"flex items-center gap-2 text-sm text-slate-500\">\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                                Loading...\n                            </div>\n                        ) : conversations.length === 0 ? (\n                            <p className=\"text-sm text-slate-500\">No conversations yet</p>\n                        ) : (\n                            <div className=\"space-y-2\">\n                                {conversations.slice().reverse().map((conv) => (\n                                    <div\n                                        key={conv.id}\n                                        className={cn(\n                                            \"p-2 rounded-lg cursor-pointer text-sm group flex justify-between items-start transition-colors\",\n                                            activeConversationId === conv.id\n                                                ? \"bg-[#3D4A67]/10 text-[#3D4A67]\"\n                                                : \"hover:bg-slate-100 text-slate-700\"\n                                        )}\n                                        onClick={() => setActiveConversation(conv.id)}\n                                    >\n                                        <span className=\"truncate flex-1\">{conv.title}</span>\n                                        <button\n                                            className=\"opacity-0 group-hover:opacity-100 text-[#D1855C] hover:text-[#B1653C] ml-2\"\n                                            onClick={(e) => {\n                                                e.stopPropagation()\n                                                deleteConversation(conv.id)\n                                            }}\n                                        >\n                                            <X className=\"h-4 w-4\" />\n                                        </button>\n                                    </div>\n                                ))}\n                            </div>\n                        )}\n                    </CardContent>\n                </Card>\n\n                {/* Chat Area */}\n                <div className=\"flex flex-1 flex-col min-w-0\">\n                    <Card className=\"flex-1 border-slate-200 bg-white shadow-sm overflow-hidden flex flex-col\">\n                        {activeConversation ? (\n                            <>\n                                {/* Model selector */}\n                                <div className=\"p-3 border-b border-slate-200 flex items-center gap-2\">\n                                    <span className=\"text-sm text-slate-600\">Model:</span>\n                                    <Select value={selectedModel} onValueChange={handleModelChange}>\n                                        <SelectTrigger className=\"w-48 h-8\">\n                                            <SelectValue />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            {AVAILABLE_MODELS.map((model) => (\n                                                <SelectItem key={model.id} value={model.id}>\n                                                    <div className=\"flex flex-col\">\n                                                        <span className=\"font-medium\">{model.name}</span>\n                                                        <span className=\"text-xs text-slate-500\">{model.description}</span>\n                                                    </div>\n                                                </SelectItem>\n                                            ))}\n                                        </SelectContent>\n                                    </Select>\n                                    <span className=\"text-xs text-slate-500 ml-2\">\n                                        {AVAILABLE_MODELS.find(m => m.id === selectedModel)?.provider}\n                                    </span>\n                                </div>\n\n                                {/* Messages */}\n                                <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n                                    {messages.map((message) => (\n                                        <div\n                                            key={message.id}\n                                            className={cn(\n                                                \"flex\",\n                                                message.role === 'user' ? 'justify-end' : 'justify-start'\n                                            )}\n                                        >\n                                            <div\n                                                className={cn(\n                                                    \"max-w-[80%] rounded-lg px-4 py-2 whitespace-pre-wrap\",\n                                                    message.role === 'user'\n                                                        ? 'bg-[#3D4A67] text-white'\n                                                        : 'bg-slate-100 text-slate-900'\n                                                )}\n                                            >\n                                                {message.content}\n                                            </div>\n                                        </div>\n                                    ))}\n                                    {isLoading && (\n                                        <div className=\"flex justify-start\">\n                                            <div className=\"bg-slate-100 text-slate-600 rounded-lg px-4 py-2 flex items-center gap-2\">\n                                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                                                <span>Thinking...</span>\n                                            </div>\n                                        </div>\n                                    )}\n                                    <div ref={messagesEndRef} />\n                                </div>\n                            </>\n                        ) : (\n                            <CardContent className=\"flex-1 flex items-center justify-center\">\n                                <div className=\"text-center\">\n                                    <div className=\"mx-auto w-16 h-16 rounded-full bg-[#D1855C]/10 flex items-center justify-center mb-4\">\n                                        <Bot className=\"h-8 w-8 text-[#D1855C]\" />\n                                    </div>\n                                    <p className=\"text-slate-600\">\n                                        Start a new conversation or select one from the sidebar\n                                    </p>\n                                    <Button\n                                        className=\"mt-4 bg-[#D1855C] hover:bg-[#B1653C] text-white gap-2\"\n                                        onClick={() => createConversation()}\n                                    >\n                                        <Plus className=\"h-4 w-4\" />\n                                        Start New Chat\n                                    </Button>\n                                </div>\n                            </CardContent>\n                        )}\n                    </Card>\n\n                    {/* Input Area */}\n                    <form onSubmit={handleChatSubmit} className=\"mt-4 flex gap-2\">\n                        <Input\n                            placeholder=\"Type your message... (Try: 'Help me draft an email' or 'Summarize my contacts')\"\n                            value={input}\n                            onChange={handleInputChange}\n                            disabled={isLoading}\n                            className=\"flex-1 border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                        />\n                        <Button\n                            type=\"submit\"\n                            className=\"bg-[#3D4A67] hover:bg-[#2D3A57] text-white\"\n                            disabled={isLoading || !input.trim()}\n                        >\n                            <Send className=\"h-4 w-4\" />\n                        </Button>\n                    </form>\n                </div>\n            </div>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/contacts/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectValue' is defined but never used.","line":10,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":71,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SelectValue"},"fix":{"range":[465,478],"text":""},"desc":"Remove unused variable \"SelectValue\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fetchContacts' is assigned a value but never used.","line":42,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useContactStore } from '@/stores/contact-store'\nimport { Contact, ContactStatus, STATUS_LABELS, STATUS_COLORS } from '@/types/contact'\nimport { useParams, useRouter } from 'next/navigation'\nimport { useEffect, useState } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Checkbox } from '@/components/ui/checkbox'\nimport { ArrowLeft, Edit, Trash2, Loader2, Download, AlertTriangle } from 'lucide-react'\nimport Link from 'next/link'\nimport { TagsInput } from '@/components/contacts/tags-input'\nimport { NotesSection } from '@/components/contacts/notes-section'\nimport { EditContactDialog } from '@/components/contacts/edit-contact-dialog'\nimport { ContactOverviewTab } from '@/components/contacts/contact-overview-tab'\nimport { ContactInvoicesTab } from '@/components/contacts/contact-invoices-tab'\nimport { ContactProjectsTab } from '@/components/contacts/contact-projects-tab'\nimport { ContactTasksTab } from '@/components/contacts/contact-tasks-tab'\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\"\n\nexport default function ContactDetailPage() {\n    const params = useParams()\n    const router = useRouter()\n    const contactId = params.id as string\n\n    // Subscribe to the contacts array directly for reactivity\n    const contacts = useContactStore((state) => state.contacts)\n    const updateStatus = useContactStore((state) => state.updateStatus)\n    const deleteContact = useContactStore((state) => state.deleteContact)\n    const fetchContacts = useContactStore((state) => state.fetchContacts)\n    const fetchContactById = useContactStore((state) => state.fetchContactById)\n    const isLoadingStore = useContactStore((state) => state.isLoading)\n\n    const [contact, setContact] = useState<Contact | null>(null)\n    const [isInternalLoading, setIsInternalLoading] = useState(false)\n    const [showEditDialog, setShowEditDialog] = useState(false)\n    const [showDeleteDialog, setShowDeleteDialog] = useState(false)\n    const [showExportMenu, setShowExportMenu] = useState(false)\n    const [gdprDelete, setGdprDelete] = useState(false)\n    const [isDeleting, setIsDeleting] = useState(false)\n\n    useEffect(() => {\n        const loadContact = async () => {\n            // First try to find in store\n            const found = contacts.find(c => c.id === contactId)\n            if (found) {\n                setContact(found)\n            } else {\n                // Not in store (maybe not on current page), fetch individually\n                setIsInternalLoading(true)\n                const fetched = await fetchContactById(contactId)\n                setContact(fetched)\n                setIsInternalLoading(false)\n            }\n        }\n\n        loadContact()\n    }, [contactId, contacts, fetchContactById])\n\n    const isLoading = isLoadingStore || isInternalLoading\n\n    const handleDelete = async () => {\n        setIsDeleting(true)\n        try {\n            if (gdprDelete) {\n                // GDPR permanent deletion\n                const response = await fetch(`/api/contacts/${contactId}/gdpr-delete`, {\n                    method: 'DELETE',\n                })\n                const data = await response.json()\n\n                if (response.ok) {\n                    // Download deletion certificate\n                    const blob = new Blob(\n                        [JSON.stringify(data.deletion_certificate, null, 2)],\n                        { type: 'application/json' }\n                    )\n                    const url = URL.createObjectURL(blob)\n                    const a = document.createElement('a')\n                    a.href = url\n                    a.download = `deletion-certificate-${contactId}.json`\n                    a.click()\n                    URL.revokeObjectURL(url)\n\n                    router.push('/contacts')\n                } else {\n                    alert('Failed to delete contact: ' + data.error)\n                }\n            } else {\n                // Regular deletion\n                await deleteContact(contactId)\n                router.push('/contacts')\n            }\n        } catch (error) {\n            console.error('Delete error:', error)\n            alert('Failed to delete contact')\n        } finally {\n            setIsDeleting(false)\n            setShowDeleteDialog(false)\n            setGdprDelete(false)\n        }\n    }\n\n    const handleExport = (format: 'json' | 'csv') => {\n        const url = `/api/contacts/${contactId}/export?format=${format}`\n        window.open(url, '_blank')\n        setShowExportMenu(false)\n    }\n\n    if (isLoading || !contact) {\n        return (\n            <div className=\"flex items-center justify-center min-h-screen\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-[#3D4A67]\" />\n                <span className=\"ml-2 text-slate-500\">Loading contact...</span>\n            </div>\n        )\n    }\n\n    // Generate avatar initials\n    const displayName = contact.isCompany ? (contact.companyName || 'C') : `${contact.firstName} ${contact.lastName}`\n    const initials = (contact.isCompany ? contact.companyName : `${contact.firstName} ${contact.lastName}`)\n        ?.split(' ')\n        .map(n => n[0])\n        .join('')\n        .toUpperCase()\n        .slice(0, 2) || '?'\n\n    return (\n        <div className=\"space-y-6 max-w-6xl\">\n            {/* Back Button */}\n            <Link href=\"/contacts\">\n                <Button variant=\"ghost\" className=\"text-slate-600 hover:text-slate-900\">\n                    <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                    Back to Contacts\n                </Button>\n            </Link>\n\n            {/* Contact Header */}\n            <Card className=\"border-slate-200 bg-white shadow-sm\">\n                <CardContent className=\"pt-6\">\n                    <div className=\"flex items-start justify-between\">\n                        <div className=\"flex items-start gap-4\">\n                            {/* Avatar */}\n                            <div className=\"h-16 w-16 rounded-full bg-[#3D4A67] text-white flex items-center justify-center text-xl font-semibold\">\n                                {initials}\n                            </div>\n\n                            {/* Contact Info */}\n                            <div className=\"space-y-2\">\n                                <h1 className=\"text-3xl font-bold text-[#3D4A67]\">\n                                    {contact.isCompany ? contact.companyName : `${contact.firstName} ${contact.lastName}`}\n                                </h1>\n\n                                {/* Status Selector */}\n                                <div className=\"flex items-center gap-3\">\n                                    <Select\n                                        value={contact.status}\n                                        onValueChange={(v) => updateStatus(contactId, v as ContactStatus)}\n                                    >\n                                        <SelectTrigger className=\"w-40 h-9\">\n                                            <Badge className={STATUS_COLORS[contact.status]}>\n                                                {STATUS_LABELS[contact.status]}\n                                            </Badge>\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            {Object.entries(STATUS_LABELS).map(([value, label]) => (\n                                                <SelectItem key={value} value={value}>\n                                                    {label}\n                                                </SelectItem>\n                                            ))}\n                                        </SelectContent>\n                                    </Select>\n\n                                    {/* Tags Preview */}\n                                    <div className=\"flex flex-wrap gap-1\">\n                                        {contact.tags.slice(0, 3).map((tag) => (\n                                            <Badge key={tag} variant=\"secondary\" className=\"bg-slate-100 text-slate-700\">\n                                                {tag}\n                                            </Badge>\n                                        ))}\n                                        {contact.tags.length > 3 && (\n                                            <Badge variant=\"secondary\" className=\"bg-slate-100 text-slate-700\">\n                                                +{contact.tags.length - 3}\n                                            </Badge>\n                                        )}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Action Buttons */}\n                        <div className=\"flex gap-2\">\n                            <div className=\"relative\">\n                                <Button\n                                    variant=\"outline\"\n                                    onClick={() => setShowExportMenu(!showExportMenu)}\n                                    className=\"border-slate-300\"\n                                >\n                                    <Download className=\"h-4 w-4 mr-2\" />\n                                    Export Data\n                                </Button>\n                                {showExportMenu && (\n                                    <div className=\"absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg border border-slate-200 z-10\">\n                                        <button\n                                            onClick={() => handleExport('json')}\n                                            className=\"w-full px-4 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 rounded-t-lg\"\n                                        >\n                                            Export as JSON\n                                        </button>\n                                        <button\n                                            onClick={() => handleExport('csv')}\n                                            className=\"w-full px-4 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 rounded-b-lg\"\n                                        >\n                                            Export as CSV\n                                        </button>\n                                    </div>\n                                )}\n                            </div>\n                            <Button\n                                variant=\"outline\"\n                                onClick={() => setShowEditDialog(true)}\n                                className=\"border-slate-300\"\n                            >\n                                <Edit className=\"h-4 w-4 mr-2\" />\n                                Edit\n                            </Button>\n                            <Button\n                                variant=\"outline\"\n                                onClick={() => setShowDeleteDialog(true)}\n                                className=\"border-red-300 text-red-600 hover:bg-red-50\"\n                            >\n                                <Trash2 className=\"h-4 w-4 mr-2\" />\n                                Delete\n                            </Button>\n                        </div>\n                    </div>\n                </CardContent>\n            </Card>\n\n            {/* Tab Navigation */}\n            <Tabs defaultValue=\"overview\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-5 bg-slate-100\">\n                    <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n                    <TabsTrigger value=\"invoices\">Invoices</TabsTrigger>\n                    <TabsTrigger value=\"projects\">Projects</TabsTrigger>\n                    <TabsTrigger value=\"tasks\">Tasks</TabsTrigger>\n                    <TabsTrigger value=\"notes\">Notes</TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"overview\" className=\"mt-6\">\n                    <ContactOverviewTab contact={contact} />\n                </TabsContent>\n\n                <TabsContent value=\"invoices\" className=\"mt-6\">\n                    <ContactInvoicesTab contact={contact} />\n                </TabsContent>\n\n                <TabsContent value=\"projects\" className=\"mt-6\">\n                    <ContactProjectsTab contact={contact} />\n                </TabsContent>\n\n                <TabsContent value=\"tasks\" className=\"mt-6\">\n                    <ContactTasksTab contact={contact} />\n                </TabsContent>\n\n                <TabsContent value=\"notes\" className=\"mt-6\">\n                    <Card className=\"border-slate-200 bg-white shadow-sm\">\n                        <CardContent className=\"pt-6\">\n                            <div className=\"mb-4\">\n                                <h3 className=\"text-lg font-semibold text-[#3D4A67] mb-2\">Tags</h3>\n                                <TagsInput contactId={contactId} tags={contact.tags} />\n                            </div>\n                            <div className=\"border-t border-slate-200 pt-4 mt-4\">\n                                <h3 className=\"text-lg font-semibold text-[#3D4A67] mb-2\">Notes</h3>\n                                <NotesSection contactId={contactId} notes={contact.notes} />\n                            </div>\n                        </CardContent>\n                    </Card>\n                </TabsContent>\n            </Tabs>\n\n            {/* Edit Dialog */}\n            <EditContactDialog\n                contact={contact}\n                open={showEditDialog}\n                onOpenChange={setShowEditDialog}\n            />\n\n            {/* Delete Confirmation */}\n            <AlertDialog open={showDeleteDialog} onOpenChange={(open) => {\n                setShowDeleteDialog(open)\n                if (!open) setGdprDelete(false)\n            }}>\n                <AlertDialogContent className=\"max-w-md\">\n                    <AlertDialogHeader>\n                        <AlertDialogTitle className=\"flex items-center gap-2\">\n                            <Trash2 className=\"h-5 w-5 text-red-600\" />\n                            Delete Contact?\n                        </AlertDialogTitle>\n                        <AlertDialogDescription className=\"space-y-3\">\n                            <p>\n                                Are you sure you want to delete <strong>{displayName}</strong>?\n                            </p>\n\n                            {/* GDPR Permanent Delete Option */}\n                            <div className=\"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\n                                <div className=\"flex items-start gap-3\">\n                                    <Checkbox\n                                        id=\"gdpr-delete\"\n                                        checked={gdprDelete}\n                                        onCheckedChange={(checked) => setGdprDelete(checked as boolean)}\n                                        className=\"mt-0.5\"\n                                    />\n                                    <div className=\"flex-1\">\n                                        <label\n                                            htmlFor=\"gdpr-delete\"\n                                            className=\"text-sm font-medium text-red-900 cursor-pointer flex items-center gap-2\"\n                                        >\n                                            <AlertTriangle className=\"h-4 w-4\" />\n                                            GDPR Permanent Deletion\n                                        </label>\n                                        <p className=\"text-xs text-red-700 mt-1\">\n                                            Permanently delete ALL data related to this contact including invoices,\n                                            tasks, projects, and activity history. This action <strong>cannot be\n                                                undone</strong>. A deletion certificate will be generated for compliance.\n                                        </p>\n                                    </div>\n                                </div>\n                            </div>\n\n                            {!gdprDelete && (\n                                <p className=\"text-xs text-slate-500\">\n                                    Regular deletion will remove the contact but may retain some data for business\n                                    records.\n                                </p>\n                            )}\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel disabled={isDeleting}>Cancel</AlertDialogCancel>\n                        <AlertDialogAction\n                            onClick={handleDelete}\n                            disabled={isDeleting}\n                            className={gdprDelete ? 'bg-red-700 hover:bg-red-800' : 'bg-red-600 hover:bg-red-700'}\n                        >\n                            {isDeleting ? (\n                                <>\n                                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                                    Deleting...\n                                </>\n                            ) : (\n                                <>\n                                    {gdprDelete ? 'Permanently Delete (GDPR)' : 'Delete'}\n                                </>\n                            )}\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/contacts/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":40,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":24,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Filter"},"fix":{"range":[1287,1295],"text":""},"desc":"Remove unused variable \"Filter\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toggleColumn' is assigned a value but never used.","line":70,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":70,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":118,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":118,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useContactStore } from '@/stores/contact-store'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Input } from \"@/components/ui/input\"\nimport { Button } from \"@/components/ui/button\"\nimport { Badge } from \"@/components/ui/badge\"\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from \"@/components/ui/table\"\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\"\nimport { AddContactDialog } from '@/components/contacts/add-contact-dialog'\nimport { ImportContactsDialog } from '@/components/contacts/import-contacts-dialog'\nimport { ExportContactsDialog } from '@/components/contacts/export-contacts-dialog'\nimport { KanbanBoard } from '@/components/contacts/kanban-board'\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\"\nimport { Checkbox } from \"@/components/ui/checkbox\"\nimport { STATUS_LABELS, STATUS_COLORS, ContactStatus } from '@/types/contact'\nimport { useState, useEffect } from 'react'\nimport { Search, Filter, Trash2, Loader2, LayoutGrid, List, ArrowLeft, ArrowRight, X } from 'lucide-react'\nimport Link from 'next/link'\nimport { cn } from '@/lib/utils'\nimport { QuickActionsMenu } from '@/components/contacts/quick-actions-menu'\nimport { ColumnSettings } from '@/components/contacts/column-settings'\nimport { MergeContactsDialog } from '@/components/contacts/merge-contacts-dialog'\nimport { AdvancedFilters } from '@/components/contacts/advanced-filters'\n\nexport default function ContactsPage() {\n    const {\n        contacts,\n        deleteContact,\n        updateStatus,\n        fetchContacts,\n        isLoading,\n        error,\n        currentPage,\n        pageSize,\n        totalCount,\n        filters,\n        sortConfig,\n        visibleColumns,\n        selectedContactIds,\n        setPage,\n        setFilters,\n        setSortConfig,\n        toggleSelection,\n        clearSelection,\n        selectPage,\n        bulkArchiveContacts,\n        toggleColumn,\n        setVisibleColumns\n    } = useContactStore()\n\n    const currentPageIds = contacts.map(c => c.id)\n    const isAllPageSelected = currentPageIds.length > 0 && currentPageIds.every(id => selectedContactIds.includes(id))\n\n    const [view, setView] = useState<'list' | 'kanban'>('list')\n    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false)\n    const [isBulkArchiveDialogOpen, setIsBulkArchiveDialogOpen] = useState(false)\n    const [isMergeDialogOpen, setIsMergeDialogOpen] = useState(false)\n    const [contactToDeleteId, setContactToDeleteId] = useState<string | null>(null)\n    const [localSearch, setLocalSearch] = useState(filters.search)\n\n    // Sync local search with store\n    useEffect(() => {\n        const timer = setTimeout(() => {\n            if (localSearch !== filters.search) {\n                setFilters({ search: localSearch })\n            }\n        }, 300)\n        return () => clearTimeout(timer)\n    }, [localSearch, setFilters, filters.search])\n\n    // Fetch contacts on mount and load column preferences\n    useEffect(() => {\n        fetchContacts()\n\n        // Load column preferences\n        if (typeof window !== 'undefined') {\n            const saved = localStorage.getItem('orbit_contact_columns')\n            if (saved) {\n                try {\n                    const columns = JSON.parse(saved)\n                    if (Array.isArray(columns) && columns.length > 0) {\n                        setVisibleColumns(columns)\n                    }\n                } catch (e) {\n                    console.error('Error loading columns:', e)\n                }\n            }\n        }\n    }, [fetchContacts, setVisibleColumns])\n\n    const handleBulkArchive = async () => {\n        try {\n            await bulkArchiveContacts(selectedContactIds)\n            setIsBulkArchiveDialogOpen(false)\n        } catch (error) {\n            // Error is handled by store\n        }\n    }\n\n    const totalPages = Math.ceil(totalCount / pageSize)\n\n    const handleSort = (column: string) => {\n        if (sortConfig.column === column) {\n            setSortConfig({ column, ascending: !sortConfig.ascending })\n        } else {\n            setSortConfig({ column, ascending: true })\n        }\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-[#3D4A67]\">Contacts</h1>\n                    <p className=\"text-slate-600\">Manage your customer relationships</p>\n                </div>\n                <div className=\"flex gap-2\">\n                    <ExportContactsDialog totalContacts={totalCount} />\n                    <ImportContactsDialog onImportComplete={() => fetchContacts()} />\n                    <AddContactDialog />\n                </div>\n            </div>\n\n            <div className=\"flex items-center justify-between gap-4 mb-4\">\n                <div className=\"flex gap-2 flex-1\">\n                    <div className=\"relative max-w-md flex-1 sm:w-80\">\n                        <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n                        <Input\n                            placeholder=\"Search contacts...\"\n                            value={localSearch}\n                            onChange={(e) => setLocalSearch(e.target.value)}\n                            className=\"pl-10 pr-10 border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                        />\n                        {localSearch && (\n                            <button\n                                onClick={() => setLocalSearch('')}\n                                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600\"\n                            >\n                                <X className=\"h-4 w-4\" />\n                            </button>\n                        )}\n                    </div>\n                    <AdvancedFilters />\n                    <ColumnSettings />\n                </div>\n\n                <div className=\"bg-slate-200 p-1 rounded-lg flex items-center gap-1\">\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => setView('list')}\n                        className={`h-8 px-2 ${view === 'list' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-600 hover:text-slate-900'}`}\n                    >\n                        <List className=\"h-4 w-4 mr-1.5\" />\n                        List\n                    </Button>\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => setView('kanban')}\n                        className={`h-8 px-2 ${view === 'kanban' ? 'bg-white shadow-sm text-slate-900' : 'text-slate-600 hover:text-slate-900'}`}\n                    >\n                        <LayoutGrid className=\"h-4 w-4 mr-1.5\" />\n                        Board\n                    </Button>\n                </div>\n            </div>\n\n            {/* Bulk Actions Bar */}\n            {selectedContactIds.length > 0 && (\n                <div className=\"bg-[#3D4A67] text-white px-4 py-3 rounded-lg flex items-center justify-between shadow-lg sticky top-4 z-40 animate-in slide-in-from-top-4\">\n                    <div className=\"flex items-center gap-4\">\n                        <span className=\"text-sm font-medium\">{selectedContactIds.length} selected</span>\n                        <div className=\"h-4 w-px bg-slate-500\" />\n                        <div className=\"flex gap-2\">\n                            <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"text-white hover:bg-white/10 h-8\"\n                                onClick={() => setIsBulkArchiveDialogOpen(true)}\n                            >\n                                <Trash2 className=\"h-4 w-4 mr-2\" />\n                                Archive Selected\n                            </Button>\n                            {selectedContactIds.length === 2 && (\n                                <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"text-white hover:bg-white/10 h-8\"\n                                    onClick={() => setIsMergeDialogOpen(true)}\n                                >\n                                    <List className=\"h-4 w-4 mr-2\" />\n                                    Merge Contacts\n                                </Button>\n                            )}\n                        </div>\n                    </div>\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={clearSelection}\n                        className=\"text-white hover:bg-white/10 h-8\"\n                    >\n                        <X className=\"h-4 w-4 mr-2\" />\n                        Clear Selection\n                    </Button>\n                </div>\n            )}\n\n            {isLoading ? (\n                <div className=\"flex items-center justify-center py-12\">\n                    <Loader2 className=\"h-8 w-8 animate-spin text-[#3D4A67]\" />\n                    <span className=\"ml-2 text-slate-500\">Loading contacts...</span>\n                </div>\n            ) : error ? (\n                <div className=\"text-center py-12\">\n                    <p className=\"text-red-500 mb-2\">Error loading contacts</p>\n                    <p className=\"text-sm text-slate-500\">{error}</p>\n                    <Button variant=\"outline\" onClick={fetchContacts} className=\"mt-4\">\n                        Retry\n                    </Button>\n                </div>\n            ) : contacts.length === 0 ? (\n                <Card className=\"border-slate-200 bg-white shadow-sm\">\n                    <CardContent className=\"pt-6\">\n                        <p className=\"text-slate-500 text-center py-12\">\n                            {filters.search || filters.status !== 'all' || filters.tags.length > 0\n                                ? \"No contacts match your filters.\"\n                                : \"No contacts yet. Add your first contact to get started.\"\n                            }\n                        </p>\n                    </CardContent>\n                </Card>\n            ) : view === 'list' ? (\n                <Card className=\"border-slate-200 bg-white shadow-sm\">\n                    <CardHeader className=\"flex flex-row items-center justify-between\">\n                        <div>\n                            <CardTitle className=\"text-[#3D4A67]\">All Contacts</CardTitle>\n                            <CardDescription className=\"text-slate-600\">\n                                {totalCount} contact{totalCount !== 1 ? 's' : ''} total\n                            </CardDescription>\n                        </div>\n                    </CardHeader>\n                    <CardContent>\n                        <Table>\n                            <TableHeader>\n                                <TableRow className=\"bg-slate-50 hover:bg-slate-50 border-slate-200\">\n                                    <TableHead className=\"w-12\">\n                                        <Checkbox\n                                            checked={isAllPageSelected}\n                                            onCheckedChange={() => selectPage(currentPageIds)}\n                                            aria-label=\"Select all\"\n                                        />\n                                    </TableHead>\n                                    {visibleColumns.includes('name') && (\n                                        <TableHead\n                                            className=\"cursor-pointer hover:text-[#3D4A67] transition-colors\"\n                                            onClick={() => handleSort('first_name')}\n                                        >\n                                            Name {sortConfig.column === 'first_name' && (sortConfig.ascending ? '' : '')}\n                                        </TableHead>\n                                    )}\n                                    {visibleColumns.includes('email') && (\n                                        <TableHead\n                                            className=\"cursor-pointer hover:text-[#3D4A67] transition-colors\"\n                                            onClick={() => handleSort('email')}\n                                        >\n                                            Email {sortConfig.column === 'email' && (sortConfig.ascending ? '' : '')}\n                                        </TableHead>\n                                    )}\n                                    {visibleColumns.includes('phone') && (\n                                        <TableHead\n                                            className=\"cursor-pointer hover:text-[#3D4A67] transition-colors\"\n                                            onClick={() => handleSort('phone')}\n                                        >\n                                            Phone {sortConfig.column === 'phone' && (sortConfig.ascending ? '' : '')}\n                                        </TableHead>\n                                    )}\n                                    {visibleColumns.includes('company') && (\n                                        <TableHead\n                                            className=\"cursor-pointer hover:text-[#3D4A67] transition-colors\"\n                                            onClick={() => handleSort('company_name')}\n                                        >\n                                            Company {sortConfig.column === 'company_name' && (sortConfig.ascending ? '' : '')}\n                                        </TableHead>\n                                    )}\n                                    {visibleColumns.includes('status') && (\n                                        <TableHead\n                                            className=\"cursor-pointer hover:text-[#3D4A67] transition-colors\"\n                                            onClick={() => handleSort('status')}\n                                        >\n                                            Status {sortConfig.column === 'status' && (sortConfig.ascending ? '' : '')}\n                                        </TableHead>\n                                    )}\n                                    {visibleColumns.includes('created_at') && (\n                                        <TableHead\n                                            className=\"cursor-pointer hover:text-[#3D4A67] transition-colors\"\n                                            onClick={() => handleSort('created_at')}\n                                        >\n                                            Added {sortConfig.column === 'created_at' && (sortConfig.ascending ? '' : '')}\n                                        </TableHead>\n                                    )}\n                                    {visibleColumns.includes('actions') && (\n                                        <TableHead className=\"text-right\">Actions</TableHead>\n                                    )}\n                                </TableRow>\n                            </TableHeader>\n                            <TableBody>\n                                {contacts.map((contact) => (\n                                    <TableRow key={contact.id} className={selectedContactIds.includes(contact.id) ? 'bg-slate-50' : ''}>\n                                        <TableCell>\n                                            <Checkbox\n                                                checked={selectedContactIds.includes(contact.id)}\n                                                onCheckedChange={() => toggleSelection(contact.id)}\n                                                aria-label={`Select ${contact.firstName}`}\n                                            />\n                                        </TableCell>\n                                        {visibleColumns.includes('name') && (\n                                            <TableCell className=\"font-medium\">\n                                                <Link\n                                                    href={`/contacts/${contact.id}`}\n                                                    className=\"text-[#3D4A67] hover:underline\"\n                                                >\n                                                    {contact.isCompany ? contact.companyName : `${contact.firstName} ${contact.lastName}`}\n                                                </Link>\n                                            </TableCell>\n                                        )}\n                                        {visibleColumns.includes('email') && (\n                                            <TableCell>{contact.email}</TableCell>\n                                        )}\n                                        {visibleColumns.includes('phone') && (\n                                            <TableCell>{contact.phone || '-'}</TableCell>\n                                        )}\n                                        {visibleColumns.includes('company') && (\n                                            <TableCell>{contact.companyName || '-'}</TableCell>\n                                        )}\n                                        {visibleColumns.includes('status') && (\n                                            <TableCell>\n                                                <Select\n                                                    value={contact.status}\n                                                    onValueChange={(v) => updateStatus(contact.id, v as ContactStatus)}\n                                                >\n                                                    <SelectTrigger\n                                                        className=\"w-32 h-8\"\n                                                        onClick={(e) => e.stopPropagation()}\n                                                    >\n                                                        <SelectValue placeholder={STATUS_LABELS[contact.status]}>\n                                                            <Badge className={cn(\"font-normal pointer-events-none\", STATUS_COLORS[contact.status])}>\n                                                                {STATUS_LABELS[contact.status]}\n                                                            </Badge>\n                                                        </SelectValue>\n                                                    </SelectTrigger>\n                                                    <SelectContent>\n                                                        {Object.entries(STATUS_LABELS).map(([value, label]) => (\n                                                            <SelectItem key={value} value={value}>\n                                                                {label}\n                                                            </SelectItem>\n                                                        ))}\n                                                    </SelectContent>\n                                                </Select>\n                                            </TableCell>\n                                        )}\n                                        {visibleColumns.includes('created_at') && (\n                                            <TableCell>{new Date(contact.createdAt).toLocaleDateString()}</TableCell>\n                                        )}\n                                        {visibleColumns.includes('actions') && (\n                                            <TableCell className=\"text-right\">\n                                                <QuickActionsMenu\n                                                    contact={contact}\n                                                    onDelete={() => {\n                                                        setContactToDeleteId(contact.id)\n                                                        setIsDeleteDialogOpen(true)\n                                                    }}\n                                                />\n                                            </TableCell>\n                                        )}\n                                    </TableRow>\n                                ))}\n                            </TableBody>\n                        </Table>\n\n                        {/* Pagination Controls */}\n                        <div className=\"flex flex-col sm:flex-row items-center justify-between mt-6 gap-4\">\n                            <div className=\"flex items-center gap-4\">\n                                <p className=\"text-sm text-slate-500\">\n                                    Showing <span className=\"font-medium\">{(currentPage - 1) * pageSize + 1}</span> to <span className=\"font-medium\">{Math.min(currentPage * pageSize, totalCount)}</span> of <span className=\"font-medium\">{totalCount}</span> results\n                                </p>\n                                <div className=\"flex items-center gap-2\">\n                                    <span className=\"text-sm text-slate-500\">Rows:</span>\n                                    <Select\n                                        value={pageSize.toString()}\n                                        onValueChange={(v) => useContactStore.getState().setPageSize(parseInt(v))}\n                                    >\n                                        <SelectTrigger className=\"w-20 h-8 border-slate-300\">\n                                            <SelectValue />\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            {[10, 20, 50, 100].map(size => (\n                                                <SelectItem key={size} value={size.toString()}>{size}</SelectItem>\n                                            ))}\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                            </div>\n                            <div className=\"flex gap-2\">\n                                <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={() => setPage(currentPage - 1)}\n                                    disabled={currentPage === 1}\n                                    className=\"border-slate-300\"\n                                >\n                                    <ArrowLeft className=\"h-4 w-4 mr-1\" />\n                                    Previous\n                                </Button>\n                                <div className=\"flex items-center gap-1\">\n                                    {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n                                        // Simple pagination window logic\n                                        let pageNum = i + 1\n                                        if (totalPages > 5 && currentPage > 3) {\n                                            pageNum = currentPage - 2 + i\n                                            if (pageNum + (5 - i - 1) > totalPages) {\n                                                pageNum = totalPages - 4 + i\n                                            }\n                                        }\n\n                                        return (\n                                            <Button\n                                                key={pageNum}\n                                                variant={currentPage === pageNum ? \"default\" : \"outline\"}\n                                                size=\"sm\"\n                                                onClick={() => setPage(pageNum)}\n                                                className={currentPage === pageNum ? \"bg-[#3D4A67]\" : \"border-slate-300\"}\n                                            >\n                                                {pageNum}\n                                            </Button>\n                                        )\n                                    })}\n                                </div>\n                                <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={() => setPage(currentPage + 1)}\n                                    disabled={currentPage === totalPages}\n                                    className=\"border-slate-300\"\n                                >\n                                    Next\n                                    <ArrowRight className=\"h-4 w-4 ml-1\" />\n                                </Button>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n            ) : (\n                <KanbanBoard\n                    contacts={contacts}\n                    onDeleteContact={(id) => {\n                        setContactToDeleteId(id)\n                        setIsDeleteDialogOpen(true)\n                    }}\n                />\n            )}\n\n            <MergeContactsDialog\n                open={isMergeDialogOpen}\n                onOpenChange={setIsMergeDialogOpen}\n                contacts={contacts.filter(c => selectedContactIds.includes(c.id))}\n            />\n\n            <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Are you sure?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            This action will archive the contact. You can still see archived contacts in the filters.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel onClick={() => setContactToDeleteId(null)}>Cancel</AlertDialogCancel>\n                        <AlertDialogAction\n                            className=\"bg-[#D1855C] hover:bg-[#B1653C] text-white\"\n                            onClick={() => {\n                                if (contactToDeleteId) {\n                                    deleteContact(contactToDeleteId)\n                                    setContactToDeleteId(null)\n                                }\n                            }}\n                        >\n                            Archive\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n            {/* Bulk Archive Confirmation */}\n            <AlertDialog open={isBulkArchiveDialogOpen} onOpenChange={setIsBulkArchiveDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle>Archive Multiple Contacts?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            Are you sure you want to archive {selectedContactIds.length} contacts?\n                            They will be hidden from the main list but can be restored later.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction onClick={handleBulkArchive} className=\"bg-red-600 focus:ring-red-600\">\n                            Archive All\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/crm/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/dashboard/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/documents/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/invoices/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ExternalLink' is defined but never used.","line":42,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ExternalLink"},"fix":{"range":[1019,1037],"text":""},"desc":"Remove unused variable \"ExternalLink\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useInvoiceStore, InvoiceWithLineItems } from '@/stores/invoice-store'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Input } from \"@/components/ui/input\"\nimport { Button } from \"@/components/ui/button\"\nimport { Badge } from \"@/components/ui/badge\"\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from \"@/components/ui/table\"\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\"\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport { CreateInvoiceDialog } from '@/components/modules/invoicing/create-invoice-dialog'\nimport { useState, useEffect } from 'react'\nimport { \n    Search, \n    Filter, \n    Trash2, \n    Loader2, \n    MoreHorizontal,\n    FileText,\n    CreditCard,\n    CheckCircle,\n    Send,\n    ExternalLink,\n    Copy\n} from 'lucide-react'\nimport type { InvoiceStatus } from '@/lib/types/schema'\n\n// Status labels and colors\nconst STATUS_LABELS: Record<InvoiceStatus, string> = {\n    draft: 'Draft',\n    sent: 'Sent',\n    paid: 'Paid',\n    overdue: 'Overdue',\n    cancelled: 'Cancelled',\n}\n\nconst STATUS_COLORS: Record<InvoiceStatus, string> = {\n    draft: 'bg-slate-100 text-slate-700',\n    sent: 'bg-blue-100 text-blue-700',\n    paid: 'bg-green-100 text-green-700',\n    overdue: 'bg-red-100 text-red-700',\n    cancelled: 'bg-gray-100 text-gray-500',\n}\n\nfunction formatMoney(amount: number, currency: string): string {\n    return new Intl.NumberFormat('de-CH', {\n        style: 'currency',\n        currency: currency,\n        minimumFractionDigits: 2,\n    }).format(amount)\n}\n\nfunction formatDate(dateStr: string | null): string {\n    if (!dateStr) return '-'\n    const date = new Date(dateStr)\n    return date.toLocaleDateString('de-CH', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric',\n    })\n}\n\nfunction getContactName(invoice: InvoiceWithLineItems): string {\n    if (!invoice.contact) return '-'\n    if (invoice.contact.is_company) {\n        return invoice.contact.company_name || 'Unknown Company'\n    }\n    const name = [invoice.contact.first_name, invoice.contact.last_name]\n        .filter(Boolean)\n        .join(' ')\n    return name || invoice.contact.email || 'Unknown'\n}\n\nexport default function InvoicesPage() {\n    const { \n        invoices, \n        fetchInvoices, \n        deleteInvoice,\n        markAsPaid,\n        markAsSent,\n        createPaymentLink,\n        isLoading, \n        error \n    } = useInvoiceStore()\n    \n    const [search, setSearch] = useState('')\n    const [statusFilter, setStatusFilter] = useState<string>('all')\n    const [actionLoading, setActionLoading] = useState<string | null>(null)\n\n    // Fetch invoices on mount\n    useEffect(() => {\n        fetchInvoices()\n    }, [fetchInvoices])\n\n    const filteredInvoices = invoices.filter((invoice) => {\n        const contactName = getContactName(invoice).toLowerCase()\n        const matchesSearch =\n            invoice.invoice_number.toLowerCase().includes(search.toLowerCase()) ||\n            contactName.includes(search.toLowerCase())\n        const matchesStatus = statusFilter === 'all' || invoice.status === statusFilter\n        return matchesSearch && matchesStatus\n    })\n\n    // Calculate summary stats\n    const stats = {\n        total: invoices.length,\n        draft: invoices.filter(i => i.status === 'draft').length,\n        sent: invoices.filter(i => i.status === 'sent').length,\n        paid: invoices.filter(i => i.status === 'paid').length,\n        overdue: invoices.filter(i => i.status === 'overdue').length,\n        totalAmount: invoices.reduce((sum, i) => sum + i.amount_total, 0),\n        paidAmount: invoices.filter(i => i.status === 'paid').reduce((sum, i) => sum + i.amount_total, 0),\n    }\n\n    const handleDownloadPDF = (invoiceId: string) => {\n        window.open(`/api/invoices/${invoiceId}/download`, '_blank')\n    }\n\n    const handleCreatePaymentLink = async (invoiceId: string) => {\n        setActionLoading(invoiceId)\n        const link = await createPaymentLink(invoiceId)\n        setActionLoading(null)\n        \n        if (link) {\n            // Copy to clipboard\n            await navigator.clipboard.writeText(link)\n            alert('Payment link copied to clipboard!')\n        }\n    }\n\n    const handleMarkAsSent = async (invoiceId: string) => {\n        setActionLoading(invoiceId)\n        await markAsSent(invoiceId)\n        setActionLoading(null)\n    }\n\n    const handleMarkAsPaid = async (invoiceId: string) => {\n        setActionLoading(invoiceId)\n        await markAsPaid(invoiceId)\n        setActionLoading(null)\n    }\n\n    const handleDelete = async (invoiceId: string) => {\n        if (confirm('Are you sure you want to delete this invoice?')) {\n            await deleteInvoice(invoiceId)\n        }\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-[#3D4A67]\">Invoices</h1>\n                    <p className=\"text-slate-600\">Create and manage invoices with QR-Bill support</p>\n                </div>\n                <CreateInvoiceDialog />\n            </div>\n\n            {/* Stats Cards */}\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <Card className=\"border-slate-200 bg-white\">\n                    <CardContent className=\"pt-6\">\n                        <div className=\"text-2xl font-bold text-[#3D4A67]\">{stats.total}</div>\n                        <p className=\"text-sm text-slate-500\">Total Invoices</p>\n                    </CardContent>\n                </Card>\n                <Card className=\"border-slate-200 bg-white\">\n                    <CardContent className=\"pt-6\">\n                        <div className=\"text-2xl font-bold text-blue-600\">{stats.sent}</div>\n                        <p className=\"text-sm text-slate-500\">Awaiting Payment</p>\n                    </CardContent>\n                </Card>\n                <Card className=\"border-slate-200 bg-white\">\n                    <CardContent className=\"pt-6\">\n                        <div className=\"text-2xl font-bold text-green-600\">{stats.paid}</div>\n                        <p className=\"text-sm text-slate-500\">Paid</p>\n                    </CardContent>\n                </Card>\n                <Card className=\"border-slate-200 bg-white\">\n                    <CardContent className=\"pt-6\">\n                        <div className=\"text-2xl font-bold text-[#3D4A67]\">\n                            {formatMoney(stats.paidAmount, 'CHF')}\n                        </div>\n                        <p className=\"text-sm text-slate-500\">Revenue</p>\n                    </CardContent>\n                </Card>\n            </div>\n\n            {/* Filters */}\n            <div className=\"flex gap-4\">\n                <div className=\"relative max-w-md flex-1\">\n                    <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n                    <Input\n                        placeholder=\"Search by invoice number or contact...\"\n                        value={search}\n                        onChange={(e) => setSearch(e.target.value)}\n                        className=\"pl-10 border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                    />\n                </div>\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                    <SelectTrigger className=\"w-40 border-slate-300\">\n                        <Filter className=\"h-4 w-4 mr-2\" />\n                        <SelectValue placeholder=\"Filter\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"all\">All Statuses</SelectItem>\n                        {Object.entries(STATUS_LABELS).map(([value, label]) => (\n                            <SelectItem key={value} value={value}>\n                                {label}\n                            </SelectItem>\n                        ))}\n                    </SelectContent>\n                </Select>\n            </div>\n\n            {/* Invoice Table */}\n            <Card className=\"border-slate-200 bg-white shadow-sm\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">All Invoices</CardTitle>\n                    <CardDescription className=\"text-slate-600\">\n                        {filteredInvoices.length} invoice{filteredInvoices.length !== 1 ? 's' : ''} total\n                    </CardDescription>\n                </CardHeader>\n                <CardContent>\n                    {isLoading ? (\n                        <div className=\"flex items-center justify-center py-12\">\n                            <Loader2 className=\"h-8 w-8 animate-spin text-[#3D4A67]\" />\n                            <span className=\"ml-2 text-slate-500\">Loading invoices...</span>\n                        </div>\n                    ) : error ? (\n                        <div className=\"text-center py-12\">\n                            <p className=\"text-red-500 mb-2\">Error loading invoices</p>\n                            <p className=\"text-sm text-slate-500\">{error}</p>\n                            <Button variant=\"outline\" onClick={fetchInvoices} className=\"mt-4\">\n                                Retry\n                            </Button>\n                        </div>\n                    ) : filteredInvoices.length === 0 ? (\n                        <div className=\"text-center py-12\">\n                            <FileText className=\"mx-auto h-12 w-12 text-slate-300\" />\n                            <p className=\"text-slate-500 mt-4\">\n                                {invoices.length === 0\n                                    ? \"No invoices yet. Create your first invoice to get started.\"\n                                    : \"No invoices match your search.\"\n                                }\n                            </p>\n                        </div>\n                    ) : (\n                        <Table>\n                            <TableHeader>\n                                <TableRow>\n                                    <TableHead>Invoice #</TableHead>\n                                    <TableHead>Contact</TableHead>\n                                    <TableHead>Date</TableHead>\n                                    <TableHead>Due Date</TableHead>\n                                    <TableHead>Amount</TableHead>\n                                    <TableHead>Type</TableHead>\n                                    <TableHead>Status</TableHead>\n                                    <TableHead className=\"text-right\">Actions</TableHead>\n                                </TableRow>\n                            </TableHeader>\n                            <TableBody>\n                                {filteredInvoices.map((invoice) => (\n                                    <TableRow key={invoice.id}>\n                                        <TableCell className=\"font-medium font-mono\">\n                                            {invoice.invoice_number}\n                                        </TableCell>\n                                        <TableCell>{getContactName(invoice)}</TableCell>\n                                        <TableCell>{formatDate(invoice.invoice_date)}</TableCell>\n                                        <TableCell>{formatDate(invoice.due_date)}</TableCell>\n                                        <TableCell className=\"font-medium\">\n                                            {formatMoney(invoice.amount_total, invoice.currency)}\n                                        </TableCell>\n                                        <TableCell>\n                                            <Badge variant=\"outline\" className=\"font-normal\">\n                                                {invoice.invoice_type === 'swiss_qr' ? 'Swiss QR' : 'EU SEPA'}\n                                            </Badge>\n                                        </TableCell>\n                                        <TableCell>\n                                            <Badge className={STATUS_COLORS[invoice.status]}>\n                                                {STATUS_LABELS[invoice.status]}\n                                            </Badge>\n                                        </TableCell>\n                                        <TableCell className=\"text-right\">\n                                            <DropdownMenu>\n                                                <DropdownMenuTrigger asChild>\n                                                    <Button \n                                                        variant=\"ghost\" \n                                                        size=\"sm\"\n                                                        disabled={actionLoading === invoice.id}\n                                                    >\n                                                        {actionLoading === invoice.id ? (\n                                                            <Loader2 className=\"h-4 w-4 animate-spin\" />\n                                                        ) : (\n                                                            <MoreHorizontal className=\"h-4 w-4\" />\n                                                        )}\n                                                    </Button>\n                                                </DropdownMenuTrigger>\n                                                <DropdownMenuContent align=\"end\">\n                                                    <DropdownMenuItem onClick={() => handleDownloadPDF(invoice.id)}>\n                                                        <FileText className=\"h-4 w-4 mr-2\" />\n                                                        Download PDF\n                                                    </DropdownMenuItem>\n                                                    \n                                                    {invoice.stripe_payment_link && (\n                                                        <DropdownMenuItem \n                                                            onClick={() => {\n                                                                navigator.clipboard.writeText(invoice.stripe_payment_link!)\n                                                                alert('Payment link copied!')\n                                                            }}\n                                                        >\n                                                            <Copy className=\"h-4 w-4 mr-2\" />\n                                                            Copy Payment Link\n                                                        </DropdownMenuItem>\n                                                    )}\n                                                    \n                                                    {!invoice.stripe_payment_link && invoice.status !== 'paid' && invoice.status !== 'cancelled' && (\n                                                        <DropdownMenuItem onClick={() => handleCreatePaymentLink(invoice.id)}>\n                                                            <CreditCard className=\"h-4 w-4 mr-2\" />\n                                                            Create Payment Link\n                                                        </DropdownMenuItem>\n                                                    )}\n\n                                                    <DropdownMenuSeparator />\n                                                    \n                                                    {invoice.status === 'draft' && (\n                                                        <DropdownMenuItem onClick={() => handleMarkAsSent(invoice.id)}>\n                                                            <Send className=\"h-4 w-4 mr-2\" />\n                                                            Mark as Sent\n                                                        </DropdownMenuItem>\n                                                    )}\n                                                    \n                                                    {(invoice.status === 'sent' || invoice.status === 'overdue') && (\n                                                        <DropdownMenuItem onClick={() => handleMarkAsPaid(invoice.id)}>\n                                                            <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                                            Mark as Paid\n                                                        </DropdownMenuItem>\n                                                    )}\n\n                                                    <DropdownMenuSeparator />\n                                                    \n                                                    <DropdownMenuItem \n                                                        onClick={() => handleDelete(invoice.id)}\n                                                        className=\"text-red-600\"\n                                                    >\n                                                        <Trash2 className=\"h-4 w-4 mr-2\" />\n                                                        Delete\n                                                    </DropdownMenuItem>\n                                                </DropdownMenuContent>\n                                            </DropdownMenu>\n                                        </TableCell>\n                                    </TableRow>\n                                ))}\n                            </TableBody>\n                        </Table>\n                    )}\n                </CardContent>\n            </Card>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/projects/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":46,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AlertCircle"},"fix":{"range":[1309,1326],"text":""},"desc":"Remove unused variable \"AlertCircle\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/projects/[id]/page.tsx:74:13\n  72 |     useEffect(() => {\n  73 |         if (project) {\n> 74 |             setEditName(project.name)\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  75 |             setEditDescription(project.description || '')\n  76 |             setEditClientId(project.clientId || '')\n  77 |             setEditDeadline(project.deadline ? project.deadline.toISOString().split('T')[0] : '')","line":74,"column":13,"nodeType":null,"endLine":74,"endColumn":24},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":123,"column":70,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4279,4340],"text":"The project you&apos;re looking for doesn't exist or was archived."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4279,4340],"text":"The project you&lsquo;re looking for doesn't exist or was archived."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4279,4340],"text":"The project you&#39;re looking for doesn't exist or was archived."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4279,4340],"text":"The project you&rsquo;re looking for doesn't exist or was archived."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":123,"column":91,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4279,4340],"text":"The project you're looking for doesn&apos;t exist or was archived."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4279,4340],"text":"The project you're looking for doesn&lsquo;t exist or was archived."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4279,4340],"text":"The project you're looking for doesn&#39;t exist or was archived."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4279,4340],"text":"The project you're looking for doesn&rsquo;t exist or was archived."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { useProjectStore } from '@/stores/project-store'\nimport { useContactStore } from '@/stores/contact-store'\nimport { useTaskStore } from '@/stores/task-store'\nimport { useInvoiceStore } from '@/stores/invoice-store'\nimport { useDocumentStore } from '@/stores/document-store'\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\"\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\"\nimport { PROJECT_STATUS_LABELS, PROJECT_STATUS_COLORS, ProjectStatus } from '@/types/project'\nimport {\n    ChevronLeft,\n    Calendar,\n    User,\n    Clock,\n    Edit,\n    Archive,\n    CheckCircle2,\n    Briefcase,\n    Plus,\n    FileText,\n    Download,\n    FileIcon,\n    AlertCircle,\n    Loader2\n} from 'lucide-react'\nimport { format } from 'date-fns'\nimport Link from 'next/link'\n\nexport default function ProjectDetailPage() {\n    const params = useParams()\n    const router = useRouter()\n    const projectId = params.id as string\n    const { getProject, fetchProjects, isLoading, updateProject } = useProjectStore()\n    const { contacts, fetchContacts } = useContactStore()\n    const { tasks, fetchTasks } = useTaskStore()\n    const { invoices, fetchInvoices } = useInvoiceStore()\n    const { documents, fetchDocuments } = useDocumentStore()\n    const project = getProject(projectId)\n\n    // Edit Form State\n    const [isEditDialogOpen, setIsEditDialogOpen] = useState(false)\n    const [editName, setEditName] = useState('')\n    const [editDescription, setEditDescription] = useState('')\n    const [editClientId, setEditClientId] = useState('')\n    const [editDeadline, setEditDeadline] = useState('')\n    const [editStatus, setEditStatus] = useState<ProjectStatus>('lead')\n    const [isSubmittingEdit, setIsSubmittingEdit] = useState(false)\n\n    useEffect(() => {\n        if (project) {\n            setEditName(project.name)\n            setEditDescription(project.description || '')\n            setEditClientId(project.clientId || '')\n            setEditDeadline(project.deadline ? project.deadline.toISOString().split('T')[0] : '')\n            setEditStatus(project.status)\n        }\n    }, [project])\n\n    useEffect(() => {\n        fetchProjects()\n        fetchContacts()\n        fetchTasks(projectId)\n        fetchInvoices(projectId)\n        fetchDocuments(projectId)\n    }, [fetchProjects, fetchContacts, fetchTasks, fetchInvoices, fetchDocuments, projectId])\n\n    const handleSubmitEdit = async (e: React.FormEvent) => {\n        e.preventDefault()\n        if (!editName || isSubmittingEdit) return\n\n        setIsSubmittingEdit(true)\n        await updateProject(projectId, {\n            name: editName,\n            description: editDescription,\n            clientId: editClientId,\n            deadline: editDeadline ? new Date(editDeadline) : undefined,\n            status: editStatus\n        })\n        setIsSubmittingEdit(false)\n        setIsEditDialogOpen(false)\n    }\n\n    if (isLoading) {\n        return (\n            <div className=\"flex items-center justify-center min-h-[400px]\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-[#3D4A67]\"></div>\n            </div>\n        )\n    }\n\n    if (!project) {\n        return (\n            <div className=\"space-y-4\">\n                <Button variant=\"ghost\" onClick={() => router.back()} className=\"gap-2\">\n                    <ChevronLeft className=\"h-4 w-4\" /> Back to Projects\n                </Button>\n                <Card>\n                    <CardContent className=\"py-12 text-center\">\n                        <p className=\"text-slate-500 text-lg font-medium\">Project not found</p>\n                        <p className=\"text-slate-400\">The project you're looking for doesn't exist or was archived.</p>\n                    </CardContent>\n                </Card>\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"space-y-6 pb-20\">\n            {/* Header */}\n            <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n                <div className=\"space-y-1\">\n                    <div className=\"flex items-center gap-2 text-sm text-slate-500 mb-2\">\n                        <Link href=\"/projects\" className=\"hover:text-[#3D4A67] flex items-center gap-1\">\n                            <Briefcase className=\"h-3 w-3\" /> Projects\n                        </Link>\n                        <span>/</span>\n                        <span className=\"font-medium text-slate-900\">{project.name}</span>\n                    </div>\n                    <div className=\"flex items-center gap-3\">\n                        <h1 className=\"text-3xl font-bold text-[#3D4A67]\">{project.name}</h1>\n                        <Badge className={PROJECT_STATUS_COLORS[project.status]}>\n                            {PROJECT_STATUS_LABELS[project.status]}\n                        </Badge>\n                    </div>\n                    {project.description && (\n                        <p className=\"text-slate-600 max-w-2xl\">{project.description}</p>\n                    )}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n                        <DialogTrigger asChild>\n                            <Button variant=\"outline\" className=\"gap-2\">\n                                <Edit className=\"h-4 w-4\" /> Edit\n                            </Button>\n                        </DialogTrigger>\n                        <DialogContent>\n                            <form onSubmit={handleSubmitEdit}>\n                                <DialogHeader>\n                                    <DialogTitle className=\"text-[#3D4A67]\">Edit Project</DialogTitle>\n                                    <DialogDescription>Update project details and metadata.</DialogDescription>\n                                </DialogHeader>\n                                <div className=\"grid gap-4 py-4\">\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"edit-name\">Project Name *</Label>\n                                        <Input\n                                            id=\"edit-name\"\n                                            value={editName}\n                                            onChange={(e) => setEditName(e.target.value)}\n                                            required\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"edit-description\">Description</Label>\n                                        <Input\n                                            id=\"edit-description\"\n                                            value={editDescription}\n                                            onChange={(e) => setEditDescription(e.target.value)}\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"edit-client\">Client</Label>\n                                        <Select value={editClientId} onValueChange={setEditClientId}>\n                                            <SelectTrigger>\n                                                <SelectValue placeholder=\"Select client...\" />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                {contacts.map(contact => (\n                                                    <SelectItem key={contact.id} value={contact.id}>\n                                                        {contact.isCompany ? contact.companyName : `${contact.firstName} ${contact.lastName}`}\n                                                    </SelectItem>\n                                                ))}\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"edit-deadline\">Deadline</Label>\n                                        <Input\n                                            id=\"edit-deadline\"\n                                            type=\"date\"\n                                            value={editDeadline}\n                                            onChange={(e) => setEditDeadline(e.target.value)}\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"edit-status\">Status</Label>\n                                        <Select value={editStatus} onValueChange={(v) => setEditStatus(v as ProjectStatus)}>\n                                            <SelectTrigger>\n                                                <SelectValue />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                {Object.entries(PROJECT_STATUS_LABELS).map(([value, label]) => (\n                                                    <SelectItem key={value} value={value}>{label}</SelectItem>\n                                                ))}\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                </div>\n                                <DialogFooter>\n                                    <Button type=\"button\" variant=\"outline\" onClick={() => setIsEditDialogOpen(false)} disabled={isSubmittingEdit}>Cancel</Button>\n                                    <Button type=\"submit\" className=\"bg-[#9EAE8E] hover:bg-[#7E8E6E]\" disabled={isSubmittingEdit}>\n                                        {isSubmittingEdit ? <><Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />Saving...</> : 'Save Changes'}\n                                    </Button>\n                                </DialogFooter>\n                            </form>\n                        </DialogContent>\n                    </Dialog>\n                    <Button variant=\"outline\" className=\"text-red-600 hover:text-red-700 hover:bg-red-50 gap-2 border-slate-200\">\n                        <Archive className=\"h-4 w-4\" /> Archive\n                    </Button>\n                </div>\n            </div>\n\n            {/* Content Tabs */}\n            <Tabs defaultValue=\"overview\" className=\"w-full\">\n                <TabsList className=\"bg-slate-100/50 p-1 border border-slate-200 w-full justify-start md:w-auto\">\n                    <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n                    <TabsTrigger value=\"tasks\">Tasks ({tasks.length})</TabsTrigger>\n                    <TabsTrigger value=\"documents\">Documents ({documents.length})</TabsTrigger>\n                    <TabsTrigger value=\"invoices\">Invoices ({invoices.length})</TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"overview\" className=\"mt-6\">\n                    <div className=\"grid gap-6 md:grid-cols-3\">\n                        {/* Quick Info */}\n                        <Card className=\"md:col-span-2 border-slate-200\">\n                            <CardHeader>\n                                <CardTitle className=\"text-lg\">Project Details</CardTitle>\n                            </CardHeader>\n                            <CardContent className=\"grid gap-6\">\n                                <div className=\"grid sm:grid-cols-2 gap-4\">\n                                    <div className=\"space-y-1\">\n                                        <p className=\"text-xs font-medium text-slate-500 uppercase\">Client</p>\n                                        <div className=\"flex items-center gap-2 text-[#3D4A67] font-medium\">\n                                            <User className=\"h-4 w-4 text-slate-400\" />\n                                            {project.clientName || 'No client assigned'}\n                                        </div>\n                                    </div>\n                                    <div className=\"space-y-1\">\n                                        <p className=\"text-xs font-medium text-slate-500 uppercase\">Deadline</p>\n                                        <div className=\"flex items-center gap-2 text-[#3D4A67] font-medium\">\n                                            <Calendar className=\"h-4 w-4 text-slate-400\" />\n                                            {project.deadline ? format(project.deadline, 'MMMM d, yyyy') : 'No deadline set'}\n                                        </div>\n                                    </div>\n                                    <div className=\"space-y-1\">\n                                        <p className=\"text-xs font-medium text-slate-500 uppercase\">Created On</p>\n                                        <div className=\"flex items-center gap-2 text-slate-600 text-sm\">\n                                            <Clock className=\"h-4 w-4 text-slate-400\" />\n                                            {format(project.createdAt, 'MMM d, yyyy')}\n                                        </div>\n                                    </div>\n                                    <div className=\"space-y-1\">\n                                        <p className=\"text-xs font-medium text-slate-500 uppercase\">Last Updated</p>\n                                        <div className=\"flex items-center gap-2 text-slate-600 text-sm\">\n                                            <CheckCircle2 className=\"h-4 w-4 text-slate-400\" />\n                                            {format(project.updatedAt, 'MMM d, yyyy h:mm a')}\n                                        </div>\n                                    </div>\n                                </div>\n                            </CardContent>\n                        </Card>\n\n                        {/* Status/Progress Sidebar Card */}\n                        <Card className=\"border-slate-200 bg-slate-50/50\">\n                            <CardHeader>\n                                <CardTitle className=\"text-lg\">Stats</CardTitle>\n                                <CardDescription>Quick performance indicators</CardDescription>\n                            </CardHeader>\n                            <CardContent className=\"space-y-4\">\n                                <div className=\"p-4 bg-white rounded-lg border border-slate-200 shadow-sm\">\n                                    <p className=\"text-sm font-medium text-slate-500 mb-1\">Tasks</p>\n                                    <p className=\"text-2xl font-bold text-[#3D4A67]\">{tasks.filter(t => t.status === 'done').length} / {tasks.length}</p>\n                                    <p className=\"text-xs text-slate-400 mt-1\">Completed / Total</p>\n                                </div>\n                                <div className=\"p-4 bg-white rounded-lg border border-slate-200 shadow-sm\">\n                                    <p className=\"text-sm font-medium text-slate-500 mb-1\">Invoices</p>\n                                    <p className=\"text-2xl font-bold text-[#3D4A67]\">{invoices.length}</p>\n                                    <p className=\"text-xs text-slate-400 mt-1\">Total project invoices</p>\n                                </div>\n                            </CardContent>\n                        </Card>\n                    </div>\n                </TabsContent>\n\n                <TabsContent value=\"tasks\" className=\"mt-6 space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-lg font-medium text-[#3D4A67]\">Project Tasks</h3>\n                        <Button className=\"bg-[#9EAE8E] hover:bg-[#7E8E6E] gap-2\">\n                            <Plus className=\"h-4 w-4\" /> Add Task\n                        </Button>\n                    </div>\n                    {tasks.length === 0 ? (\n                        <Card className=\"border-dashed border-2\">\n                            <CardContent className=\"py-12 text-center text-slate-500\">\n                                No tasks assigned to this project yet.\n                            </CardContent>\n                        </Card>\n                    ) : (\n                        <div className=\"grid gap-3\">\n                            {tasks.map(task => (\n                                <Card key={task.id} className=\"border-slate-200 shadow-sm\">\n                                    <div className=\"p-4 flex items-center justify-between\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <div className=\"h-5 w-5 rounded-md border border-slate-300 flex-shrink-0\" />\n                                            <div>\n                                                <p className=\"font-medium text-[#3D4A67]\">{task.title}</p>\n                                                {task.dueDate && (\n                                                    <p className=\"text-xs text-slate-500\">\n                                                        Due {format(task.dueDate, 'MMM d, yyyy')}\n                                                    </p>\n                                                )}\n                                            </div>\n                                        </div>\n                                        <Badge variant=\"outline\" className=\"capitalize\">\n                                            {task.priority}\n                                        </Badge>\n                                    </div>\n                                </Card>\n                            ))}\n                        </div>\n                    )}\n                </TabsContent>\n\n                <TabsContent value=\"documents\" className=\"mt-6 space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-lg font-medium text-[#3D4A67]\">Documents</h3>\n                        <Button variant=\"outline\" className=\"gap-2\">\n                            <Plus className=\"h-4 w-4\" /> Upload\n                        </Button>\n                    </div>\n                    {documents.length === 0 ? (\n                        <Card className=\"border-dashed border-2\">\n                            <CardContent className=\"py-12 text-center text-slate-500\">\n                                No documents uploaded for this project.\n                            </CardContent>\n                        </Card>\n                    ) : (\n                        <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\n                            {documents.map(doc => (\n                                <Card key={doc.id} className=\"border-slate-200 shadow-sm group\">\n                                    <CardContent className=\"p-4\">\n                                        <div className=\"flex items-start gap-3\">\n                                            <div className=\"p-2 bg-slate-50 rounded-lg\">\n                                                <FileIcon className=\"h-6 w-6 text-slate-400\" />\n                                            </div>\n                                            <div className=\"flex-1 min-w-0\">\n                                                <p className=\"font-medium text-[#3D4A67] truncate\" title={doc.name}>\n                                                    {doc.name}\n                                                </p>\n                                                <p className=\"text-xs text-slate-500\">\n                                                    {(doc.sizeBytes ? doc.sizeBytes / 1024 : 0).toFixed(1)} KB  {format(doc.createdAt, 'MMM d')}\n                                                </p>\n                                            </div>\n                                        </div>\n                                        <div className=\"mt-4 flex items-center justify-end gap-2\">\n                                            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                                <Download className=\"h-4 w-4\" />\n                                            </Button>\n                                        </div>\n                                    </CardContent>\n                                </Card>\n                            ))}\n                        </div>\n                    )}\n                </TabsContent>\n\n                <TabsContent value=\"invoices\" className=\"mt-6 space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-lg font-medium text-[#3D4A67]\">Project Invoices</h3>\n                        <Button variant=\"outline\" className=\"gap-2\">\n                            <FileText className=\"h-4 w-4\" /> New Invoice\n                        </Button>\n                    </div>\n                    {invoices.length === 0 ? (\n                        <Card className=\"border-dashed border-2\">\n                            <CardContent className=\"py-12 text-center text-slate-500\">\n                                No invoices found for this project.\n                            </CardContent>\n                        </Card>\n                    ) : (\n                        <div className=\"bg-white rounded-lg border border-slate-200 overflow-hidden\">\n                            <table className=\"w-full text-sm text-left\">\n                                <thead className=\"bg-slate-50 text-slate-500 uppercase text-[10px] font-bold\">\n                                    <tr>\n                                        <th className=\"px-4 py-3\">Number</th>\n                                        <th className=\"px-4 py-3\">Date</th>\n                                        <th className=\"px-4 py-3 text-right\">Amount</th>\n                                        <th className=\"px-4 py-3 text-center\">Status</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {invoices.map(invoice => (\n                                        <tr key={invoice.id} className=\"border-t border-slate-100 hover:bg-slate-50 transition-colors\">\n                                            <td className=\"px-4 py-3 font-medium text-[#3D4A67]\">{invoice.invoice_number}</td>\n                                            <td className=\"px-4 py-3 text-slate-500\">\n                                                {invoice.invoice_date ? format(new Date(invoice.invoice_date), 'MMM d, yyyy') : '-'}\n                                            </td>\n                                            <td className=\"px-4 py-3 text-right font-medium\">\n                                                {invoice.currency} {invoice.amount_total.toLocaleString()}\n                                            </td>\n                                            <td className=\"px-4 py-3 text-center\">\n                                                <Badge className=\"capitalize\">\n                                                    {invoice.status}\n                                                </Badge>\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                    )}\n                </TabsContent>\n            </Tabs>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/projects/page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/projects/page.tsx:90:9\n  88 |     // Update local search when filters change externally\n  89 |     useEffect(() => {\n> 90 |         setLocalSearch(filters.search)\n     |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  91 |     }, [filters.search])\n  92 |\n  93 |     // Fetch data on mount","line":90,"column":9,"nodeType":null,"endLine":90,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":268,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12406,12409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12406,12409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useProjectStore } from '@/stores/project-store'\nimport { useContactStore } from '@/stores/contact-store'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\"\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\"\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\"\nimport { PROJECT_STATUS_LABELS, PROJECT_STATUS_COLORS, ProjectStatus } from '@/types/project'\nimport { FolderPlus, Trash2, Loader2, Calendar, User, Search, ArrowUpDown, ChevronLeft, ChevronRight } from 'lucide-react'\nimport { format } from 'date-fns'\nimport Link from 'next/link'\n\nexport default function ProjectsPage() {\n    const {\n        projects,\n        addProject,\n        archiveProject,\n        updateProject,\n        fetchProjects,\n        isLoading,\n        filters,\n        setFilters,\n        sortConfig,\n        setSort,\n        currentPage,\n        setPage,\n        pageSize,\n        setPageSize,\n        totalCount\n    } = useProjectStore()\n    const { contacts, fetchContacts } = useContactStore()\n\n    // Create Project Form State\n    const [open, setOpen] = useState(false)\n    const [name, setName] = useState('')\n    const [description, setDescription] = useState('')\n    const [clientId, setClientId] = useState('')\n    const [deadline, setDeadline] = useState('')\n    const [status, setStatus] = useState<ProjectStatus>('lead')\n    const [isSubmitting, setIsSubmitting] = useState(false)\n\n    // Archiving State\n    const [isArchiveDialogOpen, setIsArchiveDialogOpen] = useState(false)\n    const [projectToArchiveId, setProjectToArchiveId] = useState<string | null>(null)\n\n    // Search State\n    const [localSearch, setLocalSearch] = useState(filters.search)\n\n    // Debounce search\n    useEffect(() => {\n        const timer = setTimeout(() => {\n            if (localSearch !== filters.search) {\n                setFilters({ search: localSearch })\n            }\n        }, 300)\n        return () => clearTimeout(timer)\n    }, [localSearch, setFilters, filters.search])\n\n    // Update local search when filters change externally\n    useEffect(() => {\n        setLocalSearch(filters.search)\n    }, [filters.search])\n\n    // Fetch data on mount\n    useEffect(() => {\n        fetchProjects()\n        fetchContacts()\n    }, [fetchProjects, fetchContacts])\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault()\n        if (!name || isSubmitting) return\n\n        setIsSubmitting(true)\n        await addProject({\n            name,\n            description: description || undefined,\n            clientId: clientId || undefined,\n            deadline: deadline ? new Date(deadline) : undefined,\n            status\n        })\n        setName('')\n        setDescription('')\n        setClientId('')\n        setDeadline('')\n        setStatus('lead')\n        setOpen(false)\n        setIsSubmitting(false)\n    }\n\n    const handleArchive = async () => {\n        if (!projectToArchiveId) return\n        await archiveProject(projectToArchiveId)\n        setIsArchiveDialogOpen(false)\n        setProjectToArchiveId(null)\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-[#3D4A67]\">Projects</h1>\n                    <p className=\"text-slate-600\">Track your client projects</p>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                    <Dialog open={open} onOpenChange={setOpen}>\n                        <DialogTrigger asChild>\n                            <Button className=\"bg-[#9EAE8E] hover:bg-[#7E8E6E] text-white gap-2\">\n                                <FolderPlus className=\"h-4 w-4\" />\n                                New Project\n                            </Button>\n                        </DialogTrigger>\n                        <DialogContent>\n                            <form onSubmit={handleSubmit}>\n                                <DialogHeader>\n                                    <DialogTitle className=\"text-[#3D4A67]\">Create New Project</DialogTitle>\n                                    <DialogDescription>Add a new project to track.</DialogDescription>\n                                </DialogHeader>\n                                <div className=\"grid gap-4 py-4\">\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"name\">Project Name *</Label>\n                                        <Input\n                                            id=\"name\"\n                                            value={name}\n                                            onChange={(e) => setName(e.target.value)}\n                                            placeholder=\"Website Redesign\"\n                                            required\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"description\">Description</Label>\n                                        <Input\n                                            id=\"description\"\n                                            value={description}\n                                            onChange={(e) => setDescription(e.target.value)}\n                                            placeholder=\"Project description...\"\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"client\">Client</Label>\n                                        <Select value={clientId} onValueChange={setClientId}>\n                                            <SelectTrigger>\n                                                <SelectValue placeholder=\"Select client...\" />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                {contacts.map(contact => (\n                                                    <SelectItem key={contact.id} value={contact.id}>\n                                                        {contact.isCompany ? contact.companyName : `${contact.firstName} ${contact.lastName}`}\n                                                    </SelectItem>\n                                                ))}\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"deadline\">Deadline</Label>\n                                        <Input\n                                            id=\"deadline\"\n                                            type=\"date\"\n                                            value={deadline}\n                                            onChange={(e) => setDeadline(e.target.value)}\n                                            min={new Date().toISOString().split('T')[0]}\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"status\">Status</Label>\n                                        <Select value={status} onValueChange={(v) => setStatus(v as ProjectStatus)}>\n                                            <SelectTrigger>\n                                                <SelectValue />\n                                            </SelectTrigger>\n                                            <SelectContent>\n                                                {Object.entries(PROJECT_STATUS_LABELS).map(([value, label]) => (\n                                                    <SelectItem key={value} value={value}>{label}</SelectItem>\n                                                ))}\n                                            </SelectContent>\n                                        </Select>\n                                    </div>\n                                </div>\n                                <DialogFooter>\n                                    <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} disabled={isSubmitting}>Cancel</Button>\n                                    <Button type=\"submit\" className=\"bg-[#9EAE8E] hover:bg-[#7E8E6E]\" disabled={isSubmitting}>\n                                        {isSubmitting ? <><Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />Creating...</> : 'Create Project'}\n                                    </Button>\n                                </DialogFooter>\n                            </form>\n                        </DialogContent>\n                    </Dialog>\n                </div>\n            </div>\n\n            {/* Filters Bar */}\n            <div className=\"flex flex-col gap-4 bg-white p-4 rounded-lg border border-slate-200 shadow-sm md:flex-row md:items-center\">\n                <div className=\"relative flex-1\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n                    <Input\n                        placeholder=\"Search projects...\"\n                        className=\"pl-10 bg-slate-50 border-slate-200\"\n                        value={localSearch}\n                        onChange={(e) => setLocalSearch(e.target.value)}\n                    />\n                </div>\n                <div className=\"flex flex-wrap items-center gap-2\">\n                    <Select\n                        value={filters.status}\n                        onValueChange={(v) => setFilters({ status: v as ProjectStatus | 'all' })}\n                    >\n                        <SelectTrigger className=\"w-[140px] bg-white border-slate-200\">\n                            <SelectValue placeholder=\"Status: All\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                            <SelectItem value=\"all\">All Statuses</SelectItem>\n                            {Object.entries(PROJECT_STATUS_LABELS).map(([value, label]) => (\n                                <SelectItem key={value} value={value}>{label}</SelectItem>\n                            ))}\n                        </SelectContent>\n                    </Select>\n\n                    <Select\n                        value={filters.clientId}\n                        onValueChange={(v) => setFilters({ clientId: v })}\n                    >\n                        <SelectTrigger className=\"w-[180px] bg-white border-slate-200\">\n                            <SelectValue placeholder=\"Client: All\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                            <SelectItem value=\"all\">All Clients</SelectItem>\n                            {contacts.map((contact) => (\n                                <SelectItem key={contact.id} value={contact.id}>\n                                    {contact.isCompany ? contact.companyName : `${contact.firstName} ${contact.lastName}`}\n                                </SelectItem>\n                            ))}\n                        </SelectContent>\n                    </Select>\n\n                    <Select\n                        value={`${sortConfig.column}-${sortConfig.direction}`}\n                        onValueChange={(v) => {\n                            const [col, dir] = v.split('-')\n                            if (col !== sortConfig.column || dir !== sortConfig.direction) {\n                                setSort(col as any)\n                            }\n                        }}\n                    >\n                        <SelectTrigger className=\"w-[180px] bg-white border-slate-200 text-sm\">\n                            <ArrowUpDown className=\"h-4 w-4 mr-2 opacity-50\" />\n                            <SelectValue placeholder=\"Sort by\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                            <SelectItem value=\"created_at-desc\">Newest First</SelectItem>\n                            <SelectItem value=\"created_at-asc\">Oldest First</SelectItem>\n                            <SelectItem value=\"name-asc\">Name (A-Z)</SelectItem>\n                            <SelectItem value=\"name-desc\">Name (Z-A)</SelectItem>\n                            <SelectItem value=\"deadline-asc\">Deadline (Soonest)</SelectItem>\n                            <SelectItem value=\"deadline-desc\">Deadline (Furthest)</SelectItem>\n                        </SelectContent>\n                    </Select>\n                </div>\n            </div>\n\n            {isLoading ? (\n                <div className=\"py-20 flex flex-col items-center justify-center\">\n                    <Loader2 className=\"h-8 w-8 animate-spin text-[#3D4A67] mb-4\" />\n                    <p className=\"text-slate-500 font-medium\">Loading projects...</p>\n                </div>\n            ) : projects.length === 0 ? (\n                <Card className=\"border-slate-200 bg-white shadow-sm\">\n                    <CardContent className=\"py-20 flex flex-col items-center justify-center text-center\">\n                        <div className=\"bg-slate-50 p-4 rounded-full mb-4\">\n                            <Search className=\"h-8 w-8 text-slate-300\" />\n                        </div>\n                        <h3 className=\"text-lg font-medium text-slate-900 mb-1\">No projects found</h3>\n                        <p className=\"text-slate-500 max-w-xs\">\n                            {filters.search || filters.status !== 'all' || filters.clientId !== 'all'\n                                ? \"No projects match your current filters. Try adjusting them.\"\n                                : \"Get started by creating your first project.\"}\n                        </p>\n                        {!filters.search && filters.status === 'all' && filters.clientId === 'all' && (\n                            <Button className=\"mt-6 bg-[#9EAE8E] hover:bg-[#7E8E6E]\" onClick={() => setOpen(true)}>\n                                Create Project\n                            </Button>\n                        )}\n                    </CardContent>\n                </Card>\n            ) : (\n                <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n                    {projects.map((project) => (\n                        <Card key={project.id} className=\"border-slate-200 bg-white shadow-sm hover:shadow-md transition-shadow group flex flex-col\">\n                            <CardHeader className=\"flex-1\">\n                                <div className=\"flex items-start justify-between mb-2\">\n                                    <Link href={`/projects/${project.id}`} className=\"hover:underline\">\n                                        <CardTitle className=\"text-[#3D4A67] font-bold line-clamp-1\">{project.name}</CardTitle>\n                                    </Link>\n                                    <Select\n                                        value={project.status}\n                                        onValueChange={(v) => updateProject(project.id, { status: v as ProjectStatus })}\n                                    >\n                                        <SelectTrigger className=\"w-auto h-7 border-0 p-0 hover:bg-transparent shadow-none\">\n                                            <Badge className={`${PROJECT_STATUS_COLORS[project.status]} border-0`}>\n                                                {PROJECT_STATUS_LABELS[project.status]}\n                                            </Badge>\n                                        </SelectTrigger>\n                                        <SelectContent>\n                                            {Object.entries(PROJECT_STATUS_LABELS).map(([value, label]) => (\n                                                <SelectItem key={value} value={value}>{label}</SelectItem>\n                                            ))}\n                                        </SelectContent>\n                                    </Select>\n                                </div>\n                                {project.description && (\n                                    <CardDescription className=\"text-slate-500 line-clamp-2 min-h-[2.5rem]\">\n                                        {project.description}\n                                    </CardDescription>\n                                )}\n                            </CardHeader>\n                            <CardContent className=\"pt-0 space-y-4\">\n                                <div className=\"space-y-2\">\n                                    {project.clientName && (\n                                        <div className=\"flex items-center text-sm text-slate-600\">\n                                            <User className=\"h-4 w-4 mr-2 text-slate-400\" />\n                                            <span className=\"truncate\">{project.clientName}</span>\n                                        </div>\n                                    )}\n                                    {project.deadline && (\n                                        <div className=\"flex items-center text-sm text-slate-600\">\n                                            <Calendar className=\"h-4 w-4 mr-2 text-slate-400\" />\n                                            <span>Due {format(project.deadline, 'MMM d, yyyy')}</span>\n                                        </div>\n                                    )}\n                                </div>\n                                <div className=\"pt-4 border-t border-slate-100 flex items-center justify-between\">\n                                    <Link href={`/projects/${project.id}`} className=\"text-sm font-medium text-[#9EAE8E] hover:underline\">\n                                        View details\n                                    </Link>\n                                    <Button\n                                        variant=\"ghost\"\n                                        size=\"sm\"\n                                        className=\"text-slate-400 hover:text-red-600 hover:bg-red-50 h-8 w-8 p-0\"\n                                        onClick={() => {\n                                            setProjectToArchiveId(project.id)\n                                            setIsArchiveDialogOpen(true)\n                                        }}\n                                    >\n                                        <Trash2 className=\"h-4 w-4\" />\n                                    </Button>\n                                </div>\n                            </CardContent>\n                        </Card>\n                    ))}\n                </div>\n            )}\n\n            {/* Pagination */}\n            {!isLoading && projects.length > 0 && (\n                <div className=\"flex flex-col gap-4 items-center justify-between bg-white p-4 rounded-lg border border-slate-200 shadow-sm sm:flex-row\">\n                    <div className=\"text-sm text-slate-500\">\n                        Showing <span className=\"font-medium\">{(currentPage - 1) * pageSize + 1}</span> to <span className=\"font-medium\">{Math.min(currentPage * pageSize, totalCount)}</span> of <span className=\"font-medium\">{totalCount}</span> projects\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"flex items-center gap-2\">\n                            <span className=\"text-sm text-slate-500 whitespace-nowrap\">Rows</span>\n                            <Select\n                                value={pageSize.toString()}\n                                onValueChange={(v) => setPageSize(parseInt(v))}\n                            >\n                                <SelectTrigger className=\"w-[70px] h-8 bg-white border-slate-200\">\n                                    <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    {[12, 24, 48, 100].map((size) => (\n                                        <SelectItem key={size} value={size.toString()}>{size}</SelectItem>\n                                    ))}\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                            <Button\n                                variant=\"outline\"\n                                size=\"icon\"\n                                className=\"h-8 w-8 text-[#3D4A67] border-slate-200\"\n                                onClick={() => setPage(currentPage - 1)}\n                                disabled={currentPage === 1}\n                            >\n                                <ChevronLeft className=\"h-4 w-4\" />\n                            </Button>\n                            <div className=\"flex items-center justify-center min-w-[32px] font-medium text-sm text-[#3D4A67]\">\n                                {currentPage}\n                            </div>\n                            <Button\n                                variant=\"outline\"\n                                size=\"icon\"\n                                className=\"h-8 w-8 text-[#3D4A67] border-slate-200\"\n                                onClick={() => setPage(currentPage + 1)}\n                                disabled={currentPage * pageSize >= totalCount}\n                            >\n                                <ChevronRight className=\"h-4 w-4\" />\n                            </Button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Archive Dialog */}\n            <AlertDialog open={isArchiveDialogOpen} onOpenChange={setIsArchiveDialogOpen}>\n                <AlertDialogContent>\n                    <AlertDialogHeader>\n                        <AlertDialogTitle className=\"text-[#3D4A67]\">Archive Project?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                            This will move the project to your archive. You can still access its history later.\n                        </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction\n                            onClick={handleArchive}\n                            className=\"bg-red-600 hover:bg-red-700 text-white border-0\"\n                        >\n                            Archive\n                        </AlertDialogAction>\n                    </AlertDialogFooter>\n                </AlertDialogContent>\n            </AlertDialog>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/settings/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Separator"},"fix":{"range":[398,451],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSettings'. Either include it or remove the dependency array.","line":63,"column":8,"nodeType":"ArrayExpression","endLine":63,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadSettings]","fix":{"range":[1968,1970],"text":"[loadSettings]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4636,4639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4636,4639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { createClient } from '@/lib/supabase/client'\nimport { Loader2, Save, Building2, CreditCard, Receipt } from 'lucide-react'\nimport { getSupportedCountries, TAX_RATES } from '@/lib/invoices/tax-rates'\n\ninterface BillingSettings {\n    company_name: string\n    address: string\n    zip: string\n    city: string\n    country: string\n    iban: string\n    bic: string\n    bank_name: string\n    vat_number: string\n    email: string\n    phone: string\n    default_currency: string\n    default_tax_rate: number\n    invoice_prefix: string\n}\n\nconst DEFAULT_BILLING: BillingSettings = {\n    company_name: '',\n    address: '',\n    zip: '',\n    city: '',\n    country: 'CH',\n    iban: '',\n    bic: '',\n    bank_name: '',\n    vat_number: '',\n    email: '',\n    phone: '',\n    default_currency: 'CHF',\n    default_tax_rate: 8.1,\n    invoice_prefix: 'INV',\n}\n\nexport default function SettingsPage() {\n    const [loading, setLoading] = useState(true)\n    const [saving, setSaving] = useState(false)\n    const [orgId, setOrgId] = useState<string | null>(null)\n    const [orgName, setOrgName] = useState('')\n    const [billing, setBilling] = useState<BillingSettings>(DEFAULT_BILLING)\n    const [profileName, setProfileName] = useState('')\n    const [profileEmail, setProfileEmail] = useState('')\n    const [message, setMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null)\n\n    const supabase = createClient()\n    const countries = getSupportedCountries()\n\n    useEffect(() => {\n        loadSettings()\n    }, [])\n\n    const loadSettings = async () => {\n        setLoading(true)\n        try {\n            // Get current user\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) return\n\n            // Get profile\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('full_name, email, tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (profile) {\n                setProfileName(profile.full_name || '')\n                setProfileEmail(profile.email || user.email || '')\n                \n                if (profile.tenant_id) {\n                    setOrgId(profile.tenant_id)\n                    \n                    // Get organization settings\n                    const { data: org } = await supabase\n                        .from('organizations')\n                        .select('name, settings')\n                        .eq('id', profile.tenant_id)\n                        .single()\n\n                    if (org) {\n                        setOrgName(org.name || '')\n                        const settings = (org.settings as Record<string, unknown>) || {}\n                        const billingSettings = (settings.billing as BillingSettings) || {}\n                        setBilling({\n                            ...DEFAULT_BILLING,\n                            ...billingSettings,\n                        })\n                    }\n                }\n            }\n        } catch (error) {\n            console.error('Error loading settings:', error)\n        } finally {\n            setLoading(false)\n        }\n    }\n\n    const handleSaveBilling = async () => {\n        if (!orgId) return\n        setSaving(true)\n        setMessage(null)\n\n        try {\n            // Get current settings\n            const { data: org } = await supabase\n                .from('organizations')\n                .select('settings')\n                .eq('id', orgId)\n                .single()\n\n            const currentSettings = (org?.settings as Record<string, unknown>) || {}\n\n            // Merge billing settings\n            const updatedSettings = {\n                ...currentSettings,\n                billing: billing,\n            }\n\n            // Update organization\n            const { error } = await supabase\n                .from('organizations')\n                .update({\n                    name: orgName,\n                    settings: updatedSettings,\n                })\n                .eq('id', orgId)\n\n            if (error) throw error\n\n            setMessage({ type: 'success', text: 'Settings saved successfully!' })\n        } catch (error: any) {\n            console.error('Error saving settings:', error)\n            setMessage({ type: 'error', text: error.message || 'Failed to save settings' })\n        } finally {\n            setSaving(false)\n        }\n    }\n\n    const updateBilling = (field: keyof BillingSettings, value: string | number) => {\n        setBilling(prev => ({ ...prev, [field]: value }))\n    }\n\n    if (loading) {\n        return (\n            <div className=\"flex items-center justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-[#3D4A67]\" />\n                <span className=\"ml-2 text-slate-500\">Loading settings...</span>\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"space-y-6\">\n            <div>\n                <h1 className=\"text-3xl font-bold text-[#3D4A67]\">Settings</h1>\n                <p className=\"text-slate-600\">Manage your account and organization</p>\n            </div>\n\n            {message && (\n                <div className={`p-4 rounded-lg ${message.type === 'success' ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'}`}>\n                    {message.text}\n                </div>\n            )}\n\n            <div className=\"space-y-6\">\n                {/* Profile Section */}\n                <Card className=\"border-slate-200 bg-white shadow-sm\">\n                    <CardHeader>\n                        <CardTitle className=\"text-[#3D4A67]\">Profile</CardTitle>\n                        <CardDescription className=\"text-slate-600\">Your personal information</CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label>Full Name</Label>\n                                <Input\n                                    value={profileName}\n                                    onChange={e => setProfileName(e.target.value)}\n                                    placeholder=\"Your name\"\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>Email</Label>\n                                <Input\n                                    value={profileEmail}\n                                    disabled\n                                    className=\"bg-slate-100 text-slate-500\"\n                                />\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                {/* Organization Section */}\n                <Card className=\"border-slate-200 bg-white shadow-sm\">\n                    <CardHeader className=\"flex flex-row items-center gap-3\">\n                        <Building2 className=\"h-5 w-5 text-[#3D4A67]\" />\n                        <div>\n                            <CardTitle className=\"text-[#3D4A67]\">Organization</CardTitle>\n                            <CardDescription className=\"text-slate-600\">Your company details for invoices</CardDescription>\n                        </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label>Company Name</Label>\n                                <Input\n                                    value={billing.company_name}\n                                    onChange={e => updateBilling('company_name', e.target.value)}\n                                    placeholder=\"Your Company GmbH\"\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>VAT Number</Label>\n                                <Input\n                                    value={billing.vat_number}\n                                    onChange={e => updateBilling('vat_number', e.target.value)}\n                                    placeholder=\"CHE-123.456.789 MWST\"\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"space-y-2\">\n                            <Label>Address</Label>\n                            <Input\n                                value={billing.address}\n                                onChange={e => updateBilling('address', e.target.value)}\n                                placeholder=\"Street and number\"\n                            />\n                        </div>\n\n                        <div className=\"grid grid-cols-3 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label>ZIP/Postal Code</Label>\n                                <Input\n                                    value={billing.zip}\n                                    onChange={e => updateBilling('zip', e.target.value)}\n                                    placeholder=\"8000\"\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>City</Label>\n                                <Input\n                                    value={billing.city}\n                                    onChange={e => updateBilling('city', e.target.value)}\n                                    placeholder=\"Zurich\"\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>Country</Label>\n                                <Select value={billing.country} onValueChange={v => updateBilling('country', v)}>\n                                    <SelectTrigger>\n                                        <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        {countries.map(code => (\n                                            <SelectItem key={code} value={code}>\n                                                {TAX_RATES[code]?.name || code}\n                                            </SelectItem>\n                                        ))}\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                        </div>\n\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label>Email</Label>\n                                <Input\n                                    type=\"email\"\n                                    value={billing.email}\n                                    onChange={e => updateBilling('email', e.target.value)}\n                                    placeholder=\"invoices@company.ch\"\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>Phone</Label>\n                                <Input\n                                    value={billing.phone}\n                                    onChange={e => updateBilling('phone', e.target.value)}\n                                    placeholder=\"+41 44 123 45 67\"\n                                />\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                {/* Bank Details Section */}\n                <Card className=\"border-slate-200 bg-white shadow-sm\">\n                    <CardHeader className=\"flex flex-row items-center gap-3\">\n                        <CreditCard className=\"h-5 w-5 text-[#3D4A67]\" />\n                        <div>\n                            <CardTitle className=\"text-[#3D4A67]\">Bank Details</CardTitle>\n                            <CardDescription className=\"text-slate-600\">Payment information for invoices and QR-Bills</CardDescription>\n                        </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                            <Label>IBAN</Label>\n                            <Input\n                                value={billing.iban}\n                                onChange={e => updateBilling('iban', e.target.value)}\n                                placeholder=\"CH93 0076 2011 6238 5295 7\"\n                                className=\"font-mono\"\n                            />\n                            <p className=\"text-xs text-slate-500\">\n                                This IBAN will be used for Swiss QR-Bills and EU SEPA invoices\n                            </p>\n                        </div>\n\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label>BIC/SWIFT (optional)</Label>\n                                <Input\n                                    value={billing.bic}\n                                    onChange={e => updateBilling('bic', e.target.value)}\n                                    placeholder=\"ZKBKCHZZ80A\"\n                                    className=\"font-mono\"\n                                />\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>Bank Name (optional)</Label>\n                                <Input\n                                    value={billing.bank_name}\n                                    onChange={e => updateBilling('bank_name', e.target.value)}\n                                    placeholder=\"Zrcher Kantonalbank\"\n                                />\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                {/* Invoice Preferences Section */}\n                <Card className=\"border-slate-200 bg-white shadow-sm\">\n                    <CardHeader className=\"flex flex-row items-center gap-3\">\n                        <Receipt className=\"h-5 w-5 text-[#3D4A67]\" />\n                        <div>\n                            <CardTitle className=\"text-[#3D4A67]\">Invoice Preferences</CardTitle>\n                            <CardDescription className=\"text-slate-600\">Default settings for new invoices</CardDescription>\n                        </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                        <div className=\"grid grid-cols-3 gap-4\">\n                            <div className=\"space-y-2\">\n                                <Label>Invoice Number Prefix</Label>\n                                <Input\n                                    value={billing.invoice_prefix}\n                                    onChange={e => updateBilling('invoice_prefix', e.target.value)}\n                                    placeholder=\"INV\"\n                                    maxLength={10}\n                                />\n                                <p className=\"text-xs text-slate-500\">\n                                    e.g., INV-2026-0001\n                                </p>\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>Default Currency</Label>\n                                <Select \n                                    value={billing.default_currency} \n                                    onValueChange={v => updateBilling('default_currency', v)}\n                                >\n                                    <SelectTrigger>\n                                        <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        <SelectItem value=\"CHF\">CHF - Swiss Franc</SelectItem>\n                                        <SelectItem value=\"EUR\">EUR - Euro</SelectItem>\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label>Default Tax Rate</Label>\n                                <Select \n                                    value={billing.default_tax_rate.toString()} \n                                    onValueChange={v => updateBilling('default_tax_rate', parseFloat(v))}\n                                >\n                                    <SelectTrigger>\n                                        <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                        <SelectItem value=\"0\">0% (Exempt)</SelectItem>\n                                        <SelectItem value=\"2.6\">2.6% (CH Reduced)</SelectItem>\n                                        <SelectItem value=\"8.1\">8.1% (CH Standard)</SelectItem>\n                                        <SelectItem value=\"7\">7% (DE Reduced)</SelectItem>\n                                        <SelectItem value=\"19\">19% (DE Standard)</SelectItem>\n                                    </SelectContent>\n                                </Select>\n                            </div>\n                        </div>\n                    </CardContent>\n                </Card>\n\n                {/* Save Button */}\n                <div className=\"flex justify-end\">\n                    <Button \n                        onClick={handleSaveBilling}\n                        disabled={saving}\n                        className=\"bg-[#3D4A67] hover:bg-[#2D3A57]\"\n                    >\n                        {saving ? (\n                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        ) : (\n                            <Save className=\"mr-2 h-4 w-4\" />\n                        )}\n                        Save All Settings\n                    </Button>\n                </div>\n            </div>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(admin)/tasks/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(auth)/actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(auth)/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(auth)/login/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[492,495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[492,495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Input } from \"@/components/ui/input\"\nimport Link from \"next/link\"\nimport { Mail, Lock, ArrowRight } from 'lucide-react'\nimport { login, signInWithGoogle } from \"../actions\"\nimport { useActionState } from \"react\"\n\nexport default function LoginPage() {\n    const [state, formAction, isPending] = useActionState(async (_prev: any, formData: FormData) => {\n        const res = await login(formData);\n        if (res?.error) return { error: res.error };\n        return null;\n    }, null);\n\n    const handleGoogleSignIn = async () => {\n        const res = await signInWithGoogle();\n        if (res?.error) {\n            console.error('Google sign-in error:', res.error);\n        }\n    };\n\n    return (\n        <div className=\"min-h-screen flex items-center justify-center bg-slate-50 px-4\">\n            <Card className=\"w-full max-w-md border-slate-200 bg-white shadow-lg\">\n                <CardHeader className=\"text-center\">\n                    <CardTitle className=\"text-2xl text-[#3D4A67]\">Welcome back</CardTitle>\n                    <CardDescription className=\"text-slate-600\">\n                        Sign in to your OrbitCRM account\n                    </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <form action={formAction} className=\"space-y-4\">\n                        {state?.error && (\n                            <div className=\"bg-red-50 text-red-600 text-sm p-3 rounded-md\">\n                                {state.error}\n                            </div>\n                        )}\n                        <div className=\"space-y-2\">\n                            <label htmlFor=\"email\" className=\"text-sm font-medium text-slate-700\">\n                                Email\n                            </label>\n                            <div className=\"relative\">\n                                <Mail className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n                                <Input\n                                    id=\"email\"\n                                    name=\"email\"\n                                    type=\"email\"\n                                    placeholder=\"you@example.com\"\n                                    required\n                                    className=\"pl-10 border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                                />\n                            </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <label htmlFor=\"password\" className=\"text-sm font-medium text-slate-700\">\n                                Password\n                            </label>\n                            <div className=\"relative\">\n                                <Lock className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n                                <Input\n                                    id=\"password\"\n                                    name=\"password\"\n                                    type=\"password\"\n                                    placeholder=\"\"\n                                    required\n                                    className=\"pl-10 border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                                />\n                            </div>\n                        </div>\n                        <Button type=\"submit\" disabled={isPending} className=\"w-full bg-[#3D4A67] hover:bg-[#2D3A57] text-white gap-2\">\n                            {isPending ? 'Signing in...' : 'Sign In'}\n                            <ArrowRight className=\"h-4 w-4\" />\n                        </Button>\n                    </form>\n\n                    <div className=\"relative\">\n                        <div className=\"absolute inset-0 flex items-center\">\n                            <span className=\"w-full border-t border-slate-200\" />\n                        </div>\n                        <div className=\"relative flex justify-center text-xs\">\n                            <span className=\"bg-white px-2 text-slate-500\">or continue with</span>\n                        </div>\n                    </div>\n\n                    <Button\n                        variant=\"outline\"\n                        className=\"w-full border-slate-300 text-slate-700 hover:bg-slate-50\"\n                        onClick={handleGoogleSignIn}\n                    >\n                        <svg className=\"h-4 w-4 mr-2\" viewBox=\"0 0 24 24\">\n                            <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" />\n                            <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" />\n                            <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" />\n                            <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" />\n                        </svg>\n                        Sign in with Google\n                    </Button>\n\n                    <p className=\"text-center text-sm text-slate-500\">\n                        Don&apos;t have an account?{' '}\n                        <Link href=\"/signup\" className=\"text-[#3D4A67] hover:underline font-medium\">\n                            Sign up\n                        </Link>\n                    </p>\n                </CardContent>\n            </Card>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/(auth)/signup/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[500,503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[500,503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Input } from \"@/components/ui/input\"\nimport Link from \"next/link\"\nimport { Mail, Lock, ArrowRight, User } from 'lucide-react'\nimport { signUp, signInWithGoogle } from \"../actions\"\nimport { useActionState } from \"react\"\n\nexport default function SignupPage() {\n    const [state, formAction, isPending] = useActionState(async (_prev: any, formData: FormData) => {\n        const res = await signUp(formData);\n        if (res?.error) return { error: res.error };\n        return null;\n    }, null);\n\n    const handleGoogleSignIn = async () => {\n        const res = await signInWithGoogle();\n        if (res?.error) {\n            // If there's an error, we stay on the page\n            console.error('Google sign-in error:', res.error);\n        }\n    };\n\n    return (\n        <div className=\"min-h-screen flex items-center justify-center bg-slate-50 px-4\">\n            <Card className=\"w-full max-w-md border-slate-200 bg-white shadow-lg\">\n                <CardHeader className=\"text-center\">\n                    <CardTitle className=\"text-2xl text-[#3D4A67]\">Create your account</CardTitle>\n                    <CardDescription className=\"text-slate-600\">\n                        Get started with OrbitCRM\n                    </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <form action={formAction} className=\"space-y-4\">\n                        {state?.error && (\n                            <div className=\"bg-red-50 text-red-600 text-sm p-3 rounded-md\">\n                                {state.error}\n                            </div>\n                        )}\n                        <div className=\"space-y-2\">\n                            <label htmlFor=\"fullName\" className=\"text-sm font-medium text-slate-700\">\n                                Full Name\n                            </label>\n                            <div className=\"relative\">\n                                <User className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n                                <Input\n                                    id=\"fullName\"\n                                    name=\"fullName\"\n                                    type=\"text\"\n                                    placeholder=\"John Doe\"\n                                    required\n                                    className=\"pl-10 border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                                />\n                            </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <label htmlFor=\"email\" className=\"text-sm font-medium text-slate-700\">\n                                Email\n                            </label>\n                            <div className=\"relative\">\n                                <Mail className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n                                <Input\n                                    id=\"email\"\n                                    name=\"email\"\n                                    type=\"email\"\n                                    placeholder=\"you@example.com\"\n                                    required\n                                    className=\"pl-10 border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                                />\n                            </div>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <label htmlFor=\"password\" className=\"text-sm font-medium text-slate-700\">\n                                Password\n                            </label>\n                            <div className=\"relative\">\n                                <Lock className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400\" />\n                                <Input\n                                    id=\"password\"\n                                    name=\"password\"\n                                    type=\"password\"\n                                    placeholder=\"\"\n                                    required\n                                    minLength={6}\n                                    className=\"pl-10 border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                                />\n                            </div>\n                        </div>\n                        <Button type=\"submit\" disabled={isPending} className=\"w-full bg-[#3D4A67] hover:bg-[#2D3A57] text-white gap-2\">\n                            {isPending ? 'Creating account...' : 'Create Account'}\n                            <ArrowRight className=\"h-4 w-4\" />\n                        </Button>\n                    </form>\n\n                    <div className=\"relative\">\n                        <div className=\"absolute inset-0 flex items-center\">\n                            <span className=\"w-full border-t border-slate-200\" />\n                        </div>\n                        <div className=\"relative flex justify-center text-xs\">\n                            <span className=\"bg-white px-2 text-slate-500\">or continue with</span>\n                        </div>\n                    </div>\n\n                    <Button\n                        variant=\"outline\"\n                        className=\"w-full border-slate-300 text-slate-700 hover:bg-slate-50\"\n                        onClick={handleGoogleSignIn}\n                    >\n                        <svg className=\"h-4 w-4 mr-2\" viewBox=\"0 0 24 24\">\n                            <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" />\n                            <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" />\n                            <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" />\n                            <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" />\n                        </svg>\n                        Sign up with Google\n                    </Button>\n\n                    <p className=\"text-center text-sm text-slate-500\">\n                        Already have an account?{' '}\n                        <Link href=\"/login\" className=\"text-[#3D4A67] hover:underline font-medium\">\n                            Sign in\n                        </Link>\n                    </p>\n                </CardContent>\n            </Card>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/ai/embed/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/chat/route.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":76,"column":21,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":76,"endColumn":34,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2444,2457],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4190,4193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4190,4193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { streamText } from 'ai';\nimport { openai } from '@ai-sdk/openai';\nimport { anthropic } from '@ai-sdk/anthropic';\nimport { google } from '@ai-sdk/google';\nimport { RagService } from '@/lib/ai/rag';\nimport { createClient } from '@/lib/supabase/server';\nimport { z } from 'zod';\n\nexport const maxDuration = 30;\n\n// Helper to get the correct model based on provider and model ID\nfunction getModel(modelId: string) {\n    // OpenAI models\n    if (modelId.startsWith('gpt-')) {\n        return openai(modelId);\n    }\n\n    // Anthropic models\n    if (modelId.startsWith('claude-')) {\n        return anthropic(modelId);\n    }\n\n    // Google models\n    if (modelId.startsWith('gemini-')) {\n        return google(modelId);\n    }\n\n    // Default to GPT-4o Mini\n    return openai('gpt-4o-mini');\n}\n\n// Helper to determine provider from model ID\nfunction getProvider(modelId: string): string {\n    if (modelId.startsWith('gpt-')) return 'OpenAI';\n    if (modelId.startsWith('claude-')) return 'Anthropic';\n    if (modelId.startsWith('gemini-')) return 'Google';\n    return 'Unknown';\n}\n\nexport async function POST(req: Request) {\n    const { messages, model, conversationId } = await req.json();\n    const supabase = await createClient();\n    const { data: { user } } = await supabase.auth.getUser();\n\n    if (!user) {\n        return new Response('Unauthorized', { status: 401 });\n    }\n\n    // Get User Role to determine RAG permissions\n    const { data: profile } = await supabase.from('profiles').select('tenant_id, role').eq('id', user.id).single();\n    const tenantId = profile?.tenant_id;\n    const role = profile?.role || 'member';\n\n    if (!tenantId) {\n        return new Response('No organization found', { status: 400 });\n    }\n\n    // Security Filter: Owners see Internal + Shared, Members see Shared only\n    const visibilityFilter = role === 'owner' ? ['internal', 'shared'] : ['shared'];\n\n    // Select the AI model\n    const selectedModel = model || 'gpt-4o-mini';\n    const aiModel = getModel(selectedModel);\n\n    const result = await streamText({\n        model: aiModel,\n        messages,\n        tools: {\n            search_documents: {\n                description: 'Search for documents in the vault based on query',\n                inputSchema: z.object({\n                    query: z.string().describe('The search query')\n                }),\n                execute: async ({ query }: { query: string }) => {\n                    // @ts-ignore\n                    const docs = await RagService.searchSimilarDocuments(query, tenantId, visibilityFilter);\n                    return docs.length > 0 ? JSON.stringify(docs) : \"No relevant documents found.\";\n                }\n            }\n        },\n        system: `You are Orbit, an AI assistant for service professionals using OrbitCRM.\nCurrent User Role: ${role}.\n\nYou help users manage their CRM, draft emails, create tasks, analyze contacts, and find information.\n\nYou have access to tools:\n- Always use 'search_documents' if the user asks about files, contracts, or specific client info.\n- If you find documents, cite them in your answer.\n\nBe concise, professional, and helpful.`,\n        onFinish: async ({ usage }) => {\n            // Record token usage for billing and analytics\n            if (usage && conversationId) {\n                try {\n                    await supabase.from('token_usage').insert({\n                        tenant_id: tenantId,\n                        user_id: user.id,\n                        conversation_id: conversationId,\n                        model: selectedModel,\n                        provider: getProvider(selectedModel),\n                        prompt_tokens: usage.promptTokens || 0,\n                        completion_tokens: usage.completionTokens || 0,\n                        total_tokens: usage.totalTokens || 0,\n                        estimated_cost_cents: 0, // TODO: Calculate based on pricing\n                    });\n                } catch (error) {\n                    console.error('Failed to record token usage:', error);\n                    // Don't fail the request if token tracking fails\n                }\n            }\n        },\n    });\n\n    return (result as any).toDataStreamResponse();\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/contacts/[id]/export/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notes' is assigned a value but never used.","line":47,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":48},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5776,5779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5776,5779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6025,6028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6025,6028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":195,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6686,6689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6686,6689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7093,7096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7093,7096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":221,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7510,7513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7510,7513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":234,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7967,7970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7967,7970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * GET /api/contacts/[id]/export?format=json|csv\n *\n * Export all contact data for GDPR compliance (data portability)\n * Includes personal data, related invoices, tasks, projects, notes, and activity history\n */\n\nimport { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(\n    request: NextRequest,\n    { params }: { params: { id: string } }\n) {\n    try {\n        const supabase = await createClient()\n        const contactId = params.id\n\n        // Get query params\n        const searchParams = request.nextUrl.searchParams\n        const format = searchParams.get('format') || 'json'\n\n        // Verify user is authenticated\n        const { data: { user }, error: authError } = await supabase.auth.getUser()\n        if (authError || !user) {\n            return NextResponse.json(\n                { error: 'Unauthorized' },\n                { status: 401 }\n            )\n        }\n\n        // Get contact data\n        const { data: contact, error: contactError } = await supabase\n            .from('contacts')\n            .select('*')\n            .eq('id', contactId)\n            .single()\n\n        if (contactError || !contact) {\n            return NextResponse.json(\n                { error: 'Contact not found' },\n                { status: 404 }\n            )\n        }\n\n        // Get related data\n        const [invoices, tasks, projects, notes, activities] = await Promise.all([\n            // Invoices\n            supabase\n                .from('invoices')\n                .select('*')\n                .eq('contact_id', contactId)\n                .then(({ data }) => data || []),\n\n            // Tasks\n            supabase\n                .from('tasks')\n                .select('*')\n                .eq('contact_id', contactId)\n                .then(({ data }) => data || []),\n\n            // Projects\n            supabase\n                .from('projects')\n                .select('*')\n                .eq('contact_id', contactId)\n                .then(({ data }) => data || []),\n\n            // Notes (assuming they're stored in contact.notes field)\n            Promise.resolve(contact.notes || []),\n\n            // Activity history\n            supabase\n                .from('activity_feed')\n                .select('*')\n                .eq('entity_type', 'contact')\n                .eq('entity_id', contactId)\n                .order('created_at', { ascending: false })\n                .then(({ data }) => data || []),\n        ])\n\n        // Compile complete data export\n        const exportData = {\n            export_info: {\n                exported_at: new Date().toISOString(),\n                export_format: format,\n                contact_id: contactId,\n                gdpr_compliant: true,\n            },\n            personal_data: {\n                id: contact.id,\n                name: contact.name,\n                email: contact.email,\n                phone: contact.phone,\n                company: contact.company,\n                status: contact.status,\n                tags: contact.tags,\n                notes: contact.notes,\n                created_at: contact.created_at,\n                updated_at: contact.updated_at,\n                // Portal access info\n                portal_enabled: contact.portal_enabled,\n                portal_invited_at: contact.portal_invited_at,\n                last_portal_login: contact.last_portal_login,\n                // Consent info (if exists)\n                marketing_consent: contact.marketing_consent,\n                data_processing_consent: contact.data_processing_consent,\n                consent_date: contact.consent_date,\n            },\n            invoices: invoices.map(inv => ({\n                id: inv.id,\n                invoice_number: inv.invoice_number,\n                status: inv.status,\n                total: inv.total,\n                due_date: inv.due_date,\n                paid_date: inv.paid_date,\n                created_at: inv.created_at,\n            })),\n            tasks: tasks.map(task => ({\n                id: task.id,\n                title: task.title,\n                description: task.description,\n                status: task.status,\n                priority: task.priority,\n                due_date: task.due_date,\n                created_at: task.created_at,\n            })),\n            projects: projects.map(proj => ({\n                id: proj.id,\n                name: proj.name,\n                description: proj.description,\n                status: proj.status,\n                start_date: proj.start_date,\n                end_date: proj.end_date,\n                created_at: proj.created_at,\n            })),\n            activity_history: activities.map(act => ({\n                event_type: act.event_type,\n                description: act.description,\n                user_name: act.user_name,\n                created_at: act.created_at,\n            })),\n        }\n\n        // Generate response based on format\n        if (format === 'csv') {\n            // Generate CSV format\n            const csv = generateCSV(exportData)\n            return new NextResponse(csv, {\n                headers: {\n                    'Content-Type': 'text/csv',\n                    'Content-Disposition': `attachment; filename=\"contact-${contactId}-export.csv\"`,\n                },\n            })\n        } else {\n            // Default to JSON\n            const json = JSON.stringify(exportData, null, 2)\n            return new NextResponse(json, {\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Content-Disposition': `attachment; filename=\"contact-${contactId}-export.json\"`,\n                },\n            })\n        }\n    } catch (error: any) {\n        console.error('Contact export error:', error)\n        return NextResponse.json(\n            { error: 'Failed to export contact data', details: error.message },\n            { status: 500 }\n        )\n    }\n}\n\nfunction generateCSV(data: any): string {\n    const lines: string[] = []\n\n    // Header\n    lines.push('GDPR Data Export')\n    lines.push(`Exported at: ${data.export_info.exported_at}`)\n    lines.push('')\n\n    // Personal Data\n    lines.push('=== PERSONAL DATA ===')\n    lines.push('Field,Value')\n    Object.entries(data.personal_data).forEach(([key, value]) => {\n        lines.push(`${key},\"${String(value || '').replace(/\"/g, '\"\"')}\"`)\n    })\n    lines.push('')\n\n    // Invoices\n    lines.push('=== INVOICES ===')\n    if (data.invoices.length > 0) {\n        const invoiceKeys = Object.keys(data.invoices[0])\n        lines.push(invoiceKeys.join(','))\n        data.invoices.forEach((inv: any) => {\n            lines.push(invoiceKeys.map(k => `\"${String(inv[k] || '').replace(/\"/g, '\"\"')}\"`).join(','))\n        })\n    } else {\n        lines.push('No invoices found')\n    }\n    lines.push('')\n\n    // Tasks\n    lines.push('=== TASKS ===')\n    if (data.tasks.length > 0) {\n        const taskKeys = Object.keys(data.tasks[0])\n        lines.push(taskKeys.join(','))\n        data.tasks.forEach((task: any) => {\n            lines.push(taskKeys.map(k => `\"${String(task[k] || '').replace(/\"/g, '\"\"')}\"`).join(','))\n        })\n    } else {\n        lines.push('No tasks found')\n    }\n    lines.push('')\n\n    // Projects\n    lines.push('=== PROJECTS ===')\n    if (data.projects.length > 0) {\n        const projKeys = Object.keys(data.projects[0])\n        lines.push(projKeys.join(','))\n        data.projects.forEach((proj: any) => {\n            lines.push(projKeys.map(k => `\"${String(proj[k] || '').replace(/\"/g, '\"\"')}\"`).join(','))\n        })\n    } else {\n        lines.push('No projects found')\n    }\n    lines.push('')\n\n    // Activity History\n    lines.push('=== ACTIVITY HISTORY ===')\n    if (data.activity_history.length > 0) {\n        const actKeys = Object.keys(data.activity_history[0])\n        lines.push(actKeys.join(','))\n        data.activity_history.forEach((act: any) => {\n            lines.push(actKeys.map(k => `\"${String(act[k] || '').replace(/\"/g, '\"\"')}\"`).join(','))\n        })\n    } else {\n        lines.push('No activity history found')\n    }\n\n    return lines.join('\\n')\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/contacts/[id]/gdpr-delete/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4478,4481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4478,4481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * DELETE /api/contacts/[id]/gdpr-delete\n *\n * Permanently delete contact data for GDPR \"Right to be Forgotten\" compliance\n * This is a HARD DELETE that removes all data and cannot be undone\n */\n\nimport { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { logActivity } from '@/lib/activity-log'\n\nexport async function DELETE(\n    request: NextRequest,\n    { params }: { params: { id: string } }\n) {\n    try {\n        const supabase = await createClient()\n        const contactId = params.id\n\n        // Verify user is authenticated\n        const { data: { user }, error: authError } = await supabase.auth.getUser()\n        if (authError || !user) {\n            return NextResponse.json(\n                { error: 'Unauthorized' },\n                { status: 401 }\n            )\n        }\n\n        // Get contact data before deletion (for audit log)\n        const { data: contact, error: contactError } = await supabase\n            .from('contacts')\n            .select('*')\n            .eq('id', contactId)\n            .single()\n\n        if (contactError || !contact) {\n            return NextResponse.json(\n                { error: 'Contact not found' },\n                { status: 404 }\n            )\n        }\n\n        // Log the deletion action BEFORE deleting (for GDPR compliance audit)\n        await logActivity({\n            eventType: 'deleted',\n            entityType: 'contact',\n            entityId: contactId,\n            entityName: contact.name,\n            description: `GDPR: Right to be Forgotten - Permanent deletion of contact and all related data`,\n            metadata: {\n                gdpr_deletion: true,\n                deleted_at: new Date().toISOString(),\n                contact_email: contact.email,\n                contact_name: contact.name,\n                requester_id: user.id,\n            },\n        })\n\n        // Generate deletion certificate data\n        const deletionCertificate = {\n            certificate_id: crypto.randomUUID(),\n            deletion_type: 'GDPR Right to be Forgotten',\n            contact_id: contactId,\n            contact_name: contact.name,\n            contact_email: contact.email,\n            deleted_at: new Date().toISOString(),\n            deleted_by: user.id,\n            data_deleted: [\n                'Personal information (name, email, phone, company)',\n                'Contact tags and notes',\n                'Portal access credentials',\n                'Related invoices and payment records',\n                'Related tasks and assignments',\n                'Related projects',\n                'Activity history',\n                'All associated metadata',\n            ],\n            legal_basis: 'GDPR Article 17 - Right to Erasure',\n            retention_period: 'Data deleted permanently, no retention',\n        }\n\n        // Delete related data in correct order (respecting foreign key constraints)\n        // Note: If you have ON DELETE CASCADE set up, some of these may be automatic\n\n        // 1. Delete activity logs (already logged the deletion above)\n        // Activity logs related to this contact will be handled by CASCADE or remain for audit\n\n        // 2. Delete portal sessions\n        await supabase\n            .from('portal_sessions')\n            .delete()\n            .eq('contact_id', contactId)\n\n        // 3. Delete tasks\n        await supabase\n            .from('tasks')\n            .delete()\n            .eq('contact_id', contactId)\n\n        // 4. Delete project associations\n        await supabase\n            .from('projects')\n            .delete()\n            .eq('contact_id', contactId)\n\n        // 5. Delete invoices\n        await supabase\n            .from('invoices')\n            .delete()\n            .eq('contact_id', contactId)\n\n        // 6. Finally, delete the contact\n        const { error: deleteError } = await supabase\n            .from('contacts')\n            .delete()\n            .eq('id', contactId)\n\n        if (deleteError) {\n            console.error('GDPR deletion error:', deleteError)\n            return NextResponse.json(\n                { error: 'Failed to delete contact', details: deleteError.message },\n                { status: 500 }\n            )\n        }\n\n        return NextResponse.json({\n            success: true,\n            message: 'Contact and all related data permanently deleted',\n            deletion_certificate: deletionCertificate,\n        })\n    } catch (error: any) {\n        console.error('GDPR deletion error:', error)\n        return NextResponse.json(\n            { error: 'Failed to process GDPR deletion', details: error.message },\n            { status: 500 }\n        )\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/contacts/duplicates/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":71,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'email' is defined but never used.","line":119,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":119,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":236,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8146,8149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8146,8149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":312,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10490,10493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10490,10493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Duplicate Detection API\n *\n * Finds potential duplicate contacts based on email, name, phone similarity\n */\n\nimport { NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\ninterface DuplicateGroup {\n    reason: 'exact_email' | 'similar_name' | 'exact_phone' | 'fuzzy_match'\n    score: number // 0-100, higher = more likely duplicate\n    contacts: Array<{\n        id: string\n        name: string\n        email?: string\n        phone?: string\n        company?: string\n        createdAt: Date\n    }>\n}\n\n/**\n * Calculate string similarity (Levenshtein distance)\n */\nfunction calculateSimilarity(str1: string, str2: string): number {\n    const s1 = str1.toLowerCase().trim()\n    const s2 = str2.toLowerCase().trim()\n\n    if (s1 === s2) return 100\n\n    const len1 = s1.length\n    const len2 = s2.length\n\n    if (len1 === 0) return 0\n    if (len2 === 0) return 0\n\n    const matrix: number[][] = []\n\n    for (let i = 0; i <= len2; i++) {\n        matrix[i] = [i]\n    }\n\n    for (let j = 0; j <= len1; j++) {\n        matrix[0][j] = j\n    }\n\n    for (let i = 1; i <= len2; i++) {\n        for (let j = 1; j <= len1; j++) {\n            if (s2.charAt(i - 1) === s1.charAt(j - 1)) {\n                matrix[i][j] = matrix[i - 1][j - 1]\n            } else {\n                matrix[i][j] = Math.min(\n                    matrix[i - 1][j - 1] + 1,\n                    matrix[i][j - 1] + 1,\n                    matrix[i - 1][j] + 1\n                )\n            }\n        }\n    }\n\n    const distance = matrix[len2][len1]\n    const maxLen = Math.max(len1, len2)\n    return Math.round(((maxLen - distance) / maxLen) * 100)\n}\n\n/**\n * GET /api/contacts/duplicates\n * Find potential duplicate contacts in the organization\n */\nexport async function GET(req: Request) {\n    try {\n        const supabase = await createClient()\n        const { data: { user } } = await supabase.auth.getUser()\n\n        if (!user) {\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n        }\n\n        const { data: profile } = await supabase\n            .from('profiles')\n            .select('tenant_id')\n            .eq('id', user.id)\n            .single()\n\n        if (!profile?.tenant_id) {\n            return NextResponse.json({ error: 'No organization found' }, { status: 400 })\n        }\n\n        // Fetch all contacts\n        const { data: contacts, error } = await supabase\n            .from('contacts')\n            .select('id, first_name, last_name, email, phone, company_name, is_company, created_at')\n            .eq('tenant_id', profile.tenant_id)\n            .order('created_at', { ascending: false })\n\n        if (error) throw error\n\n        if (!contacts || contacts.length === 0) {\n            return NextResponse.json({ duplicates: [] })\n        }\n\n        // Find duplicates\n        const duplicateGroups: DuplicateGroup[] = []\n        const processedIds = new Set<string>()\n\n        // 1. Exact email matches\n        const emailMap = new Map<string, typeof contacts>()\n        contacts.forEach((contact) => {\n            if (contact.email) {\n                const email = contact.email.toLowerCase().trim()\n                if (!emailMap.has(email)) {\n                    emailMap.set(email, [])\n                }\n                emailMap.get(email)!.push(contact)\n            }\n        })\n\n        emailMap.forEach((group, email) => {\n            if (group.length > 1) {\n                duplicateGroups.push({\n                    reason: 'exact_email',\n                    score: 100,\n                    contacts: group.map((c) => {\n                        processedIds.add(c.id)\n                        return {\n                            id: c.id,\n                            name: c.is_company\n                                ? c.company_name || 'Unnamed'\n                                : `${c.first_name || ''} ${c.last_name || ''}`.trim() || 'Unnamed',\n                            email: c.email || undefined,\n                            phone: c.phone || undefined,\n                            company: c.is_company ? undefined : c.company_name || undefined,\n                            createdAt: new Date(c.created_at),\n                        }\n                    }),\n                })\n            }\n        })\n\n        // 2. Exact phone matches (if both have phone)\n        const phoneMap = new Map<string, typeof contacts>()\n        contacts.forEach((contact) => {\n            if (contact.phone && !processedIds.has(contact.id)) {\n                const phone = contact.phone.replace(/\\D/g, '') // Remove non-digits\n                if (phone.length >= 9) {\n                    // Only match if substantial phone number\n                    if (!phoneMap.has(phone)) {\n                        phoneMap.set(phone, [])\n                    }\n                    phoneMap.get(phone)!.push(contact)\n                }\n            }\n        })\n\n        phoneMap.forEach((group) => {\n            if (group.length > 1) {\n                duplicateGroups.push({\n                    reason: 'exact_phone',\n                    score: 95,\n                    contacts: group.map((c) => {\n                        processedIds.add(c.id)\n                        return {\n                            id: c.id,\n                            name: c.is_company\n                                ? c.company_name || 'Unnamed'\n                                : `${c.first_name || ''} ${c.last_name || ''}`.trim() || 'Unnamed',\n                            email: c.email || undefined,\n                            phone: c.phone || undefined,\n                            company: c.is_company ? undefined : c.company_name || undefined,\n                            createdAt: new Date(c.created_at),\n                        }\n                    }),\n                })\n            }\n        })\n\n        // 3. Similar names (fuzzy matching)\n        // Compare each contact with others, skip already processed\n        const unprocessed = contacts.filter((c) => !processedIds.has(c.id))\n\n        for (let i = 0; i < unprocessed.length; i++) {\n            const contact1 = unprocessed[i]\n            const name1 = contact1.is_company\n                ? contact1.company_name || ''\n                : `${contact1.first_name || ''} ${contact1.last_name || ''}`.trim()\n\n            if (!name1) continue\n\n            const similarContacts = [contact1]\n\n            for (let j = i + 1; j < unprocessed.length; j++) {\n                const contact2 = unprocessed[j]\n                const name2 = contact2.is_company\n                    ? contact2.company_name || ''\n                    : `${contact2.first_name || ''} ${contact2.last_name || ''}`.trim()\n\n                if (!name2) continue\n\n                const similarity = calculateSimilarity(name1, name2)\n\n                // If names are very similar (>85%), consider duplicates\n                if (similarity >= 85) {\n                    similarContacts.push(contact2)\n                    processedIds.add(contact2.id)\n                }\n            }\n\n            if (similarContacts.length > 1) {\n                processedIds.add(contact1.id)\n                duplicateGroups.push({\n                    reason: 'similar_name',\n                    score: 85,\n                    contacts: similarContacts.map((c) => ({\n                        id: c.id,\n                        name: c.is_company\n                            ? c.company_name || 'Unnamed'\n                            : `${c.first_name || ''} ${c.last_name || ''}`.trim() || 'Unnamed',\n                        email: c.email || undefined,\n                        phone: c.phone || undefined,\n                        company: c.is_company ? undefined : c.company_name || undefined,\n                        createdAt: new Date(c.created_at),\n                    })),\n                })\n            }\n        }\n\n        // Sort by score (highest first)\n        duplicateGroups.sort((a, b) => b.score - a.score)\n\n        return NextResponse.json({\n            duplicates: duplicateGroups,\n            total: duplicateGroups.length,\n            contactsAffected: processedIds.size,\n        })\n    } catch (error: any) {\n        console.error('Duplicate detection error:', error)\n        return NextResponse.json(\n            { error: error.message || 'Failed to detect duplicates' },\n            { status: 500 }\n        )\n    }\n}\n\n/**\n * POST /api/contacts/duplicates/merge\n * Merge multiple contacts into one\n */\nexport async function POST(req: Request) {\n    try {\n        const supabase = await createClient()\n        const { data: { user } } = await supabase.auth.getUser()\n\n        if (!user) {\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n        }\n\n        const { primaryId, duplicateIds, mergedData } = await req.json()\n\n        if (!primaryId || !duplicateIds || duplicateIds.length === 0) {\n            return NextResponse.json(\n                { error: 'primaryId and duplicateIds are required' },\n                { status: 400 }\n            )\n        }\n\n        const { data: profile } = await supabase\n            .from('profiles')\n            .select('tenant_id')\n            .eq('id', user.id)\n            .single()\n\n        if (!profile?.tenant_id) {\n            return NextResponse.json({ error: 'No organization found' }, { status: 400 })\n        }\n\n        // Verify all contacts belong to the user's org\n        const { data: primaryContact } = await supabase\n            .from('contacts')\n            .select('tenant_id')\n            .eq('id', primaryId)\n            .single()\n\n        if (!primaryContact || primaryContact.tenant_id !== profile.tenant_id) {\n            return NextResponse.json({ error: 'Primary contact not found' }, { status: 404 })\n        }\n\n        // Update primary contact with merged data\n        if (mergedData) {\n            const { error: updateError } = await supabase\n                .from('contacts')\n                .update(mergedData)\n                .eq('id', primaryId)\n\n            if (updateError) throw updateError\n        }\n\n        // Delete duplicate contacts\n        const { error: deleteError } = await supabase\n            .from('contacts')\n            .delete()\n            .in('id', duplicateIds)\n            .eq('tenant_id', profile.tenant_id)\n\n        if (deleteError) throw deleteError\n\n        return NextResponse.json({\n            success: true,\n            primaryId,\n            mergedCount: duplicateIds.length,\n        })\n    } catch (error: any) {\n        console.error('Merge contacts error:', error)\n        return NextResponse.json(\n            { error: error.message || 'Failed to merge contacts' },\n            { status: 500 }\n        )\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/contacts/export/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1924,1927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1924,1927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1953,1956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1953,1956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3033,3036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3033,3036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4682,4685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4682,4685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport Papa from 'papaparse'\nimport * as XLSX from 'xlsx'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n\n    // Get authenticated user\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      )\n    }\n\n    // Get user's organization\n    const { data: profile, error: profileError } = await supabase\n      .from('profiles')\n      .select('tenant_id')\n      .eq('id', user.id)\n      .single()\n\n    if (profileError || !profile?.tenant_id) {\n      return NextResponse.json(\n        {\n          error: 'Organization not found',\n          details: 'Your user profile is not linked to an organization. Please try logging out and back in, or contact support.'\n        },\n        { status: 404 }\n      )\n    }\n\n    // Get query params\n    const { searchParams } = new URL(request.url)\n    const format = searchParams.get('format') || 'csv'\n    const fieldsParam = searchParams.get('fields') || 'name,email,phone,company,status,tags'\n    const fields = fieldsParam.split(',')\n\n    // Fetch all contacts for this organization\n    const { data: contacts, error: fetchError } = await supabase\n      .from('contacts')\n      .select('*')\n      .eq('tenant_id', profile.tenant_id)\n      .order('created_at', { ascending: false })\n\n    if (fetchError) {\n      return NextResponse.json(\n        { error: 'Failed to fetch contacts' },\n        { status: 500 }\n      )\n    }\n\n    // If no contacts, we'll still proceed to generate a file with headers only\n    const hasContacts = contacts && contacts.length > 0;\n\n    // Transform contacts based on selected fields\n    const exportData = hasContacts\n      ? contacts.map((contact: any) => {\n        const row: any = {}\n        if (fields.includes('name')) {\n          const name = contact.is_company\n            ? contact.company_name\n            : [contact.first_name, contact.last_name].filter(Boolean).join(' ')\n          row['Name'] = name || contact.email || 'Unknown'\n        }\n        if (fields.includes('email')) row['Email'] = contact.email || ''\n        if (fields.includes('phone')) row['Phone'] = contact.phone || ''\n        if (fields.includes('company')) row['Company'] = contact.is_company ? '' : (contact.company_name || '')\n        if (fields.includes('status')) row['Status'] = contact.status || 'lead'\n        if (fields.includes('tags')) row['Tags'] = Array.isArray(contact.tags) ? contact.tags.join(', ') : ''\n        if (fields.includes('createdAt')) {\n          row['Created Date'] = contact.created_at ? new Date(contact.created_at).toISOString().split('T')[0] : ''\n        }\n        return row\n      })\n      : []\n\n    // For PapaParse/XLSX to work correctly with empty data, we provide the columns\n    const columns = fields.map(field => {\n      const headerMap: any = {\n        'name': 'Name',\n        'email': 'Email',\n        'phone': 'Phone',\n        'company': 'Company',\n        'status': 'Status',\n        'tags': 'Tags',\n        'createdAt': 'Created Date'\n      }\n      return headerMap[field] || field\n    })\n\n    // Generate file based on format\n    if (format === 'csv') {\n      // Generate CSV\n      // Generate CSV\n      const csv = Papa.unparse({\n        fields: columns,\n        data: exportData\n      })\n      const filename = `contacts-export-${new Date().toISOString().split('T')[0]}.csv`\n\n      return new NextResponse(csv, {\n        headers: {\n          'Content-Type': 'text/csv',\n          'Content-Disposition': `attachment; filename=\"${filename}\"`,\n        },\n      })\n    } else if (format === 'xlsx') {\n      // Generate Excel\n      // Generate Excel\n      const worksheet = exportData.length > 0\n        ? XLSX.utils.json_to_sheet(exportData)\n        : XLSX.utils.aoa_to_sheet([columns])\n      const workbook = XLSX.utils.book_new()\n      XLSX.utils.book_append_sheet(workbook, worksheet, 'Contacts')\n\n      // Write to buffer\n      const buffer = XLSX.write(workbook, { type: 'buffer', bookType: 'xlsx' })\n      const filename = `contacts-export-${new Date().toISOString().split('T')[0]}.xlsx`\n\n      return new NextResponse(buffer, {\n        headers: {\n          'Content-Type': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n          'Content-Disposition': `attachment; filename=\"${filename}\"`,\n        },\n      })\n    } else {\n      return NextResponse.json(\n        { error: 'Unsupported format' },\n        { status: 400 }\n      )\n    }\n\n  } catch (error: any) {\n    console.error('Export error:', error)\n    return NextResponse.json(\n      {\n        error: 'Internal server error',\n        details: error.message\n      },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/contacts/import/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1279,1282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1279,1282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1309,1312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1309,1312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3969,3972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3969,3972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":195,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5515,5518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5515,5518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { validateContacts, ImportContactInput } from '@/lib/validation/contact-import'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n\n    // Get authenticated user\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      )\n    }\n\n    // Get user's organization\n    const { data: profile, error: profileError } = await supabase\n      .from('profiles')\n      .select('tenant_id')\n      .eq('id', user.id)\n      .single()\n\n    if (profileError || !profile?.tenant_id) {\n      return NextResponse.json(\n        { error: 'Organization not found' },\n        { status: 404 }\n      )\n    }\n\n    // Parse request body\n    const body = await request.json()\n    const { contacts, columnMapping } = body\n\n    if (!Array.isArray(contacts) || contacts.length === 0) {\n      return NextResponse.json(\n        { error: 'No contacts provided' },\n        { status: 400 }\n      )\n    }\n\n    // Transform contacts based on column mapping\n    const mappedContacts = contacts.map((row: any) => {\n      const mapped: any = {}\n      Object.entries(columnMapping).forEach(([sourceCol, targetField]) => {\n        if (targetField !== 'skip') {\n          mapped[targetField as string] = row[sourceCol]\n        }\n      })\n      return mapped\n    })\n\n    // Fetch existing emails to check for duplicates\n    const { data: existingContacts } = await supabase\n      .from('contacts')\n      .select('email')\n      .eq('tenant_id', profile.tenant_id)\n\n    const existingEmails = new Set(\n      (existingContacts || []).map(c => c.email?.toLowerCase()).filter(Boolean)\n    )\n\n    // Validate contacts\n    const validationResult = validateContacts(mappedContacts, existingEmails)\n\n    // If there are invalid contacts, return errors\n    if (validationResult.invalid.length > 0) {\n      return NextResponse.json({\n        success: false,\n        error: 'Validation failed',\n        details: {\n          valid: validationResult.valid.length,\n          invalid: validationResult.invalid.length,\n          duplicates: validationResult.duplicates.length,\n          errors: validationResult.invalid.map(inv => ({\n            row: inv.row,\n            errors: inv.errors.issues.map(err => ({\n              field: err.path.join('.'),\n              message: err.message\n            }))\n          }))\n        }\n      }, { status: 400 })\n    }\n\n    // Prepare contacts for insertion\n    const contactsToInsert = validationResult.valid.map((contact: ImportContactInput) => {\n      return {\n        tenant_id: profile.tenant_id,\n        first_name: contact.firstName,\n        last_name: contact.lastName,\n        email: contact.email,\n        phone: contact.phone,\n        company_name: contact.companyName,\n        is_company: !contact.firstName && !!contact.companyName,\n        status: contact.status,\n        tags: contact.tags || [],\n        notes: null,\n      }\n    })\n\n    // Batch insert contacts (Supabase handles this efficiently)\n    const { data: insertedContacts, error: insertError } = await supabase\n      .from('contacts')\n      .insert(contactsToInsert)\n      .select()\n\n    if (insertError) {\n      console.error('Insert error:', insertError)\n      return NextResponse.json(\n        {\n          error: 'Failed to import contacts',\n          details: insertError.message\n        },\n        { status: 500 }\n      )\n    }\n\n    // Return success with statistics\n    return NextResponse.json({\n      success: true,\n      imported: insertedContacts?.length || 0,\n      skipped: validationResult.duplicates.length,\n      duplicates: validationResult.duplicates.map(dup => ({\n        row: dup.row,\n        email: dup.email\n      })),\n      contacts: insertedContacts\n    })\n\n  } catch (error: any) {\n    console.error('Import error:', error)\n    return NextResponse.json(\n      {\n        error: 'Internal server error',\n        details: error.message\n      },\n      { status: 500 }\n    )\n  }\n}\n\n// GET endpoint to check for duplicates before import\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n\n    // Get authenticated user\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      )\n    }\n\n    // Get user's organization\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('tenant_id')\n      .eq('id', user.id)\n      .single()\n\n    if (!profile?.tenant_id) {\n      return NextResponse.json(\n        { error: 'Organization not found' },\n        { status: 404 }\n      )\n    }\n\n    // Get emails from query params\n    const { searchParams } = new URL(request.url)\n    const emailsParam = searchParams.get('emails')\n\n    if (!emailsParam) {\n      return NextResponse.json({ duplicates: [] })\n    }\n\n    const emails = emailsParam.split(',').map(e => e.trim().toLowerCase())\n\n    // Check for existing contacts\n    const { data: existingContacts } = await supabase\n      .from('contacts')\n      .select('id, email, first_name, last_name')\n      .eq('tenant_id', profile.tenant_id)\n      .in('email', emails)\n\n    return NextResponse.json({\n      duplicates: existingContacts || []\n    })\n\n  } catch (error: any) {\n    console.error('Duplicate check error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/documents/process/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/documents/search/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/documents/upload/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ext' is assigned a value but never used.","line":67,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":67,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'storageData' is assigned a value but never used.","line":73,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\nimport { type DocVisibility } from '@/lib/types/schema';\n\nexport const runtime = 'nodejs';\nexport const dynamic = 'force-dynamic';\n\nconst MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\n\nconst ALLOWED_MIME_TYPES = [\n  'application/pdf',\n  'text/plain',\n  'text/markdown',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document', // .docx\n];\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient();\n\n    // Check authentication\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n    if (authError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user's tenant_id\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('tenant_id')\n      .eq('id', user.id)\n      .single();\n\n    if (!profile?.tenant_id) {\n      return NextResponse.json({ error: 'No organization found' }, { status: 400 });\n    }\n\n    // Parse form data\n    const formData = await request.formData();\n    const file = formData.get('file') as File | null;\n    const visibility = (formData.get('visibility') as DocVisibility) || 'internal';\n    const projectId = formData.get('project_id') as string | null;\n    const contactId = formData.get('contact_id') as string | null;\n\n    if (!file) {\n      return NextResponse.json({ error: 'No file provided' }, { status: 400 });\n    }\n\n    // Validate file\n    if (file.size > MAX_FILE_SIZE) {\n      return NextResponse.json(\n        { error: `File too large. Maximum size is ${MAX_FILE_SIZE / (1024 * 1024)}MB` },\n        { status: 400 }\n      );\n    }\n\n    if (!ALLOWED_MIME_TYPES.includes(file.type)) {\n      return NextResponse.json(\n        { error: 'Invalid file type. Allowed: PDF, TXT, MD, DOCX' },\n        { status: 400 }\n      );\n    }\n\n    // Generate unique file path\n    const timestamp = Date.now();\n    const randomId = Math.random().toString(36).substring(2, 15);\n    const ext = file.name.split('.').pop();\n    const sanitizedName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');\n    const storagePath = `${profile.tenant_id}/${timestamp}-${randomId}-${sanitizedName}`;\n\n    // Upload to Supabase Storage\n    const fileBuffer = await file.arrayBuffer();\n    const { data: storageData, error: storageError } = await supabase.storage\n      .from('documents')\n      .upload(storagePath, fileBuffer, {\n        contentType: file.type,\n        upsert: false,\n      });\n\n    if (storageError) {\n      console.error('Storage upload error:', storageError);\n      return NextResponse.json(\n        { error: 'Failed to upload file to storage' },\n        { status: 500 }\n      );\n    }\n\n    // Create document record in database\n    const { data: document, error: dbError } = await supabase\n      .from('documents')\n      .insert([\n        {\n          tenant_id: profile.tenant_id,\n          project_id: projectId,\n          contact_id: contactId,\n          name: file.name,\n          file_path: storagePath,\n          file_type: file.type,\n          size_bytes: file.size,\n          visibility,\n          embedding_status: 'pending', // Will be processed by background job\n        },\n      ])\n      .select()\n      .single();\n\n    if (dbError) {\n      console.error('Database insert error:', dbError);\n\n      // Cleanup: delete uploaded file if DB insert fails\n      await supabase.storage.from('documents').remove([storagePath]);\n\n      return NextResponse.json(\n        { error: 'Failed to create document record' },\n        { status: 500 }\n      );\n    }\n\n    // TODO: Trigger background job to process document (extract text, chunk, embed)\n    // For now, we'll handle this in Task #2\n\n    return NextResponse.json({\n      success: true,\n      id: document.id,\n      name: document.name,\n      size: document.size_bytes,\n      path: document.file_path,\n    });\n  } catch (error) {\n    console.error('Upload error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/gdpr/delete/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6114,6117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6114,6117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":199,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":199,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":301,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9900,9903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9900,9903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * GDPR Data Deletion API\n *\n * Provides complete account deletion as required by GDPR Article 17\n * (Right to Erasure / \"Right to be Forgotten\")\n */\n\nimport { NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function POST(req: Request) {\n    try {\n        const supabase = await createClient()\n        const { data: { user } } = await supabase.auth.getUser()\n\n        if (!user) {\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n        }\n\n        const { confirmEmail } = await req.json()\n\n        // Safety check: User must confirm with their email\n        if (confirmEmail !== user.email) {\n            return NextResponse.json(\n                { error: 'Email confirmation does not match' },\n                { status: 400 }\n            )\n        }\n\n        // Get user profile\n        const { data: profile } = await supabase\n            .from('profiles')\n            .select('tenant_id, role')\n            .eq('id', user.id)\n            .single()\n\n        if (!profile) {\n            return NextResponse.json({ error: 'Profile not found' }, { status: 404 })\n        }\n\n        // If user is an org owner, prevent deletion if there are other members\n        if (profile.role === 'owner' && profile.tenant_id) {\n            const { data: orgMembers, error: membersError } = await supabase\n                .from('profiles')\n                .select('id')\n                .eq('tenant_id', profile.tenant_id)\n\n            if (membersError) throw membersError\n\n            if (orgMembers && orgMembers.length > 1) {\n                return NextResponse.json(\n                    {\n                        error: 'Cannot delete account. You are the owner of an organization with other members. Please transfer ownership or remove all members first.',\n                    },\n                    { status: 400 }\n                )\n            }\n        }\n\n        // Track what will be deleted\n        const deletionSummary = {\n            userId: user.id,\n            email: user.email,\n            deletedAt: new Date().toISOString(),\n            itemsDeleted: {\n                profile: 0,\n                conversations: 0,\n                messages: 0,\n                activityLog: 0,\n                notifications: 0,\n                tokenUsage: 0,\n            },\n        }\n\n        // Delete user-specific data (CASCADE will handle related records)\n\n        // 1. Delete AI conversations and messages\n        const { data: conversations } = await supabase\n            .from('ai_conversations')\n            .select('id')\n            .eq('user_id', user.id)\n\n        if (conversations) {\n            deletionSummary.itemsDeleted.conversations = conversations.length\n\n            for (const conv of conversations) {\n                const { data: messages } = await supabase\n                    .from('ai_messages')\n                    .select('id')\n                    .eq('conversation_id', conv.id)\n\n                if (messages) {\n                    deletionSummary.itemsDeleted.messages += messages.length\n                }\n            }\n\n            // Delete conversations (CASCADE deletes messages)\n            await supabase\n                .from('ai_conversations')\n                .delete()\n                .eq('user_id', user.id)\n        }\n\n        // 2. Delete activity log entries\n        const { data: activities } = await supabase\n            .from('activity_log')\n            .select('id')\n            .eq('user_id', user.id)\n\n        if (activities) {\n            deletionSummary.itemsDeleted.activityLog = activities.length\n\n            await supabase\n                .from('activity_log')\n                .delete()\n                .eq('user_id', user.id)\n        }\n\n        // 3. Delete notifications\n        const { data: notifications } = await supabase\n            .from('notifications')\n            .select('id')\n            .eq('user_id', user.id)\n\n        if (notifications) {\n            deletionSummary.itemsDeleted.notifications = notifications.length\n\n            await supabase\n                .from('notifications')\n                .delete()\n                .eq('user_id', user.id)\n        }\n\n        // 4. Delete token usage records\n        const { data: tokenUsage } = await supabase\n            .from('token_usage')\n            .select('id')\n            .eq('user_id', user.id)\n\n        if (tokenUsage) {\n            deletionSummary.itemsDeleted.tokenUsage = tokenUsage.length\n\n            await supabase\n                .from('token_usage')\n                .delete()\n                .eq('user_id', user.id)\n        }\n\n        // 5. If user is the last/only member of the org, delete the org and all its data\n        if (profile.tenant_id) {\n            const { data: orgMembers } = await supabase\n                .from('profiles')\n                .select('id')\n                .eq('tenant_id', profile.tenant_id)\n\n            // If this is the only member, delete the organization (CASCADE deletes everything)\n            if (orgMembers && orgMembers.length === 1) {\n                await supabase\n                    .from('organizations')\n                    .delete()\n                    .eq('id', profile.tenant_id)\n            }\n        }\n\n        // 6. Delete profile\n        await supabase\n            .from('profiles')\n            .delete()\n            .eq('id', user.id)\n\n        deletionSummary.itemsDeleted.profile = 1\n\n        // 7. Delete auth user (this is the final step)\n        // Note: This requires admin privileges. In production, this should be done\n        // via a server-side admin SDK or by calling Supabase Admin API\n\n        // For now, we'll log out the user and return the deletion summary\n        // The actual auth user deletion should be handled by an admin process\n\n        return NextResponse.json({\n            success: true,\n            message: 'Your data has been permanently deleted.',\n            summary: deletionSummary,\n            note: 'Your account will be fully removed within 24 hours. You have been logged out.',\n        })\n    } catch (error: any) {\n        console.error('GDPR deletion error:', error)\n        return NextResponse.json(\n            { error: error.message || 'Failed to delete account' },\n            { status: 500 }\n        )\n    }\n}\n\n/**\n * GET /api/gdpr/delete/preview\n * Preview what data will be deleted (without actually deleting)\n */\nexport async function GET(req: Request) {\n    try {\n        const supabase = await createClient()\n        const { data: { user } } = await supabase.auth.getUser()\n\n        if (!user) {\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n        }\n\n        // Get user profile\n        const { data: profile } = await supabase\n            .from('profiles')\n            .select('tenant_id, role')\n            .eq('id', user.id)\n            .single()\n\n        if (!profile) {\n            return NextResponse.json({ error: 'Profile not found' }, { status: 404 })\n        }\n\n        // Count what will be deleted\n        const preview = {\n            userId: user.id,\n            email: user.email,\n            role: profile.role,\n            itemsToDelete: {\n                profile: 1,\n                conversations: 0,\n                messages: 0,\n                activityLog: 0,\n                notifications: 0,\n                tokenUsage: 0,\n            },\n            warnings: [] as string[],\n        }\n\n        // Count conversations\n        const { data: conversations } = await supabase\n            .from('ai_conversations')\n            .select('id')\n            .eq('user_id', user.id)\n\n        if (conversations) {\n            preview.itemsToDelete.conversations = conversations.length\n\n            let messageCount = 0\n            for (const conv of conversations) {\n                const { data: messages } = await supabase\n                    .from('ai_messages')\n                    .select('id')\n                    .eq('conversation_id', conv.id)\n\n                if (messages) {\n                    messageCount += messages.length\n                }\n            }\n            preview.itemsToDelete.messages = messageCount\n        }\n\n        // Count activity log\n        const { count: activityCount } = await supabase\n            .from('activity_log')\n            .select('*', { count: 'exact', head: true })\n            .eq('user_id', user.id)\n\n        preview.itemsToDelete.activityLog = activityCount || 0\n\n        // Count notifications\n        const { count: notificationCount } = await supabase\n            .from('notifications')\n            .select('*', { count: 'exact', head: true })\n            .eq('user_id', user.id)\n\n        preview.itemsToDelete.notifications = notificationCount || 0\n\n        // Count token usage\n        const { count: tokenCount } = await supabase\n            .from('token_usage')\n            .select('*', { count: 'exact', head: true })\n            .eq('user_id', user.id)\n\n        preview.itemsToDelete.tokenUsage = tokenCount || 0\n\n        // Check if user is org owner with other members\n        if (profile.role === 'owner' && profile.tenant_id) {\n            const { data: orgMembers } = await supabase\n                .from('profiles')\n                .select('id')\n                .eq('tenant_id', profile.tenant_id)\n\n            if (orgMembers && orgMembers.length > 1) {\n                preview.warnings.push(\n                    'You are the owner of an organization with other members. Transfer ownership or remove all members before deleting your account.'\n                )\n            } else {\n                preview.warnings.push(\n                    'Deleting your account will also delete your organization and all associated data (contacts, projects, tasks, invoices).'\n                )\n            }\n        }\n\n        return NextResponse.json(preview)\n    } catch (error: any) {\n        console.error('GDPR deletion preview error:', error)\n        return NextResponse.json(\n            { error: error.message || 'Failed to preview deletion' },\n            { status: 500 }\n        )\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/gdpr/export/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":11,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[940,943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[940,943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4604,4607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4604,4607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * GDPR Data Export API\n *\n * Provides complete account data export as required by GDPR Article 20\n * (Right to Data Portability)\n */\n\nimport { NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(req: Request) {\n    try {\n        const supabase = await createClient()\n        const { data: { user } } = await supabase.auth.getUser()\n\n        if (!user) {\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n        }\n\n        // Get user profile and organization\n        const { data: profile } = await supabase\n            .from('profiles')\n            .select('*')\n            .eq('id', user.id)\n            .single()\n\n        if (!profile) {\n            return NextResponse.json({ error: 'Profile not found' }, { status: 404 })\n        }\n\n        const tenantId = profile.tenant_id\n\n        // Collect all user data\n        const exportData: any = {\n            exportDate: new Date().toISOString(),\n            user: {\n                id: user.id,\n                email: user.email,\n                createdAt: user.created_at,\n            },\n            profile: {\n                firstName: profile.first_name,\n                lastName: profile.last_name,\n                role: profile.role,\n                avatarUrl: profile.avatar_url,\n            },\n            organization: null,\n            contacts: [],\n            projects: [],\n            tasks: [],\n            invoices: [],\n            aiConversations: [],\n            activityLog: [],\n            notifications: [],\n        }\n\n        // Get organization data\n        if (tenantId) {\n            const { data: org } = await supabase\n                .from('organizations')\n                .select('*')\n                .eq('id', tenantId)\n                .single()\n\n            if (org) {\n                exportData.organization = {\n                    id: org.id,\n                    name: org.name,\n                    createdAt: org.created_at,\n                }\n            }\n\n            // Get contacts\n            const { data: contacts } = await supabase\n                .from('contacts')\n                .select('*')\n                .eq('tenant_id', tenantId)\n\n            exportData.contacts = contacts || []\n\n            // Get projects\n            const { data: projects } = await supabase\n                .from('projects')\n                .select('*')\n                .eq('tenant_id', tenantId)\n\n            exportData.projects = projects || []\n\n            // Get tasks\n            const { data: tasks } = await supabase\n                .from('tasks')\n                .select('*')\n                .eq('tenant_id', tenantId)\n\n            exportData.tasks = tasks || []\n\n            // Get invoices\n            const { data: invoices } = await supabase\n                .from('invoices')\n                .select('*')\n                .eq('tenant_id', tenantId)\n\n            exportData.invoices = invoices || []\n\n            // Get AI conversations\n            const { data: conversations } = await supabase\n                .from('ai_conversations')\n                .select(`\n                    *,\n                    ai_messages (*)\n                `)\n                .eq('user_id', user.id)\n\n            exportData.aiConversations = conversations || []\n\n            // Get activity log\n            const { data: activityLog } = await supabase\n                .from('activity_log')\n                .select('*')\n                .eq('user_id', user.id)\n                .order('created_at', { ascending: false })\n                .limit(1000) // Limit to last 1000 activities\n\n            exportData.activityLog = activityLog || []\n\n            // Get notifications\n            const { data: notifications } = await supabase\n                .from('notifications')\n                .select('*')\n                .eq('user_id', user.id)\n                .order('created_at', { ascending: false })\n\n            exportData.notifications = notifications || []\n        }\n\n        // Create filename with timestamp\n        const filename = `orbit-crm-data-export-${user.id.slice(0, 8)}-${new Date().toISOString().split('T')[0]}.json`\n\n        // Return as downloadable JSON\n        return new NextResponse(JSON.stringify(exportData, null, 2), {\n            headers: {\n                'Content-Type': 'application/json',\n                'Content-Disposition': `attachment; filename=\"${filename}\"`,\n                'X-Export-Date': new Date().toISOString(),\n                'X-Export-Format': 'JSON',\n            },\n        })\n    } catch (error: any) {\n        console.error('GDPR export error:', error)\n        return NextResponse.json(\n            { error: error.message || 'Failed to export data' },\n            { status: 500 }\n        )\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/invoices/[id]/download/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'profile' is assigned a value but never used.","line":41,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1784,1787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1784,1787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { createClient } from '@/lib/supabase/server';\nimport { generateInvoicePDF } from '@/lib/invoices/pdf-generator';\nimport type { InvoiceWithLineItems } from '@/stores/invoice-store';\n\nexport async function GET(request: Request, { params }: { params: Promise<{ id: string }> }) {\n    const { id } = await params;\n    const supabase = await createClient();\n\n    // 1. Fetch Invoice Data with Lines & Contact\n    const { data: invoice, error } = await supabase\n        .from('invoices')\n        .select(`\n        *,\n        contacts (\n            id, first_name, last_name, company_name, is_company, email, \n            phone, address_line1, address_line2, city, state, postal_code, country\n        )\n    `)\n        .eq('id', id)\n        .single();\n\n    if (error || !invoice) {\n        return new Response('Invoice not found', { status: 404 });\n    }\n\n    // 2. Fetch Line Items\n    const { data: lineItems } = await supabase\n        .from('invoice_line_items')\n        .select('*')\n        .eq('invoice_id', id)\n        .order('sort_order', { ascending: true });\n\n    const fullInvoice: InvoiceWithLineItems = {\n        ...invoice,\n        contact: invoice.contacts,\n        line_items: lineItems || [],\n    };\n\n    // 3. Fetch Organization Settings (for branding/IBAN)\n    const { data: profile } = await supabase.auth.getUser();\n    // Assuming the user requesting is authorized or we check tenant_id\n\n    // Security check: Ensure user belongs to the same tenant as invoice\n    // (Simplified for now, assuming RLS handles basic access, but for API generation we need settings)\n\n    const { data: org } = await supabase\n        .from('organizations')\n        .select('settings')\n        .eq('id', invoice.tenant_id)\n        .single();\n\n    const settings = (org?.settings as any) || {};\n\n    try {\n        // 4. Generate PDF\n        const pdfBuffer = await generateInvoicePDF(fullInvoice, settings);\n\n        // 5. Return Response\n        return new Response(pdfBuffer as unknown as BodyInit, {\n            headers: {\n                'Content-Type': 'application/pdf',\n                'Content-Disposition': `attachment; filename=\"${invoice.invoice_number}.pdf\"`,\n            },\n        });\n    } catch (err) {\n        console.error('PDF Generation Error:', err);\n        return new Response('Failed to generate PDF', { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/invoices/[id]/payment-link/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2018,2021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2018,2021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3086,3089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3086,3089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Invoice Payment Link API\n * \n * POST /api/invoices/:id/payment-link\n * Creates a Stripe payment link for the invoice\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\nimport { StripeService } from '@/lib/services/stripe-service';\nimport { InvoiceService } from '@/lib/services/invoice-service';\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id: invoiceId } = await params;\n    \n    // Check if Stripe is configured\n    if (!StripeService.isConfigured()) {\n      return NextResponse.json(\n        { error: 'Stripe is not configured. Please add STRIPE_SECRET_KEY to your environment.' },\n        { status: 503 }\n      );\n    }\n\n    // Get the invoice\n    const supabase = await createClient();\n    const { data: invoice, error } = await supabase\n      .from('invoices')\n      .select('*')\n      .eq('id', invoiceId)\n      .single();\n\n    if (error || !invoice) {\n      return NextResponse.json(\n        { error: 'Invoice not found' },\n        { status: 404 }\n      );\n    }\n\n    // Check if invoice can receive payment\n    if (invoice.status === 'paid') {\n      return NextResponse.json(\n        { error: 'Invoice is already paid' },\n        { status: 400 }\n      );\n    }\n\n    if (invoice.status === 'cancelled') {\n      return NextResponse.json(\n        { error: 'Invoice is cancelled' },\n        { status: 400 }\n      );\n    }\n\n    // Check if we already have a payment link\n    if (invoice.stripe_payment_link) {\n      return NextResponse.json({\n        payment_link: invoice.stripe_payment_link,\n        cached: true,\n      });\n    }\n\n    // Create new payment link\n    const paymentLink = await StripeService.createPaymentLink(invoice);\n\n    // Save the payment link to the invoice\n    await InvoiceService.setPaymentLink(invoiceId, paymentLink);\n\n    return NextResponse.json({\n      payment_link: paymentLink,\n      cached: false,\n    });\n\n  } catch (error: any) {\n    console.error('Payment link creation error:', error);\n    return NextResponse.json(\n      { error: error.message || 'Failed to create payment link' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id: invoiceId } = await params;\n    \n    // Get the invoice's existing payment link\n    const supabase = await createClient();\n    const { data: invoice, error } = await supabase\n      .from('invoices')\n      .select('stripe_payment_link, status')\n      .eq('id', invoiceId)\n      .single();\n\n    if (error || !invoice) {\n      return NextResponse.json(\n        { error: 'Invoice not found' },\n        { status: 404 }\n      );\n    }\n\n    if (!invoice.stripe_payment_link) {\n      return NextResponse.json(\n        { error: 'No payment link exists for this invoice' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({\n      payment_link: invoice.stripe_payment_link,\n      status: invoice.status,\n    });\n\n  } catch (error: any) {\n    console.error('Get payment link error:', error);\n    return NextResponse.json(\n      { error: error.message || 'Failed to get payment link' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/notifications/check-triggers/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FollowUpReminderEmail' is defined but never used.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":24,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FollowUpReminderEmail"},"fix":{"range":[426,451],"text":""},"desc":"Remove unused variable \"FollowUpReminderEmail\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used.","line":20,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":277,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9016,9019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9016,9019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * POST /api/notifications/check-triggers\n * Check for conditions that should trigger notifications\n *\n * Called by:\n * - Cron job (daily at 9am)\n * - Manual trigger from admin\n * - Background worker\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\nimport { sendEmail } from '@/lib/email/resend-client';\nimport {\n  OverdueInvoiceEmail,\n  TaskReminderEmail,\n  FollowUpReminderEmail,\n} from '@/lib/email/notification-templates';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient();\n\n    // Get all organizations\n    const { data: orgs, error: orgsError } = await supabase\n      .from('organizations')\n      .select('id, name');\n\n    if (orgsError) throw orgsError;\n\n    const results = {\n      invoices_checked: 0,\n      tasks_checked: 0,\n      contacts_checked: 0,\n      notifications_created: 0,\n      emails_sent: 0,\n    };\n\n    for (const org of orgs || []) {\n      // Get org users who want notifications\n      const { data: users } = await supabase\n        .from('profiles')\n        .select('id, email, full_name')\n        .eq('tenant_id', org.id);\n\n      if (!users || users.length === 0) continue;\n\n      // 1. CHECK OVERDUE INVOICES\n      const { data: overdueInvoices } = await supabase\n        .from('invoices')\n        .select('id, invoice_number, total, due_date, contact_id, contacts(name, email)')\n        .eq('tenant_id', org.id)\n        .in('status', ['sent', 'overdue'])\n        .lt('due_date', new Date().toISOString())\n        .is('notified_overdue', false);\n\n      results.invoices_checked += overdueInvoices?.length || 0;\n\n      for (const invoice of overdueInvoices || []) {\n        for (const user of users) {\n          // Check user preferences\n          const { data: prefs } = await supabase\n            .from('notification_preferences')\n            .select('notify_invoice_overdue, enable_email')\n            .eq('user_id', user.id)\n            .single();\n\n          if (!prefs?.notify_invoice_overdue) continue;\n\n          const daysOverdue = Math.floor(\n            (new Date().getTime() - new Date(invoice.due_date).getTime()) /\n              (1000 * 60 * 60 * 24)\n          );\n\n          // Create notification\n          const { error: notifError } = await supabase.rpc('create_notification', {\n            p_tenant_id: org.id,\n            p_user_id: user.id,\n            p_type: 'invoice_overdue',\n            p_title: `Invoice #${invoice.invoice_number} is overdue`,\n            p_message: `Invoice for ${invoice.contacts?.name || 'customer'} is ${daysOverdue} days overdue (CHF ${invoice.total})`,\n            p_priority: daysOverdue > 30 ? 'high' : 'medium',\n            p_related_id: invoice.id,\n            p_related_type: 'invoice',\n            p_action_url: `/admin/invoices/${invoice.id}`,\n          });\n\n          if (!notifError) {\n            results.notifications_created++;\n\n            // Send email if enabled\n            if (prefs.enable_email) {\n              const emailHtml = OverdueInvoiceEmail({\n                userName: user.full_name || user.email,\n                invoiceNumber: invoice.invoice_number,\n                customerName: invoice.contacts?.name || 'Customer',\n                amount: invoice.total,\n                daysOverdue,\n                invoiceUrl: `${process.env.NEXT_PUBLIC_APP_URL}/admin/invoices/${invoice.id}`,\n              });\n\n              await sendEmail({\n                to: user.email,\n                subject: `Invoice #${invoice.invoice_number} is ${daysOverdue} days overdue`,\n                html: emailHtml,\n              });\n\n              results.emails_sent++;\n            }\n          }\n        }\n\n        // Mark invoice as notified\n        await supabase\n          .from('invoices')\n          .update({ notified_overdue: true })\n          .eq('id', invoice.id);\n      }\n\n      // 2. CHECK TASKS DUE SOON (next 24 hours)\n      const tomorrow = new Date();\n      tomorrow.setDate(tomorrow.getDate() + 1);\n\n      const { data: dueTasks } = await supabase\n        .from('tasks')\n        .select('id, title, due_date, contact_id, contacts(name)')\n        .eq('tenant_id', org.id)\n        .eq('status', 'todo')\n        .gte('due_date', new Date().toISOString())\n        .lte('due_date', tomorrow.toISOString())\n        .is('notified_due_soon', false);\n\n      results.tasks_checked += dueTasks?.length || 0;\n\n      for (const task of dueTasks || []) {\n        for (const user of users) {\n          const { data: prefs } = await supabase\n            .from('notification_preferences')\n            .select('notify_task_due, enable_email')\n            .eq('user_id', user.id)\n            .single();\n\n          if (!prefs?.notify_task_due) continue;\n\n          const { error: notifError } = await supabase.rpc('create_notification', {\n            p_tenant_id: org.id,\n            p_user_id: user.id,\n            p_type: 'task_due_soon',\n            p_title: 'Task due tomorrow',\n            p_message: `\"${task.title}\" is due tomorrow`,\n            p_priority: 'medium',\n            p_related_id: task.id,\n            p_related_type: 'task',\n            p_action_url: `/admin/tasks/${task.id}`,\n          });\n\n          if (!notifError) {\n            results.notifications_created++;\n\n            if (prefs.enable_email) {\n              const emailHtml = TaskReminderEmail({\n                userName: user.full_name || user.email,\n                taskTitle: task.title,\n                dueDate: new Date(task.due_date),\n                contactName: task.contacts?.name,\n                taskUrl: `${process.env.NEXT_PUBLIC_APP_URL}/admin/tasks/${task.id}`,\n              });\n\n              await sendEmail({\n                to: user.email,\n                subject: `Task reminder: \"${task.title}\" due tomorrow`,\n                html: emailHtml,\n              });\n\n              results.emails_sent++;\n            }\n          }\n        }\n\n        await supabase\n          .from('tasks')\n          .update({ notified_due_soon: true })\n          .eq('id', task.id);\n      }\n\n      // 3. CHECK OVERDUE TASKS\n      const { data: overdueTasks } = await supabase\n        .from('tasks')\n        .select('id, title, due_date, contact_id, contacts(name)')\n        .eq('tenant_id', org.id)\n        .neq('status', 'done')\n        .lt('due_date', new Date().toISOString())\n        .is('notified_overdue', false);\n\n      for (const task of overdueTasks || []) {\n        for (const user of users) {\n          const { data: prefs } = await supabase\n            .from('notification_preferences')\n            .select('notify_task_overdue, enable_email')\n            .eq('user_id', user.id)\n            .single();\n\n          if (!prefs?.notify_task_overdue) continue;\n\n          await supabase.rpc('create_notification', {\n            p_tenant_id: org.id,\n            p_user_id: user.id,\n            p_type: 'task_overdue',\n            p_title: 'Task is overdue',\n            p_message: `\"${task.title}\" is overdue`,\n            p_priority: 'high',\n            p_related_id: task.id,\n            p_related_type: 'task',\n            p_action_url: `/admin/tasks/${task.id}`,\n          });\n\n          results.notifications_created++;\n        }\n\n        await supabase\n          .from('tasks')\n          .update({ notified_overdue: true })\n          .eq('id', task.id);\n      }\n\n      // 4. CHECK CONTACTS NEEDING FOLLOW-UP (no activity in 30 days)\n      const thirtyDaysAgo = new Date();\n      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n      const { data: inactiveContacts } = await supabase\n        .from('contacts')\n        .select('id, name, email, status')\n        .eq('tenant_id', org.id)\n        .eq('status', 'lead')\n        .lt('updated_at', thirtyDaysAgo.toISOString())\n        .is('notified_follow_up', false);\n\n      results.contacts_checked += inactiveContacts?.length || 0;\n\n      for (const contact of inactiveContacts || []) {\n        for (const user of users) {\n          const { data: prefs } = await supabase\n            .from('notification_preferences')\n            .select('notify_follow_up')\n            .eq('user_id', user.id)\n            .single();\n\n          if (!prefs?.notify_follow_up) continue;\n\n          await supabase.rpc('create_notification', {\n            p_tenant_id: org.id,\n            p_user_id: user.id,\n            p_type: 'follow_up_reminder',\n            p_title: 'Follow up needed',\n            p_message: `${contact.name} has had no activity in 30 days`,\n            p_priority: 'low',\n            p_related_id: contact.id,\n            p_related_type: 'contact',\n            p_action_url: `/admin/contacts/${contact.id}`,\n          });\n\n          results.notifications_created++;\n        }\n\n        await supabase\n          .from('contacts')\n          .update({ notified_follow_up: true })\n          .eq('id', contact.id);\n      }\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Notification check complete',\n      results,\n    });\n  } catch (error: any) {\n    console.error('Notification trigger error:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to check notification triggers',\n        details: error.message,\n      },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/portal/documents/[id]/download/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/portal/invite/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/portal/invoices/[id]/download/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2271,2274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2271,2274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * GET /api/portal/invoices/[id]/download\n * Download invoice PDF from client portal\n * Uses portal session authentication (not Supabase auth)\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\nimport { generateInvoicePDF } from '@/lib/invoices/pdf-generator';\nimport type { InvoiceWithLineItems } from '@/stores/invoice-store';\nimport { getPortalSession } from '@/lib/portal/session';\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const supabase = await createClient();\n    const invoiceId = params.id;\n\n    // Get portal session (verify client is authenticated)\n    const session = await getPortalSession();\n    if (!session) {\n      return NextResponse.json(\n        { error: 'Unauthorized - Portal session required' },\n        { status: 401 }\n      );\n    }\n\n    // Fetch invoice with contact and line items\n    const { data: invoice, error } = await supabase\n      .from('invoices')\n      .select(\n        `\n        *,\n        contacts (\n            id, name, email, phone, company,\n            address_line1, address_line2, city, state, postal_code, country\n        )\n    `\n      )\n      .eq('id', invoiceId)\n      .single();\n\n    if (error || !invoice) {\n      return NextResponse.json(\n        { error: 'Invoice not found' },\n        { status: 404 }\n      );\n    }\n\n    // Security check: Verify invoice belongs to this portal contact\n    if (invoice.contact_id !== session.contact_id) {\n      return NextResponse.json(\n        { error: 'Unauthorized - This invoice does not belong to you' },\n        { status: 403 }\n      );\n    }\n\n    // Fetch line items\n    const { data: lineItems } = await supabase\n      .from('invoice_line_items')\n      .select('*')\n      .eq('invoice_id', invoiceId)\n      .order('sort_order', { ascending: true });\n\n    const fullInvoice: InvoiceWithLineItems = {\n      ...invoice,\n      contact: invoice.contacts,\n      line_items: lineItems || [],\n    };\n\n    // Fetch organization settings for branding/IBAN\n    const { data: org } = await supabase\n      .from('organizations')\n      .select('settings, name')\n      .eq('id', invoice.tenant_id)\n      .single();\n\n    const settings = (org?.settings as any) || {};\n\n    // Generate PDF\n    const pdfBuffer = await generateInvoicePDF(fullInvoice, settings);\n\n    // Return PDF\n    return new Response(pdfBuffer as unknown as BodyInit, {\n      headers: {\n        'Content-Type': 'application/pdf',\n        'Content-Disposition': `attachment; filename=\"Invoice-${invoice.invoice_number || invoiceId.slice(0, 8)}.pdf\"`,\n      },\n    });\n  } catch (error) {\n    console.error('Portal invoice download error:', error);\n    return NextResponse.json(\n      { error: 'Failed to generate PDF' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/portal/logout/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/portal/toggle/route.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'updateData' is never reassigned. Use 'const' instead.","line":33,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":33,"endColumn":24,"fix":{"range":[881,942],"text":"const updateData: any = {\n      portal_enabled: enabled,\n    };"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[897,900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[897,900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\n * POST /api/portal/toggle\n * Enable or disable portal access for a contact\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient();\n    const { contactId, enabled } = await request.json();\n\n    // Validate input\n    if (!contactId || typeof enabled !== 'boolean') {\n      return NextResponse.json(\n        { error: 'Missing required fields: contactId, enabled' },\n        { status: 400 }\n      );\n    }\n\n    // Get current user\n    const {\n      data: { user },\n      error: authError,\n    } = await supabase.auth.getUser();\n\n    if (authError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // If enabling portal, generate a portal token if it doesn't exist\n    let updateData: any = {\n      portal_enabled: enabled,\n    };\n\n    if (enabled) {\n      // Check if contact already has a portal_token\n      const { data: contact } = await supabase\n        .from('contacts')\n        .select('portal_token')\n        .eq('id', contactId)\n        .single();\n\n      // If no token exists, generate one using the database function\n      if (!contact?.portal_token) {\n        const { data: tokenData } = await supabase.rpc('generate_portal_token');\n        if (tokenData) {\n          updateData.portal_token = tokenData;\n        }\n      }\n    }\n\n    // Update contact\n    const { data, error } = await supabase\n      .from('contacts')\n      .update(updateData)\n      .eq('id', contactId)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Failed to update contact:', error);\n      return NextResponse.json(\n        { error: 'Failed to update portal access' },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      portal_enabled: data.portal_enabled,\n      portal_token: data.portal_token,\n    });\n  } catch (error) {\n    console.error('Portal toggle error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/portal/verify/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/trpc/[trpc]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/api/webhooks/stripe/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1349,1352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1349,1352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3493,3496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3493,3496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Stripe Webhook Handler\n * \n * Handles Stripe webhook events for payment processing.\n * \n * Events handled:\n * - checkout.session.completed: Mark invoice as paid\n * - checkout.session.expired: Payment link expired (optional handling)\n * \n * SETUP:\n * 1. Configure webhook endpoint in Stripe Dashboard\n * 2. Set STRIPE_WEBHOOK_SECRET in .env.local\n * 3. For local testing: stripe listen --forward-to localhost:3000/api/webhooks/stripe\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { StripeService } from '@/lib/services/stripe-service';\nimport { InvoiceService } from '@/lib/services/invoice-service';\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Check if Stripe is configured\n    if (!StripeService.isConfigured()) {\n      return NextResponse.json(\n        { error: 'Stripe is not configured' },\n        { status: 500 }\n      );\n    }\n\n    // Get the raw body for signature verification\n    const payload = await request.text();\n    const signature = request.headers.get('stripe-signature');\n\n    if (!signature) {\n      return NextResponse.json(\n        { error: 'Missing stripe-signature header' },\n        { status: 400 }\n      );\n    }\n\n    // Verify the webhook signature\n    let event;\n    try {\n      event = await StripeService.verifyWebhookSignature(payload, signature);\n    } catch (err: any) {\n      console.error('Webhook signature verification failed:', err.message);\n      return NextResponse.json(\n        { error: `Webhook Error: ${err.message}` },\n        { status: 400 }\n      );\n    }\n\n    // Handle the event\n    switch (event.type) {\n      case 'checkout.session.completed': {\n        const session = event.data.object;\n        \n        // Extract invoice ID from metadata\n        const invoiceId = session.metadata?.invoice_id;\n        \n        if (!invoiceId) {\n          console.warn('Checkout session completed without invoice_id in metadata');\n          break;\n        }\n\n        // Mark the invoice as paid\n        try {\n          await InvoiceService.markAsPaid(invoiceId, session.id);\n          console.log(`Invoice ${invoiceId} marked as paid via Stripe session ${session.id}`);\n        } catch (error) {\n          console.error(`Failed to mark invoice ${invoiceId} as paid:`, error);\n          // Don't return error - Stripe will retry on 5xx\n        }\n        \n        break;\n      }\n\n      case 'checkout.session.expired': {\n        // Optional: Handle expired sessions\n        const session = event.data.object;\n        const invoiceId = session.metadata?.invoice_id;\n        \n        if (invoiceId) {\n          console.log(`Payment session expired for invoice ${invoiceId}`);\n          // Could update invoice status or send notification\n        }\n        \n        break;\n      }\n\n      case 'payment_intent.succeeded': {\n        // Handle direct payment intent success (alternative to checkout.session.completed)\n        const paymentIntent = event.data.object;\n        console.log(`Payment intent succeeded: ${paymentIntent.id}`);\n        break;\n      }\n\n      case 'payment_intent.payment_failed': {\n        // Handle payment failure\n        const paymentIntent = event.data.object;\n        console.log(`Payment failed: ${paymentIntent.id}`);\n        break;\n      }\n\n      default:\n        // Log unhandled event types for debugging\n        console.log(`Unhandled event type: ${event.type}`);\n    }\n\n    // Return success response\n    return NextResponse.json({ received: true });\n    \n  } catch (error: any) {\n    console.error('Webhook error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n// Stripe sends POST requests\nexport async function GET() {\n  return NextResponse.json(\n    { message: 'Stripe webhook endpoint. Use POST for webhook events.' },\n    { status: 200 }\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/auth/callback/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx","messages":[{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:38:9\n  36 |       // Invalid or expired token\n  37 |       return (\n> 38 |         <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n     |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 39 |           <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 40 |             <div className=\"mb-4\">\n     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 67 |           </div>\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 68 |         </div>\n     | ^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  69 |       );\n  70 |     }\n  71 |","line":38,"column":9,"nodeType":null,"endLine":68,"endColumn":15},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:39:11\n  37 |       return (\n  38 |         <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n> 39 |           <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n     |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 40 |             <div className=\"mb-4\">\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 41 |               <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4\">\n     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 66 |             </div>\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 67 |           </div>\n     | ^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  68 |         </div>\n  69 |       );\n  70 |     }","line":39,"column":11,"nodeType":null,"endLine":67,"endColumn":17},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:40:13\n  38 |         <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n  39 |           <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n> 40 |             <div className=\"mb-4\">\n     |             ^^^^^^^^^^^^^^^^^^^^^^\n> 41 |               <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4\">\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |                 <svg\n     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 65 |               </p>\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 66 |             </div>\n     | ^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  67 |           </div>\n  68 |         </div>\n  69 |       );","line":40,"column":13,"nodeType":null,"endLine":66,"endColumn":19},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:41:15\n  39 |           <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n  40 |             <div className=\"mb-4\">\n> 41 |               <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4\">\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 42 |                 <svg\n     | ^^^^^^^^^^^^^^^^^^^^\n> 43 |                   className=\"w-8 h-8 text-red-600\"\n     \n     | ^^^^^^^^^^^^^^^^^^^^\n> 54 |                 </svg>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 55 |               </div>\n     | ^^^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  56 |               <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">\n  57 |                 Invalid or Expired Link\n  58 |               </h1>","line":41,"column":15,"nodeType":null,"endLine":55,"endColumn":21},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:42:17\n  40 |             <div className=\"mb-4\">\n  41 |               <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4\">\n> 42 |                 <svg\n     |                 ^^^^\n> 43 |                   className=\"w-8 h-8 text-red-600\"\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 44 |                   fill=\"none\"\n     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 53 |                   />\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 54 |                 </svg>\n     | ^^^^^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  55 |               </div>\n  56 |               <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">\n  57 |                 Invalid or Expired Link","line":42,"column":17,"nodeType":null,"endLine":54,"endColumn":23},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:48:19\n  46 |                   viewBox=\"0 0 24 24\"\n  47 |                 >\n> 48 |                   <path\n     |                   ^^^^^\n> 49 |                     strokeLinecap=\"round\"\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 50 |                     strokeLinejoin=\"round\"\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 51 |                     strokeWidth={2}\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 52 |                     d=\"M6 18L18 6M6 6l12 12\"\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 53 |                   />\n     | ^^^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  54 |                 </svg>\n  55 |               </div>\n  56 |               <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">","line":48,"column":19,"nodeType":null,"endLine":53,"endColumn":21},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:56:15\n  54 |                 </svg>\n  55 |               </div>\n> 56 |               <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 57 |                 Invalid or Expired Link\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 58 |               </h1>\n     | ^^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  59 |               <p className=\"text-slate-600 mb-6\">\n  60 |                 This portal access link is invalid or has expired. Portal links\n  61 |                 expire after 1 hour and can only be used once.","line":56,"column":15,"nodeType":null,"endLine":58,"endColumn":20},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:59:15\n  57 |                 Invalid or Expired Link\n  58 |               </h1>\n> 59 |               <p className=\"text-slate-600 mb-6\">\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 60 |                 This portal access link is invalid or has expired. Portal links\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 61 |                 expire after 1 hour and can only be used once.\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 62 |               </p>\n     | ^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  63 |               <p className=\"text-sm text-slate-500\">\n  64 |                 Please contact your service provider for a new invitation.\n  65 |               </p>","line":59,"column":15,"nodeType":null,"endLine":62,"endColumn":19},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:63:15\n  61 |                 expire after 1 hour and can only be used once.\n  62 |               </p>\n> 63 |               <p className=\"text-sm text-slate-500\">\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 64 |                 Please contact your service provider for a new invitation.\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 65 |               </p>\n     | ^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  66 |             </div>\n  67 |           </div>\n  68 |         </div>","line":63,"column":15,"nodeType":null,"endLine":65,"endColumn":19},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:77:9\n   75 |     if (!session.is_valid) {\n   76 |       return (\n>  77 |         <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n      |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  78 |           <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  79 |             <div className=\"mb-4\">\n      \n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 106 |           </div>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 107 |         </div>\n      | ^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  108 |       );\n  109 |     }\n  110 |","line":77,"column":9,"nodeType":null,"endLine":107,"endColumn":15},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:78:11\n   76 |       return (\n   77 |         <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n>  78 |           <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n      |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  79 |             <div className=\"mb-4\">\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  80 |               <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-amber-100 mb-4\">\n      \n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 105 |             </div>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 106 |           </div>\n      | ^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  107 |         </div>\n  108 |       );\n  109 |     }","line":78,"column":11,"nodeType":null,"endLine":106,"endColumn":17},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:79:13\n   77 |         <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n   78 |           <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n>  79 |             <div className=\"mb-4\">\n      |             ^^^^^^^^^^^^^^^^^^^^^^\n>  80 |               <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-amber-100 mb-4\">\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  81 |                 <svg\n      \n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 104 |               </p>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 105 |             </div>\n      | ^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  106 |           </div>\n  107 |         </div>\n  108 |       );","line":79,"column":13,"nodeType":null,"endLine":105,"endColumn":19},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:80:15\n  78 |           <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n  79 |             <div className=\"mb-4\">\n> 80 |               <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-amber-100 mb-4\">\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 81 |                 <svg\n     | ^^^^^^^^^^^^^^^^^^^^\n> 82 |                   className=\"w-8 h-8 text-amber-600\"\n     \n     | ^^^^^^^^^^^^^^^^^^^^\n> 93 |                 </svg>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 94 |               </div>\n     | ^^^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  95 |               <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">\n  96 |                 Link Expired\n  97 |               </h1>","line":80,"column":15,"nodeType":null,"endLine":94,"endColumn":21},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:81:17\n  79 |             <div className=\"mb-4\">\n  80 |               <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-amber-100 mb-4\">\n> 81 |                 <svg\n     |                 ^^^^\n> 82 |                   className=\"w-8 h-8 text-amber-600\"\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 83 |                   fill=\"none\"\n     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |                   />\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 93 |                 </svg>\n     | ^^^^^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  94 |               </div>\n  95 |               <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">\n  96 |                 Link Expired","line":81,"column":17,"nodeType":null,"endLine":93,"endColumn":23},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:87:19\n  85 |                   viewBox=\"0 0 24 24\"\n  86 |                 >\n> 87 |                   <path\n     |                   ^^^^^\n> 88 |                     strokeLinecap=\"round\"\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |                     strokeLinejoin=\"round\"\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |                     strokeWidth={2}\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |                     d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |                   />\n     | ^^^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  93 |                 </svg>\n  94 |               </div>\n  95 |               <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">","line":87,"column":19,"nodeType":null,"endLine":92,"endColumn":21},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:95:15\n   93 |                 </svg>\n   94 |               </div>\n>  95 |               <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">\n      |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  96 |                 Link Expired\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  97 |               </h1>\n      | ^^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n   98 |               <p className=\"text-slate-600 mb-6\">\n   99 |                 This portal access link has expired or has already been used.\n  100 |                 Portal links can only be used once for security.","line":95,"column":15,"nodeType":null,"endLine":97,"endColumn":20},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:98:15\n   96 |                 Link Expired\n   97 |               </h1>\n>  98 |               <p className=\"text-slate-600 mb-6\">\n      |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  99 |                 This portal access link has expired or has already been used.\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 100 |                 Portal links can only be used once for security.\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 101 |               </p>\n      | ^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  102 |               <p className=\"text-sm text-slate-500\">\n  103 |                 Please request a new invitation from your service provider.\n  104 |               </p>","line":98,"column":15,"nodeType":null,"endLine":101,"endColumn":19},{"ruleId":"react-hooks/error-boundaries","severity":2,"message":"Error: Avoid constructing JSX within try/catch\n\nReact does not immediately render components when JSX is rendered, so any errors from this component will not be caught by the try/catch. To catch errors in rendering a given component, wrap that component in an error boundary. (https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/auth/[token]/page.tsx:102:15\n  100 |                 Portal links can only be used once for security.\n  101 |               </p>\n> 102 |               <p className=\"text-sm text-slate-500\">\n      |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 103 |                 Please request a new invitation from your service provider.\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 104 |               </p>\n      | ^^^^^^^^^^^^^^^^^^^ Avoid constructing JSX within try/catch\n  105 |             </div>\n  106 |           </div>\n  107 |         </div>","line":102,"column":15,"nodeType":null,"endLine":104,"endColumn":19}],"suppressedMessages":[],"errorCount":18,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Portal Magic Link Authentication\n * Route: /portal/auth/[token]\n *\n * This page handles magic link authentication for client portal access:\n * 1. Verifies the session token\n * 2. Creates a secure session cookie\n * 3. Marks the session as used\n * 4. Updates last_portal_login timestamp\n * 5. Redirects to portal dashboard\n */\n\nimport { createClient } from '@/lib/supabase/server';\nimport { redirect } from 'next/navigation';\nimport { cookies } from 'next/headers';\n\ninterface PortalAuthPageProps {\n  params: {\n    token: string;\n  };\n}\n\nexport default async function PortalAuthPage({\n  params,\n}: PortalAuthPageProps) {\n  const supabase = await createClient();\n  const { token } = params;\n\n  try {\n    // Verify the portal session token\n    const { data, error } = await supabase.rpc('verify_portal_session', {\n      session_token: token,\n    });\n\n    if (error || !data || data.length === 0) {\n      // Invalid or expired token\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n          <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n            <div className=\"mb-4\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4\">\n                <svg\n                  className=\"w-8 h-8 text-red-600\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M6 18L18 6M6 6l12 12\"\n                  />\n                </svg>\n              </div>\n              <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">\n                Invalid or Expired Link\n              </h1>\n              <p className=\"text-slate-600 mb-6\">\n                This portal access link is invalid or has expired. Portal links\n                expire after 1 hour and can only be used once.\n              </p>\n              <p className=\"text-sm text-slate-500\">\n                Please contact your service provider for a new invitation.\n              </p>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    const session = data[0];\n\n    // Check if token is still valid (not expired and not used)\n    if (!session.is_valid) {\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n          <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n            <div className=\"mb-4\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-amber-100 mb-4\">\n                <svg\n                  className=\"w-8 h-8 text-amber-600\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"\n                  />\n                </svg>\n              </div>\n              <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">\n                Link Expired\n              </h1>\n              <p className=\"text-slate-600 mb-6\">\n                This portal access link has expired or has already been used.\n                Portal links can only be used once for security.\n              </p>\n              <p className=\"text-sm text-slate-500\">\n                Please request a new invitation from your service provider.\n              </p>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    // Mark session as used\n    const { error: updateError } = await supabase\n      .from('portal_sessions')\n      .update({ used_at: new Date().toISOString() })\n      .eq('token', token);\n\n    if (updateError) {\n      console.error('Failed to mark session as used:', updateError);\n    }\n\n    // Update last_portal_login timestamp\n    const { error: loginError } = await supabase\n      .from('contacts')\n      .update({ last_portal_login: new Date().toISOString() })\n      .eq('id', session.contact_id);\n\n    if (loginError) {\n      console.error('Failed to update last_portal_login:', loginError);\n    }\n\n    // Create secure session cookie\n    const cookieStore = await cookies();\n    const sessionData = {\n      contact_id: session.contact_id,\n      contact_email: session.contact_email,\n      contact_name: session.contact_name,\n      tenant_id: session.tenant_id,\n      authenticated_at: new Date().toISOString(),\n    };\n\n    cookieStore.set('portal_session', JSON.stringify(sessionData), {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === 'production',\n      sameSite: 'lax',\n      maxAge: 60 * 60 * 24 * 30, // 30 days\n      path: '/portal',\n    });\n\n    // Redirect to portal dashboard\n    redirect('/portal/dashboard');\n  } catch (error) {\n    console.error('Portal auth error:', error);\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n        <div className=\"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center\">\n          <div className=\"mb-4\">\n            <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 mb-4\">\n              <svg\n                className=\"w-8 h-8 text-red-600\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n                />\n              </svg>\n            </div>\n            <h1 className=\"text-2xl font-bold text-slate-900 mb-2\">\n              Something Went Wrong\n            </h1>\n            <p className=\"text-slate-600 mb-6\">\n              We encountered an error while processing your portal access.\n            </p>\n            <p className=\"text-sm text-slate-500\">\n              Please try again or contact support if the problem persists.\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/dashboard/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/dashboard/portal-dashboard-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[509,512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[509,512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[529,532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[529,532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[548,551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[548,551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":132,"column":19,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3824,3886],"text":"\n              Here&apos;s an overview of your account\n            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3824,3886],"text":"\n              Here&lsquo;s an overview of your account\n            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3824,3886],"text":"\n              Here&#39;s an overview of your account\n            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3824,3886],"text":"\n              Here&rsquo;s an overview of your account\n            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport {\n  FileText,\n  FolderKanban,\n  DollarSign,\n  Download,\n  LogOut,\n  Clock,\n} from 'lucide-react';\nimport { PortalSession } from '@/lib/portal/session';\nimport { useRouter } from 'next/navigation';\nimport { format } from 'date-fns';\n\ninterface PortalDashboardClientProps {\n  session: PortalSession;\n  invoices: any[];\n  documents: any[];\n  projects: any[];\n}\n\nexport function PortalDashboardClient({\n  session,\n  invoices,\n  documents,\n  projects,\n}: PortalDashboardClientProps) {\n  const router = useRouter();\n\n  const handleLogout = async () => {\n    try {\n      await fetch('/api/portal/logout', { method: 'POST' });\n      router.push('/');\n    } catch (error) {\n      console.error('Logout error:', error);\n    }\n  };\n\n  const handleDownloadInvoice = async (invoiceId: string, invoiceNumber: string) => {\n    try {\n      const response = await fetch(`/api/portal/invoices/${invoiceId}/download`);\n\n      if (!response.ok) {\n        throw new Error('Failed to download invoice');\n      }\n\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `Invoice-${invoiceNumber}.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n    } catch (error) {\n      console.error('Download error:', error);\n      alert('Failed to download invoice. Please try again.');\n    }\n  };\n\n  const handleDownloadDocument = async (documentId: string, fileName: string) => {\n    try {\n      const response = await fetch(`/api/portal/documents/${documentId}/download`);\n\n      if (!response.ok) {\n        throw new Error('Failed to download document');\n      }\n\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = fileName;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n    } catch (error) {\n      console.error('Download error:', error);\n      alert('Failed to download document. Please try again.');\n    }\n  };\n\n  const getInvoiceStatusColor = (status: string) => {\n    switch (status) {\n      case 'paid':\n        return 'bg-green-100 text-green-800';\n      case 'sent':\n        return 'bg-blue-100 text-blue-800';\n      case 'overdue':\n        return 'bg-red-100 text-red-800';\n      case 'draft':\n        return 'bg-slate-100 text-slate-800';\n      default:\n        return 'bg-slate-100 text-slate-800';\n    }\n  };\n\n  const getProjectStatusColor = (status: string) => {\n    switch (status) {\n      case 'active':\n        return 'bg-green-100 text-green-800';\n      case 'planning':\n        return 'bg-blue-100 text-blue-800';\n      case 'on_hold':\n        return 'bg-amber-100 text-amber-800';\n      case 'completed':\n        return 'bg-slate-100 text-slate-800';\n      default:\n        return 'bg-slate-100 text-slate-800';\n    }\n  };\n\n  // Calculate stats\n  const totalInvoiced = invoices.reduce((sum, inv) => sum + (inv.total || 0), 0);\n  const activeProjects = projects.filter((p) => p.status === 'active').length;\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 p-4 md:p-8\">\n      <div className=\"max-w-6xl mx-auto space-y-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-slate-900\">\n              Welcome back, {session.contact_name.split(' ')[0]}\n            </h1>\n            <p className=\"text-slate-600 mt-1\">\n              Here's an overview of your account\n            </p>\n          </div>\n          <Button\n            variant=\"outline\"\n            onClick={handleLogout}\n            className=\"border-slate-300\"\n          >\n            <LogOut className=\"h-4 w-4 mr-2\" />\n            Logout\n          </Button>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <Card className=\"border-slate-200 bg-white\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-sm font-medium text-slate-600\">\n                  Total Invoiced\n                </CardTitle>\n                <DollarSign className=\"h-4 w-4 text-slate-400\" />\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-slate-900\">\n                CHF {totalInvoiced.toLocaleString('de-CH', { minimumFractionDigits: 2 })}\n              </div>\n              <p className=\"text-xs text-slate-500 mt-1\">\n                {invoices.length} invoice{invoices.length !== 1 ? 's' : ''} total\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-slate-200 bg-white\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-sm font-medium text-slate-600\">\n                  Active Projects\n                </CardTitle>\n                <FolderKanban className=\"h-4 w-4 text-slate-400\" />\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-slate-900\">\n                {activeProjects}\n              </div>\n              <p className=\"text-xs text-slate-500 mt-1\">\n                {projects.length} project{projects.length !== 1 ? 's' : ''} total\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-slate-200 bg-white\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-sm font-medium text-slate-600\">\n                  Documents\n                </CardTitle>\n                <FileText className=\"h-4 w-4 text-slate-400\" />\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-slate-900\">\n                {documents.length}\n              </div>\n              <p className=\"text-xs text-slate-500 mt-1\">Shared with you</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {/* Invoices */}\n          <Card className=\"border-slate-200 bg-white\">\n            <CardHeader>\n              <CardTitle className=\"text-slate-900\">Recent Invoices</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {invoices.length === 0 ? (\n                <p className=\"text-sm text-slate-500\">No invoices yet.</p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {invoices.slice(0, 5).map((invoice) => (\n                    <div\n                      key={invoice.id}\n                      className=\"flex items-center justify-between p-3 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors\"\n                    >\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <p className=\"text-sm font-medium text-slate-900 truncate\">\n                            Invoice #{invoice.invoice_number || invoice.id.slice(0, 8)}\n                          </p>\n                          <Badge className={getInvoiceStatusColor(invoice.status)}>\n                            {invoice.status}\n                          </Badge>\n                        </div>\n                        <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                          <Clock className=\"h-3 w-3\" />\n                          {format(new Date(invoice.created_at), 'dd MMM yyyy')}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-3 ml-4\">\n                        <span className=\"text-sm font-semibold text-slate-900\">\n                          CHF {invoice.total?.toLocaleString('de-CH', { minimumFractionDigits: 2 })}\n                        </span>\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => handleDownloadInvoice(invoice.id, invoice.invoice_number || invoice.id.slice(0, 8))}\n                        >\n                          <Download className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Documents */}\n          <Card className=\"border-slate-200 bg-white\">\n            <CardHeader>\n              <CardTitle className=\"text-slate-900\">Shared Documents</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {documents.length === 0 ? (\n                <p className=\"text-sm text-slate-500\">\n                  No documents shared with you yet.\n                </p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {documents.slice(0, 5).map((doc) => (\n                    <div\n                      key={doc.id}\n                      className=\"flex items-center justify-between p-3 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors\"\n                    >\n                      <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n                        <div className=\"bg-blue-100 p-2 rounded-lg flex-shrink-0\">\n                          <FileText className=\"h-4 w-4 text-blue-600\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm font-medium text-slate-900 truncate\">\n                            {doc.name}\n                          </p>\n                          <p className=\"text-xs text-slate-500\">\n                            {format(new Date(doc.created_at), 'dd MMM yyyy')}\n                          </p>\n                        </div>\n                      </div>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => handleDownloadDocument(doc.id, doc.name)}\n                      >\n                        <Download className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Projects */}\n        {projects.length > 0 && (\n          <Card className=\"border-slate-200 bg-white\">\n            <CardHeader>\n              <CardTitle className=\"text-slate-900\">Your Projects</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {projects.map((project) => (\n                  <div\n                    key={project.id}\n                    className=\"p-5 rounded-lg border border-slate-200 hover:border-slate-300 transition-all bg-white\"\n                  >\n                    {/* Project Header */}\n                    <div className=\"flex items-start justify-between mb-3\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-3 mb-1\">\n                          <h3 className=\"font-semibold text-lg text-slate-900\">\n                            {project.name}\n                          </h3>\n                          <Badge className={getProjectStatusColor(project.status)}>\n                            {project.status?.replace('_', ' ')}\n                          </Badge>\n                        </div>\n                        {project.description && (\n                          <p className=\"text-sm text-slate-600 mt-2 leading-relaxed\">\n                            {project.description}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n\n                    {/* Project Timeline */}\n                    {(project.start_date || project.end_date) && (\n                      <div className=\"flex items-center gap-4 mt-3 pt-3 border-t border-slate-100\">\n                        {project.start_date && (\n                          <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                            <Clock className=\"h-3 w-3\" />\n                            <span>\n                              Started: {format(new Date(project.start_date), 'dd MMM yyyy')}\n                            </span>\n                          </div>\n                        )}\n                        {project.end_date && (\n                          <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                            <Clock className=\"h-3 w-3\" />\n                            <span>\n                              {project.status === 'completed' ? 'Completed' : 'Due'}: {format(new Date(project.end_date), 'dd MMM yyyy')}\n                            </span>\n                          </div>\n                        )}\n                      </div>\n                    )}\n\n                    {/* Project Progress (if available) */}\n                    {project.progress !== undefined && project.progress !== null && (\n                      <div className=\"mt-3 pt-3 border-t border-slate-100\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <span className=\"text-xs font-medium text-slate-600\">\n                            Progress\n                          </span>\n                          <span className=\"text-xs font-semibold text-slate-900\">\n                            {project.progress}%\n                          </span>\n                        </div>\n                        <div className=\"w-full bg-slate-100 rounded-full h-2\">\n                          <div\n                            className=\"bg-blue-600 h-2 rounded-full transition-all\"\n                            style={{ width: `${project.progress}%` }}\n                          />\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/portal/layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[848,851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[848,851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":29,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PortalHeader } from \"@/components/layout/portal-header\";\nimport { getPortalSession } from \"@/lib/portal/session\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport default async function PortalLayout({\n    children,\n}: {\n    children: React.ReactNode\n}) {\n    // Get portal session to fetch organization data\n    let orgName = \"Client Portal\";\n    let orgLogo = null;\n\n    try {\n        const session = await getPortalSession();\n        if (session) {\n            const supabase = await createClient();\n            const { data: org } = await supabase\n                .from('organizations')\n                .select('name, settings')\n                .eq('id', session.tenant_id)\n                .single();\n\n            if (org) {\n                orgName = org.name || \"Client Portal\";\n                orgLogo = (org.settings as any)?.logo_url || null;\n            }\n        }\n    } catch (error) {\n        // If not authenticated, just use defaults\n        console.log('Portal layout: No session found');\n    }\n\n    return (\n        <div className=\"min-h-screen bg-slate-50\">\n            <PortalHeader companyName={orgName} companyLogo={orgLogo} />\n            <main>\n                {children}\n            </main>\n            <footer className=\"border-t bg-white mt-16\">\n                <div className=\"container px-4 sm:px-8 py-8\">\n                    <div className=\"flex flex-col md:flex-row items-center justify-between gap-4\">\n                        <p className=\"text-sm text-slate-600\">\n                             {new Date().getFullYear()} {orgName}. All rights reserved.\n                        </p>\n                        <p className=\"text-xs text-slate-500\">\n                            Powered by OrbitCRM\n                        </p>\n                    </div>\n                </div>\n            </footer>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/privacy/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/app/terms/page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":20,"column":62,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[966,1282],"text":"\n                            By accessing and using OrbitCRM (&quot;the Service\"), you accept and agree to be bound by the terms and provision of this agreement. In addition, when using these particular services, you shall be subject to any posted guidelines or rules applicable to such services.\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[966,1282],"text":"\n                            By accessing and using OrbitCRM (&ldquo;the Service\"), you accept and agree to be bound by the terms and provision of this agreement. In addition, when using these particular services, you shall be subject to any posted guidelines or rules applicable to such services.\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[966,1282],"text":"\n                            By accessing and using OrbitCRM (&#34;the Service\"), you accept and agree to be bound by the terms and provision of this agreement. In addition, when using these particular services, you shall be subject to any posted guidelines or rules applicable to such services.\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[966,1282],"text":"\n                            By accessing and using OrbitCRM (&rdquo;the Service\"), you accept and agree to be bound by the terms and provision of this agreement. In addition, when using these particular services, you shall be subject to any posted guidelines or rules applicable to such services.\n                        "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":20,"column":74,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[966,1282],"text":"\n                            By accessing and using OrbitCRM (\"the Service&quot;), you accept and agree to be bound by the terms and provision of this agreement. In addition, when using these particular services, you shall be subject to any posted guidelines or rules applicable to such services.\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[966,1282],"text":"\n                            By accessing and using OrbitCRM (\"the Service&ldquo;), you accept and agree to be bound by the terms and provision of this agreement. In addition, when using these particular services, you shall be subject to any posted guidelines or rules applicable to such services.\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[966,1282],"text":"\n                            By accessing and using OrbitCRM (\"the Service&#34;), you accept and agree to be bound by the terms and provision of this agreement. In addition, when using these particular services, you shall be subject to any posted guidelines or rules applicable to such services.\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[966,1282],"text":"\n                            By accessing and using OrbitCRM (\"the Service&rdquo;), you accept and agree to be bound by the terms and provision of this agreement. In addition, when using these particular services, you shall be subject to any posted guidelines or rules applicable to such services.\n                        "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from \"next/link\"\nimport { ArrowLeft } from \"lucide-react\"\n\nexport default function TermsPage() {\n    return (\n        <div className=\"min-h-screen bg-slate-50 font-sans\">\n            <div className=\"container mx-auto px-6 py-12 max-w-4xl\">\n                <Link href=\"/\" className=\"inline-flex items-center text-[#3D4A67] hover:text-[#E9B949] font-medium mb-8 transition-colors\">\n                    <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                    Back to Home\n                </Link>\n\n                <h1 className=\"text-4xl font-bold text-[#3D4A67] mb-2\">Terms of Service</h1>\n                <p className=\"text-slate-500 mb-12\">Last updated: January 16, 2026</p>\n\n                <div className=\"prose prose-slate max-w-none\">\n                    <section className=\"mb-8\">\n                        <h2 className=\"text-2xl font-bold text-[#3D4A67] mb-4\">1. Acceptance of Terms</h2>\n                        <p className=\"text-slate-600 mb-4\">\n                            By accessing and using OrbitCRM (\"the Service\"), you accept and agree to be bound by the terms and provision of this agreement. In addition, when using these particular services, you shall be subject to any posted guidelines or rules applicable to such services.\n                        </p>\n                    </section>\n\n                    <section className=\"mb-8\">\n                        <h2 className=\"text-2xl font-bold text-[#3D4A67] mb-4\">2. Account Registration</h2>\n                        <p className=\"text-slate-600 mb-4\">\n                            To access certain features of the Service, you may be required to register for an account. You agree to provide accurate, current, and complete information during the registration process and to update such information to keep it accurate, current, and complete. You are responsible for safeguarding your password and for all activities that occur under your account.\n                        </p>\n                    </section>\n\n                    <section className=\"mb-8\">\n                        <h2 className=\"text-2xl font-bold text-[#3D4A67] mb-4\">3. Subscription and Billing</h2>\n                        <p className=\"text-slate-600 mb-4\">\n                            Detailed pricing and subscription terms are available on our pricing page. You agree to pay all fees or charges to your account in accordance with the fees, charges, and billing terms in effect at the time a fee or charge is due and payable. Subscription fees are non-refundable except as required by law.\n                        </p>\n                    </section>\n\n                    <section className=\"mb-8\">\n                        <h2 className=\"text-2xl font-bold text-[#3D4A67] mb-4\">4. Intellectual Property</h2>\n                        <p className=\"text-slate-600 mb-4\">\n                            The Service and its original content, features, and functionality are and will remain the exclusive property of OrbitCRM and its licensors. The Service is protected by copyright, trademark, and other laws of both the United States and foreign countries. Our trademarks and trade dress may not be used in connection with any product or service without the prior written consent of OrbitCRM.\n                        </p>\n                    </section>\n\n                    <section className=\"mb-8\">\n                        <h2 className=\"text-2xl font-bold text-[#3D4A67] mb-4\">5. Limitation of Liability</h2>\n                        <p className=\"text-slate-600 mb-4\">\n                            In no event shall OrbitCRM, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from (i) your access to or use of or inability to access or use the Service; (ii) any conduct or content of any third party on the Service; (iii) any content obtained from the Service; and (iv) unauthorized access, use or alteration of your transmissions or content, whether based on warranty, contract, tort (including negligence) or any other legal theory, whether or not we have been informed of the possibility of such damage, and even if a remedy set forth herein is found to have failed of its essential purpose.\n                        </p>\n                    </section>\n\n                    <section className=\"mb-8\">\n                        <h2 className=\"text-2xl font-bold text-[#3D4A67] mb-4\">6. Contact Us</h2>\n                        <p className=\"text-slate-600 mb-4\">\n                            If you have any questions about these Terms, please contact us at legal@orbitcrm.com.\n                        </p>\n                    </section>\n                </div>\n            </div>\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/activity/activity-feed.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2344,2347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2344,2347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":141,"column":37,"nodeType":"JSXOpeningElement","endLine":145,"endColumn":39}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { getOrganizationActivity } from '@/lib/activity-log'\nimport { formatRelativeTime } from '@/lib/format-time'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport {\n    Clock,\n    Plus,\n    Edit,\n    Trash2,\n    Mail,\n    Phone,\n    FileText,\n    Tag,\n    CheckCircle,\n    DollarSign,\n    Download,\n    Upload,\n    Eye,\n    TrendingUp,\n    User,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface ActivityFeedProps {\n    title?: string\n    limit?: number\n    showAvatar?: boolean\n}\n\n// Map event types to icons\nconst eventIcons: Record<string, React.ReactNode> = {\n    created: <Plus className=\"h-3.5 w-3.5\" />,\n    updated: <Edit className=\"h-3.5 w-3.5\" />,\n    deleted: <Trash2 className=\"h-3.5 w-3.5\" />,\n    viewed: <Eye className=\"h-3.5 w-3.5\" />,\n    emailed: <Mail className=\"h-3.5 w-3.5\" />,\n    called: <Phone className=\"h-3.5 w-3.5\" />,\n    noted: <FileText className=\"h-3.5 w-3.5\" />,\n    tagged: <Tag className=\"h-3.5 w-3.5\" />,\n    status_changed: <TrendingUp className=\"h-3.5 w-3.5\" />,\n    assigned: <Plus className=\"h-3.5 w-3.5\" />,\n    completed: <CheckCircle className=\"h-3.5 w-3.5\" />,\n    invoiced: <DollarSign className=\"h-3.5 w-3.5\" />,\n    paid: <DollarSign className=\"h-3.5 w-3.5\" />,\n    uploaded: <Upload className=\"h-3.5 w-3.5\" />,\n    downloaded: <Download className=\"h-3.5 w-3.5\" />,\n}\n\n// Map event types to colors\nconst eventColors: Record<string, string> = {\n    created: 'bg-green-100 text-green-700',\n    updated: 'bg-blue-100 text-blue-700',\n    deleted: 'bg-red-100 text-red-700',\n    viewed: 'bg-gray-100 text-gray-700',\n    emailed: 'bg-purple-100 text-purple-700',\n    called: 'bg-indigo-100 text-indigo-700',\n    noted: 'bg-yellow-100 text-yellow-700',\n    tagged: 'bg-pink-100 text-pink-700',\n    status_changed: 'bg-orange-100 text-orange-700',\n    assigned: 'bg-cyan-100 text-cyan-700',\n    completed: 'bg-green-100 text-green-700',\n    invoiced: 'bg-emerald-100 text-emerald-700',\n    paid: 'bg-green-100 text-green-700',\n    uploaded: 'bg-blue-100 text-blue-700',\n    downloaded: 'bg-blue-100 text-blue-700',\n}\n\nexport function ActivityFeed({\n    title = 'Recent Activity',\n    limit = 20,\n    showAvatar = true,\n}: ActivityFeedProps) {\n    const [activities, setActivities] = useState<any[]>([])\n    const [isLoading, setIsLoading] = useState(true)\n\n    useEffect(() => {\n        async function fetchActivities() {\n            setIsLoading(true)\n            const data = await getOrganizationActivity(limit)\n            setActivities(data)\n            setIsLoading(false)\n        }\n\n        fetchActivities()\n    }, [limit])\n\n    if (isLoading) {\n        return (\n            <Card className=\"border-slate-200\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">{title}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"flex items-center gap-2 text-slate-500\">\n                        <Clock className=\"h-4 w-4 animate-spin\" />\n                        <span>Loading activity...</span>\n                    </div>\n                </CardContent>\n            </Card>\n        )\n    }\n\n    if (activities.length === 0) {\n        return (\n            <Card className=\"border-slate-200\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">{title}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"text-center py-8 text-slate-500\">\n                        <Clock className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n                        <p>No recent activity</p>\n                        <p className=\"text-sm mt-1\">Activity will appear here as you work</p>\n                    </div>\n                </CardContent>\n            </Card>\n        )\n    }\n\n    return (\n        <Card className=\"border-slate-200\">\n            <CardHeader>\n                <CardTitle className=\"text-[#3D4A67]\">{title}</CardTitle>\n            </CardHeader>\n            <CardContent>\n                <div className=\"space-y-3\">\n                    {activities.map((activity) => {\n                        const icon = eventIcons[activity.event_type] || <Clock className=\"h-3.5 w-3.5\" />\n                        const colorClass =\n                            eventColors[activity.event_type] || 'bg-gray-100 text-gray-700'\n\n                        return (\n                            <div\n                                key={activity.id}\n                                className=\"flex items-start gap-3 p-2 rounded-lg hover:bg-slate-50 transition-colors\"\n                            >\n                                {/* Avatar or Icon */}\n                                {showAvatar && activity.user_avatar ? (\n                                    <img\n                                        src={activity.user_avatar}\n                                        alt={activity.user_name}\n                                        className=\"w-8 h-8 rounded-full flex-shrink-0\"\n                                    />\n                                ) : showAvatar ? (\n                                    <div className=\"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center flex-shrink-0\">\n                                        <User className=\"h-4 w-4 text-slate-500\" />\n                                    </div>\n                                ) : (\n                                    <div\n                                        className={cn(\n                                            'w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0',\n                                            colorClass\n                                        )}\n                                    >\n                                        {icon}\n                                    </div>\n                                )}\n\n                                {/* Content */}\n                                <div className=\"flex-1 min-w-0\">\n                                    <p className=\"text-sm text-slate-900\">\n                                        {showAvatar && activity.user_name && (\n                                            <span className=\"font-medium\">{activity.user_name} </span>\n                                        )}\n                                        <span className=\"text-slate-600\">\n                                            {activity.description || activity.event_type}\n                                        </span>\n                                    </p>\n                                    <div className=\"flex items-center gap-2 mt-1\">\n                                        <span className=\"text-xs text-slate-500\">\n                                            {formatRelativeTime(activity.created_at)}\n                                        </span>\n                                        <span className=\"text-xs text-slate-400\"></span>\n                                        <span className=\"text-xs text-slate-500 capitalize\">\n                                            {activity.entity_type}\n                                        </span>\n                                    </div>\n                                </div>\n                            </div>\n                        )\n                    })}\n                </div>\n            </CardContent>\n        </Card>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/activity/activity-timeline.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2354,2357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2354,2357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { getEntityActivity, EntityType } from '@/lib/activity-log'\nimport { formatRelativeTime, formatAbsoluteTime } from '@/lib/format-time'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport {\n    Clock,\n    Plus,\n    Edit,\n    Trash2,\n    Mail,\n    Phone,\n    FileText,\n    Tag,\n    CheckCircle,\n    DollarSign,\n    Download,\n    Upload,\n    Eye,\n    TrendingUp,\n} from 'lucide-react'\n\ninterface ActivityTimelineProps {\n    entityType: EntityType\n    entityId: string\n    title?: string\n    limit?: number\n    compact?: boolean\n}\n\n// Map event types to icons\nconst eventIcons: Record<string, React.ReactNode> = {\n    created: <Plus className=\"h-4 w-4\" />,\n    updated: <Edit className=\"h-4 w-4\" />,\n    deleted: <Trash2 className=\"h-4 w-4\" />,\n    viewed: <Eye className=\"h-4 w-4\" />,\n    emailed: <Mail className=\"h-4 w-4\" />,\n    called: <Phone className=\"h-4 w-4\" />,\n    noted: <FileText className=\"h-4 w-4\" />,\n    tagged: <Tag className=\"h-4 w-4\" />,\n    status_changed: <TrendingUp className=\"h-4 w-4\" />,\n    assigned: <Plus className=\"h-4 w-4\" />,\n    completed: <CheckCircle className=\"h-4 w-4\" />,\n    invoiced: <DollarSign className=\"h-4 w-4\" />,\n    paid: <DollarSign className=\"h-4 w-4\" />,\n    uploaded: <Upload className=\"h-4 w-4\" />,\n    downloaded: <Download className=\"h-4 w-4\" />,\n}\n\n// Map event types to colors\nconst eventColors: Record<string, string> = {\n    created: 'bg-green-100 text-green-700',\n    updated: 'bg-blue-100 text-blue-700',\n    deleted: 'bg-red-100 text-red-700',\n    viewed: 'bg-gray-100 text-gray-700',\n    emailed: 'bg-purple-100 text-purple-700',\n    called: 'bg-indigo-100 text-indigo-700',\n    noted: 'bg-yellow-100 text-yellow-700',\n    tagged: 'bg-pink-100 text-pink-700',\n    status_changed: 'bg-orange-100 text-orange-700',\n    assigned: 'bg-cyan-100 text-cyan-700',\n    completed: 'bg-green-100 text-green-700',\n    invoiced: 'bg-emerald-100 text-emerald-700',\n    paid: 'bg-green-100 text-green-700',\n    uploaded: 'bg-blue-100 text-blue-700',\n    downloaded: 'bg-blue-100 text-blue-700',\n}\n\nexport function ActivityTimeline({\n    entityType,\n    entityId,\n    title = 'Activity Timeline',\n    limit = 50,\n    compact = false,\n}: ActivityTimelineProps) {\n    const [activities, setActivities] = useState<any[]>([])\n    const [isLoading, setIsLoading] = useState(true)\n    const [showAbsolute, setShowAbsolute] = useState(false)\n\n    useEffect(() => {\n        async function fetchActivities() {\n            setIsLoading(true)\n            const data = await getEntityActivity(entityType, entityId, limit)\n            setActivities(data)\n            setIsLoading(false)\n        }\n\n        fetchActivities()\n    }, [entityType, entityId, limit])\n\n    if (isLoading) {\n        return (\n            <Card className=\"border-slate-200\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">{title}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"flex items-center gap-2 text-slate-500\">\n                        <Clock className=\"h-4 w-4 animate-spin\" />\n                        <span>Loading activity...</span>\n                    </div>\n                </CardContent>\n            </Card>\n        )\n    }\n\n    if (activities.length === 0) {\n        return (\n            <Card className=\"border-slate-200\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">{title}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <div className=\"text-center py-8 text-slate-500\">\n                        <Clock className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n                        <p>No activity yet</p>\n                    </div>\n                </CardContent>\n            </Card>\n        )\n    }\n\n    return (\n        <Card className=\"border-slate-200\">\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n                <CardTitle className=\"text-[#3D4A67]\">{title}</CardTitle>\n                <button\n                    onClick={() => setShowAbsolute(!showAbsolute)}\n                    className=\"text-xs text-slate-500 hover:text-slate-700\"\n                >\n                    {showAbsolute ? 'Show relative' : 'Show absolute'}\n                </button>\n            </CardHeader>\n            <CardContent>\n                <div className=\"space-y-4\">\n                    {activities.map((activity, index) => {\n                        const icon = eventIcons[activity.event_type] || <Clock className=\"h-4 w-4\" />\n                        const colorClass =\n                            eventColors[activity.event_type] || 'bg-gray-100 text-gray-700'\n\n                        return (\n                            <div key={activity.id} className=\"relative flex gap-3\">\n                                {/* Timeline line */}\n                                {index < activities.length - 1 && (\n                                    <div\n                                        className=\"absolute left-[15px] top-8 bottom-0 w-px bg-slate-200\"\n                                        style={{ height: 'calc(100% + 1rem)' }}\n                                    />\n                                )}\n\n                                {/* Icon */}\n                                <div\n                                    className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${colorClass} relative z-10`}\n                                >\n                                    {icon}\n                                </div>\n\n                                {/* Content */}\n                                <div className=\"flex-1 pt-0.5\">\n                                    <div className=\"flex items-start justify-between gap-2\">\n                                        <div className=\"flex-1\">\n                                            <p className=\"text-sm font-medium text-slate-900\">\n                                                {activity.description || activity.event_type}\n                                            </p>\n                                            {!compact && activity.user_name && (\n                                                <p className=\"text-xs text-slate-500 mt-0.5\">\n                                                    by {activity.user_name}\n                                                </p>\n                                            )}\n                                        </div>\n                                        <span className=\"text-xs text-slate-500 flex-shrink-0\">\n                                            {showAbsolute\n                                                ? formatAbsoluteTime(activity.created_at)\n                                                : formatRelativeTime(activity.created_at)}\n                                        </span>\n                                    </div>\n\n                                    {/* Metadata display */}\n                                    {!compact && activity.metadata && Object.keys(activity.metadata).length > 0 && (\n                                        <div className=\"mt-2 p-2 bg-slate-50 rounded text-xs text-slate-600\">\n                                            {Object.entries(activity.metadata).map(([key, value]) => (\n                                                <div key={key}>\n                                                    <span className=\"font-medium\">{key}:</span>{' '}\n                                                    {String(value)}\n                                                </div>\n                                            ))}\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        )\n                    })}\n                </div>\n            </CardContent>\n        </Card>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/command-palette/command-palette.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LogOut' is defined but never used.","line":16,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":11,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"LogOut"},"fix":{"range":[297,309],"text":""},"desc":"Remove unused variable \"LogOut\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used.","line":19,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DollarSign"},"fix":{"range":[333,349],"text":""},"desc":"Remove unused variable \"DollarSign\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1108,1111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1108,1111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`performSearch` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/command-palette/command-palette.tsx:194:19\n  192 |         const timeout = setTimeout(async () => {\n  193 |             setIsSearching(true)\n> 194 |             await performSearch(query)\n      |                   ^^^^^^^^^^^^^ `performSearch` accessed before it is declared\n  195 |             setIsSearching(false)\n  196 |         }, 300)\n  197 |\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/command-palette/command-palette.tsx:201:5\n  199 |     }, [query])\n  200 |\n> 201 |     const performSearch = async (searchQuery: string) => {\n      |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 202 |         try {\n      | ^^^^^^^^^^^^^\n> 203 |             const supabase = createClient()\n      \n      | ^^^^^^^^^^^^^\n> 271 |         }\n      | ^^^^^^^^^^^^^\n> 272 |     }\n      | ^^^^^^ `performSearch` is declared here\n  273 |\n  274 |     // Filter static commands based on query\n  275 |     const filteredCommands = staticCommands.filter(","line":194,"column":19,"nodeType":null,"endLine":194,"endColumn":32},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'performSearch'. Either include it or remove the dependency array.","line":199,"column":8,"nodeType":"ArrayExpression","endLine":199,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [performSearch, query]","fix":{"range":[5736,5743],"text":"[performSearch, query]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6221,6224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6221,6224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'allCommands' conditional could make the dependencies of useCallback Hook (at line 309) change on every render. To fix this, wrap the initialization of 'allCommands' in its own useMemo() Hook.","line":282,"column":11,"nodeType":"VariableDeclarator","endLine":282,"endColumn":103},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":364,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":364,"endColumn":66}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useCallback } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/client'\nimport {\n    Search,\n    Home,\n    User,\n    Users,\n    Briefcase,\n    CheckSquare,\n    FileText,\n    MessageSquare,\n    Settings,\n    LogOut,\n    Plus,\n    Calendar,\n    DollarSign,\n    Loader2,\n} from 'lucide-react'\nimport { Dialog, DialogContent } from '@/components/ui/dialog'\nimport { Input } from '@/components/ui/input'\nimport { cn } from '@/lib/utils'\n\ninterface Command {\n    id: string\n    label: string\n    description?: string\n    icon: React.ReactNode\n    action: () => void\n    category: 'navigation' | 'create' | 'search' | 'settings'\n}\n\ninterface CommandPaletteProps {\n    open: boolean\n    onOpenChange: (open: boolean) => void\n}\n\nexport function CommandPalette({ open, onOpenChange }: CommandPaletteProps) {\n    const [query, setQuery] = useState('')\n    const [selectedIndex, setSelectedIndex] = useState(0)\n    const [isSearching, setIsSearching] = useState(false)\n    const [searchResults, setSearchResults] = useState<any[]>([])\n    const router = useRouter()\n\n    // Static commands (navigation & actions)\n    const staticCommands: Command[] = [\n        // Navigation\n        {\n            id: 'nav-dashboard',\n            label: 'Dashboard',\n            description: 'Go to dashboard',\n            icon: <Home className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/dashboard')\n                onOpenChange(false)\n            },\n            category: 'navigation',\n        },\n        {\n            id: 'nav-contacts',\n            label: 'Contacts',\n            description: 'View all contacts',\n            icon: <Users className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/contacts')\n                onOpenChange(false)\n            },\n            category: 'navigation',\n        },\n        {\n            id: 'nav-projects',\n            label: 'Projects',\n            description: 'View all projects',\n            icon: <Briefcase className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/projects')\n                onOpenChange(false)\n            },\n            category: 'navigation',\n        },\n        {\n            id: 'nav-tasks',\n            label: 'Tasks',\n            description: 'View all tasks',\n            icon: <CheckSquare className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/tasks')\n                onOpenChange(false)\n            },\n            category: 'navigation',\n        },\n        {\n            id: 'nav-invoices',\n            label: 'Invoices',\n            description: 'View all invoices',\n            icon: <FileText className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/invoices')\n                onOpenChange(false)\n            },\n            category: 'navigation',\n        },\n        {\n            id: 'nav-chat',\n            label: 'AI Chat',\n            description: 'Open AI assistant',\n            icon: <MessageSquare className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/chat')\n                onOpenChange(false)\n            },\n            category: 'navigation',\n        },\n        {\n            id: 'nav-calendar',\n            label: 'Calendar',\n            description: 'View calendar',\n            icon: <Calendar className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/calendar')\n                onOpenChange(false)\n            },\n            category: 'navigation',\n        },\n        {\n            id: 'nav-settings',\n            label: 'Settings',\n            description: 'Open settings',\n            icon: <Settings className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/settings')\n                onOpenChange(false)\n            },\n            category: 'settings',\n        },\n        // Create actions\n        {\n            id: 'create-contact',\n            label: 'New Contact',\n            description: 'Create a new contact',\n            icon: <Plus className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/contacts?new=true')\n                onOpenChange(false)\n            },\n            category: 'create',\n        },\n        {\n            id: 'create-project',\n            label: 'New Project',\n            description: 'Create a new project',\n            icon: <Plus className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/projects?new=true')\n                onOpenChange(false)\n            },\n            category: 'create',\n        },\n        {\n            id: 'create-task',\n            label: 'New Task',\n            description: 'Create a new task',\n            icon: <Plus className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/tasks?new=true')\n                onOpenChange(false)\n            },\n            category: 'create',\n        },\n        {\n            id: 'create-invoice',\n            label: 'New Invoice',\n            description: 'Create a new invoice',\n            icon: <Plus className=\"h-4 w-4\" />,\n            action: () => {\n                router.push('/invoices?new=true')\n                onOpenChange(false)\n            },\n            category: 'create',\n        },\n    ]\n\n    // Search for entities when query changes\n    useEffect(() => {\n        if (query.trim().length < 2) {\n            setSearchResults([])\n            return\n        }\n\n        const timeout = setTimeout(async () => {\n            setIsSearching(true)\n            await performSearch(query)\n            setIsSearching(false)\n        }, 300)\n\n        return () => clearTimeout(timeout)\n    }, [query])\n\n    const performSearch = async (searchQuery: string) => {\n        try {\n            const supabase = createClient()\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) return\n\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (!profile?.tenant_id) return\n\n            const results: any[] = []\n\n            // Search contacts\n            const { data: contacts } = await supabase\n                .from('contacts')\n                .select('id, first_name, last_name, company_name, email, is_company')\n                .eq('tenant_id', profile.tenant_id)\n                .or(`first_name.ilike.%${searchQuery}%,last_name.ilike.%${searchQuery}%,company_name.ilike.%${searchQuery}%,email.ilike.%${searchQuery}%`)\n                .limit(3)\n\n            if (contacts) {\n                results.push(\n                    ...contacts.map((contact) => ({\n                        id: `contact-${contact.id}`,\n                        label: contact.is_company\n                            ? contact.company_name || 'Unnamed Company'\n                            : `${contact.first_name || ''} ${contact.last_name || ''}`.trim() ||\n                            'Unnamed Contact',\n                        description: contact.email || undefined,\n                        icon: <User className=\"h-4 w-4\" />,\n                        action: () => {\n                            router.push(`/contacts/${contact.id}`)\n                            onOpenChange(false)\n                        },\n                        category: 'search',\n                    }))\n                )\n            }\n\n            // Search projects\n            const { data: projects } = await supabase\n                .from('projects')\n                .select('id, name')\n                .eq('tenant_id', profile.tenant_id)\n                .ilike('name', `%${searchQuery}%`)\n                .limit(3)\n\n            if (projects) {\n                results.push(\n                    ...projects.map((project) => ({\n                        id: `project-${project.id}`,\n                        label: project.name,\n                        description: 'Project',\n                        icon: <Briefcase className=\"h-4 w-4\" />,\n                        action: () => {\n                            router.push(`/projects/${project.id}`)\n                            onOpenChange(false)\n                        },\n                        category: 'search',\n                    }))\n                )\n            }\n\n            setSearchResults(results)\n        } catch (error) {\n            console.error('Command palette search error:', error)\n        }\n    }\n\n    // Filter static commands based on query\n    const filteredCommands = staticCommands.filter(\n        (cmd) =>\n            cmd.label.toLowerCase().includes(query.toLowerCase()) ||\n            cmd.description?.toLowerCase().includes(query.toLowerCase())\n    )\n\n    // Combine filtered commands and search results\n    const allCommands = query.length >= 2 ? [...filteredCommands, ...searchResults] : filteredCommands\n\n    // Reset selection when commands change\n    useEffect(() => {\n        setSelectedIndex(0)\n    }, [query])\n\n    // Keyboard navigation\n    const handleKeyDown = useCallback(\n        (e: React.KeyboardEvent) => {\n            switch (e.key) {\n                case 'ArrowDown':\n                    e.preventDefault()\n                    setSelectedIndex((prev) => (prev + 1) % allCommands.length)\n                    break\n                case 'ArrowUp':\n                    e.preventDefault()\n                    setSelectedIndex((prev) => (prev - 1 + allCommands.length) % allCommands.length)\n                    break\n                case 'Enter':\n                    e.preventDefault()\n                    if (allCommands[selectedIndex]) {\n                        allCommands[selectedIndex].action()\n                    }\n                    break\n            }\n        },\n        [allCommands, selectedIndex]\n    )\n\n    // Group commands by category\n    const groupedCommands = allCommands.reduce((acc, cmd) => {\n        if (!acc[cmd.category]) {\n            acc[cmd.category] = []\n        }\n        acc[cmd.category].push(cmd)\n        return acc\n    }, {} as Record<string, Command[]>)\n\n    const categoryLabels = {\n        navigation: 'Navigation',\n        create: 'Create New',\n        search: 'Search Results',\n        settings: 'Settings',\n    }\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent className=\"p-0 max-w-2xl\">\n                <div className=\"flex flex-col max-h-[600px]\">\n                    {/* Search input */}\n                    <div className=\"p-4 border-b border-slate-200\">\n                        <div className=\"relative\">\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n                            <Input\n                                autoFocus\n                                placeholder=\"Type a command or search...\"\n                                value={query}\n                                onChange={(e) => setQuery(e.target.value)}\n                                onKeyDown={handleKeyDown}\n                                className=\"pl-10 pr-10 border-0 focus-visible:ring-0 focus-visible:ring-offset-0\"\n                            />\n                            {isSearching && (\n                                <Loader2 className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-slate-400\" />\n                            )}\n                        </div>\n                    </div>\n\n                    {/* Commands list */}\n                    <div className=\"overflow-y-auto p-2\">\n                        {Object.entries(groupedCommands).length === 0 ? (\n                            <div className=\"p-8 text-center text-slate-500\">\n                                <Search className=\"h-8 w-8 mx-auto mb-2 opacity-30\" />\n                                <p className=\"text-sm\">No commands found</p>\n                            </div>\n                        ) : (\n                            Object.entries(groupedCommands).map(([category, commands]) => (\n                                <div key={category} className=\"mb-4 last:mb-0\">\n                                    <div className=\"px-2 py-1 text-xs font-semibold text-slate-500 uppercase\">\n                                        {categoryLabels[category as keyof typeof categoryLabels]}\n                                    </div>\n                                    <div className=\"space-y-1\">\n                                        {commands.map((cmd, index) => {\n                                            const globalIndex = allCommands.indexOf(cmd)\n                                            return (\n                                                <button\n                                                    key={cmd.id}\n                                                    onClick={() => cmd.action()}\n                                                    onMouseEnter={() => setSelectedIndex(globalIndex)}\n                                                    className={cn(\n                                                        'w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors',\n                                                        globalIndex === selectedIndex\n                                                            ? 'bg-[#3D4A67] text-white'\n                                                            : 'hover:bg-slate-100 text-slate-900'\n                                                    )}\n                                                >\n                                                    <div\n                                                        className={cn(\n                                                            'flex-shrink-0',\n                                                            globalIndex === selectedIndex\n                                                                ? 'text-white'\n                                                                : 'text-slate-600'\n                                                        )}\n                                                    >\n                                                        {cmd.icon}\n                                                    </div>\n                                                    <div className=\"flex-1 min-w-0\">\n                                                        <div className=\"text-sm font-medium truncate\">\n                                                            {cmd.label}\n                                                        </div>\n                                                        {cmd.description && (\n                                                            <div\n                                                                className={cn(\n                                                                    'text-xs truncate',\n                                                                    globalIndex === selectedIndex\n                                                                        ? 'text-white/70'\n                                                                        : 'text-slate-500'\n                                                                )}\n                                                            >\n                                                                {cmd.description}\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                </button>\n                                            )\n                                        })}\n                                    </div>\n                                </div>\n                            ))\n                        )}\n                    </div>\n\n                    {/* Footer */}\n                    <div className=\"p-2 border-t border-slate-200 bg-slate-50\">\n                        <div className=\"flex items-center justify-between text-xs text-slate-500\">\n                            <div className=\"flex gap-4\">\n                                <span>\n                                    <kbd className=\"px-1.5 py-0.5 bg-white border border-slate-300 rounded\">\n                                        \n                                    </kbd>{' '}\n                                    Navigate\n                                </span>\n                                <span>\n                                    <kbd className=\"px-1.5 py-0.5 bg-white border border-slate-300 rounded\">\n                                        Enter\n                                    </kbd>{' '}\n                                    Select\n                                </span>\n                                <span>\n                                    <kbd className=\"px-1.5 py-0.5 bg-white border border-slate-300 rounded\">\n                                        Esc\n                                    </kbd>{' '}\n                                    Close\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </DialogContent>\n        </Dialog>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/activity-timeline.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[929,932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[929,932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadActivities'. Either include it or remove the dependency array.","line":90,"column":8,"nodeType":"ArrayExpression","endLine":90,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [contactId, loadActivities]","fix":{"range":[2737,2748],"text":"[contactId, loadActivities]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { getEntityActivity, EventType } from '@/lib/activity-log'\nimport { formatDistanceToNow } from 'date-fns'\nimport {\n    UserPlus,\n    Edit,\n    Trash2,\n    Mail,\n    Phone,\n    FileText,\n    CheckCircle,\n    Clock,\n    Tag,\n    Loader2,\n    Activity,\n    DollarSign,\n    Upload,\n    Download,\n    Eye,\n    AlertCircle,\n} from 'lucide-react'\n\ninterface ActivityTimelineProps {\n    contactId: string\n}\n\ninterface ActivityEntry {\n    id: string\n    tenant_id: string\n    user_id: string\n    event_type: EventType\n    entity_type: string\n    entity_id: string\n    entity_name?: string\n    description?: string\n    metadata?: Record<string, any>\n    created_at: string\n    user_name?: string\n    user_avatar?: string\n}\n\nconst EVENT_ICONS: Record<EventType, React.ReactNode> = {\n    created: <UserPlus className=\"h-4 w-4 text-green-600\" />,\n    updated: <Edit className=\"h-4 w-4 text-blue-600\" />,\n    deleted: <Trash2 className=\"h-4 w-4 text-red-600\" />,\n    viewed: <Eye className=\"h-4 w-4 text-slate-500\" />,\n    emailed: <Mail className=\"h-4 w-4 text-purple-600\" />,\n    called: <Phone className=\"h-4 w-4 text-indigo-600\" />,\n    noted: <FileText className=\"h-4 w-4 text-amber-600\" />,\n    tagged: <Tag className=\"h-4 w-4 text-pink-600\" />,\n    status_changed: <Activity className=\"h-4 w-4 text-orange-600\" />,\n    assigned: <UserPlus className=\"h-4 w-4 text-teal-600\" />,\n    completed: <CheckCircle className=\"h-4 w-4 text-green-600\" />,\n    invoiced: <DollarSign className=\"h-4 w-4 text-emerald-600\" />,\n    paid: <DollarSign className=\"h-4 w-4 text-green-600\" />,\n    uploaded: <Upload className=\"h-4 w-4 text-blue-500\" />,\n    downloaded: <Download className=\"h-4 w-4 text-slate-500\" />,\n}\n\nconst EVENT_LABELS: Record<EventType, string> = {\n    created: 'Created',\n    updated: 'Updated',\n    deleted: 'Deleted',\n    viewed: 'Viewed',\n    emailed: 'Emailed',\n    called: 'Called',\n    noted: 'Note Added',\n    tagged: 'Tagged',\n    status_changed: 'Status Changed',\n    assigned: 'Assigned',\n    completed: 'Completed',\n    invoiced: 'Invoiced',\n    paid: 'Paid',\n    uploaded: 'Uploaded',\n    downloaded: 'Downloaded',\n}\n\nexport function ActivityTimeline({ contactId }: ActivityTimelineProps) {\n    const [activities, setActivities] = useState<ActivityEntry[]>([])\n    const [isLoading, setIsLoading] = useState(true)\n    const [filter, setFilter] = useState<EventType | 'all'>('all')\n\n    useEffect(() => {\n        loadActivities()\n    }, [contactId])\n\n    async function loadActivities() {\n        setIsLoading(true)\n        try {\n            const data = await getEntityActivity('contact', contactId)\n            setActivities(data as ActivityEntry[])\n        } catch (error) {\n            console.error('Failed to load activities:', error)\n        } finally {\n            setIsLoading(false)\n        }\n    }\n\n    const filteredActivities = filter === 'all'\n        ? activities\n        : activities.filter(a => a.event_type === filter)\n\n    if (isLoading) {\n        return (\n            <Card className=\"border-slate-200 bg-white\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">Activity Timeline</CardTitle>\n                </CardHeader>\n                <CardContent className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-slate-400\" />\n                    <span className=\"ml-2 text-slate-500\">Loading activities...</span>\n                </CardContent>\n            </Card>\n        )\n    }\n\n    return (\n        <Card className=\"border-slate-200 bg-white\">\n            <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-[#3D4A67]\">Activity Timeline</CardTitle>\n                    <Select value={filter} onValueChange={(v) => setFilter(v as EventType | 'all')}>\n                        <SelectTrigger className=\"w-40\">\n                            <SelectValue placeholder=\"Filter by type\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                            <SelectItem value=\"all\">All Activities</SelectItem>\n                            <SelectItem value=\"created\">Created</SelectItem>\n                            <SelectItem value=\"updated\">Updated</SelectItem>\n                            <SelectItem value=\"status_changed\">Status Changed</SelectItem>\n                            <SelectItem value=\"emailed\">Emailed</SelectItem>\n                            <SelectItem value=\"called\">Called</SelectItem>\n                            <SelectItem value=\"noted\">Notes</SelectItem>\n                            <SelectItem value=\"invoiced\">Invoiced</SelectItem>\n                            <SelectItem value=\"paid\">Paid</SelectItem>\n                        </SelectContent>\n                    </Select>\n                </div>\n            </CardHeader>\n            <CardContent>\n                {filteredActivities.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                        <AlertCircle className=\"h-12 w-12 text-slate-300 mb-3\" />\n                        <p className=\"text-slate-500 text-sm\">\n                            {filter === 'all'\n                                ? 'No activity yet for this contact'\n                                : `No ${EVENT_LABELS[filter as EventType].toLowerCase()} activities`}\n                        </p>\n                    </div>\n                ) : (\n                    <div className=\"relative\">\n                        {/* Timeline line */}\n                        <div className=\"absolute left-4 top-0 bottom-0 w-0.5 bg-slate-200\" />\n\n                        {/* Activity items */}\n                        <div className=\"space-y-6\">\n                            {filteredActivities.map((activity) => (\n                                <div key={activity.id} className=\"relative pl-10\">\n                                    {/* Icon */}\n                                    <div className=\"absolute left-0 top-0 flex h-8 w-8 items-center justify-center rounded-full bg-white border-2 border-slate-200\">\n                                        {EVENT_ICONS[activity.event_type] || (\n                                            <Activity className=\"h-4 w-4 text-slate-400\" />\n                                        )}\n                                    </div>\n\n                                    {/* Content */}\n                                    <div className=\"flex-1\">\n                                        <div className=\"flex items-start justify-between gap-2\">\n                                            <div className=\"flex-1\">\n                                                <div className=\"flex items-center gap-2 mb-1\">\n                                                    <Badge variant=\"secondary\" className=\"text-xs bg-slate-100\">\n                                                        {EVENT_LABELS[activity.event_type]}\n                                                    </Badge>\n                                                    {activity.user_name && (\n                                                        <span className=\"text-xs text-slate-500\">\n                                                            by {activity.user_name}\n                                                        </span>\n                                                    )}\n                                                </div>\n                                                <p className=\"text-sm text-slate-700\">\n                                                    {activity.description || `${EVENT_LABELS[activity.event_type]} ${activity.entity_type}`}\n                                                </p>\n                                                {activity.metadata && Object.keys(activity.metadata).length > 0 && (\n                                                    <div className=\"mt-2 text-xs text-slate-500 space-y-1\">\n                                                        {activity.metadata.subject && (\n                                                            <div>Subject: {activity.metadata.subject}</div>\n                                                        )}\n                                                        {activity.metadata.duration && (\n                                                            <div>Duration: {activity.metadata.duration} minutes</div>\n                                                        )}\n                                                        {activity.metadata.amount && (\n                                                            <div>\n                                                                Amount: {activity.metadata.currency} {activity.metadata.amount}\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                )}\n                                            </div>\n                                            <div className=\"flex items-center gap-1 text-xs text-slate-500 shrink-0\">\n                                                <Clock className=\"h-3 w-3\" />\n                                                {formatDistanceToNow(new Date(activity.created_at), { addSuffix: true })}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n            </CardContent>\n        </Card>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/add-contact-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'emailRegex' is defined but never used.","line":26,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"emailRegex"},"fix":{"range":[669,680],"text":""},"desc":"Remove unused variable \"emailRegex\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":28,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Phone"},"fix":{"range":[819,855],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3915,3918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3915,3918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n    DialogTrigger,\n} from \"@/components/ui/dialog\"\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from \"@/components/ui/select\"\nimport { useContactStore } from '@/stores/contact-store'\nimport { ContactStatus, STATUS_LABELS } from '@/types/contact'\nimport { UserPlus, Loader2, AlertCircle } from 'lucide-react'\nimport { emailRegex, isValidEmail, isValidPhone, formatPhone } from '@/lib/validation/contact'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { Phone } from 'lucide-react'\n\nexport function AddContactDialog() {\n    const [open, setOpen] = useState(false)\n    const [isCompany, setIsCompany] = useState(false)\n    const [firstName, setFirstName] = useState('')\n    const [lastName, setLastName] = useState('')\n    const [companyName, setCompanyName] = useState('')\n    const [email, setEmail] = useState('')\n    const [phone, setPhone] = useState('')\n    const [status, setStatus] = useState<ContactStatus>('lead')\n    const [isSubmitting, setIsSubmitting] = useState(false)\n    const [emailError, setEmailError] = useState<string | null>(null)\n    const [phoneError, setPhoneError] = useState<string | null>(null)\n    const [isCheckingEmail, setIsCheckingEmail] = useState(false)\n\n    const addContact = useContactStore((state) => state.addContact)\n    const checkDuplicate = useContactStore((state) => state.checkDuplicate)\n\n    const handleEmailBlur = async () => {\n        if (!email || !isValidEmail(email)) {\n            setEmailError(!email ? null : 'Invalid email format')\n            return\n        }\n\n        setIsCheckingEmail(true)\n        const duplicate = await checkDuplicate(email, undefined)\n        setIsCheckingEmail(false)\n\n        if (duplicate) {\n            setEmailError(`Contact already exists: ${duplicate.firstName} ${duplicate.lastName}`)\n        } else {\n            setEmailError(null)\n        }\n    }\n\n    const handlePhoneBlur = async () => {\n        if (!phone) {\n            setPhoneError(null)\n            return\n        }\n\n        if (isValidPhone(phone)) {\n            const formatted = formatPhone(phone)\n            setPhone(formatted)\n            setPhoneError(null)\n\n            setIsCheckingEmail(true) // Reuse checking state for simplicity\n            const duplicate = await checkDuplicate(undefined, formatted)\n            setIsCheckingEmail(false)\n\n            if (duplicate) {\n                setPhoneError(`Phone already exists: ${duplicate.firstName} ${duplicate.lastName}`)\n            }\n        } else {\n            setPhoneError('Invalid phone format for Switzerland')\n        }\n    }\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault()\n        if (isCompany && !companyName) return\n        if (!isCompany && !firstName) return\n        if (!email || !isValidEmail(email) || emailError || isSubmitting) return\n\n        setIsSubmitting(true)\n        try {\n            const result = await addContact({\n                firstName: isCompany ? '' : firstName,\n                lastName: isCompany ? '' : lastName,\n                isCompany,\n                companyName: companyName || undefined,\n                email,\n                phone: phone || undefined,\n                status,\n            })\n\n            if (result) {\n                // Reset form\n                setIsCompany(false)\n                setFirstName('')\n                setLastName('')\n                setCompanyName('')\n                setEmail('')\n                setPhone('')\n                setStatus('lead')\n                setOpen(false)\n            }\n        } catch (err: any) {\n            setEmailError(err.message)\n        } finally {\n            setIsSubmitting(false)\n        }\n    }\n\n    return (\n        <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n                <Button className=\"bg-[#3D4A67] hover:bg-[#2D3A57] text-white gap-2\">\n                    <UserPlus className=\"h-4 w-4\" />\n                    Add Contact\n                </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[425px]\">\n                <form onSubmit={handleSubmit}>\n                    <DialogHeader>\n                        <DialogTitle className=\"text-[#3D4A67]\">Add New Contact</DialogTitle>\n                        <DialogDescription>\n                            Enter the contact details below. Click save when you&apos;re done.\n                        </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"grid gap-4 py-4\">\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <Button\n                                type=\"button\"\n                                variant={isCompany ? \"outline\" : \"default\"}\n                                onClick={() => setIsCompany(false)}\n                                className={!isCompany ? \"bg-[#3D4A67] text-white\" : \"\"}\n                            >\n                                Individual\n                            </Button>\n                            <Button\n                                type=\"button\"\n                                variant={isCompany ? \"default\" : \"outline\"}\n                                onClick={() => setIsCompany(true)}\n                                className={isCompany ? \"bg-[#3D4A67] text-white\" : \"\"}\n                            >\n                                Company\n                            </Button>\n                        </div>\n\n                        {!isCompany ? (\n                            <>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"firstName\">First Name *</Label>\n                                        <Input\n                                            id=\"firstName\"\n                                            value={firstName}\n                                            onChange={(e) => setFirstName(e.target.value)}\n                                            placeholder=\"John\"\n                                            required={!isCompany}\n                                        />\n                                    </div>\n                                    <div className=\"grid gap-2\">\n                                        <Label htmlFor=\"lastName\">Last Name</Label>\n                                        <Input\n                                            id=\"lastName\"\n                                            value={lastName}\n                                            onChange={(e) => setLastName(e.target.value)}\n                                            placeholder=\"Doe\"\n                                        />\n                                    </div>\n                                </div>\n                                <div className=\"grid gap-2\">\n                                    <Label htmlFor=\"companyName\">Company (Optional)</Label>\n                                    <Input\n                                        id=\"companyName\"\n                                        value={companyName}\n                                        onChange={(e) => setCompanyName(e.target.value)}\n                                        placeholder=\"Acme Inc\"\n                                    />\n                                </div>\n                            </>\n                        ) : (\n                            <div className=\"grid gap-2\">\n                                <Label htmlFor=\"companyName\">Company Name *</Label>\n                                <Input\n                                    id=\"companyName\"\n                                    value={companyName}\n                                    onChange={(e) => setCompanyName(e.target.value)}\n                                    placeholder=\"Acme Inc\"\n                                    required={isCompany}\n                                />\n                            </div>\n                        )}\n                        <div className=\"grid gap-2\">\n                            <Label htmlFor=\"phone\">Phone</Label>\n                            <Input\n                                id=\"phone\"\n                                type=\"tel\"\n                                value={phone}\n                                onChange={(e) => {\n                                    setPhone(e.target.value)\n                                    if (phoneError) setPhoneError(null)\n                                }}\n                                onBlur={handlePhoneBlur}\n                                placeholder=\"+41 79 123 4567\"\n                                className={phoneError ? \"border-red-500\" : \"\"}\n                            />\n                            {phoneError && (\n                                <Alert variant=\"destructive\" className=\"py-2 px-3 mt-1\">\n                                    <AlertCircle className=\"h-3 w-3\" />\n                                    <AlertDescription className=\"text-[11px]\">\n                                        {phoneError}\n                                    </AlertDescription>\n                                </Alert>\n                            )}\n                        </div>\n                        <div className=\"grid gap-2\">\n                            <Label htmlFor=\"email\">Email *</Label>\n                            <Input\n                                id=\"email\"\n                                type=\"email\"\n                                value={email}\n                                onChange={(e) => {\n                                    setEmail(e.target.value)\n                                    if (emailError) setEmailError(null)\n                                }}\n                                onBlur={handleEmailBlur}\n                                placeholder=\"john@example.com\"\n                                required\n                                className={emailError ? \"border-red-500\" : \"\"}\n                            />\n                            {isCheckingEmail && <p className=\"text-[10px] text-slate-500 animate-pulse\">Checking for duplicates...</p>}\n                            {emailError && (\n                                <Alert variant=\"destructive\" className=\"py-2 px-3 mt-1\">\n                                    <AlertCircle className=\"h-3 w-3\" />\n                                    <AlertDescription className=\"text-[11px]\">\n                                        {emailError}\n                                    </AlertDescription>\n                                </Alert>\n                            )}\n                        </div>\n                        <div className=\"grid gap-2\">\n                            <Label htmlFor=\"status\">Status</Label>\n                            <Select value={status} onValueChange={(v) => setStatus(v as ContactStatus)}>\n                                <SelectTrigger>\n                                    <SelectValue placeholder=\"Select status\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    {Object.entries(STATUS_LABELS).map(([value, label]) => (\n                                        <SelectItem key={value} value={value}>\n                                            {label}\n                                        </SelectItem>\n                                    ))}\n                                </SelectContent>\n                            </Select>\n                        </div>\n                    </div>\n                    <DialogFooter>\n                        <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} disabled={isSubmitting}>\n                            Cancel\n                        </Button>\n                        <Button type=\"submit\" className=\"bg-[#3D4A67] hover:bg-[#2D3A57]\" disabled={isSubmitting}>\n                            {isSubmitting ? <><Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />Saving...</> : 'Save Contact'}\n                        </Button>\n                    </DialogFooter>\n                </form>\n            </DialogContent>\n        </Dialog>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/advanced-filters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/column-settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/consent-management.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/contact-invoices-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/contact-overview-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":11,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Plus"},"fix":{"range":[503,509],"text":""},"desc":"Remove unused variable \"Plus\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6978,6981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6978,6981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7059,7062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7059,7062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7135,7138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7135,7138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7210,7213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7210,7213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Contact } from '@/types/contact'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { useInvoiceStore } from '@/stores/invoice-store'\nimport { useProjectStore } from '@/stores/project-store'\nimport { PortalAccessSection } from './portal-access-section'\nimport { ActivityTimeline } from './activity-timeline'\nimport { ConsentManagement } from './consent-management'\nimport { Mail, Phone, Building2, Plus, FileText, FolderKanban, CheckSquare } from 'lucide-react'\nimport { useRouter } from 'next/navigation'\nimport { useMemo } from 'react'\n\ninterface ContactOverviewTabProps {\n    contact: Contact\n}\n\nexport function ContactOverviewTab({ contact }: ContactOverviewTabProps) {\n    const router = useRouter()\n    const invoices = useInvoiceStore((state) => state.invoices)\n    const projects = useProjectStore((state) => state.projects)\n\n    // Calculate stats\n    const stats = useMemo(() => {\n        const contactInvoices = invoices.filter(inv => inv.contact_id === contact.id)\n        const contactProjects = projects.filter(proj => proj.contact_id === contact.id)\n\n        const totalRevenue = contactInvoices\n            .filter(inv => inv.status === 'paid')\n            .reduce((sum, inv) => sum + inv.total, 0)\n\n        const openInvoices = contactInvoices.filter(inv =>\n            inv.status === 'sent' || inv.status === 'overdue'\n        ).length\n\n        const activeProjects = contactProjects.filter(proj =>\n            proj.status === 'active'\n        ).length\n\n        return { totalRevenue, openInvoices, activeProjects }\n    }, [invoices, projects, contact.id])\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Quick Stats */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <Card className=\"border-slate-200 bg-white\">\n                    <CardHeader className=\"pb-3\">\n                        <CardTitle className=\"text-sm font-medium text-slate-600\">Total Revenue</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-2xl font-bold text-[#3D4A67]\">\n                            CHF {stats.totalRevenue.toLocaleString('de-CH', { minimumFractionDigits: 2 })}\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card className=\"border-slate-200 bg-white\">\n                    <CardHeader className=\"pb-3\">\n                        <CardTitle className=\"text-sm font-medium text-slate-600\">Open Invoices</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-2xl font-bold text-[#3D4A67]\">\n                            {stats.openInvoices}\n                        </div>\n                    </CardContent>\n                </Card>\n\n                <Card className=\"border-slate-200 bg-white\">\n                    <CardHeader className=\"pb-3\">\n                        <CardTitle className=\"text-sm font-medium text-slate-600\">Active Projects</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                        <div className=\"text-2xl font-bold text-[#3D4A67]\">\n                            {stats.activeProjects}\n                        </div>\n                    </CardContent>\n                </Card>\n            </div>\n\n            {/* Contact Information */}\n            <Card className=\"border-slate-200 bg-white\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">Contact Information</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-1\">\n                            <span className=\"text-xs text-slate-500 uppercase font-semibold\">Type</span>\n                            <div className=\"text-sm text-slate-700\">{contact.isCompany ? 'Company' : 'Individual'}</div>\n                        </div>\n                        {contact.isCompany ? (\n                            <div className=\"space-y-1\">\n                                <span className=\"text-xs text-slate-500 uppercase font-semibold\">Company Name</span>\n                                <div className=\"text-sm text-slate-700\">{contact.companyName}</div>\n                            </div>\n                        ) : (\n                            <>\n                                <div className=\"space-y-1\">\n                                    <span className=\"text-xs text-slate-500 uppercase font-semibold\">First Name</span>\n                                    <div className=\"text-sm text-slate-700\">{contact.firstName}</div>\n                                </div>\n                                <div className=\"space-y-1\">\n                                    <span className=\"text-xs text-slate-500 uppercase font-semibold\">Last Name</span>\n                                    <div className=\"text-sm text-slate-700\">{contact.lastName || '-'}</div>\n                                </div>\n                            </>\n                        )}\n                    </div>\n\n                    <div className=\"border-t border-slate-100 pt-4 space-y-3\">\n                        {contact.email && (\n                            <div className=\"flex items-center gap-3\">\n                                <Mail className=\"h-4 w-4 text-slate-500\" />\n                                <a href={`mailto:${contact.email}`} className=\"text-slate-700 hover:text-[#3D4A67]\">\n                                    {contact.email}\n                                </a>\n                            </div>\n                        )}\n                        {contact.phone && (\n                            <div className=\"flex items-center gap-3\">\n                                <Phone className=\"h-4 w-4 text-slate-500\" />\n                                <a href={`tel:${contact.phone}`} className=\"text-slate-700 hover:text-[#3D4A67]\">\n                                    {contact.phone}\n                                </a>\n                            </div>\n                        )}\n                        {!contact.isCompany && contact.companyName && (\n                            <div className=\"flex items-center gap-3\">\n                                <Building2 className=\"h-4 w-4 text-slate-500\" />\n                                <span className=\"text-slate-700\">{contact.companyName}</span>\n                            </div>\n                        )}\n                    </div>\n                </CardContent>\n            </Card>\n\n            {/* Client Portal Access */}\n            <PortalAccessSection contact={contact} />\n\n            {/* Privacy & Consent */}\n            <ConsentManagement\n                contactId={contact.id}\n                currentConsent={{\n                    marketing_consent: (contact as any).marketing_consent,\n                    data_processing_consent: (contact as any).data_processing_consent,\n                    consent_date: (contact as any).consent_date,\n                    privacy_policy_version: (contact as any).privacy_policy_version,\n                }}\n            />\n\n            {/* Quick Actions */}\n            <Card className=\"border-slate-200 bg-white\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">Quick Actions</CardTitle>\n                </CardHeader>\n                <CardContent className=\"flex flex-wrap gap-3\">\n                    <Button\n                        onClick={() => router.push(`/invoices/new?contact=${contact.id}`)}\n                        className=\"bg-[#3D4A67] hover:bg-[#2D3A57] text-white\"\n                    >\n                        <FileText className=\"h-4 w-4 mr-2\" />\n                        New Invoice\n                    </Button>\n                    <Button\n                        onClick={() => router.push(`/projects/new?contact=${contact.id}`)}\n                        variant=\"outline\"\n                        className=\"border-slate-300\"\n                    >\n                        <FolderKanban className=\"h-4 w-4 mr-2\" />\n                        New Project\n                    </Button>\n                    <Button\n                        onClick={() => router.push(`/tasks/new?contact=${contact.id}`)}\n                        variant=\"outline\"\n                        className=\"border-slate-300\"\n                    >\n                        <CheckSquare className=\"h-4 w-4 mr-2\" />\n                        New Task\n                    </Button>\n                </CardContent>\n            </Card>\n\n            {/* Activity Timeline */}\n            <ActivityTimeline contactId={contact.id} />\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/contact-projects-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/contact-tasks-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/edit-contact-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":17,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Phone"},"fix":{"range":[463,470],"text":""},"desc":"Remove unused variable \"Phone\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3469,3472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3469,3472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { useContactStore } from '@/stores/contact-store'\nimport { Contact } from '@/types/contact'\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Loader2, AlertCircle, Phone } from 'lucide-react'\nimport { isValidEmail, isValidPhone, formatPhone } from '@/lib/validation/contact'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\n\ninterface EditContactDialogProps {\n    contact: Contact\n    open: boolean\n    onOpenChange: (open: boolean) => void\n}\n\nexport function EditContactDialog({ contact, open, onOpenChange }: EditContactDialogProps) {\n    const { updateContact, checkDuplicate } = useContactStore()\n    const [isLoading, setIsLoading] = useState(false)\n    const [emailError, setEmailError] = useState<string | null>(null)\n    const [phoneError, setPhoneError] = useState<string | null>(null)\n    const [isCheckingEmail, setIsCheckingEmail] = useState(false)\n    const [formData, setFormData] = useState({\n        firstName: contact.firstName,\n        lastName: contact.lastName,\n        isCompany: contact.isCompany,\n        companyName: contact.companyName || '',\n        email: contact.email,\n        phone: contact.phone || '',\n    })\n\n    const handleEmailBlur = async () => {\n        const email = formData.email?.trim()\n        if (!email || !isValidEmail(email)) {\n            setEmailError(!email ? null : 'Invalid email format')\n            return\n        }\n\n        setIsCheckingEmail(true)\n        const duplicate = await checkDuplicate(email, undefined, contact.id)\n        setIsCheckingEmail(false)\n\n        if (duplicate) {\n            setEmailError(`Contact already exists: ${duplicate.firstName} ${duplicate.lastName}`)\n        } else {\n            setEmailError(null)\n        }\n    }\n\n    const handlePhoneBlur = async () => {\n        const phone = formData.phone?.trim()\n        if (!phone) {\n            setPhoneError(null)\n            return\n        }\n\n        if (isValidPhone(phone)) {\n            const formatted = formatPhone(phone)\n            setFormData({ ...formData, phone: formatted })\n            setPhoneError(null)\n\n            setIsCheckingEmail(true)\n            const duplicate = await checkDuplicate(undefined, formatted, contact.id)\n            setIsCheckingEmail(false)\n\n            if (duplicate) {\n                setPhoneError(`Phone already exists: ${duplicate.firstName} ${duplicate.lastName}`)\n            }\n        } else {\n            setPhoneError('Invalid phone format for Switzerland')\n        }\n    }\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault()\n        if (!formData.email || !isValidEmail(formData.email) || emailError || phoneError || isLoading) return\n\n        setIsLoading(true)\n        try {\n            await updateContact(contact.id, {\n                firstName: formData.isCompany ? '' : formData.firstName,\n                lastName: formData.isCompany ? '' : formData.lastName,\n                isCompany: formData.isCompany,\n                companyName: formData.companyName || undefined,\n                email: formData.email,\n                phone: formData.phone || undefined,\n            })\n            onOpenChange(false)\n        } catch (err: any) {\n            setEmailError(err.message)\n        } finally {\n            setIsLoading(false)\n        }\n    }\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent className=\"sm:max-w-[500px] bg-white\">\n                <DialogHeader>\n                    <DialogTitle className=\"text-[#3D4A67]\">Edit Contact</DialogTitle>\n                    <DialogDescription className=\"text-slate-600\">\n                        Update contact information\n                    </DialogDescription>\n                </DialogHeader>\n\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <Button\n                            type=\"button\"\n                            variant={formData.isCompany ? \"outline\" : \"default\"}\n                            onClick={() => setFormData({ ...formData, isCompany: false })}\n                            className={!formData.isCompany ? \"bg-[#3D4A67] text-white\" : \"\"}\n                        >\n                            Individual\n                        </Button>\n                        <Button\n                            type=\"button\"\n                            variant={formData.isCompany ? \"default\" : \"outline\"}\n                            onClick={() => setFormData({ ...formData, isCompany: true })}\n                            className={formData.isCompany ? \"bg-[#3D4A67] text-white\" : \"\"}\n                        >\n                            Company\n                        </Button>\n                    </div>\n\n                    {!formData.isCompany ? (\n                        <>\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"space-y-2\">\n                                    <Label htmlFor=\"firstName\" className=\"text-slate-700\">First Name *</Label>\n                                    <Input\n                                        id=\"firstName\"\n                                        value={formData.firstName}\n                                        onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\n                                        placeholder=\"John\"\n                                        required={!formData.isCompany}\n                                        className=\"border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                                    />\n                                </div>\n                                <div className=\"space-y-2\">\n                                    <Label htmlFor=\"lastName\" className=\"text-slate-700\">Last Name</Label>\n                                    <Input\n                                        id=\"lastName\"\n                                        value={formData.lastName}\n                                        onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\n                                        placeholder=\"Doe\"\n                                        className=\"border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                                    />\n                                </div>\n                            </div>\n                            <div className=\"space-y-2\">\n                                <Label htmlFor=\"companyName\" className=\"text-slate-700\">Company (Optional)</Label>\n                                <Input\n                                    id=\"companyName\"\n                                    value={formData.companyName}\n                                    onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}\n                                    placeholder=\"Acme Inc\"\n                                    className=\"border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                                />\n                            </div>\n                        </>\n                    ) : (\n                        <div className=\"space-y-2\">\n                            <Label htmlFor=\"companyName\" className=\"text-slate-700\">Company Name *</Label>\n                            <Input\n                                id=\"companyName\"\n                                value={formData.companyName}\n                                onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}\n                                placeholder=\"Acme Inc\"\n                                required={formData.isCompany}\n                                className=\"border-slate-300 bg-white text-slate-900 placeholder:text-slate-400\"\n                            />\n                        </div>\n                    )}\n\n                    <div className=\"space-y-2\">\n                        <Label htmlFor=\"email\" className=\"text-slate-700\">\n                            Email *\n                        </Label>\n                        <Input\n                            id=\"email\"\n                            type=\"email\"\n                            value={formData.email}\n                            onChange={(e) => {\n                                setFormData({ ...formData, email: e.target.value })\n                                if (emailError) setEmailError(null)\n                            }}\n                            onBlur={handleEmailBlur}\n                            placeholder=\"john@example.com\"\n                            required\n                            className={`border-slate-300 bg-white text-slate-900 placeholder:text-slate-400 ${emailError ? \"border-red-500\" : \"\"}`}\n                        />\n                        {isCheckingEmail && <p className=\"text-[10px] text-slate-500 animate-pulse\">Checking for duplicates...</p>}\n                        {emailError && (\n                            <Alert variant=\"destructive\" className=\"py-2 px-3 mt-1\">\n                                <AlertCircle className=\"h-3 w-3\" />\n                                <AlertDescription className=\"text-[11px]\">\n                                    {emailError}\n                                </AlertDescription>\n                            </Alert>\n                        )}\n                    </div>\n\n                    <div className=\"space-y-2\">\n                        <Label htmlFor=\"phone\" className=\"text-slate-700\">\n                            Phone\n                        </Label>\n                        <Input\n                            id=\"phone\"\n                            type=\"tel\"\n                            value={formData.phone}\n                            onChange={(e) => {\n                                setFormData({ ...formData, phone: e.target.value })\n                                if (phoneError) setPhoneError(null)\n                            }}\n                            onBlur={handlePhoneBlur}\n                            placeholder=\"+41 79 123 4567\"\n                            className={`border-slate-300 bg-white text-slate-900 placeholder:text-slate-400 ${phoneError ? \"border-red-500\" : \"\"}`}\n                        />\n                        {phoneError && (\n                            <Alert variant=\"destructive\" className=\"py-2 px-3 mt-1\">\n                                <AlertCircle className=\"h-3 w-3\" />\n                                <AlertDescription className=\"text-[11px]\">\n                                    {phoneError}\n                                </AlertDescription>\n                            </Alert>\n                        )}\n                    </div>\n\n                    <DialogFooter>\n                        <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            onClick={() => onOpenChange(false)}\n                            disabled={isLoading}\n                            className=\"border-slate-300\"\n                        >\n                            Cancel\n                        </Button>\n                        <Button\n                            type=\"submit\"\n                            disabled={isLoading}\n                            className=\"bg-[#3D4A67] hover:bg-[#2D3A57] text-white\"\n                        >\n                            {isLoading ? (\n                                <>\n                                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                                    Saving...\n                                </>\n                            ) : (\n                                'Save Changes'\n                            )}\n                        </Button>\n                    </DialogFooter>\n                </form>\n            </DialogContent>\n        </Dialog>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/export-contacts-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":55,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2611,2614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2611,2614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Download, FileSpreadsheet, File, CheckCircle2, Loader2 } from 'lucide-react'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { Label } from '@/components/ui/label'\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'\nimport { Checkbox } from '@/components/ui/checkbox'\n\ninterface ExportContactsDialogProps {\n  totalContacts: number\n}\n\ntype ExportFormat = 'csv' | 'xlsx'\n\ninterface ExportOptions {\n  format: ExportFormat\n  includeFields: {\n    name: boolean\n    email: boolean\n    phone: boolean\n    company: boolean\n    status: boolean\n    tags: boolean\n    createdAt: boolean\n  }\n}\n\nexport function ExportContactsDialog({ totalContacts }: ExportContactsDialogProps) {\n  const [open, setOpen] = useState(false)\n  const [isExporting, setIsExporting] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [options, setOptions] = useState<ExportOptions>({\n    format: 'csv',\n    includeFields: {\n      name: true,\n      email: true,\n      phone: true,\n      company: true,\n      status: true,\n      tags: true,\n      createdAt: false,\n    }\n  })\n\n  const handleExport = async () => {\n    setIsExporting(true)\n    setError(null)\n\n    try {\n      // Build query params for selected fields\n      const fields = Object.entries(options.includeFields)\n        .filter(([_, include]) => include)\n        .map(([field]) => field)\n        .join(',')\n\n      const response = await fetch(`/api/contacts/export?format=${options.format}&fields=${fields}`, {\n        method: 'GET',\n      })\n\n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(error.error || 'Export failed')\n      }\n\n      // Get filename from Content-Disposition header or generate one\n      const contentDisposition = response.headers.get('Content-Disposition')\n      const filenameMatch = contentDisposition?.match(/filename=\"?([^\";]+)\"?/)\n      const filename = filenameMatch?.[1] || `contacts-export.${options.format}`\n\n      // Download file\n      const blob = await response.blob()\n      const url = window.URL.createObjectURL(blob)\n      const a = document.createElement('a')\n      a.href = url\n      a.download = filename\n      document.body.appendChild(a)\n      a.click()\n      window.URL.revokeObjectURL(url)\n      document.body.removeChild(a)\n\n      // Close dialog\n      setOpen(false)\n    } catch (err: any) {\n      console.error('Export error:', err)\n      setError(err.message || 'Failed to export contacts')\n    } finally {\n      setIsExporting(false)\n    }\n  }\n\n  const toggleField = (field: keyof ExportOptions['includeFields']) => {\n    setOptions(prev => ({\n      ...prev,\n      includeFields: {\n        ...prev.includeFields,\n        [field]: !prev.includeFields[field]\n      }\n    }))\n  }\n\n  const selectedFieldsCount = Object.values(options.includeFields).filter(Boolean).length\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" className=\"gap-2\">\n          <Download className=\"h-4 w-4\" />\n          Export\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Export Contacts</DialogTitle>\n          <DialogDescription>\n            Download your contacts in CSV or Excel format\n          </DialogDescription>\n        </DialogHeader>\n\n        {error && (\n          <Alert variant=\"destructive\">\n            <AlertDescription>{error}</AlertDescription>\n          </Alert>\n        )}\n\n        <div className=\"space-y-6\">\n          {/* Format Selection */}\n          <div className=\"space-y-3\">\n            <Label className=\"text-sm font-medium\">Export Format</Label>\n            <RadioGroup\n              value={options.format}\n              onValueChange={(value) => setOptions(prev => ({ ...prev, format: value as ExportFormat }))}\n            >\n              <div className=\"flex items-center space-x-2 border rounded-lg p-3 hover:bg-gray-50 cursor-pointer\">\n                <RadioGroupItem value=\"csv\" id=\"csv\" />\n                <Label htmlFor=\"csv\" className=\"flex items-center gap-2 cursor-pointer flex-1\">\n                  <FileSpreadsheet className=\"h-4 w-4 text-gray-600\" />\n                  <div>\n                    <div className=\"font-medium\">CSV</div>\n                    <div className=\"text-xs text-gray-500\">Comma-separated values</div>\n                  </div>\n                </Label>\n              </div>\n              <div className=\"flex items-center space-x-2 border rounded-lg p-3 hover:bg-gray-50 cursor-pointer\">\n                <RadioGroupItem value=\"xlsx\" id=\"xlsx\" />\n                <Label htmlFor=\"xlsx\" className=\"flex items-center gap-2 cursor-pointer flex-1\">\n                  <File className=\"h-4 w-4 text-gray-600\" />\n                  <div>\n                    <div className=\"font-medium\">Excel</div>\n                    <div className=\"text-xs text-gray-500\">Microsoft Excel (.xlsx)</div>\n                  </div>\n                </Label>\n              </div>\n            </RadioGroup>\n          </div>\n\n          {/* Field Selection */}\n          <div className=\"space-y-3\">\n            <Label className=\"text-sm font-medium\">Include Fields</Label>\n            <div className=\"border rounded-lg p-4 space-y-3\">\n              {Object.entries(options.includeFields).map(([field, included]) => (\n                <div key={field} className=\"flex items-center space-x-2\">\n                  <Checkbox\n                    id={field}\n                    checked={included}\n                    onCheckedChange={() => toggleField(field as keyof ExportOptions['includeFields'])}\n                  />\n                  <Label\n                    htmlFor={field}\n                    className=\"text-sm font-normal cursor-pointer capitalize\"\n                  >\n                    {field === 'createdAt' ? 'Created Date' : field}\n                  </Label>\n                </div>\n              ))}\n            </div>\n            <p className=\"text-xs text-gray-500\">\n              {selectedFieldsCount} field{selectedFieldsCount !== 1 ? 's' : ''} selected\n            </p>\n          </div>\n\n          {/* Summary */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <div className=\"flex items-start gap-2\">\n              <CheckCircle2 className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n              <div className=\"text-sm\">\n                <p className=\"font-medium text-blue-900\">Ready to export</p>\n                <p className=\"text-blue-700\">\n                  {totalContacts} contact{totalContacts !== 1 ? 's' : ''}  {selectedFieldsCount} field{selectedFieldsCount !== 1 ? 's' : ''}  {options.format.toUpperCase()}\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-2 justify-end\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setOpen(false)}\n              disabled={isExporting}\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleExport}\n              disabled={isExporting || selectedFieldsCount === 0}\n            >\n              {isExporting ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Exporting...\n                </>\n              ) : (\n                <>\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Export\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/import-contacts-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":9,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[382,385],"text":""},"desc":"Remove unused variable \"X\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1029,1032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1029,1032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3608,3611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3608,3611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5488,5491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5488,5491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5556,5559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5556,5559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5587,5590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5587,5590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6125,6128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6125,6128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":200,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7215,7218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7215,7218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'errorData' is assigned a value but never used.","line":250,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":250,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":251,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":251,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8458,8461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8458,8461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":263,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8720,8723],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8720,8723],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":393,"column":32,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[13760,13875],"text":"\n                Match your file&apos;s columns to OrbitCRM fields. Required fields: First Name and Email\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[13760,13875],"text":"\n                Match your file&lsquo;s columns to OrbitCRM fields. Required fields: First Name and Email\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[13760,13875],"text":"\n                Match your file&#39;s columns to OrbitCRM fields. Required fields: First Name and Email\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[13760,13875],"text":"\n                Match your file&rsquo;s columns to OrbitCRM fields. Required fields: First Name and Email\n              "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useCallback, useMemo } from 'react'\nimport { useDropzone } from 'react-dropzone'\nimport Papa from 'papaparse'\nimport * as XLSX from 'xlsx'\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Upload, FileSpreadsheet, File, X, CheckCircle2, AlertCircle, ArrowRight, ArrowLeft } from 'lucide-react'\nimport { Progress } from '@/components/ui/progress'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'\nimport { Badge } from '@/components/ui/badge'\n\ninterface ImportContactsDialogProps {\n  onImportComplete?: () => void\n}\n\ntype ImportStep = 'upload' | 'mapping' | 'preview' | 'importing' | 'complete'\n\ninterface ParsedData {\n  headers: string[]\n  rows: any[]\n  fileName: string\n  fileType: 'csv' | 'xlsx' | 'vcf'\n}\n\n// OrbitCRM field definitions\nconst ORBITCRM_FIELDS = [\n  { value: 'firstName', label: 'First Name', required: true },\n  { value: 'lastName', label: 'Last Name', required: false },\n  { value: 'companyName', label: 'Company Name', required: false },\n  { value: 'email', label: 'Email', required: true },\n  { value: 'phone', label: 'Phone', required: false },\n  { value: 'status', label: 'Status', required: false },\n  { value: 'tags', label: 'Tags', required: false },\n  { value: 'skip', label: '(Skip this column)', required: false },\n] as const\n\ntype ColumnMapping = Record<string, string>\n\n// Auto-detect column mappings based on common patterns\nfunction autoDetectMapping(headers: string[]): ColumnMapping {\n  const mapping: ColumnMapping = {}\n\n  headers.forEach(header => {\n    const lowerHeader = header.toLowerCase().trim()\n\n    if (lowerHeader === 'first name' || lowerHeader === 'given name' || lowerHeader === 'fname') {\n      mapping[header] = 'firstName'\n    } else if (lowerHeader === 'last name' || lowerHeader === 'family name' || lowerHeader === 'lname') {\n      mapping[header] = 'lastName'\n    } else if (lowerHeader === 'name' || lowerHeader === 'full name' || lowerHeader === 'contact') {\n      mapping[header] = 'firstName' // Default to first name if single name column\n    } else if (lowerHeader.includes('email') || lowerHeader === 'e-mail') {\n      mapping[header] = 'email'\n    } else if (lowerHeader.includes('phone') || lowerHeader.includes('mobile') || lowerHeader.includes('tel')) {\n      mapping[header] = 'phone'\n    } else if (lowerHeader.includes('company') || lowerHeader.includes('organization') || lowerHeader.includes('org')) {\n      mapping[header] = 'companyName'\n    } else if (lowerHeader.includes('status') || lowerHeader.includes('stage')) {\n      mapping[header] = 'status'\n    } else if (lowerHeader.includes('tag')) {\n      mapping[header] = 'tags'\n    } else {\n      mapping[header] = 'skip'\n    }\n  })\n\n  return mapping\n}\n\nexport function ImportContactsDialog({ onImportComplete }: ImportContactsDialogProps) {\n  const [open, setOpen] = useState(false)\n  const [step, setStep] = useState<ImportStep>('upload')\n  const [parsedData, setParsedData] = useState<ParsedData | null>(null)\n  const [columnMapping, setColumnMapping] = useState<ColumnMapping>({})\n  const [error, setError] = useState<string | null>(null)\n  const [progress, setProgress] = useState(0)\n  const [importResult, setImportResult] = useState<{\n    imported: number\n    skipped: number\n    duplicates: any[]\n  } | null>(null)\n  const [validationErrors, setValidationErrors] = useState<{ row: number, errors: { field: string, message: string }[] }[]>([])\n\n  const onDrop = useCallback(async (acceptedFiles: File[]) => {\n    const file = acceptedFiles[0]\n    if (!file) return\n\n    setError(null)\n\n    try {\n      const fileType = file.name.endsWith('.csv') ? 'csv'\n        : file.name.endsWith('.xlsx') || file.name.endsWith('.xls') ? 'xlsx'\n          : file.name.endsWith('.vcf') ? 'vcf'\n            : null\n\n      if (!fileType) {\n        setError('Unsupported file type. Please upload CSV, Excel, or vCard files.')\n        return\n      }\n\n      if (fileType === 'csv') {\n        // Parse CSV\n        Papa.parse(file, {\n          header: true,\n          skipEmptyLines: true,\n          complete: (results) => {\n            if (results.data.length === 0) {\n              setError('File is empty or could not be parsed.')\n              return\n            }\n\n            const headers = results.meta.fields || []\n            setParsedData({\n              headers,\n              rows: results.data,\n              fileName: file.name,\n              fileType: 'csv'\n            })\n            setColumnMapping(autoDetectMapping(headers))\n            setStep('mapping')\n          },\n          error: (error) => {\n            setError(`CSV parsing error: ${error.message}`)\n          }\n        })\n      } else if (fileType === 'xlsx') {\n        // Parse Excel\n        const data = await file.arrayBuffer()\n        const workbook = XLSX.read(data, { type: 'array' })\n        const firstSheet = workbook.Sheets[workbook.SheetNames[0]]\n        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 })\n\n        if (jsonData.length < 2) {\n          setError('Excel file must have at least 2 rows (header + data).')\n          return\n        }\n\n        const headers = (jsonData[0] as any[]).map(String)\n        const rows = jsonData.slice(1).map((row: any) => {\n          const obj: any = {}\n          headers.forEach((header, index) => {\n            obj[header] = row[index] || ''\n          })\n          return obj\n        })\n\n        setParsedData({\n          headers,\n          rows,\n          fileName: file.name,\n          fileType: 'xlsx'\n        })\n        setColumnMapping(autoDetectMapping(headers))\n        setStep('mapping')\n      } else if (fileType === 'vcf') {\n        // TODO: Implement vCard parsing\n        setError('vCard import coming soon. Please use CSV or Excel for now.')\n      }\n    } catch (err: any) {\n      setError(`Failed to parse file: ${err.message}`)\n    }\n  }, [])\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: {\n      'text/csv': ['.csv'],\n      'application/vnd.ms-excel': ['.xls'],\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],\n      'text/vcard': ['.vcf']\n    },\n    maxFiles: 1\n  })\n\n  // Validate column mapping\n  const mappingValidation = useMemo(() => {\n    const mappedFields = Object.values(columnMapping).filter(v => v !== 'skip')\n    const hasFirstName = mappedFields.includes('firstName')\n    const hasEmail = mappedFields.includes('email')\n    const isValid = hasFirstName && hasEmail\n\n    return {\n      isValid,\n      errors: [\n        ...(!hasFirstName ? ['First Name field is required'] : []),\n        ...(!hasEmail ? ['Email field is required'] : []),\n      ]\n    }\n  }, [columnMapping])\n\n  // Preview data with mapped columns\n  const previewData = useMemo(() => {\n    if (!parsedData) return []\n\n    return parsedData.rows.slice(0, 50).map(row => {\n      const mapped: any = {}\n      Object.entries(columnMapping).forEach(([sourceCol, targetField]) => {\n        if (targetField !== 'skip') {\n          mapped[targetField] = row[sourceCol]\n        }\n      })\n      return mapped\n    })\n  }, [parsedData, columnMapping])\n\n  const handleReset = () => {\n    setStep('upload')\n    setParsedData(null)\n    setColumnMapping({})\n    setError(null)\n    setProgress(0)\n    setImportResult(null)\n    setValidationErrors([])\n  }\n\n  const handleImport = async () => {\n    if (!parsedData) return\n\n    setStep('importing')\n    setError(null)\n    setProgress(0)\n\n    try {\n      // Simulate progress\n      const progressInterval = setInterval(() => {\n        setProgress(prev => Math.min(prev + 5, 90))\n      }, 100)\n\n      const response = await fetch('/api/contacts/import', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          contacts: parsedData.rows,\n          columnMapping,\n        }),\n      })\n\n      clearInterval(progressInterval)\n      setProgress(100)\n\n      const result = await response.json()\n\n      if (!response.ok) {\n        const errorData = result\n        const error = new Error(result.error || 'Import failed') as any\n        error.details = result.details\n        throw error\n      }\n\n      setImportResult({\n        imported: result.imported,\n        skipped: result.skipped,\n        duplicates: result.duplicates || []\n      })\n\n      setStep('complete')\n    } catch (err: any) {\n      console.error('Import error:', err)\n      setError(err.message || 'Failed to import contacts')\n      if (err.details?.errors) {\n        setValidationErrors(err.details.errors)\n      }\n      setStep('preview')\n    }\n  }\n\n  const handleClose = () => {\n    setOpen(false)\n    handleReset()\n  }\n\n  const updateColumnMapping = (sourceColumn: string, targetField: string) => {\n    setColumnMapping(prev => ({\n      ...prev,\n      [sourceColumn]: targetField\n    }))\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" className=\"gap-2\">\n          <Upload className=\"h-4 w-4\" />\n          Import Contacts\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto overflow-x-hidden\">\n        <DialogHeader>\n          <DialogTitle>Import Contacts</DialogTitle>\n          <DialogDescription>\n            Upload a CSV or Excel file to import your contacts in bulk\n          </DialogDescription>\n        </DialogHeader>\n\n        {error && (\n          <div className=\"space-y-2\">\n            <Alert variant=\"destructive\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n            {validationErrors.length > 0 && (\n              <div className=\"bg-red-50 border border-red-200 rounded-lg p-3 max-h-40 overflow-y-auto\">\n                <p className=\"text-xs font-bold text-red-800 mb-1\">Row-level Validation Failures:</p>\n                <ul className=\"space-y-1\">\n                  {validationErrors.map((err, i) => (\n                    <li key={i} className=\"text-[11px] text-red-700\">\n                      Row {err.row}: {err.errors.map(e => `${e.field}: ${e.message}`).join(', ')}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Step 1: Upload */}\n        {step === 'upload' && (\n          <div className=\"space-y-4\">\n            <div\n              {...getRootProps()}\n              className={`border-2 border-dashed rounded-lg p-12 text-center cursor-pointer transition-colors ${isDragActive\n                ? 'border-blue-500 bg-blue-50'\n                : 'border-gray-300 hover:border-gray-400'\n                }`}\n            >\n              <input {...getInputProps()} />\n              <Upload className=\"h-12 w-12 mx-auto mb-4 text-gray-400\" />\n              {isDragActive ? (\n                <p className=\"text-lg font-medium\">Drop your file here...</p>\n              ) : (\n                <>\n                  <p className=\"text-lg font-medium mb-2\">\n                    Drag and drop your file here\n                  </p>\n                  <p className=\"text-sm text-gray-500 mb-4\">\n                    or click to browse\n                  </p>\n                  <div className=\"flex items-center justify-center gap-4 text-sm text-gray-600\">\n                    <div className=\"flex items-center gap-1\">\n                      <FileSpreadsheet className=\"h-4 w-4\" />\n                      CSV\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <File className=\"h-4 w-4\" />\n                      Excel\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <File className=\"h-4 w-4\" />\n                      vCard\n                    </div>\n                  </div>\n                </>\n              )}\n            </div>\n\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n              <p className=\"text-sm font-medium text-blue-900 mb-2\">\n                Supported file formats:\n              </p>\n              <ul className=\"text-sm text-blue-800 space-y-1\">\n                <li> CSV (.csv) - Comma-separated values</li>\n                <li> Excel (.xlsx, .xls) - Microsoft Excel spreadsheet</li>\n                <li> vCard (.vcf) - Contact card format (coming soon)</li>\n              </ul>\n            </div>\n          </div>\n        )}\n\n        {/* Step 2: Column Mapping */}\n        {step === 'mapping' && parsedData && (\n          <div className=\"space-y-4 w-full overflow-hidden\">\n            <div className=\"bg-gray-50 border rounded-lg p-4 flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium mb-1\">File uploaded successfully:</p>\n                <p className=\"text-sm text-gray-600 truncate max-w-[250px] sm:max-w-md\">\n                  {parsedData.fileName}  {parsedData.rows.length} contacts found\n                </p>\n              </div>\n              <Button variant=\"ghost\" size=\"sm\" onClick={handleReset} className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-50\">\n                Change File\n              </Button>\n            </div>\n\n            <div>\n              <h3 className=\"text-lg font-medium mb-2\">Map Your Columns</h3>\n              <p className=\"text-sm text-gray-600 mb-4\">\n                Match your file's columns to OrbitCRM fields. Required fields: First Name and Email\n              </p>\n\n              <div className=\"border rounded-lg overflow-x-auto w-full\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"w-1/3\">Your Column</TableHead>\n                      <TableHead className=\"w-1/3\">Maps To</TableHead>\n                      <TableHead className=\"w-1/3\">Sample Data</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {parsedData.headers.map((header) => (\n                      <TableRow key={header}>\n                        <TableCell className=\"font-medium\">{header}</TableCell>\n                        <TableCell>\n                          <Select\n                            value={columnMapping[header]}\n                            onValueChange={(value) => updateColumnMapping(header, value)}\n                          >\n                            <SelectTrigger className=\"w-full\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {ORBITCRM_FIELDS.map((field) => (\n                                <SelectItem key={field.value} value={field.value}>\n                                  <div className=\"flex items-center gap-2\">\n                                    {field.label} {field.required && <Badge variant=\"destructive\" className=\"ml-1 text-xs\">Required</Badge>}\n                                  </div>\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell className=\"text-sm text-gray-500 italic max-w-0 truncate\">\n                          {parsedData.rows[0]?.[header] || '(empty)'}\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n\n            {!mappingValidation.isValid && (\n              <Alert variant=\"destructive\">\n                <AlertCircle className=\"h-4 w-4\" />\n                <AlertDescription>\n                  <p className=\"font-medium mb-1\">Please fix the following errors:</p>\n                  <ul className=\"list-disc list-inside\">\n                    {mappingValidation.errors.map((error, i) => (\n                      <li key={i}>{error}</li>\n                    ))}\n                  </ul>\n                </AlertDescription>\n              </Alert>\n            )}\n\n            <div className=\"flex gap-2 justify-between\">\n              <Button variant=\"outline\" onClick={handleReset}>\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back\n              </Button>\n              <Button\n                onClick={() => setStep('preview')}\n                disabled={!mappingValidation.isValid}\n              >\n                Continue to Preview\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* Step 3: Preview */}\n        {step === 'preview' && parsedData && (\n          <div className=\"space-y-4 w-full overflow-hidden\">\n            <div>\n              <h3 className=\"text-lg font-medium mb-2\">Preview Import</h3>\n              <p className=\"text-sm text-gray-600 mb-4\">\n                Showing first {Math.min(50, parsedData.rows.length)} of {parsedData.rows.length} contacts\n              </p>\n\n              <div className=\"border rounded-lg overflow-x-auto w-full\">\n                <Table className=\"w-full\" style={{ minWidth: '800px' }}>\n                  <TableHeader>\n                    <TableRow>\n                      {ORBITCRM_FIELDS.filter(f => f.value !== 'skip' && Object.values(columnMapping).includes(f.value)).map((field) => (\n                        <TableHead key={field.value} className=\"whitespace-nowrap font-semibold\">\n                          {field.label}\n                        </TableHead>\n                      ))}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {previewData.map((row, i) => (\n                      <TableRow key={i}>\n                        {ORBITCRM_FIELDS.filter(f => f.value !== 'skip' && Object.values(columnMapping).includes(f.value)).map((field) => (\n                          <TableCell key={`${i}-${field.value}`} className=\"whitespace-nowrap\">\n                            {row[field.value] || '-'}\n                          </TableCell>\n                        ))}\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n\n            <div className=\"flex items-center justify-between border-t pt-4\">\n              <Button variant=\"outline\" onClick={() => setStep('mapping')} className=\"flex items-center gap-2\">\n                <ArrowLeft className=\"h-4 w-4\" />\n                Back to Mapping\n              </Button>\n              <Button onClick={handleImport} className=\"flex items-center gap-2\">\n                Start Import ({parsedData.rows.length} contacts)\n                <ArrowRight className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* Step 4: Importing */}\n        {step === 'importing' && (\n          <div className=\"space-y-4\">\n            <div className=\"text-center py-8\">\n              <p className=\"text-lg font-medium mb-4\">Importing contacts...</p>\n              <Progress value={progress} className=\"w-full\" />\n              <p className=\"text-sm text-gray-500 mt-2\">{progress}% complete</p>\n            </div>\n          </div>\n        )}\n\n        {/* Step 5: Complete */}\n        {step === 'complete' && importResult && (\n          <div className=\"space-y-4\">\n            <div className=\"text-center py-8\">\n              <CheckCircle2 className=\"h-16 w-16 mx-auto mb-4 text-green-600\" />\n              <p className=\"text-lg font-medium mb-2\">Import Complete!</p>\n              <p className=\"text-sm text-gray-600\">\n                Successfully imported {importResult.imported} contacts\n              </p>\n              {importResult.skipped > 0 && (\n                <p className=\"text-sm text-amber-600 mt-2\">\n                  {importResult.skipped} duplicate(s) skipped\n                </p>\n              )}\n            </div>\n\n            {importResult.duplicates.length > 0 && (\n              <Alert>\n                <AlertCircle className=\"h-4 w-4\" />\n                <AlertDescription>\n                  <p className=\"font-medium mb-1\">Duplicates found:</p>\n                  <ul className=\"text-sm space-y-1\">\n                    {importResult.duplicates.slice(0, 5).map((dup, i) => (\n                      <li key={i}>Row {dup.row}: {dup.email}</li>\n                    ))}\n                    {importResult.duplicates.length > 5 && (\n                      <li>...and {importResult.duplicates.length - 5} more</li>\n                    )}\n                  </ul>\n                </AlertDescription>\n              </Alert>\n            )}\n\n            <div className=\"flex gap-2 justify-end\">\n              <Button onClick={() => {\n                handleClose()\n                onImportComplete?.()\n              }}>\n                Done\n              </Button>\n            </div>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/kanban-board.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/kanban-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/kanban-column.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/merge-contacts-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ContactStatus' is defined but never used.","line":4,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":32,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ContactStatus"},"fix":{"range":[74,89],"text":""},"desc":"Remove unused variable \"ContactStatus\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/merge-contacts-dialog.tsx:51:13\n  49 |         if (open && contacts.length === 2) {\n  50 |             const first = contacts[0]\n> 51 |             setPrimaryId(prev => prev === first.id ? prev : first.id)\n     |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  52 |             setMergedData({\n  53 |                 firstName: first.firstName,\n  54 |                 lastName: first.lastName,","line":51,"column":13,"nodeType":null,"endLine":51,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from \"react\"\nimport { Contact, ContactStatus, STATUS_LABELS } from \"@/types/contact\"\nimport {\n    Dialog,\n    DialogContent,\n    DialogDescription,\n    DialogFooter,\n    DialogHeader,\n    DialogTitle,\n} from \"@/components/ui/dialog\"\nimport { Button } from \"@/components/ui/button\"\nimport { Label } from \"@/components/ui/label\"\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\"\nimport { useContactStore } from \"@/stores/contact-store\"\nimport { toast } from \"sonner\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Info } from \"lucide-react\"\n\ninterface MergeContactsDialogProps {\n    open: boolean\n    onOpenChange: (open: boolean) => void\n    contacts: Contact[]\n}\n\nexport function MergeContactsDialog({ open, onOpenChange, contacts }: MergeContactsDialogProps) {\n    const mergeContacts = useContactStore(state => state.mergeContacts)\n    const [isMerging, setIsMerging] = useState(false)\n\n    // State for winning fields\n    const [primaryId, setPrimaryId] = useState<string>(contacts[0]?.id || '')\n    const [mergedData, setMergedData] = useState<Partial<Contact>>(() => {\n        const first = contacts[0]\n        if (!first) return {}\n        return {\n            firstName: first.firstName,\n            lastName: first.lastName,\n            isCompany: first.isCompany,\n            companyName: first.companyName,\n            email: first.email,\n            phone: first.phone,\n            status: first.status,\n        }\n    })\n\n    // Reset state when contacts change and dialog opens\n    useEffect(() => {\n        if (open && contacts.length === 2) {\n            const first = contacts[0]\n            setPrimaryId(prev => prev === first.id ? prev : first.id)\n            setMergedData({\n                firstName: first.firstName,\n                lastName: first.lastName,\n                isCompany: first.isCompany,\n                companyName: first.companyName,\n                email: first.email,\n                phone: first.phone,\n                status: first.status,\n            })\n        }\n    }, [contacts, open])\n\n    if (contacts.length !== 2) return null\n\n    const contactA = contacts[0]\n    const contactB = contacts[1]\n\n    const handleFieldSelect = <K extends keyof Contact>(field: K, value: Contact[K], sourceId: string) => {\n        setMergedData(prev => ({ ...prev, [field]: value }))\n        if (field === 'id') setPrimaryId(sourceId)\n    }\n\n    const handleMerge = async () => {\n        setIsMerging(true)\n        const secondaryId = contactA.id === primaryId ? contactB.id : contactA.id\n\n        const success = await mergeContacts(primaryId, secondaryId, mergedData)\n\n        if (success) {\n            toast.success(\"Contacts merged successfully\")\n            onOpenChange(false)\n        } else {\n            toast.error(\"Failed to merge contacts\")\n        }\n        setIsMerging(false)\n    }\n\n    const renderFieldRow = (label: string, field: keyof Contact) => {\n        const valA = contactA[field]\n        const valB = contactB[field]\n        const currentVal = mergedData[field]\n\n        return (\n            <div className=\"grid grid-cols-3 gap-4 items-center py-3 border-b border-slate-100 last:border-0\">\n                <div className=\"text-sm font-medium text-slate-500\">{label}</div>\n                <div\n                    className={`p-2 rounded-md cursor-pointer border transition-colors ${currentVal === valA ? 'border-[#3D4A67] bg-[#3D4A67]/5' : 'border-slate-200 hover:border-slate-300'}`}\n                    onClick={() => handleFieldSelect(field, valA, contactA.id)}\n                >\n                    <div className=\"text-sm break-all\">{valA as string || '-'}</div>\n                </div>\n                <div\n                    className={`p-2 rounded-md cursor-pointer border transition-colors ${currentVal === valB ? 'border-[#3D4A67] bg-[#3D4A67]/5' : 'border-slate-200 hover:border-slate-300'}`}\n                    onClick={() => handleFieldSelect(field, valB, contactB.id)}\n                >\n                    <div className=\"text-sm break-all\">{valB as string || '-'}</div>\n                </div>\n            </div>\n        )\n    }\n\n    return (\n        <Dialog open={open} onOpenChange={onOpenChange}>\n            <DialogContent className=\"max-w-2xl text-slate-900 border-slate-200\">\n                <DialogHeader>\n                    <DialogTitle className=\"text-[#3D4A67]\">Merge Contacts</DialogTitle>\n                    <DialogDescription>\n                        Reconcile data between two contacts. Select the values you want to keep in the final record.\n                    </DialogDescription>\n                </DialogHeader>\n\n                <div className=\"py-4\">\n                    <div className=\"grid grid-cols-3 gap-4 mb-4 text-xs font-bold uppercase tracking-wider text-slate-400 px-2\">\n                        <div>Field</div>\n                        <div>Contact A</div>\n                        <div>Contact B</div>\n                    </div>\n\n                    <div className=\"max-h-[60vh] overflow-y-auto px-2\">\n                        {renderFieldRow(\"First Name\", \"firstName\")}\n                        {renderFieldRow(\"Last Name\", \"lastName\")}\n                        {renderFieldRow(\"Email\", \"email\")}\n                        {renderFieldRow(\"Phone\", \"phone\")}\n                        {renderFieldRow(\"Company\", \"companyName\")}\n\n                        {/* Special handling for status which is a badge */}\n                        <div className=\"grid grid-cols-3 gap-4 items-center py-3 border-b border-slate-100\">\n                            <div className=\"text-sm font-medium text-slate-500\">Status</div>\n                            <div\n                                className={`p-2 rounded-md cursor-pointer border transition-colors ${mergedData.status === contactA.status ? 'border-[#3D4A67] bg-[#3D4A67]/5' : 'border-slate-200 hover:border-slate-300'}`}\n                                onClick={() => handleFieldSelect('status', contactA.status, contactA.id)}\n                            >\n                                <Badge variant=\"outline\" className=\"font-normal\">{STATUS_LABELS[contactA.status]}</Badge>\n                            </div>\n                            <div\n                                className={`p-2 rounded-md cursor-pointer border transition-colors ${mergedData.status === contactB.status ? 'border-[#3D4A67] bg-[#3D4A67]/5' : 'border-slate-200 hover:border-slate-300'}`}\n                                onClick={() => handleFieldSelect('status', contactB.status, contactB.id)}\n                            >\n                                <Badge variant=\"outline\" className=\"font-normal\">{STATUS_LABELS[contactB.status]}</Badge>\n                            </div>\n                        </div>\n\n                        {/* Primary Record Selection */}\n                        <div className=\"mt-6 p-4 bg-slate-50 rounded-lg border border-slate-200\">\n                            <h5 className=\"text-sm font-semibold text-[#3D4A67] mb-2 flex items-center\">\n                                <Info className=\"h-4 w-4 mr-2\" />\n                                Which record should be the primary?\n                            </h5>\n                            <p className=\"text-xs text-slate-500 mb-4\">\n                                The primary record will preserve its ID. All tags and notes from both contacts will be combined.\n                            </p>\n                            <RadioGroup value={primaryId} onValueChange={setPrimaryId} className=\"flex gap-4\">\n                                <div className=\"flex items-center space-x-2\">\n                                    <RadioGroupItem value={contactA.id} id=\"primary-a\" />\n                                    <Label htmlFor=\"primary-a\" className=\"text-sm\">Contact A</Label>\n                                </div>\n                                <div className=\"flex items-center space-x-2\">\n                                    <RadioGroupItem value={contactB.id} id=\"primary-b\" />\n                                    <Label htmlFor=\"primary-b\" className=\"text-sm\">Contact B</Label>\n                                </div>\n                            </RadioGroup>\n                        </div>\n                    </div>\n                </div>\n\n                <DialogFooter>\n                    <Button variant=\"outline\" onClick={() => onOpenChange(false)} disabled={isMerging}>\n                        Cancel\n                    </Button>\n                    <Button\n                        onClick={handleMerge}\n                        disabled={isMerging}\n                        className=\"bg-[#3D4A67] hover:bg-[#2D3A57] text-white\"\n                    >\n                        {isMerging ? \"Merging...\" : \"Confirm Merge\"}\n                    </Button>\n                </DialogFooter>\n            </DialogContent>\n        </Dialog>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/notes-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/portal-access-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/quick-actions-menu.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ExternalLink' is defined but never used.","line":18,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ExternalLink"},"fix":{"range":[318,336],"text":""},"desc":"Remove unused variable \"ExternalLink\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mail' is defined but never used.","line":19,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Mail"},"fix":{"range":[336,346],"text":""},"desc":"Remove unused variable \"Mail\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle2' is defined but never used.","line":20,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCircle2"},"fix":{"range":[346,364],"text":""},"desc":"Remove unused variable \"CheckCircle2\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuLabel,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n    MoreHorizontal,\n    Edit,\n    Eye,\n    Copy,\n    Trash2,\n    ExternalLink,\n    Mail,\n    CheckCircle2\n} from \"lucide-react\"\nimport { Contact } from \"@/types/contact\"\nimport { toast } from \"sonner\"\nimport Link from \"next/link\"\n\ninterface QuickActionsMenuProps {\n    contact: Contact\n    onEdit?: () => void\n    onDelete?: () => void\n}\n\nexport function QuickActionsMenu({ contact, onEdit, onDelete }: QuickActionsMenuProps) {\n    const copyEmail = () => {\n        navigator.clipboard.writeText(contact.email)\n        toast.success(`Email copied: ${contact.email}`)\n    }\n\n    return (\n        <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" className=\"h-8 w-8 p-0\">\n                    <span className=\"sr-only\">Open menu</span>\n                    <MoreHorizontal className=\"h-4 w-4\" />\n                </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\n                <DropdownMenuLabel>Actions</DropdownMenuLabel>\n                <DropdownMenuItem asChild>\n                    <Link href={`/contacts/${contact.id}`} className=\"flex items-center cursor-pointer\">\n                        <Eye className=\"mr-2 h-4 w-4\" />\n                        View Details\n                    </Link>\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={copyEmail} className=\"cursor-pointer\">\n                    <Copy className=\"mr-2 h-4 w-4\" />\n                    Copy Email\n                </DropdownMenuItem>\n\n                <DropdownMenuSeparator />\n\n                {onEdit && (\n                    <DropdownMenuItem onClick={onEdit} className=\"cursor-pointer\">\n                        <Edit className=\"mr-2 h-4 w-4\" />\n                        Edit Contact\n                    </DropdownMenuItem>\n                )}\n\n                <DropdownMenuSeparator />\n\n                {onDelete && (\n                    <DropdownMenuItem\n                        onClick={onDelete}\n                        className=\"text-red-600 focus:text-red-600 cursor-pointer\"\n                    >\n                        <Trash2 className=\"mr-2 h-4 w-4\" />\n                        Archive\n                    </DropdownMenuItem>\n                )}\n            </DropdownMenuContent>\n        </DropdownMenu>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/contacts/tags-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/dashboard/organization-activity-feed.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[819,822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[819,822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadActivities'. Either include it or remove the dependency array.","line":109,"column":8,"nodeType":"ArrayExpression","endLine":109,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadActivities]","fix":{"range":[3282,3284],"text":"[loadActivities]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { getOrganizationActivity, EventType } from '@/lib/activity-log'\nimport { formatDistanceToNow } from 'date-fns'\nimport {\n    UserPlus,\n    Edit,\n    Trash2,\n    Mail,\n    Phone,\n    FileText,\n    CheckCircle,\n    Clock,\n    Tag,\n    Loader2,\n    Activity,\n    DollarSign,\n    Upload,\n    Download,\n    Eye,\n    AlertCircle,\n} from 'lucide-react'\nimport Link from 'next/link'\n\ninterface ActivityEntry {\n    id: string\n    tenant_id: string\n    user_id: string\n    event_type: EventType\n    entity_type: string\n    entity_id: string\n    entity_name?: string\n    description?: string\n    metadata?: Record<string, any>\n    created_at: string\n    user_name?: string\n    user_avatar?: string\n}\n\nconst EVENT_ICONS: Record<EventType, React.ReactNode> = {\n    created: <UserPlus className=\"h-3.5 w-3.5 text-green-600\" />,\n    updated: <Edit className=\"h-3.5 w-3.5 text-blue-600\" />,\n    deleted: <Trash2 className=\"h-3.5 w-3.5 text-red-600\" />,\n    viewed: <Eye className=\"h-3.5 w-3.5 text-slate-500\" />,\n    emailed: <Mail className=\"h-3.5 w-3.5 text-purple-600\" />,\n    called: <Phone className=\"h-3.5 w-3.5 text-indigo-600\" />,\n    noted: <FileText className=\"h-3.5 w-3.5 text-amber-600\" />,\n    tagged: <Tag className=\"h-3.5 w-3.5 text-pink-600\" />,\n    status_changed: <Activity className=\"h-3.5 w-3.5 text-orange-600\" />,\n    assigned: <UserPlus className=\"h-3.5 w-3.5 text-teal-600\" />,\n    completed: <CheckCircle className=\"h-3.5 w-3.5 text-green-600\" />,\n    invoiced: <DollarSign className=\"h-3.5 w-3.5 text-emerald-600\" />,\n    paid: <DollarSign className=\"h-3.5 w-3.5 text-green-600\" />,\n    uploaded: <Upload className=\"h-3.5 w-3.5 text-blue-500\" />,\n    downloaded: <Download className=\"h-3.5 w-3.5 text-slate-500\" />,\n}\n\nconst EVENT_LABELS: Record<EventType, string> = {\n    created: 'Created',\n    updated: 'Updated',\n    deleted: 'Deleted',\n    viewed: 'Viewed',\n    emailed: 'Emailed',\n    called: 'Called',\n    noted: 'Note',\n    tagged: 'Tagged',\n    status_changed: 'Status',\n    assigned: 'Assigned',\n    completed: 'Completed',\n    invoiced: 'Invoice',\n    paid: 'Payment',\n    uploaded: 'Upload',\n    downloaded: 'Download',\n}\n\nconst ENTITY_COLORS: Record<string, string> = {\n    contact: 'bg-[#3D4A67]/10 text-[#3D4A67]',\n    project: 'bg-[#9EAE8E]/10 text-[#9EAE8E]',\n    task: 'bg-[#E9B949]/10 text-[#E9B949]',\n    invoice: 'bg-[#D1855C]/10 text-[#D1855C]',\n    document: 'bg-blue-100 text-blue-700',\n    note: 'bg-purple-100 text-purple-700',\n}\n\nconst ENTITY_LINKS: Record<string, (id: string) => string> = {\n    contact: (id) => `/contacts/${id}`,\n    project: (id) => `/projects/${id}`,\n    task: (id) => `/tasks/${id}`,\n    invoice: (id) => `/invoices/${id}`,\n}\n\ninterface OrganizationActivityFeedProps {\n    limit?: number\n    showViewAll?: boolean\n}\n\nexport function OrganizationActivityFeed({\n    limit = 20,\n    showViewAll = false\n}: OrganizationActivityFeedProps) {\n    const [activities, setActivities] = useState<ActivityEntry[]>([])\n    const [isLoading, setIsLoading] = useState(true)\n\n    useEffect(() => {\n        loadActivities()\n    }, [])\n\n    async function loadActivities() {\n        setIsLoading(true)\n        try {\n            const data = await getOrganizationActivity(limit)\n            setActivities(data as ActivityEntry[])\n        } catch (error) {\n            console.error('Failed to load organization activities:', error)\n        } finally {\n            setIsLoading(false)\n        }\n    }\n\n    if (isLoading) {\n        return (\n            <Card className=\"border-slate-200 bg-white shadow-sm\">\n                <CardHeader>\n                    <CardTitle className=\"text-[#3D4A67]\">Recent Activity</CardTitle>\n                    <CardDescription className=\"text-slate-600\">\n                        Organization-wide activity feed\n                    </CardDescription>\n                </CardHeader>\n                <CardContent className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-slate-400\" />\n                    <span className=\"ml-2 text-slate-500\">Loading activities...</span>\n                </CardContent>\n            </Card>\n        )\n    }\n\n    const linkableActivity = (activity: ActivityEntry) => {\n        const entityType = activity.entity_type\n        if (ENTITY_LINKS[entityType]) {\n            return ENTITY_LINKS[entityType](activity.entity_id)\n        }\n        return null\n    }\n\n    return (\n        <Card className=\"border-slate-200 bg-white shadow-sm\">\n            <CardHeader>\n                <CardTitle className=\"text-[#3D4A67]\">Recent Activity</CardTitle>\n                <CardDescription className=\"text-slate-600\">\n                    Organization-wide activity feed\n                </CardDescription>\n            </CardHeader>\n            <CardContent>\n                {activities.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                        <AlertCircle className=\"h-12 w-12 text-slate-300 mb-3\" />\n                        <p className=\"text-slate-500 text-sm\">No recent activity</p>\n                        <p className=\"text-slate-400 text-xs mt-1\">\n                            Activity will appear here as you work in the CRM\n                        </p>\n                    </div>\n                ) : (\n                    <div className=\"space-y-3 max-h-[500px] overflow-y-auto\">\n                        {activities.map((activity) => {\n                            const link = linkableActivity(activity)\n                            const content = (\n                                <div className=\"flex items-start gap-3 text-sm\">\n                                    {/* Icon */}\n                                    <div className=\"flex-shrink-0 mt-0.5 flex h-7 w-7 items-center justify-center rounded-full bg-slate-100\">\n                                        {EVENT_ICONS[activity.event_type] || (\n                                            <Activity className=\"h-3.5 w-3.5 text-slate-400\" />\n                                        )}\n                                    </div>\n\n                                    {/* Content */}\n                                    <div className=\"flex-1 min-w-0\">\n                                        <div className=\"flex items-center gap-2 mb-0.5 flex-wrap\">\n                                            {activity.user_name && (\n                                                <span className=\"text-slate-700 font-medium\">\n                                                    {activity.user_name}\n                                                </span>\n                                            )}\n                                            <Badge\n                                                variant=\"secondary\"\n                                                className={`text-xs ${ENTITY_COLORS[activity.entity_type] || 'bg-slate-100 text-slate-700'}`}\n                                            >\n                                                {activity.entity_type}\n                                            </Badge>\n                                            <Badge variant=\"outline\" className=\"text-xs\">\n                                                {EVENT_LABELS[activity.event_type]}\n                                            </Badge>\n                                        </div>\n                                        <p className=\"text-slate-600 text-sm line-clamp-1\">\n                                            {activity.description || `${EVENT_LABELS[activity.event_type]} ${activity.entity_type}`}\n                                        </p>\n                                        {activity.entity_name && (\n                                            <p className=\"text-slate-500 text-xs mt-0.5\">\n                                                {activity.entity_name}\n                                            </p>\n                                        )}\n                                    </div>\n\n                                    {/* Timestamp */}\n                                    <div className=\"flex items-center gap-1 text-xs text-slate-400 shrink-0\">\n                                        <Clock className=\"h-3 w-3\" />\n                                        <span className=\"hidden sm:inline\">\n                                            {formatDistanceToNow(new Date(activity.created_at), { addSuffix: true })}\n                                        </span>\n                                    </div>\n                                </div>\n                            )\n\n                            return link ? (\n                                <Link\n                                    key={activity.id}\n                                    href={link}\n                                    className=\"block rounded-lg p-3 hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-200\"\n                                >\n                                    {content}\n                                </Link>\n                            ) : (\n                                <div\n                                    key={activity.id}\n                                    className=\"p-3 rounded-lg\"\n                                >\n                                    {content}\n                                </div>\n                            )\n                        })}\n                    </div>\n                )}\n\n                {showViewAll && activities.length > 0 && (\n                    <div className=\"mt-4 pt-4 border-t border-slate-200 text-center\">\n                        <Link\n                            href=\"/activity\"\n                            className=\"text-sm text-[#3D4A67] hover:underline font-medium\"\n                        >\n                            View all activity \n                        </Link>\n                    </div>\n                )}\n            </CardContent>\n        </Card>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/documents/upload-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/error-boundary.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":95,"column":39,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3308,3516],"text":"\n                                    We&apos;re sorry, but something unexpected happened. Our team has been\n                                    notified and we're working on a fix.\n                                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3308,3516],"text":"\n                                    We&lsquo;re sorry, but something unexpected happened. Our team has been\n                                    notified and we're working on a fix.\n                                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3308,3516],"text":"\n                                    We&#39;re sorry, but something unexpected happened. Our team has been\n                                    notified and we're working on a fix.\n                                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3308,3516],"text":"\n                                    We&rsquo;re sorry, but something unexpected happened. Our team has been\n                                    notified and we're working on a fix.\n                                "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":96,"column":52,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3308,3516],"text":"\n                                    We're sorry, but something unexpected happened. Our team has been\n                                    notified and we&apos;re working on a fix.\n                                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3308,3516],"text":"\n                                    We're sorry, but something unexpected happened. Our team has been\n                                    notified and we&lsquo;re working on a fix.\n                                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3308,3516],"text":"\n                                    We're sorry, but something unexpected happened. Our team has been\n                                    notified and we&#39;re working on a fix.\n                                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3308,3516],"text":"\n                                    We're sorry, but something unexpected happened. Our team has been\n                                    notified and we&rsquo;re working on a fix.\n                                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Component, ReactNode } from 'react'\nimport { AlertTriangle, RefreshCw } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent } from '@/components/ui/card'\n\ninterface Props {\n    children: ReactNode\n    fallback?: ReactNode\n}\n\ninterface State {\n    hasError: boolean\n    error?: Error\n}\n\n/**\n * Error Boundary Component\n *\n * Catches React errors and displays a fallback UI\n * In production, errors should be logged to error tracking service (e.g., Sentry)\n */\nexport class ErrorBoundary extends Component<Props, State> {\n    constructor(props: Props) {\n        super(props)\n        this.state = { hasError: false }\n    }\n\n    static getDerivedStateFromError(error: Error): State {\n        return { hasError: true, error }\n    }\n\n    componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n        // Log to console in development\n        console.error('Error caught by boundary:', error, errorInfo)\n\n        // In production, log to error tracking service\n        if (process.env.NODE_ENV === 'production') {\n            // Example: Sentry.captureException(error, { extra: errorInfo })\n            // Or send to your own error logging API\n            this.logErrorToService(error, errorInfo)\n        }\n    }\n\n    async logErrorToService(error: Error, errorInfo: React.ErrorInfo) {\n        try {\n            // Send error to your error logging endpoint\n            await fetch('/api/errors/log', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    message: error.message,\n                    stack: error.stack,\n                    componentStack: errorInfo.componentStack,\n                    timestamp: new Date().toISOString(),\n                    userAgent: navigator.userAgent,\n                    url: window.location.href,\n                }),\n            })\n        } catch (logError) {\n            console.error('Failed to log error:', logError)\n        }\n    }\n\n    handleReset = () => {\n        this.setState({ hasError: false, error: undefined })\n    }\n\n    render() {\n        if (this.state.hasError) {\n            // Custom fallback UI\n            if (this.props.fallback) {\n                return this.props.fallback\n            }\n\n            // Default fallback UI\n            return (\n                <div className=\"min-h-screen flex items-center justify-center p-4 bg-slate-50\">\n                    <Card className=\"max-w-lg w-full border-red-200\">\n                        <CardContent className=\"pt-6\">\n                            <div className=\"text-center\">\n                                {/* Icon */}\n                                <div className=\"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\n                                    <AlertTriangle className=\"h-8 w-8 text-red-600\" />\n                                </div>\n\n                                {/* Title */}\n                                <h2 className=\"text-2xl font-bold text-slate-900 mb-2\">\n                                    Something went wrong\n                                </h2>\n\n                                {/* Description */}\n                                <p className=\"text-slate-600 mb-6\">\n                                    We're sorry, but something unexpected happened. Our team has been\n                                    notified and we're working on a fix.\n                                </p>\n\n                                {/* Error details (only in development) */}\n                                {process.env.NODE_ENV === 'development' && this.state.error && (\n                                    <div className=\"mb-6 p-4 bg-slate-100 rounded-lg text-left\">\n                                        <p className=\"text-sm font-mono text-red-600 mb-2\">\n                                            {this.state.error.message}\n                                        </p>\n                                        <pre className=\"text-xs text-slate-600 overflow-auto max-h-32\">\n                                            {this.state.error.stack}\n                                        </pre>\n                                    </div>\n                                )}\n\n                                {/* Actions */}\n                                <div className=\"flex gap-3 justify-center\">\n                                    <Button\n                                        onClick={this.handleReset}\n                                        className=\"bg-[#3D4A67] hover:bg-[#2D3A57] text-white\"\n                                    >\n                                        <RefreshCw className=\"h-4 w-4 mr-2\" />\n                                        Try Again\n                                    </Button>\n                                    <Button\n                                        variant=\"outline\"\n                                        onClick={() => (window.location.href = '/dashboard')}\n                                        className=\"border-slate-300\"\n                                    >\n                                        Go to Dashboard\n                                    </Button>\n                                </div>\n\n                                {/* Support contact */}\n                                <p className=\"text-xs text-slate-500 mt-6\">\n                                    If this problem persists, please contact{' '}\n                                    <a\n                                        href=\"mailto:support@orbitcrm.com\"\n                                        className=\"text-blue-600 hover:underline\"\n                                    >\n                                        support@orbitcrm.com\n                                    </a>\n                                </p>\n                            </div>\n                        </CardContent>\n                    </Card>\n                </div>\n            )\n        }\n\n        return this.props.children\n    }\n}\n\n/**\n * Simpler error boundary for specific components\n */\nexport function SimpleErrorBoundary({ children }: { children: ReactNode }) {\n    return (\n        <ErrorBoundary\n            fallback={\n                <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg\">\n                    <div className=\"flex items-start gap-3\">\n                        <AlertTriangle className=\"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5\" />\n                        <div>\n                            <h3 className=\"font-medium text-red-900 mb-1\">Error loading component</h3>\n                            <p className=\"text-sm text-red-700\">\n                                This component failed to load. Try refreshing the page.\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            }\n        >\n            {children}\n        </ErrorBoundary>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/layout/admin-sidebar.tsx","messages":[{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/layout/admin-sidebar.tsx:136:26\n  134 |                     {/* Using Dialog as a rough mobile drawer replacement since Sheet is missing */}\n  135 |                     <DialogContent className=\"bg-[#3D4A67] border-0 text-white h-full sm:max-w-xs absolute left-0 top-0 bottom-0 rounded-none data-[state=open]:slide-in-from-left-1/2\">\n> 136 |                         <NavContent />\n      |                          ^^^^^^^^^^ This component is created during render\n  137 |                     </DialogContent>\n  138 |                 </Dialog>\n  139 |                 <span className=\"ml-4 font-bold text-white\">OrbitCRM</span>\n\n/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/layout/admin-sidebar.tsx:44:24\n  42 |     };\n  43 |\n> 44 |     const NavContent = () => (\n     |                        ^^^^^^^\n> 45 |         <div className=\"flex flex-col h-full\">\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 46 |             <div className=\"mb-8 pl-4\">\n     \n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 80 |         </div>\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 81 |     );\n     | ^^^^^^ The component is created during render here\n  82 |\n  83 |     return (\n  84 |         <>","line":136,"column":26,"nodeType":null,"endLine":136,"endColumn":36}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from \"next/link\";\nimport { usePathname, useRouter } from \"next/navigation\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Menu, LayoutDashboard, Users, FolderKanban, CheckSquare, MessageSquare, FileText, Receipt, Settings, LogOut } from 'lucide-react';\nimport * as React from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\n\nconst links = [\n    { href: \"/contacts\", icon: Users, label: \"Contacts\" },\n    { href: \"/projects\", icon: FolderKanban, label: \"Projects\" },\n    { href: \"/invoices\", icon: Receipt, label: \"Invoices\" },\n    { href: \"/tasks\", icon: CheckSquare, label: \"Tasks\" },\n    { href: \"/documents\", icon: FileText, label: \"Vault\" },\n    { href: \"/chat\", icon: MessageSquare, label: \"Orbit AI\" },\n];\n\nexport function AdminSidebar() {\n    const pathname = usePathname();\n    const router = useRouter();\n    const [open, setOpen] = React.useState(false);\n    const [isLoggingOut, setIsLoggingOut] = React.useState(false);\n\n    const handleLogout = async () => {\n        setIsLoggingOut(true);\n        try {\n            const supabase = createClient();\n            await supabase.auth.signOut();\n            // Clear any localStorage data\n            localStorage.removeItem('orbitcrm-contacts');\n            localStorage.removeItem('orbitcrm-projects');\n            localStorage.removeItem('orbitcrm-tasks');\n            localStorage.removeItem('orbitcrm-chat');\n            router.push('/login');\n            router.refresh();\n        } catch (error) {\n            console.error('Logout error:', error);\n            setIsLoggingOut(false);\n        }\n    };\n\n    const NavContent = () => (\n        <div className=\"flex flex-col h-full\">\n            <div className=\"mb-8 pl-4\">\n                <h1 className=\"text-xl font-bold text-white\">OrbitCRM</h1>\n            </div>\n            <nav className=\"space-y-1 flex-1\">\n                <Link href=\"/dashboard\"\n                    onClick={() => setOpen(false)}\n                    className={`flex items-center gap-3 rounded-lg px-3 py-2.5 transition-colors ${pathname === '/dashboard' ? 'bg-white/10 text-white' : 'text-white/80 hover:bg-white/10 hover:text-white'}`}>\n                    <LayoutDashboard className=\"h-5 w-5\" />\n                    Dashboard\n                </Link>\n                {links.map(l => (\n                    <Link key={l.href} href={l.href}\n                        onClick={() => setOpen(false)}\n                        className={`flex items-center gap-3 rounded-lg px-3 py-2.5 transition-colors ${pathname.startsWith(l.href) ? 'bg-white/10 text-white' : 'text-white/80 hover:bg-white/10 hover:text-white'}`}>\n                        <l.icon className=\"h-5 w-5\" />\n                        {l.label}\n                    </Link>\n                ))}\n            </nav>\n            <div className=\"mt-auto space-y-1\">\n                <Link href=\"/settings\" className=\"flex items-center gap-3 rounded-lg px-3 py-2.5 text-white/80 hover:bg-white/10 hover:text-white transition-colors\">\n                    <Settings className=\"h-5 w-5\" />\n                    Settings\n                </Link>\n                <Button \n                    variant=\"ghost\" \n                    onClick={handleLogout}\n                    disabled={isLoggingOut}\n                    className=\"w-full justify-start gap-3 text-white/80 hover:bg-white/10 hover:text-white\"\n                >\n                    <LogOut className=\"h-5 w-5\" />\n                    {isLoggingOut ? 'Logging out...' : 'Logout'}\n                </Button>\n            </div>\n        </div>\n    );\n\n    return (\n        <>\n            {/* Desktop Sidebar - Hover Expand */}\n            <aside className=\"hidden md:flex fixed inset-y-0 left-0 w-20 hover:w-64 bg-[#3D4A67] transition-all duration-300 ease-in-out flex-col z-50 overflow-hidden group shadow-xl\">\n                <div className=\"flex flex-col h-full w-64\">\n                    {/* Fixed width container inside to prevent text squashing during transition */}\n                    <div className=\"mb-8 pl-6 h-16 flex items-center\">\n                        <h1 className=\"text-xl font-bold text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300\">OrbitCRM</h1>\n                    </div>\n                    <nav className=\"space-y-1 flex-1 px-3\">\n                        <Link href=\"/dashboard\"\n                            className={`flex items-center gap-4 rounded-lg px-3 py-3 transition-colors ${pathname === '/dashboard' ? 'bg-white/10 text-white' : 'text-white/80 hover:bg-white/10 hover:text-white'}`}>\n                            <LayoutDashboard className=\"h-6 w-6 min-w-[24px]\" />\n                            <span className=\"opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap\">Dashboard</span>\n                        </Link>\n                        {links.map(l => (\n                            <Link key={l.href} href={l.href}\n                                className={`flex items-center gap-4 rounded-lg px-3 py-3 transition-colors ${pathname.startsWith(l.href) ? 'bg-white/10 text-white' : 'text-white/80 hover:bg-white/10 hover:text-white'}`}>\n                                <l.icon className=\"h-6 w-6 min-w-[24px]\" />\n                                <span className=\"opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap\">{l.label}</span>\n                            </Link>\n                        ))}\n                    </nav>\n                    <div className=\"mt-auto space-y-1 mb-8 px-3\">\n                        <Link href=\"/settings\" className=\"flex items-center gap-4 rounded-lg px-3 py-3 text-white/80 hover:bg-white/10 hover:text-white transition-colors\">\n                            <Settings className=\"h-6 w-6 min-w-[24px]\" />\n                            <span className=\"opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap\">Settings</span>\n                        </Link>\n                        <Button \n                            variant=\"ghost\" \n                            onClick={handleLogout}\n                            disabled={isLoggingOut}\n                            className=\"w-full justify-start gap-4 px-3 py-3 h-auto text-white/80 hover:bg-white/10 hover:text-white\"\n                        >\n                            <LogOut className=\"h-6 w-6 min-w-[24px]\" />\n                            <span className=\"opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap\">\n                                {isLoggingOut ? 'Logging out...' : 'Logout'}\n                            </span>\n                        </Button>\n                    </div>\n                </div>\n            </aside>\n\n            {/* Mobile Header */}\n            <div className=\"md:hidden fixed top-0 left-0 right-0 h-16 bg-[#3D4A67] flex items-center px-4 z-40\">\n                <Dialog open={open} onOpenChange={setOpen}>\n                    <DialogTrigger asChild>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"text-white\">\n                            <Menu className=\"h-6 w-6\" />\n                        </Button>\n                    </DialogTrigger>\n                    {/* Using Dialog as a rough mobile drawer replacement since Sheet is missing */}\n                    <DialogContent className=\"bg-[#3D4A67] border-0 text-white h-full sm:max-w-xs absolute left-0 top-0 bottom-0 rounded-none data-[state=open]:slide-in-from-left-1/2\">\n                        <NavContent />\n                    </DialogContent>\n                </Dialog>\n                <span className=\"ml-4 font-bold text-white\">OrbitCRM</span>\n            </div>\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/layout/portal-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/modules/ai/omnibox.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bot' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":13,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Bot"},"fix":{"range":[197,201],"text":""},"desc":"Remove unused variable \"Bot\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":7,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":19,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[200,206],"text":""},"desc":"Remove unused variable \"User\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[437,440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[437,440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[445,448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[445,448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":34,"column":62,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1399,1436],"text":"Example: &quot;Find documents about Taxes\""},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1399,1436],"text":"Example: &ldquo;Find documents about Taxes\""},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1399,1436],"text":"Example: &#34;Find documents about Taxes\""},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1399,1436],"text":"Example: &rdquo;Find documents about Taxes\""},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":34,"column":89,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1399,1436],"text":"Example: \"Find documents about Taxes&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1399,1436],"text":"Example: \"Find documents about Taxes&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1399,1436],"text":"Example: \"Find documents about Taxes&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1399,1436],"text":"Example: \"Find documents about Taxes&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1569,1572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1569,1572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport * as React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card } from '@/components/ui/card';\nimport { Bot, User, Send, Sparkles } from 'lucide-react';\nimport { useChat } from '@ai-sdk/react';\n\nexport function Omnibox() {\n    const { messages, input, handleInputChange, handleSubmit, isLoading } = useChat({\n        api: '/api/chat',\n    } as any) as any;\n\n    const scrollRef = React.useRef<HTMLDivElement>(null);\n\n    React.useEffect(() => {\n        if (scrollRef.current) {\n            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n        }\n    }, [messages]);\n\n    return (\n        <Card className=\"fixed bottom-4 right-4 w-[400px] h-[500px] shadow-2xl flex flex-col z-50 border-slate-200 dark:border-slate-800\">\n            <div className=\"p-3 border-b flex items-center bg-slate-50 dark:bg-slate-900 rounded-t-lg\">\n                <Sparkles className=\"w-4 h-4 text-purple-600 mr-2\" />\n                <span className=\"font-semibold text-sm\">Orbit AI</span>\n            </div>\n\n            <div className=\"flex-1 p-4 overflow-y-auto\" ref={scrollRef}>\n                {messages.length === 0 && (\n                    <div className=\"text-center text-slate-400 text-sm mt-20\">\n                        <p>How can I help you today?</p>\n                        <p className=\"text-xs mt-2\">Example: \"Find documents about Taxes\"</p>\n                    </div>\n                )}\n                <div className=\"space-y-4\">\n                    {messages.map((m: any) => (\n                        <div key={m.id} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>\n                            <div className={`max-w-[85%] rounded-lg p-3 text-sm ${m.role === 'user'\n                                ? 'bg-blue-600 text-white'\n                                : 'bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-200'\n                                }`}>\n                                {m.content}\n                            </div>\n                        </div>\n                    ))}\n                    {isLoading && (\n                        <div className=\"flex justify-start\">\n                            <div className=\"bg-slate-100 dark:bg-slate-800 rounded-lg p-3 text-sm text-slate-500 animate-pulse\">\n                                Thinking...\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n\n            <form onSubmit={handleSubmit} className=\"p-3 border-t flex gap-2\">\n                <Input\n                    value={input}\n                    onChange={handleInputChange}\n                    placeholder=\"Ask Orbit...\"\n                    className=\"flex-1\"\n                />\n                <Button type=\"submit\" size=\"icon\" disabled={isLoading}>\n                    <Send className=\"w-4 h-4\" />\n                </Button>\n            </form>\n        </Card>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/modules/directory/company-lookup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/modules/directory/contact-list.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":5,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardHeader"},"fix":{"range":[122,134],"text":""},"desc":"Remove unused variable \"CardHeader\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":5,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardTitle"},"fix":{"range":[134,145],"text":""},"desc":"Remove unused variable \"CardTitle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Select' is defined but never used.","line":10,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Select"},"fix":{"range":[489,496],"text":""},"desc":"Remove unused variable \"Select\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectContent' is defined but never used.","line":10,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":31,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SelectContent"},"fix":{"range":[495,510],"text":""},"desc":"Remove unused variable \"SelectContent\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectItem' is defined but never used.","line":10,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":43,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SelectItem"},"fix":{"range":[510,522],"text":""},"desc":"Remove unused variable \"SelectItem\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectTrigger' is defined but never used.","line":10,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":58,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SelectTrigger"},"fix":{"range":[522,537],"text":""},"desc":"Remove unused variable \"SelectTrigger\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SelectValue' is defined but never used.","line":10,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":71,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"SelectValue"},"fix":{"range":[480,583],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1370,1373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1370,1373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2574,2577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2574,2577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport * as React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { CompanyLookup } from './company-lookup';\nimport { createClient } from '@/lib/supabase/client';\nimport { type Contact } from '@/lib/types/schema';\nimport { Plus, Building2, User } from 'lucide-react';\n\nexport function ContactList() {\n    const [contacts, setContacts] = React.useState<Contact[]>([]);\n    const [isAddOpen, setIsAddOpen] = React.useState(false);\n\n    // Form State\n    const [type, setType] = React.useState<'person' | 'company'>('person');\n    const [formData, setFormData] = React.useState<Partial<Contact>>({});\n\n    const supabase = createClient();\n\n    const fetchContacts = React.useCallback(async () => {\n        const { data } = await supabase.from('contacts').select('*').order('created_at', { ascending: false });\n        if (data) setContacts(data as any);\n    }, [supabase]);\n\n    React.useEffect(() => {\n        fetchContacts();\n    }, [fetchContacts]);\n\n    const handleSave = async () => {\n        try {\n            const payload = {\n                ...formData,\n                is_company: type === 'company',\n                tenant_id: (await supabase.auth.getUser()).data.user?.user_metadata?.tenant_id // This might be tricky if not set in metadata yet\n                // Actually, RLS handles tenant_id usually if we infer it, BUT our schema defines it as NOT NULL.\n                // We need a way to get the current tenant_id.\n                // For Phase 2, let's assume we fetch it or it's inserted by trigger? \n                // Trigger approach: \" BEFORE INSERT ... set new.tenant_id = (select tenant_id from profiles where id = auth.uid()) \"\n                // We didn't add that trigger yet. Let's rely on the API or add the trigger.\n                // For now, let's assume the user has a profile with tenant_id.\n            };\n\n            // Temporary: We need to get tenant_id.\n            const { data: profile } = await supabase.from('profiles').select('tenant_id').single();\n            if (profile) {\n                (payload as any).tenant_id = profile.tenant_id;\n            }\n\n            const { error } = await supabase.from('contacts').insert([payload]);\n            if (error) throw error;\n\n            setIsAddOpen(false);\n            setFormData({});\n            fetchContacts();\n\n        } catch (e) {\n            console.error(\"Error saving contact\", e);\n            alert(\"Failed to save contact\");\n        }\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <h2 className=\"text-3xl font-bold tracking-tight\">Directory</h2>\n                <Dialog open={isAddOpen} onOpenChange={setIsAddOpen}>\n                    <DialogTrigger asChild>\n                        <Button><Plus className=\"mr-2 h-4 w-4\" /> Add Contact</Button>\n                    </DialogTrigger>\n                    <DialogContent className=\"sm:max-w-[600px]\">\n                        <DialogHeader>\n                            <DialogTitle>Add New Contact</DialogTitle>\n                        </DialogHeader>\n                        <div className=\"grid gap-4 py-4\">\n\n                            <div className=\"flex items-center gap-4\">\n                                <Button\n                                    variant={type === 'person' ? 'default' : 'outline'}\n                                    onClick={() => setType('person')}\n                                    className=\"flex-1\"\n                                >\n                                    <User className=\"mr-2 h-4 w-4\" /> Person\n                                </Button>\n                                <Button\n                                    variant={type === 'company' ? 'default' : 'outline'}\n                                    onClick={() => setType('company')}\n                                    className=\"flex-1\"\n                                >\n                                    <Building2 className=\"mr-2 h-4 w-4\" /> Organization\n                                </Button>\n                            </div>\n\n                            {type === 'company' && (\n                                <CompanyLookup onSelect={(company) => {\n                                    setFormData({\n                                        ...formData,\n                                        company_name: company.name,\n                                        company_uid: company.uidFormatted,\n                                        address_line1: `${company.address.street || ''} ${company.address.houseNumber || ''}`.trim(),\n                                        city: company.address.city,\n                                        postal_code: company.address.postalCode,\n                                        country: 'CH'\n                                    });\n                                }} />\n                            )}\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                {type === 'person' && (\n                                    <>\n                                        <div className=\"space-y-2\">\n                                            <Label>First Name</Label>\n                                            <Input value={formData.first_name || ''} onChange={e => setFormData({ ...formData, first_name: e.target.value })} />\n                                        </div>\n                                        <div className=\"space-y-2\">\n                                            <Label>Last Name</Label>\n                                            <Input value={formData.last_name || ''} onChange={e => setFormData({ ...formData, last_name: e.target.value })} />\n                                        </div>\n                                    </>\n                                )}\n                                {type === 'company' && (\n                                    <div className=\"col-span-2 space-y-2\">\n                                        <Label>Company Name</Label>\n                                        <Input value={formData.company_name || ''} onChange={e => setFormData({ ...formData, company_name: e.target.value })} />\n                                    </div>\n                                )}\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"space-y-2\">\n                                    <Label>Email</Label>\n                                    <Input value={formData.email || ''} onChange={e => setFormData({ ...formData, email: e.target.value })} />\n                                </div>\n                                <div className=\"space-y-2\">\n                                    <Label>Phone</Label>\n                                    <Input value={formData.phone || ''} onChange={e => setFormData({ ...formData, phone: e.target.value })} />\n                                </div>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <Label>Address</Label>\n                                <Input placeholder=\"Street\" value={formData.address_line1 || ''} onChange={e => setFormData({ ...formData, address_line1: e.target.value })} />\n                                <div className=\"grid grid-cols-3 gap-2 mt-2\">\n                                    <Input placeholder=\"Zip\" className=\"col-span-1\" value={formData.postal_code || ''} onChange={e => setFormData({ ...formData, postal_code: e.target.value })} />\n                                    <Input placeholder=\"City\" className=\"col-span-2\" value={formData.city || ''} onChange={e => setFormData({ ...formData, city: e.target.value })} />\n                                </div>\n                            </div>\n\n                            <Button onClick={handleSave}>Save Contact</Button>\n                        </div>\n                    </DialogContent>\n                </Dialog>\n            </div>\n\n            <Card>\n                <CardContent className=\"p-0\">\n                    <Table>\n                        <TableHeader>\n                            <TableRow>\n                                <TableHead>Type</TableHead>\n                                <TableHead>Name</TableHead>\n                                <TableHead>Email</TableHead>\n                                <TableHead>Location</TableHead>\n                                <TableHead>Tags</TableHead>\n                            </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                            {contacts.map((contact) => (\n                                <TableRow key={contact.id}>\n                                    <TableCell>\n                                        {contact.is_company ? <Building2 className=\"h-4 w-4 text-blue-500\" /> : <User className=\"h-4 w-4 text-green-500\" />}\n                                    </TableCell>\n                                    <TableCell className=\"font-medium\">\n                                        {contact.is_company ? contact.company_name : `${contact.first_name} ${contact.last_name}`}\n                                        {contact.company_uid && <span className=\"ml-2 text-xs text-slate-400 bg-slate-100 px-1 rounded\">{contact.company_uid}</span>}\n                                    </TableCell>\n                                    <TableCell>{contact.email}</TableCell>\n                                    <TableCell>{contact.city}</TableCell>\n                                    <TableCell>{contact.tags?.join(', ')}</TableCell>\n                                </TableRow>\n                            ))}\n                            {contacts.length === 0 && (\n                                <TableRow>\n                                    <TableCell colSpan={5} className=\"text-center py-10 text-slate-500\">No contacts found.</TableCell>\n                                </TableRow>\n                            )}\n                        </TableBody>\n                    </Table>\n                </CardContent>\n            </Card>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/modules/invoicing/create-invoice-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":14,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":44,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"X"},"fix":{"range":[744,747],"text":""},"desc":"Remove unused variable \"X\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1424,1427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1424,1427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'supabase'. Either include it or remove the dependency array.","line":71,"column":8,"nodeType":"ArrayExpression","endLine":71,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [open, supabase]","fix":{"range":[2711,2717],"text":"[open, supabase]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":164,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":164,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport * as React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { createClient } from '@/lib/supabase/client';\nimport { useInvoiceStore, LineItemInput } from '@/stores/invoice-store';\nimport { getTaxRatesForCountry } from '@/lib/invoices/tax-rates';\nimport { FileText, Loader2, Plus, Trash2, X } from 'lucide-react';\nimport type { InvoiceType } from '@/lib/types/schema';\n\ninterface LineItem extends LineItemInput {\n    id: string; // Temporary ID for UI\n}\n\nfunction generateTempId(): string {\n    return `temp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\nconst DEFAULT_LINE_ITEM: () => LineItem = () => ({\n    id: generateTempId(),\n    description: '',\n    quantity: 1,\n    unit_price: 0,\n    tax_rate: 8.1, // Default Swiss VAT\n    sort_order: 0,\n});\n\nexport function CreateInvoiceDialog() {\n    const [open, setOpen] = React.useState(false);\n    const [loading, setLoading] = React.useState(false);\n    const [contacts, setContacts] = React.useState<any[]>([]);\n    \n    // Form state\n    const [contactId, setContactId] = React.useState('');\n    const [invoiceType, setInvoiceType] = React.useState<InvoiceType>('swiss_qr');\n    const [currency, setCurrency] = React.useState('CHF');\n    const [dueDate, setDueDate] = React.useState('');\n    const [notes, setNotes] = React.useState('');\n    const [lineItems, setLineItems] = React.useState<LineItem[]>([DEFAULT_LINE_ITEM()]);\n    const [selectedCountry, setSelectedCountry] = React.useState('CH');\n\n    const { addInvoice } = useInvoiceStore();\n    const supabase = createClient();\n\n    // Load contacts when dialog opens\n    React.useEffect(() => {\n        const load = async () => {\n            const { data } = await supabase\n                .from('contacts')\n                .select('id, first_name, last_name, company_name, is_company, country')\n                .order('created_at', { ascending: false });\n            setContacts(data || []);\n        };\n        if (open) {\n            load();\n            // Reset form\n            setContactId('');\n            setInvoiceType('swiss_qr');\n            setCurrency('CHF');\n            setDueDate('');\n            setNotes('');\n            setLineItems([DEFAULT_LINE_ITEM()]);\n            setSelectedCountry('CH');\n        }\n    }, [open]);\n\n    // Update currency based on invoice type\n    React.useEffect(() => {\n        if (invoiceType === 'swiss_qr') {\n            setCurrency('CHF');\n            setSelectedCountry('CH');\n        } else {\n            setCurrency('EUR');\n            setSelectedCountry('DE');\n        }\n    }, [invoiceType]);\n\n    // Calculate totals\n    const totals = React.useMemo(() => {\n        let subtotal = 0;\n        let tax_total = 0;\n\n        for (const item of lineItems) {\n            const lineTotal = item.quantity * item.unit_price;\n            const lineTax = lineTotal * (item.tax_rate / 100);\n            subtotal += lineTotal;\n            tax_total += lineTax;\n        }\n\n        return {\n            subtotal: Math.round(subtotal * 100) / 100,\n            tax_total: Math.round(tax_total * 100) / 100,\n            amount_total: Math.round((subtotal + tax_total) * 100) / 100,\n        };\n    }, [lineItems]);\n\n    // Get tax rates for selected country\n    const taxRates = getTaxRatesForCountry(selectedCountry);\n\n    // Line item handlers\n    const addLineItem = () => {\n        const newItem = DEFAULT_LINE_ITEM();\n        newItem.sort_order = lineItems.length;\n        setLineItems([...lineItems, newItem]);\n    };\n\n    const removeLineItem = (id: string) => {\n        if (lineItems.length > 1) {\n            setLineItems(lineItems.filter(item => item.id !== id));\n        }\n    };\n\n    const updateLineItem = (id: string, field: keyof LineItemInput, value: string | number) => {\n        setLineItems(lineItems.map(item => {\n            if (item.id === id) {\n                return { ...item, [field]: value };\n            }\n            return item;\n        }));\n    };\n\n    const handleCreate = async () => {\n        if (!contactId) {\n            alert('Please select a contact');\n            return;\n        }\n\n        if (lineItems.some(item => !item.description || item.unit_price <= 0)) {\n            alert('Please fill in all line items with valid descriptions and prices');\n            return;\n        }\n\n        setLoading(true);\n        try {\n            // Prepare line items (remove temp IDs)\n            const preparedLineItems: LineItemInput[] = lineItems.map((item, index) => ({\n                description: item.description,\n                quantity: item.quantity,\n                unit_price: item.unit_price,\n                tax_rate: item.tax_rate,\n                sort_order: index,\n            }));\n\n            const invoice = await addInvoice({\n                contact_id: contactId,\n                currency,\n                invoice_type: invoiceType,\n                due_date: dueDate || null,\n                notes: notes || null,\n                line_items: preparedLineItems,\n            });\n\n            if (invoice) {\n                // Download PDF\n                window.open(`/api/invoices/${invoice.id}/download`, '_blank');\n                setOpen(false);\n            }\n        } catch (e) {\n            alert('Failed to create invoice');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const formatMoney = (amount: number) => {\n        return new Intl.NumberFormat('de-CH', {\n            style: 'currency',\n            currency: currency,\n            minimumFractionDigits: 2,\n        }).format(amount);\n    };\n\n    return (\n        <Dialog open={open} onOpenChange={setOpen}>\n            <DialogTrigger asChild>\n                <Button className=\"bg-[#3D4A67] hover:bg-[#2D3A57] text-white\">\n                    <FileText className=\"mr-2 h-4 w-4\" /> \n                    New Invoice\n                </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n                <DialogHeader>\n                    <DialogTitle className=\"text-[#3D4A67]\">Create Invoice</DialogTitle>\n                </DialogHeader>\n                \n                <div className=\"space-y-6 py-4\">\n                    {/* Invoice Type & Currency */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-2\">\n                            <Label>Invoice Type</Label>\n                            <Select value={invoiceType} onValueChange={(v) => setInvoiceType(v as InvoiceType)}>\n                                <SelectTrigger>\n                                    <SelectValue placeholder=\"Select type\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"swiss_qr\">Swiss QR-Bill (CHF)</SelectItem>\n                                    <SelectItem value=\"eu_sepa\">EU SEPA Invoice (EUR)</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Currency</Label>\n                            <Select value={currency} onValueChange={setCurrency}>\n                                <SelectTrigger>\n                                    <SelectValue placeholder=\"Select currency\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    <SelectItem value=\"CHF\">CHF - Swiss Franc</SelectItem>\n                                    <SelectItem value=\"EUR\">EUR - Euro</SelectItem>\n                                </SelectContent>\n                            </Select>\n                        </div>\n                    </div>\n\n                    {/* Contact & Due Date */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-2\">\n                            <Label>Client (Bill To)</Label>\n                            <Select value={contactId} onValueChange={setContactId}>\n                                <SelectTrigger>\n                                    <SelectValue placeholder=\"Select contact\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                    {contacts.map(c => (\n                                        <SelectItem key={c.id} value={c.id}>\n                                            {c.is_company \n                                                ? c.company_name \n                                                : `${c.first_name || ''} ${c.last_name || ''}`.trim() || c.company_name\n                                            }\n                                        </SelectItem>\n                                    ))}\n                                </SelectContent>\n                            </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                            <Label>Due Date</Label>\n                            <Input \n                                type=\"date\" \n                                value={dueDate} \n                                onChange={e => setDueDate(e.target.value)} \n                            />\n                        </div>\n                    </div>\n\n                    {/* Line Items */}\n                    <div className=\"space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                            <Label>Line Items</Label>\n                            <Button \n                                type=\"button\" \n                                variant=\"outline\" \n                                size=\"sm\" \n                                onClick={addLineItem}\n                            >\n                                <Plus className=\"h-4 w-4 mr-1\" /> Add Item\n                            </Button>\n                        </div>\n\n                        <div className=\"space-y-3\">\n                            {lineItems.map((item, index) => (\n                                <Card key={item.id} className=\"border-slate-200\">\n                                    <CardContent className=\"pt-4\">\n                                        <div className=\"grid grid-cols-12 gap-3 items-end\">\n                                            {/* Description - takes most space */}\n                                            <div className=\"col-span-5 space-y-1\">\n                                                {index === 0 && <Label className=\"text-xs text-slate-500\">Description</Label>}\n                                                <Input\n                                                    placeholder=\"Service or product\"\n                                                    value={item.description}\n                                                    onChange={e => updateLineItem(item.id, 'description', e.target.value)}\n                                                />\n                                            </div>\n                                            \n                                            {/* Quantity */}\n                                            <div className=\"col-span-2 space-y-1\">\n                                                {index === 0 && <Label className=\"text-xs text-slate-500\">Qty</Label>}\n                                                <Input\n                                                    type=\"number\"\n                                                    min=\"0.01\"\n                                                    step=\"0.01\"\n                                                    value={item.quantity}\n                                                    onChange={e => updateLineItem(item.id, 'quantity', parseFloat(e.target.value) || 0)}\n                                                />\n                                            </div>\n                                            \n                                            {/* Unit Price */}\n                                            <div className=\"col-span-2 space-y-1\">\n                                                {index === 0 && <Label className=\"text-xs text-slate-500\">Price</Label>}\n                                                <Input\n                                                    type=\"number\"\n                                                    min=\"0\"\n                                                    step=\"0.01\"\n                                                    value={item.unit_price}\n                                                    onChange={e => updateLineItem(item.id, 'unit_price', parseFloat(e.target.value) || 0)}\n                                                />\n                                            </div>\n                                            \n                                            {/* Tax Rate */}\n                                            <div className=\"col-span-2 space-y-1\">\n                                                {index === 0 && <Label className=\"text-xs text-slate-500\">Tax</Label>}\n                                                <Select \n                                                    value={item.tax_rate.toString()} \n                                                    onValueChange={v => updateLineItem(item.id, 'tax_rate', parseFloat(v))}\n                                                >\n                                                    <SelectTrigger>\n                                                        <SelectValue />\n                                                    </SelectTrigger>\n                                                    <SelectContent>\n                                                        {taxRates.map(rate => (\n                                                            <SelectItem key={rate.rate} value={rate.rate.toString()}>\n                                                                {rate.rate}%\n                                                            </SelectItem>\n                                                        ))}\n                                                    </SelectContent>\n                                                </Select>\n                                            </div>\n                                            \n                                            {/* Delete button */}\n                                            <div className=\"col-span-1\">\n                                                {lineItems.length > 1 && (\n                                                    <Button \n                                                        type=\"button\"\n                                                        variant=\"ghost\" \n                                                        size=\"icon\"\n                                                        className=\"text-red-500 hover:text-red-700 hover:bg-red-50\"\n                                                        onClick={() => removeLineItem(item.id)}\n                                                    >\n                                                        <Trash2 className=\"h-4 w-4\" />\n                                                    </Button>\n                                                )}\n                                            </div>\n                                        </div>\n                                        \n                                        {/* Line total */}\n                                        <div className=\"text-right mt-2 text-sm text-slate-500\">\n                                            Line total: {formatMoney(item.quantity * item.unit_price)}\n                                        </div>\n                                    </CardContent>\n                                </Card>\n                            ))}\n                        </div>\n                    </div>\n\n                    {/* Totals */}\n                    <div className=\"border-t pt-4\">\n                        <div className=\"flex justify-end\">\n                            <div className=\"w-64 space-y-2\">\n                                <div className=\"flex justify-between text-sm\">\n                                    <span className=\"text-slate-500\">Subtotal:</span>\n                                    <span>{formatMoney(totals.subtotal)}</span>\n                                </div>\n                                <div className=\"flex justify-between text-sm\">\n                                    <span className=\"text-slate-500\">VAT:</span>\n                                    <span>{formatMoney(totals.tax_total)}</span>\n                                </div>\n                                <div className=\"flex justify-between font-semibold text-lg border-t pt-2\">\n                                    <span>Total:</span>\n                                    <span className=\"text-[#3D4A67]\">{formatMoney(totals.amount_total)}</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Notes */}\n                    <div className=\"space-y-2\">\n                        <Label>Notes (optional)</Label>\n                        <Textarea\n                            placeholder=\"Additional notes for the invoice...\"\n                            value={notes}\n                            onChange={e => setNotes(e.target.value)}\n                            rows={3}\n                        />\n                    </div>\n\n                    {/* Submit */}\n                    <Button \n                        className=\"w-full bg-[#3D4A67] hover:bg-[#2D3A57]\" \n                        onClick={handleCreate} \n                        disabled={loading}\n                    >\n                        {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                        Create Invoice & Download PDF\n                    </Button>\n                </div>\n            </DialogContent>\n        </Dialog>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/modules/vault/document-manager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1021,1024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1021,1024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1337,1340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1337,1340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport * as React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { createClient } from '@/lib/supabase/client';\nimport { type Document } from '@/lib/types/schema';\nimport { FileText, Eye, EyeOff, Upload, Download, Trash2, Sparkles, Search as SearchIcon } from 'lucide-react';\nimport { UploadDialog } from '@/components/documents/upload-dialog';\nimport { Input } from '@/components/ui/input';\n\nexport function DocumentManager() {\n    const [docs, setDocs] = React.useState<Document[]>([]);\n    const [uploadDialogOpen, setUploadDialogOpen] = React.useState(false);\n    const [processingDocs, setProcessingDocs] = React.useState<Set<string>>(new Set());\n    const [searchQuery, setSearchQuery] = React.useState('');\n    const [searchResults, setSearchResults] = React.useState<any[]>([]);\n    const [isSearching, setIsSearching] = React.useState(false);\n    const supabase = createClient();\n\n    const fetchDocs = React.useCallback(async () => {\n        const { data } = await supabase.from('documents').select('*').order('created_at', { ascending: false });\n        if (data) setDocs(data as any);\n    }, [supabase]);\n\n    React.useEffect(() => {\n        fetchDocs();\n    }, [fetchDocs]);\n\n    const toggleVisibility = async (doc: Document) => {\n        const newVisibility = doc.visibility === 'internal' ? 'shared' : 'internal';\n\n        const { error } = await supabase\n            .from('documents')\n            .update({ visibility: newVisibility })\n            .eq('id', doc.id);\n\n        if (!error) {\n            fetchDocs();\n        }\n    };\n\n    const handleDelete = async (id: string, filePath: string) => {\n        if (!confirm(\"Are you sure you want to delete this document? This action cannot be undone.\")) return;\n\n        // Delete from storage first\n        const { error: storageError } = await supabase.storage\n            .from('documents')\n            .remove([filePath]);\n\n        if (storageError) {\n            console.error('Failed to delete file from storage:', storageError);\n        }\n\n        // Delete from database\n        const { error: dbError } = await supabase.from('documents').delete().eq('id', id);\n\n        if (!dbError) {\n            fetchDocs();\n        }\n    };\n\n    const handleDownload = async (doc: Document) => {\n        const { data, error } = await supabase.storage\n            .from('documents')\n            .download(doc.file_path);\n\n        if (error) {\n            console.error('Failed to download:', error);\n            alert('Failed to download file');\n            return;\n        }\n\n        // Create download link\n        const url = window.URL.createObjectURL(data);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = doc.name;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        window.URL.revokeObjectURL(url);\n    };\n\n    const formatFileSize = (bytes: number | null) => {\n        if (!bytes) return '--';\n        if (bytes < 1024) return `${bytes} B`;\n        if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n        return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    };\n\n    const formatDate = (dateString: string) => {\n        const date = new Date(dateString);\n        return new Intl.DateTimeFormat('en-GB', {\n            day: '2-digit',\n            month: '2-digit',\n            year: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit',\n        }).format(date);\n    };\n\n    const handleProcess = async (documentId: string) => {\n        setProcessingDocs(prev => new Set(prev).add(documentId));\n\n        try {\n            const response = await fetch('/api/documents/process', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ documentId }),\n            });\n\n            if (!response.ok) {\n                const error = await response.json();\n                throw new Error(error.error || 'Processing failed');\n            }\n\n            const result = await response.json();\n            console.log('Document processed:', result);\n\n            // Refresh documents to show updated status\n            fetchDocs();\n\n            alert(` Document processed successfully!\\n\\nChunks created: ${result.chunksCreated}\\nTokens used: ${result.tokensUsed}`);\n        } catch (error) {\n            console.error('Processing error:', error);\n            alert(error instanceof Error ? error.message : 'Failed to process document');\n        } finally {\n            setProcessingDocs(prev => {\n                const next = new Set(prev);\n                next.delete(documentId);\n                return next;\n            });\n        }\n    };\n\n    const handleSearch = async () => {\n        if (!searchQuery.trim()) {\n            setSearchResults([]);\n            return;\n        }\n\n        setIsSearching(true);\n\n        try {\n            const response = await fetch(`/api/documents/search?q=${encodeURIComponent(searchQuery)}&method=hybrid&limit=10`);\n\n            if (!response.ok) {\n                throw new Error('Search failed');\n            }\n\n            const data = await response.json();\n            setSearchResults(data.results || []);\n        } catch (error) {\n            console.error('Search error:', error);\n            alert('Search failed');\n        } finally {\n            setIsSearching(false);\n        }\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <div>\n                    <h2 className=\"text-3xl font-bold tracking-tight\">Vault</h2>\n                    <p className=\"text-slate-500 mt-1\">\n                        Upload and manage documents for AI knowledge base\n                    </p>\n                </div>\n                <Button onClick={() => setUploadDialogOpen(true)}>\n                    <Upload className=\"mr-2 h-4 w-4\" /> Upload Document\n                </Button>\n            </div>\n\n            {/* Semantic Search Test */}\n            <Card>\n                <CardContent className=\"p-6\">\n                    <div className=\"space-y-4\">\n                        <div>\n                            <h3 className=\"text-lg font-semibold mb-2\">Test Semantic Search</h3>\n                            <p className=\"text-sm text-slate-500 mb-4\">\n                                Try searching your documents using natural language\n                            </p>\n                        </div>\n                        <div className=\"flex gap-2\">\n                            <Input\n                                placeholder=\"Ask a question about your documents...\"\n                                value={searchQuery}\n                                onChange={(e) => setSearchQuery(e.target.value)}\n                                onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n                            />\n                            <Button onClick={handleSearch} disabled={isSearching || !searchQuery.trim()}>\n                                <SearchIcon className=\"mr-2 h-4 w-4\" />\n                                {isSearching ? 'Searching...' : 'Search'}\n                            </Button>\n                        </div>\n                        {searchResults.length > 0 && (\n                            <div className=\"mt-4 space-y-2\">\n                                <p className=\"text-sm font-medium\">Found {searchResults.length} results:</p>\n                                {searchResults.map((result, idx) => (\n                                    <div key={idx} className=\"p-3 bg-slate-50 rounded border border-slate-200\">\n                                        <div className=\"flex justify-between items-start mb-2\">\n                                            <p className=\"text-sm font-medium\">{result.documentName}</p>\n                                            <Badge variant=\"secondary\" className=\"text-xs\">\n                                                {(result.similarity * 100).toFixed(0)}% match\n                                            </Badge>\n                                        </div>\n                                        <p className=\"text-sm text-slate-700 line-clamp-3\">{result.content}</p>\n                                    </div>\n                                ))}\n                            </div>\n                        )}\n                        {searchQuery && searchResults.length === 0 && !isSearching && (\n                            <p className=\"text-sm text-slate-500 mt-2\">No results found. Try processing your documents first.</p>\n                        )}\n                    </div>\n                </CardContent>\n            </Card>\n\n            <Card>\n                <CardContent className=\"p-0\">\n                    <Table>\n                        <TableHeader>\n                            <TableRow>\n                                <TableHead className=\"w-10\"></TableHead>\n                                <TableHead>Name</TableHead>\n                                <TableHead>Visibility</TableHead>\n                                <TableHead>Status</TableHead>\n                                <TableHead>Size</TableHead>\n                                <TableHead>Uploaded</TableHead>\n                                <TableHead className=\"text-right\">Actions</TableHead>\n                            </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                            {docs.map((doc) => (\n                                <TableRow key={doc.id}>\n                                    <TableCell>\n                                        <FileText className=\"h-4 w-4 text-slate-500\" />\n                                    </TableCell>\n                                    <TableCell className=\"font-medium max-w-xs truncate\">\n                                        {doc.name}\n                                    </TableCell>\n                                    <TableCell>\n                                        <div\n                                            className=\"flex items-center space-x-2 cursor-pointer hover:underline\"\n                                            onClick={() => toggleVisibility(doc)}\n                                            title=\"Click to toggle visibility\"\n                                        >\n                                            {doc.visibility === 'internal' ? (\n                                                <Badge variant=\"secondary\" className=\"bg-amber-100 text-amber-800 hover:bg-amber-200\">\n                                                    <EyeOff className=\"w-3 h-3 mr-1\" /> Internal\n                                                </Badge>\n                                            ) : (\n                                                <Badge className=\"bg-green-100 text-green-800 hover:bg-green-200\">\n                                                    <Eye className=\"w-3 h-3 mr-1\" /> Shared\n                                                </Badge>\n                                            )}\n                                        </div>\n                                    </TableCell>\n                                    <TableCell>\n                                        {doc.embedding_status === 'pending' && (\n                                            <Badge variant=\"secondary\" className=\"bg-slate-100 text-slate-700\">\n                                                Pending\n                                            </Badge>\n                                        )}\n                                        {doc.embedding_status === 'processing' && (\n                                            <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-700\">\n                                                Processing\n                                            </Badge>\n                                        )}\n                                        {doc.embedding_status === 'complete' && (\n                                            <Badge variant=\"secondary\" className=\"bg-green-100 text-green-700\">\n                                                Ready\n                                            </Badge>\n                                        )}\n                                        {doc.embedding_status === 'error' && (\n                                            <Badge variant=\"secondary\" className=\"bg-red-100 text-red-700\">\n                                                Error\n                                            </Badge>\n                                        )}\n                                    </TableCell>\n                                    <TableCell className=\"text-slate-600\">\n                                        {formatFileSize(doc.size_bytes)}\n                                    </TableCell>\n                                    <TableCell className=\"text-slate-600 text-sm\">\n                                        {formatDate(doc.created_at)}\n                                    </TableCell>\n                                    <TableCell className=\"text-right space-x-2\">\n                                        {doc.embedding_status === 'pending' && (\n                                            <Button\n                                                size=\"icon\"\n                                                variant=\"ghost\"\n                                                onClick={() => handleProcess(doc.id)}\n                                                title=\"Process with AI (extract text & create embeddings)\"\n                                                disabled={processingDocs.has(doc.id)}\n                                            >\n                                                <Sparkles className={`h-4 w-4 ${processingDocs.has(doc.id) ? 'text-slate-400' : 'text-purple-500'}`} />\n                                            </Button>\n                                        )}\n                                        {doc.embedding_status === 'error' && (\n                                            <Button\n                                                size=\"icon\"\n                                                variant=\"ghost\"\n                                                onClick={() => handleProcess(doc.id)}\n                                                title=\"Retry processing\"\n                                                disabled={processingDocs.has(doc.id)}\n                                            >\n                                                <Sparkles className=\"h-4 w-4 text-amber-500\" />\n                                            </Button>\n                                        )}\n                                        <Button\n                                            size=\"icon\"\n                                            variant=\"ghost\"\n                                            onClick={() => handleDownload(doc)}\n                                            title=\"Download\"\n                                        >\n                                            <Download className=\"h-4 w-4\" />\n                                        </Button>\n                                        <Button\n                                            size=\"icon\"\n                                            variant=\"ghost\"\n                                            onClick={() => handleDelete(doc.id, doc.file_path)}\n                                            title=\"Delete\"\n                                        >\n                                            <Trash2 className=\"h-4 w-4 text-red-500\" />\n                                        </Button>\n                                    </TableCell>\n                                </TableRow>\n                            ))}\n                            {docs.length === 0 && (\n                                <TableRow>\n                                    <TableCell colSpan={7} className=\"text-center py-16\">\n                                        <div className=\"flex flex-col items-center justify-center text-slate-500\">\n                                            <FileText className=\"h-12 w-12 mb-3 opacity-30\" />\n                                            <p className=\"font-medium\">No documents in the Vault</p>\n                                            <p className=\"text-sm mt-1\">\n                                                Upload documents to build your AI knowledge base\n                                            </p>\n                                            <Button\n                                                onClick={() => setUploadDialogOpen(true)}\n                                                className=\"mt-4\"\n                                                variant=\"outline\"\n                                            >\n                                                <Upload className=\"h-4 w-4 mr-2\" />\n                                                Upload Your First Document\n                                            </Button>\n                                        </div>\n                                    </TableCell>\n                                </TableRow>\n                            )}\n                        </TableBody>\n                    </Table>\n                </CardContent>\n            </Card>\n\n            {/* Upload Dialog */}\n            <UploadDialog\n                open={uploadDialogOpen}\n                onOpenChange={setUploadDialogOpen}\n                onUploadComplete={fetchDocs}\n            />\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/notifications/notification-dropdown.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Button"},"fix":{"range":[224,271],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCheck' is defined but never used.","line":12,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CheckCheck"},"fix":{"range":[344,360],"text":""},"desc":"Remove unused variable \"CheckCheck\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used.","line":18,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DollarSign"},"fix":{"range":[421,437],"text":""},"desc":"Remove unused variable \"DollarSign\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2502,2505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2502,2505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":164,"column":63,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[6240,6261],"text":"You&apos;re all caught up!"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[6240,6261],"text":"You&lsquo;re all caught up!"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[6240,6261],"text":"You&#39;re all caught up!"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[6240,6261],"text":"You&rsquo;re all caught up!"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useNotificationStore } from '@/stores/notification-store'\nimport { formatRelativeTime } from '@/lib/format-time'\nimport { Button } from '@/components/ui/button'\nimport { Card } from '@/components/ui/card'\nimport {\n    Bell,\n    Check,\n    CheckCheck,\n    Trash2,\n    X,\n    Clock,\n    FileText,\n    CheckSquare,\n    DollarSign,\n    MessageSquare,\n    AlertCircle,\n    Info,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\n// Map notification types to icons\nconst notificationIcons: Record<string, React.ReactNode> = {\n    task_due: <Clock className=\"h-4 w-4\" />,\n    task_overdue: <AlertCircle className=\"h-4 w-4\" />,\n    invoice_due: <FileText className=\"h-4 w-4\" />,\n    invoice_overdue: <AlertCircle className=\"h-4 w-4\" />,\n    mention: <MessageSquare className=\"h-4 w-4\" />,\n    comment: <MessageSquare className=\"h-4 w-4\" />,\n    assignment: <CheckSquare className=\"h-4 w-4\" />,\n    status_change: <Info className=\"h-4 w-4\" />,\n    reminder: <Bell className=\"h-4 w-4\" />,\n    system: <Info className=\"h-4 w-4\" />,\n    welcome: <Info className=\"h-4 w-4\" />,\n    update: <Info className=\"h-4 w-4\" />,\n}\n\n// Map notification types to colors\nconst notificationColors: Record<string, string> = {\n    task_due: 'text-blue-600',\n    task_overdue: 'text-red-600',\n    invoice_due: 'text-orange-600',\n    invoice_overdue: 'text-red-600',\n    mention: 'text-purple-600',\n    comment: 'text-purple-600',\n    assignment: 'text-green-600',\n    status_change: 'text-blue-600',\n    reminder: 'text-yellow-600',\n    system: 'text-slate-600',\n    welcome: 'text-green-600',\n    update: 'text-blue-600',\n}\n\nexport function NotificationDropdown() {\n    const [isOpen, setIsOpen] = useState(false)\n    const router = useRouter()\n\n    const {\n        notifications,\n        unreadCount,\n        isLoading,\n        fetchNotifications,\n        markAsRead,\n        markAllAsRead,\n        archiveNotification,\n        clearAll,\n    } = useNotificationStore()\n\n    // Fetch notifications on mount and when dropdown opens\n    useEffect(() => {\n        fetchNotifications()\n    }, [fetchNotifications])\n\n    // Poll for new notifications every 30 seconds\n    useEffect(() => {\n        const interval = setInterval(() => {\n            fetchNotifications()\n        }, 30000)\n\n        return () => clearInterval(interval)\n    }, [fetchNotifications])\n\n    const handleNotificationClick = async (notification: any) => {\n        // Mark as read\n        if (!notification.read) {\n            await markAsRead(notification.id)\n        }\n\n        // Navigate if there's a URL\n        if (notification.entityUrl) {\n            router.push(notification.entityUrl)\n            setIsOpen(false)\n        }\n    }\n\n    return (\n        <div className=\"relative\">\n            {/* Bell icon button */}\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                className=\"relative p-2 rounded-lg hover:bg-slate-100 transition-colors\"\n            >\n                <Bell className=\"h-5 w-5 text-slate-600\" />\n                {unreadCount > 0 && (\n                    <span className=\"absolute top-1 right-1 h-4 w-4 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center\">\n                        {unreadCount > 9 ? '9+' : unreadCount}\n                    </span>\n                )}\n            </button>\n\n            {/* Dropdown */}\n            {isOpen && (\n                <>\n                    {/* Backdrop */}\n                    <div\n                        className=\"fixed inset-0 z-40\"\n                        onClick={() => setIsOpen(false)}\n                    />\n\n                    {/* Dropdown card */}\n                    <Card className=\"absolute right-0 top-full mt-2 w-96 max-h-[600px] overflow-hidden flex flex-col border-slate-200 shadow-lg z-50\">\n                        {/* Header */}\n                        <div className=\"p-4 border-b border-slate-200 flex items-center justify-between\">\n                            <h3 className=\"font-semibold text-slate-900\">\n                                Notifications\n                                {unreadCount > 0 && (\n                                    <span className=\"ml-2 text-xs font-normal text-slate-500\">\n                                        ({unreadCount} unread)\n                                    </span>\n                                )}\n                            </h3>\n                            <div className=\"flex items-center gap-2\">\n                                {unreadCount > 0 && (\n                                    <button\n                                        onClick={markAllAsRead}\n                                        className=\"text-xs text-blue-600 hover:text-blue-700\"\n                                    >\n                                        Mark all read\n                                    </button>\n                                )}\n                                <button\n                                    onClick={() => setIsOpen(false)}\n                                    className=\"text-slate-400 hover:text-slate-600\"\n                                >\n                                    <X className=\"h-4 w-4\" />\n                                </button>\n                            </div>\n                        </div>\n\n                        {/* Notifications list */}\n                        <div className=\"flex-1 overflow-y-auto\">\n                            {isLoading ? (\n                                <div className=\"p-8 text-center text-slate-500\">\n                                    <Bell className=\"h-8 w-8 mx-auto mb-2 animate-pulse opacity-30\" />\n                                    <p className=\"text-sm\">Loading...</p>\n                                </div>\n                            ) : notifications.length === 0 ? (\n                                <div className=\"p-8 text-center text-slate-500\">\n                                    <Bell className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n                                    <p className=\"text-sm font-medium mb-1\">No notifications</p>\n                                    <p className=\"text-xs\">You're all caught up!</p>\n                                </div>\n                            ) : (\n                                <div className=\"divide-y divide-slate-100\">\n                                    {notifications.map((notification) => {\n                                        const icon = notificationIcons[notification.type] || (\n                                            <Bell className=\"h-4 w-4\" />\n                                        )\n                                        const colorClass =\n                                            notificationColors[notification.type] || 'text-slate-600'\n\n                                        return (\n                                            <div\n                                                key={notification.id}\n                                                className={cn(\n                                                    'p-3 hover:bg-slate-50 transition-colors relative group',\n                                                    !notification.read && 'bg-blue-50/50'\n                                                )}\n                                            >\n                                                <button\n                                                    onClick={() => handleNotificationClick(notification)}\n                                                    className=\"w-full text-left\"\n                                                >\n                                                    <div className=\"flex items-start gap-3\">\n                                                        {/* Icon */}\n                                                        <div\n                                                            className={cn(\n                                                                'flex-shrink-0 mt-0.5',\n                                                                colorClass\n                                                            )}\n                                                        >\n                                                            {icon}\n                                                        </div>\n\n                                                        {/* Content */}\n                                                        <div className=\"flex-1 min-w-0\">\n                                                            <p\n                                                                className={cn(\n                                                                    'text-sm text-slate-900',\n                                                                    !notification.read && 'font-medium'\n                                                                )}\n                                                            >\n                                                                {notification.title}\n                                                            </p>\n                                                            {notification.message && (\n                                                                <p className=\"text-xs text-slate-600 mt-0.5\">\n                                                                    {notification.message}\n                                                                </p>\n                                                            )}\n                                                            <p className=\"text-xs text-slate-500 mt-1\">\n                                                                {formatRelativeTime(notification.createdAt)}\n                                                            </p>\n                                                        </div>\n\n                                                        {/* Unread indicator */}\n                                                        {!notification.read && (\n                                                            <div className=\"flex-shrink-0 w-2 h-2 bg-blue-600 rounded-full mt-2\" />\n                                                        )}\n                                                    </div>\n                                                </button>\n\n                                                {/* Action buttons (shown on hover) */}\n                                                <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1\">\n                                                    {!notification.read && (\n                                                        <button\n                                                            onClick={(e) => {\n                                                                e.stopPropagation()\n                                                                markAsRead(notification.id)\n                                                            }}\n                                                            className=\"p-1 rounded hover:bg-slate-200\"\n                                                            title=\"Mark as read\"\n                                                        >\n                                                            <Check className=\"h-3 w-3 text-slate-600\" />\n                                                        </button>\n                                                    )}\n                                                    <button\n                                                        onClick={(e) => {\n                                                            e.stopPropagation()\n                                                            archiveNotification(notification.id)\n                                                        }}\n                                                        className=\"p-1 rounded hover:bg-slate-200\"\n                                                        title=\"Archive\"\n                                                    >\n                                                        <Trash2 className=\"h-3 w-3 text-slate-600\" />\n                                                    </button>\n                                                </div>\n                                            </div>\n                                        )\n                                    })}\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Footer */}\n                        {notifications.length > 0 && (\n                            <div className=\"p-2 border-t border-slate-200 bg-slate-50\">\n                                <button\n                                    onClick={clearAll}\n                                    className=\"w-full text-center text-xs text-slate-600 hover:text-slate-900 py-2\"\n                                >\n                                    Clear all notifications\n                                </button>\n                            </div>\n                        )}\n                    </Card>\n                </>\n            )}\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/search/global-search.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":294,"column":69,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11393,11415],"text":"No results found for &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11393,11415],"text":"No results found for &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11393,11415],"text":"No results found for &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11393,11415],"text":"No results found for &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":294,"column":77,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11422,11423],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11422,11423],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11422,11423],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11422,11423],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect, useRef } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/client'\nimport { Input } from '@/components/ui/input'\nimport { Card } from '@/components/ui/card'\nimport { Search, User, Briefcase, CheckSquare, FileText, Loader2, X } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface SearchResult {\n    id: string\n    type: 'contact' | 'project' | 'task' | 'invoice'\n    title: string\n    subtitle?: string\n    url: string\n}\n\nexport function GlobalSearch() {\n    const [query, setQuery] = useState('')\n    const [results, setResults] = useState<SearchResult[]>([])\n    const [isLoading, setIsLoading] = useState(false)\n    const [isOpen, setIsOpen] = useState(false)\n    const [selectedIndex, setSelectedIndex] = useState(0)\n    const inputRef = useRef<HTMLInputElement>(null)\n    const router = useRouter()\n\n    // Debounced search\n    useEffect(() => {\n        if (query.trim().length < 2) {\n            setResults([])\n            setIsLoading(false)\n            return\n        }\n\n        setIsLoading(true)\n\n        const timeout = setTimeout(async () => {\n            await performSearch(query)\n        }, 300) // 300ms debounce\n\n        return () => clearTimeout(timeout)\n    }, [query])\n\n    const performSearch = async (searchQuery: string) => {\n        try {\n            const supabase = createClient()\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) return\n\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (!profile?.tenant_id) return\n\n            const searchResults: SearchResult[] = []\n\n            // Search contacts\n            const { data: contacts } = await supabase\n                .from('contacts')\n                .select('id, first_name, last_name, company_name, email, is_company')\n                .eq('tenant_id', profile.tenant_id)\n                .or(`first_name.ilike.%${searchQuery}%,last_name.ilike.%${searchQuery}%,company_name.ilike.%${searchQuery}%,email.ilike.%${searchQuery}%`)\n                .limit(5)\n\n            if (contacts) {\n                searchResults.push(\n                    ...contacts.map((contact) => ({\n                        id: contact.id,\n                        type: 'contact' as const,\n                        title: contact.is_company\n                            ? contact.company_name || 'Unnamed Company'\n                            : `${contact.first_name || ''} ${contact.last_name || ''}`.trim() ||\n                            'Unnamed Contact',\n                        subtitle: contact.email || undefined,\n                        url: `/contacts/${contact.id}`,\n                    }))\n                )\n            }\n\n            // Search projects\n            const { data: projects } = await supabase\n                .from('projects')\n                .select('id, name, description')\n                .eq('tenant_id', profile.tenant_id)\n                .or(`name.ilike.%${searchQuery}%,description.ilike.%${searchQuery}%`)\n                .limit(5)\n\n            if (projects) {\n                searchResults.push(\n                    ...projects.map((project) => ({\n                        id: project.id,\n                        type: 'project' as const,\n                        title: project.name,\n                        subtitle: project.description || undefined,\n                        url: `/projects/${project.id}`,\n                    }))\n                )\n            }\n\n            // Search tasks\n            const { data: tasks } = await supabase\n                .from('tasks')\n                .select('id, title, description')\n                .eq('tenant_id', profile.tenant_id)\n                .or(`title.ilike.%${searchQuery}%,description.ilike.%${searchQuery}%`)\n                .limit(5)\n\n            if (tasks) {\n                searchResults.push(\n                    ...tasks.map((task) => ({\n                        id: task.id,\n                        type: 'task' as const,\n                        title: task.title,\n                        subtitle: task.description || undefined,\n                        url: `/tasks/${task.id}`,\n                    }))\n                )\n            }\n\n            // Search invoices\n            const { data: invoices } = await supabase\n                .from('invoices')\n                .select('id, invoice_number, description')\n                .eq('tenant_id', profile.tenant_id)\n                .or(`invoice_number.ilike.%${searchQuery}%,description.ilike.%${searchQuery}%`)\n                .limit(5)\n\n            if (invoices) {\n                searchResults.push(\n                    ...invoices.map((invoice) => ({\n                        id: invoice.id,\n                        type: 'invoice' as const,\n                        title: `Invoice ${invoice.invoice_number}`,\n                        subtitle: invoice.description || undefined,\n                        url: `/invoices/${invoice.id}`,\n                    }))\n                )\n            }\n\n            setResults(searchResults)\n            setSelectedIndex(0)\n        } catch (error) {\n            console.error('Search error:', error)\n        } finally {\n            setIsLoading(false)\n        }\n    }\n\n    const handleSelect = (result: SearchResult) => {\n        router.push(result.url)\n        setQuery('')\n        setResults([])\n        setIsOpen(false)\n        inputRef.current?.blur()\n    }\n\n    const handleKeyDown = (e: React.KeyboardEvent) => {\n        if (!isOpen) return\n\n        switch (e.key) {\n            case 'ArrowDown':\n                e.preventDefault()\n                setSelectedIndex((prev) => (prev + 1) % results.length)\n                break\n            case 'ArrowUp':\n                e.preventDefault()\n                setSelectedIndex((prev) => (prev - 1 + results.length) % results.length)\n                break\n            case 'Enter':\n                e.preventDefault()\n                if (results[selectedIndex]) {\n                    handleSelect(results[selectedIndex])\n                }\n                break\n            case 'Escape':\n                e.preventDefault()\n                setIsOpen(false)\n                setQuery('')\n                setResults([])\n                inputRef.current?.blur()\n                break\n        }\n    }\n\n    const getIcon = (type: SearchResult['type']) => {\n        switch (type) {\n            case 'contact':\n                return <User className=\"h-4 w-4\" />\n            case 'project':\n                return <Briefcase className=\"h-4 w-4\" />\n            case 'task':\n                return <CheckSquare className=\"h-4 w-4\" />\n            case 'invoice':\n                return <FileText className=\"h-4 w-4\" />\n        }\n    }\n\n    const getTypeColor = (type: SearchResult['type']) => {\n        switch (type) {\n            case 'contact':\n                return 'text-blue-600'\n            case 'project':\n                return 'text-purple-600'\n            case 'task':\n                return 'text-green-600'\n            case 'invoice':\n                return 'text-orange-600'\n        }\n    }\n\n    return (\n        <div className=\"relative\">\n            <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\n                <Input\n                    ref={inputRef}\n                    type=\"text\"\n                    placeholder=\"Search contacts, projects, tasks...\"\n                    value={query}\n                    onChange={(e) => setQuery(e.target.value)}\n                    onFocus={() => setIsOpen(true)}\n                    onKeyDown={handleKeyDown}\n                    className=\"pl-10 pr-10 bg-white border-slate-300\"\n                />\n                {(isLoading || query) && (\n                    <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\n                        {isLoading ? (\n                            <Loader2 className=\"h-4 w-4 animate-spin text-slate-400\" />\n                        ) : (\n                            <button\n                                onClick={() => {\n                                    setQuery('')\n                                    setResults([])\n                                    setIsOpen(false)\n                                }}\n                                className=\"text-slate-400 hover:text-slate-600\"\n                            >\n                                <X className=\"h-4 w-4\" />\n                            </button>\n                        )}\n                    </div>\n                )}\n            </div>\n\n            {/* Results dropdown */}\n            {isOpen && results.length > 0 && (\n                <Card className=\"absolute top-full mt-2 w-full z-50 border-slate-200 shadow-lg max-h-96 overflow-y-auto\">\n                    <div className=\"p-2\">\n                        {results.map((result, index) => (\n                            <button\n                                key={`${result.type}-${result.id}`}\n                                onClick={() => handleSelect(result)}\n                                onMouseEnter={() => setSelectedIndex(index)}\n                                className={cn(\n                                    'w-full text-left p-3 rounded-lg flex items-start gap-3 transition-colors',\n                                    index === selectedIndex\n                                        ? 'bg-slate-100'\n                                        : 'hover:bg-slate-50'\n                                )}\n                            >\n                                <div className={cn('mt-0.5', getTypeColor(result.type))}>\n                                    {getIcon(result.type)}\n                                </div>\n                                <div className=\"flex-1 min-w-0\">\n                                    <div className=\"flex items-center gap-2\">\n                                        <p className=\"text-sm font-medium text-slate-900 truncate\">\n                                            {result.title}\n                                        </p>\n                                        <span className=\"text-xs text-slate-500 capitalize flex-shrink-0\">\n                                            {result.type}\n                                        </span>\n                                    </div>\n                                    {result.subtitle && (\n                                        <p className=\"text-xs text-slate-500 truncate mt-0.5\">\n                                            {result.subtitle}\n                                        </p>\n                                    )}\n                                </div>\n                            </button>\n                        ))}\n                    </div>\n                </Card>\n            )}\n\n            {/* No results */}\n            {isOpen && query.length >= 2 && !isLoading && results.length === 0 && (\n                <Card className=\"absolute top-full mt-2 w-full z-50 border-slate-200 shadow-lg\">\n                    <div className=\"p-4 text-center text-slate-500\">\n                        <Search className=\"h-8 w-8 mx-auto mb-2 opacity-30\" />\n                        <p className=\"text-sm\">No results found for \"{query}\"</p>\n                    </div>\n                </Card>\n            )}\n        </div>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/seed-data-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/empty-state.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/components/ui/textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/hooks/use-keyboard-shortcuts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/activity-log.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[832,835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[832,835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2283,2286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2283,2286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2904,2907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2904,2907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5462,5465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5462,5465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Activity Logging Utility\n *\n * Provides helper functions for logging user activities to the activity_log table.\n * This creates an audit trail and powers the timeline features.\n */\n\nimport { createClient } from '@/lib/supabase/client'\n\nexport type EventType =\n    | 'created'\n    | 'updated'\n    | 'deleted'\n    | 'viewed'\n    | 'emailed'\n    | 'called'\n    | 'noted'\n    | 'tagged'\n    | 'status_changed'\n    | 'assigned'\n    | 'completed'\n    | 'invoiced'\n    | 'paid'\n    | 'uploaded'\n    | 'downloaded'\n\nexport type EntityType =\n    | 'contact'\n    | 'project'\n    | 'task'\n    | 'invoice'\n    | 'document'\n    | 'note'\n    | 'tag'\n\nexport interface ActivityLogEntry {\n    eventType: EventType\n    entityType: EntityType\n    entityId: string\n    entityName?: string\n    description?: string\n    metadata?: Record<string, any>\n}\n\n/**\n * Log an activity to the database\n */\nexport async function logActivity({\n    eventType,\n    entityType,\n    entityId,\n    entityName,\n    description,\n    metadata = {},\n}: ActivityLogEntry): Promise<{ success: boolean; error?: string }> {\n    try {\n        const supabase = createClient()\n\n        // Get current user and org\n        const { data: { user } } = await supabase.auth.getUser()\n        if (!user) {\n            return { success: false, error: 'Not authenticated' }\n        }\n\n        const { data: profile } = await supabase\n            .from('profiles')\n            .select('tenant_id')\n            .eq('id', user.id)\n            .single()\n\n        if (!profile?.tenant_id) {\n            return { success: false, error: 'No organization found' }\n        }\n\n        // Insert activity log\n        const { error } = await supabase\n            .from('activity_log')\n            .insert({\n                tenant_id: profile.tenant_id,\n                user_id: user.id,\n                event_type: eventType,\n                entity_type: entityType,\n                entity_id: entityId,\n                entity_name: entityName,\n                description: description,\n                metadata: metadata,\n            })\n\n        if (error) {\n            console.error('Failed to log activity:', error)\n            return { success: false, error: error.message }\n        }\n\n        return { success: true }\n    } catch (error: any) {\n        console.error('Activity logging error:', error)\n        return { success: false, error: error.message }\n    }\n}\n\n/**\n * Helper functions for common activities\n */\n\nexport const ActivityLogger = {\n    // Contact activities\n    contactCreated: (contactId: string, contactName: string) =>\n        logActivity({\n            eventType: 'created',\n            entityType: 'contact',\n            entityId: contactId,\n            entityName: contactName,\n            description: `Created contact: ${contactName}`,\n        }),\n\n    contactUpdated: (contactId: string, contactName: string, changes?: Record<string, any>) =>\n        logActivity({\n            eventType: 'updated',\n            entityType: 'contact',\n            entityId: contactId,\n            entityName: contactName,\n            description: `Updated contact: ${contactName}`,\n            metadata: changes,\n        }),\n\n    contactDeleted: (contactId: string, contactName: string) =>\n        logActivity({\n            eventType: 'deleted',\n            entityType: 'contact',\n            entityId: contactId,\n            entityName: contactName,\n            description: `Deleted contact: ${contactName}`,\n        }),\n\n    contactStatusChanged: (\n        contactId: string,\n        contactName: string,\n        oldStatus: string,\n        newStatus: string\n    ) =>\n        logActivity({\n            eventType: 'status_changed',\n            entityType: 'contact',\n            entityId: contactId,\n            entityName: contactName,\n            description: `Changed status from ${oldStatus} to ${newStatus}`,\n            metadata: { old_status: oldStatus, new_status: newStatus },\n        }),\n\n    contactEmailed: (contactId: string, contactName: string, subject?: string) =>\n        logActivity({\n            eventType: 'emailed',\n            entityType: 'contact',\n            entityId: contactId,\n            entityName: contactName,\n            description: subject ? `Emailed: ${subject}` : 'Sent email',\n            metadata: { subject },\n        }),\n\n    contactCalled: (contactId: string, contactName: string, duration?: number) =>\n        logActivity({\n            eventType: 'called',\n            entityType: 'contact',\n            entityId: contactId,\n            entityName: contactName,\n            description: duration ? `Called (${duration}min)` : 'Called contact',\n            metadata: { duration },\n        }),\n\n    contactNoted: (contactId: string, contactName: string, note: string) =>\n        logActivity({\n            eventType: 'noted',\n            entityType: 'contact',\n            entityId: contactId,\n            entityName: contactName,\n            description: 'Added note',\n            metadata: { note: note.slice(0, 100) }, // Store truncated note\n        }),\n\n    // Project activities\n    projectCreated: (projectId: string, projectName: string) =>\n        logActivity({\n            eventType: 'created',\n            entityType: 'project',\n            entityId: projectId,\n            entityName: projectName,\n            description: `Created project: ${projectName}`,\n        }),\n\n    projectUpdated: (projectId: string, projectName: string, changes?: Record<string, any>) =>\n        logActivity({\n            eventType: 'updated',\n            entityType: 'project',\n            entityId: projectId,\n            entityName: projectName,\n            description: `Updated project: ${projectName}`,\n            metadata: changes,\n        }),\n\n    projectDeleted: (projectId: string, projectName: string) =>\n        logActivity({\n            eventType: 'deleted',\n            entityType: 'project',\n            entityId: projectId,\n            entityName: projectName,\n            description: `Deleted project: ${projectName}`,\n        }),\n\n    projectCompleted: (projectId: string, projectName: string) =>\n        logActivity({\n            eventType: 'completed',\n            entityType: 'project',\n            entityId: projectId,\n            entityName: projectName,\n            description: `Completed project: ${projectName}`,\n        }),\n\n    // Task activities\n    taskCreated: (taskId: string, taskTitle: string) =>\n        logActivity({\n            eventType: 'created',\n            entityType: 'task',\n            entityId: taskId,\n            entityName: taskTitle,\n            description: `Created task: ${taskTitle}`,\n        }),\n\n    taskCompleted: (taskId: string, taskTitle: string) =>\n        logActivity({\n            eventType: 'completed',\n            entityType: 'task',\n            entityId: taskId,\n            entityName: taskTitle,\n            description: `Completed task: ${taskTitle}`,\n        }),\n\n    // Invoice activities\n    invoiceCreated: (invoiceId: string, invoiceNumber: string, amount: number) =>\n        logActivity({\n            eventType: 'invoiced',\n            entityType: 'invoice',\n            entityId: invoiceId,\n            entityName: invoiceNumber,\n            description: `Created invoice ${invoiceNumber} for CHF ${amount}`,\n            metadata: { amount, currency: 'CHF' },\n        }),\n\n    invoicePaid: (invoiceId: string, invoiceNumber: string, amount: number) =>\n        logActivity({\n            eventType: 'paid',\n            entityType: 'invoice',\n            entityId: invoiceId,\n            entityName: invoiceNumber,\n            description: `Invoice ${invoiceNumber} paid (CHF ${amount})`,\n            metadata: { amount, currency: 'CHF' },\n        }),\n}\n\n/**\n * Fetch activity log for a specific entity (e.g., contact timeline)\n */\nexport async function getEntityActivity(\n    entityType: EntityType,\n    entityId: string,\n    limit = 50\n) {\n    const supabase = createClient()\n\n    const { data, error } = await supabase\n        .from('activity_feed')\n        .select('*')\n        .eq('entity_type', entityType)\n        .eq('entity_id', entityId)\n        .order('created_at', { ascending: false })\n        .limit(limit)\n\n    if (error) {\n        console.error('Failed to fetch entity activity:', error)\n        return []\n    }\n\n    return data || []\n}\n\n/**\n * Fetch recent activity for the organization\n */\nexport async function getOrganizationActivity(limit = 50) {\n    const supabase = createClient()\n\n    const { data: { user } } = await supabase.auth.getUser()\n    if (!user) return []\n\n    const { data: profile } = await supabase\n        .from('profiles')\n        .select('tenant_id')\n        .eq('id', user.id)\n        .single()\n\n    if (!profile?.tenant_id) return []\n\n    const { data, error } = await supabase\n        .from('activity_feed')\n        .select('*')\n        .eq('tenant_id', profile.tenant_id)\n        .order('created_at', { ascending: false })\n        .limit(limit)\n\n    if (error) {\n        console.error('Failed to fetch organization activity:', error)\n        return []\n    }\n\n    return data || []\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/ai/document-processor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/ai/document-search.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2088,2091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2088,2091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5404,5407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5404,5407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":263,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6731,6734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6731,6734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@/lib/supabase/server';\nimport { generateQueryEmbedding } from './embeddings';\nimport { type DocVisibility } from '@/lib/types/schema';\n\n/**\n * Document Search Result\n */\nexport interface SearchResult {\n  id: string;\n  documentId: string;\n  documentName: string;\n  content: string;\n  similarity: number;\n  chunkIndex: number;\n  visibility: DocVisibility;\n  projectId: string | null;\n  contactId: string | null;\n}\n\n/**\n * Search options\n */\nexport interface SearchOptions {\n  limit?: number;\n  threshold?: number; // Minimum similarity score (0-1)\n  visibility?: DocVisibility | 'all'; // Filter by visibility\n  projectId?: string | null; // Filter by project\n  contactId?: string | null; // Filter by contact\n}\n\n/**\n * Semantic search across document chunks using vector similarity\n * Uses pgvector cosine similarity with OpenAI embeddings\n */\nexport async function searchDocuments(\n  query: string,\n  tenantId: string,\n  options: SearchOptions = {}\n): Promise<SearchResult[]> {\n  const {\n    limit = 5,\n    threshold = 0.5,\n    visibility = 'all',\n    projectId,\n    contactId,\n  } = options;\n\n  if (!query || query.trim().length === 0) {\n    return [];\n  }\n\n  try {\n    // Generate embedding for query\n    const queryEmbedding = await generateQueryEmbedding(query);\n\n    const supabase = await createClient();\n\n    // Build RPC call for vector similarity search\n    // This uses a custom Postgres function for efficient similarity search\n    const { data, error } = await supabase.rpc('match_document_chunks', {\n      query_embedding: queryEmbedding,\n      match_tenant_id: tenantId,\n      match_threshold: threshold,\n      match_count: limit,\n      match_visibility: visibility === 'all' ? null : visibility,\n      match_project_id: projectId,\n      match_contact_id: contactId,\n    });\n\n    if (error) {\n      console.error('Vector search error:', error);\n      throw new Error('Failed to search documents');\n    }\n\n    if (!data || data.length === 0) {\n      return [];\n    }\n\n    // Transform results\n    const results: SearchResult[] = data.map((row: any) => ({\n      id: row.id,\n      documentId: row.document_id,\n      documentName: row.document_name,\n      content: row.content,\n      similarity: row.similarity,\n      chunkIndex: row.chunk_index,\n      visibility: row.visibility,\n      projectId: row.project_id,\n      contactId: row.contact_id,\n    }));\n\n    return results;\n  } catch (error) {\n    console.error('Document search error:', error);\n    throw error;\n  }\n}\n\n/**\n * Hybrid search: combines keyword search with vector similarity\n * Better recall than pure vector search\n */\nexport async function hybridSearch(\n  query: string,\n  tenantId: string,\n  options: SearchOptions = {}\n): Promise<SearchResult[]> {\n  const { limit = 5 } = options;\n\n  try {\n    // Run both searches in parallel\n    const [vectorResults, keywordResults] = await Promise.all([\n      searchDocuments(query, tenantId, { ...options, limit: limit * 2 }),\n      keywordSearchDocuments(query, tenantId, options),\n    ]);\n\n    // Combine and deduplicate results\n    const resultMap = new Map<string, SearchResult>();\n\n    // Add vector results (higher priority)\n    for (const result of vectorResults) {\n      resultMap.set(result.id, result);\n    }\n\n    // Add keyword results (fill gaps)\n    for (const result of keywordResults) {\n      if (!resultMap.has(result.id)) {\n        resultMap.set(result.id, result);\n      }\n    }\n\n    // Sort by similarity and limit\n    const combined = Array.from(resultMap.values())\n      .sort((a, b) => b.similarity - a.similarity)\n      .slice(0, limit);\n\n    return combined;\n  } catch (error) {\n    console.error('Hybrid search error:', error);\n    throw error;\n  }\n}\n\n/**\n * Keyword-based search using PostgreSQL full-text search\n * Faster but less semantic than vector search\n */\nexport async function keywordSearchDocuments(\n  query: string,\n  tenantId: string,\n  options: SearchOptions = {}\n): Promise<SearchResult[]> {\n  const {\n    limit = 5,\n    visibility = 'all',\n    projectId,\n    contactId,\n  } = options;\n\n  if (!query || query.trim().length === 0) {\n    return [];\n  }\n\n  try {\n    const supabase = await createClient();\n\n    // Build query\n    let queryBuilder = supabase\n      .from('document_chunks')\n      .select(`\n        id,\n        document_id,\n        content,\n        chunk_index,\n        documents!inner (\n          id,\n          name,\n          visibility,\n          project_id,\n          contact_id,\n          tenant_id\n        )\n      `)\n      .eq('documents.tenant_id', tenantId)\n      .textSearch('content', query, {\n        type: 'websearch',\n        config: 'english',\n      })\n      .limit(limit);\n\n    // Apply filters\n    if (visibility !== 'all') {\n      queryBuilder = queryBuilder.eq('documents.visibility', visibility);\n    }\n\n    if (projectId) {\n      queryBuilder = queryBuilder.eq('documents.project_id', projectId);\n    }\n\n    if (contactId) {\n      queryBuilder = queryBuilder.eq('documents.contact_id', contactId);\n    }\n\n    const { data, error } = await queryBuilder;\n\n    if (error) {\n      console.error('Keyword search error:', error);\n      throw new Error('Failed to search documents');\n    }\n\n    if (!data || data.length === 0) {\n      return [];\n    }\n\n    // Transform results (similarity = 0.75 as approximate value for keyword matches)\n    const results: SearchResult[] = data.map((row: any) => ({\n      id: row.id,\n      documentId: row.document_id,\n      documentName: row.documents.name,\n      content: row.content,\n      similarity: 0.75, // Approximate score for keyword matches\n      chunkIndex: row.chunk_index,\n      visibility: row.documents.visibility,\n      projectId: row.documents.project_id,\n      contactId: row.documents.contact_id,\n    }));\n\n    return results;\n  } catch (error) {\n    console.error('Keyword search error:', error);\n    throw error;\n  }\n}\n\n/**\n * Get related chunks from the same document\n * Useful for providing context around a search result\n */\nexport async function getRelatedChunks(\n  documentId: string,\n  chunkIndex: number,\n  contextWindow = 2\n): Promise<{ content: string; index: number }[]> {\n  try {\n    const supabase = await createClient();\n\n    const startIndex = Math.max(0, chunkIndex - contextWindow);\n    const endIndex = chunkIndex + contextWindow;\n\n    const { data, error } = await supabase\n      .from('document_chunks')\n      .select('content, chunk_index')\n      .eq('document_id', documentId)\n      .gte('chunk_index', startIndex)\n      .lte('chunk_index', endIndex)\n      .order('chunk_index', { ascending: true });\n\n    if (error) {\n      console.error('Error fetching related chunks:', error);\n      return [];\n    }\n\n    return (data || []).map((row: any) => ({\n      content: row.content,\n      index: row.chunk_index,\n    }));\n  } catch (error) {\n    console.error('Get related chunks error:', error);\n    return [];\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/ai/embeddings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/ai/rag.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createClient' is defined but never used.","line":1,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":22,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"createClient"},"fix":{"range":[0,53],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@/lib/supabase/server';\nimport { searchDocuments } from './document-search';\nimport { type DocVisibility } from '../types/schema';\n\n/**\n * RAG (Retrieval-Augmented Generation) Service\n * Provides context-aware document search for AI chat\n */\n\nexport interface RAGDocument {\n  id: string;\n  name: string;\n  content: string;\n  similarity: number;\n  visibility: DocVisibility;\n  documentId: string;\n}\n\nexport const RagService = {\n  /**\n   * Search similar documents for RAG context injection\n   * This is called by the AI chat tool when users ask questions\n   */\n  async searchSimilarDocuments(\n    query: string,\n    orgId: string,\n    visibilityFilter: DocVisibility[]\n  ): Promise<RAGDocument[]> {\n    try {\n      // Use visibility 'all' if both internal and shared are allowed\n      const visibility = visibilityFilter.length === 2 ? 'all' : visibilityFilter[0];\n\n      // Search using our vector similarity search\n      const results = await searchDocuments(query, orgId, {\n        limit: 5,\n        threshold: 0.5, // Minimum 50% similarity\n        visibility,\n      });\n\n      // Transform to RAG format\n      return results.map(result => ({\n        id: result.id,\n        name: result.documentName,\n        content: result.content,\n        similarity: result.similarity,\n        visibility: result.visibility,\n        documentId: result.documentId,\n      }));\n    } catch (error) {\n      console.error('RAG search error:', error);\n      // Return empty array on error - don't fail the chat request\n      return [];\n    }\n  },\n\n  /**\n   * Format RAG results for AI context injection\n   * Creates a formatted string to inject into the system prompt\n   */\n  formatRAGContext(documents: RAGDocument[]): string {\n    if (documents.length === 0) {\n      return '';\n    }\n\n    const formattedDocs = documents\n      .map((doc, idx) => {\n        const matchPercentage = (doc.similarity * 100).toFixed(0);\n        return `[${idx + 1}] Document: \"${doc.name}\" (${matchPercentage}% relevance)\nContent: ${doc.content}\n\n---`;\n      })\n      .join('\\n\\n');\n\n    return `\n\n=== RELEVANT DOCUMENTS ===\n\nThe following documents from the knowledge base are relevant to the user's question:\n\n${formattedDocs}\n\nPlease use this information to provide an accurate, context-aware response. Cite specific documents when appropriate.\n\n=========================\n`;\n  },\n\n  /**\n   * Extract citations from documents for display in chat\n   */\n  extractCitations(documents: RAGDocument[]): Array<{\n    documentId: string;\n    documentName: string;\n    similarity: number;\n  }> {\n    return documents.map(doc => ({\n      documentId: doc.documentId,\n      documentName: doc.name,\n      similarity: doc.similarity,\n    }));\n  },\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/email/notification-templates.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/email/portal-invitation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/email/resend-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/format-time.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/invoices/eu-invoice.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/invoices/pdf-generator.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[228,231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[228,231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3760,3763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3760,3763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3831,3834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3831,3834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3898,3901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3898,3901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3964,3967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3964,3967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport PDFDocument from 'pdfkit';\nimport { SwissQRBill } from './swiss-qr';\nimport type { InvoiceWithLineItems } from '@/stores/invoice-store';\n\nexport async function generateInvoicePDF(invoice: InvoiceWithLineItems, settings: any): Promise<Buffer> {\n    return new Promise((resolve, reject) => {\n        const doc = new PDFDocument({ size: 'A4', margin: 50 });\n        const chunks: Uint8Array[] = [];\n\n        doc.on('data', (chunk) => chunks.push(chunk));\n        doc.on('end', () => resolve(Buffer.concat(chunks)));\n        doc.on('error', (err) => reject(err));\n\n        // Organization details\n        const billing = settings?.billing || {};\n\n        // Header\n        doc.fontSize(20).text('INVOICE', { align: 'right' });\n        doc.fontSize(10).text(invoice.invoice_number, { align: 'right' });\n\n        // Company Logo/Name\n        doc.fontSize(16).text(billing.company_name || 'OrbitCRM User', 50, 50);\n        doc.fontSize(10)\n            .text(billing.address_line1 || '')\n            .text(`${billing.postal_code || ''} ${billing.city || ''}`)\n            .text(billing.country || '');\n\n        doc.moveDown();\n\n        // Client Details\n        const contact = invoice.contact;\n        const clientName = contact?.is_company ? contact.company_name : `${contact?.first_name} ${contact?.last_name}`.trim();\n\n        doc.text('Bill To:', 50, 150);\n        doc.font('Helvetica-Bold').text(clientName || 'Valued Client');\n        doc.font('Helvetica');\n        // Add client address if available\n\n        // Invoice Meta\n        doc.text(`Date: ${new Date(invoice.created_at).toLocaleDateString()}`, 400, 150, { align: 'right' });\n        if (invoice.due_date) {\n            doc.text(`Due Date: ${new Date(invoice.due_date).toLocaleDateString()}`, 400, 165, { align: 'right' });\n        }\n\n        // Line Items\n        let y = 250;\n        doc.font('Helvetica-Bold');\n        doc.text('Description', 50, y);\n        doc.text('Qty', 280, y, { width: 50, align: 'right' });\n        doc.text('Price', 330, y, { width: 70, align: 'right' });\n        doc.text('Total', 400, y, { width: 90, align: 'right' });\n\n        doc.moveTo(50, y + 15).lineTo(500, y + 15).stroke();\n        y += 25;\n        doc.font('Helvetica');\n\n        invoice.line_items.forEach(item => {\n            doc.text(item.description, 50, y);\n            doc.text(item.quantity.toString(), 280, y, { width: 50, align: 'right' });\n            doc.text(item.unit_price.toFixed(2), 330, y, { width: 70, align: 'right' });\n            doc.text((item.quantity * item.unit_price).toFixed(2), 400, y, { width: 90, align: 'right' });\n            y += 20;\n        });\n\n        // Totals\n        y += 20;\n        doc.moveTo(350, y).lineTo(500, y).stroke();\n        y += 10;\n\n        doc.text('Subtotal:', 300, y, { width: 100, align: 'right' });\n        doc.text((invoice.subtotal ?? 0).toFixed(2), 400, y, { width: 90, align: 'right' });\n        y += 15;\n\n        doc.text(`VAT:`, 300, y, { width: 100, align: 'right' });\n        doc.text((invoice.tax_total ?? 0).toFixed(2), 400, y, { width: 90, align: 'right' });\n        y += 15;\n\n        doc.font('Helvetica-Bold');\n        doc.text(`Total ${invoice.currency}:`, 300, y, { width: 100, align: 'right' });\n        doc.text(invoice.amount_total.toFixed(2), 400, y, { width: 90, align: 'right' });\n\n        // Swiss QR Section\n        if (invoice.invoice_type === 'swiss_qr') {\n            // Create QR Bill instance\n            const qrBill = new SwissQRBill({\n                currency: invoice.currency as 'CHF' | 'EUR',\n                amount: invoice.amount_total,\n                reference: invoice.qr_reference || '',\n                debtor: {\n                    name: clientName || 'Unknown',\n                    address: (contact as any)?.address_line1 || 'Unknown',\n                    zip: (contact as any)?.postal_code || '0000',\n                    city: (contact as any)?.city || 'Unknown',\n                    country: (contact as any)?.country || 'CH'\n                },\n                creditor: {\n                    name: billing.company_name || 'My Company',\n                    address: billing.address_line1 || 'My Address',\n                    zip: billing.postal_code || '1000',\n                    city: billing.city || 'Zurich',\n                    country: billing.country || 'CH',\n                    account: (billing.iban || '').replace(/\\s/g, '')\n                },\n                message: `Invoice ${invoice.invoice_number}`\n            });\n\n            // Apply to current page bottom\n            qrBill.attachTo(doc);\n        }\n\n        doc.end();\n    });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/invoices/swiss-qr.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PDFDocument' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"PDFDocument"},"fix":{"range":[1,34],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qrString' is assigned a value but never used.","line":62,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":91,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":91,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport PDFDocument from 'pdfkit';\nimport QRCode from 'qrcode';\n\ninterface QRBillData {\n    currency: 'CHF' | 'EUR';\n    amount: number;\n    reference: string;\n    creditor: {\n        name: string;\n        address: string;\n        zip: string;\n        city: string;\n        country: string;\n        account: string;\n    };\n    debtor: {\n        name: string;\n        address: string;\n        zip: string;\n        city: string;\n        country: string;\n    };\n    message?: string;\n}\n\nexport class SwissQRBill {\n    private data: QRBillData;\n\n    constructor(data: QRBillData) {\n        this.data = data;\n    }\n\n    public attachTo(doc: PDFKit.PDFDocument) {\n        const pageWidth = doc.page.width;\n        const pageHeight = doc.page.height;\n\n        // Swiss QR Bill specifications\n        const billHeight = 296.33; // ~105mm in points\n        const billY = pageHeight - billHeight;\n\n        // Draw separator line with scissors if needed, or just a line\n        doc.lineWidth(1)\n            .dash(3, { space: 3 })\n            .moveTo(0, billY)\n            .lineTo(pageWidth, billY)\n            .stroke();\n\n        doc.undash();\n\n        doc.text('Payment Part', 60, billY + 20); // Placeholder for actual QR Bill layout\n\n        // This is a simplified placeholder implementation.\n        // A full implementation requires precise positioning of text and the QR code.\n        // Ideally, we'd use a library, but since 'swissqrbill' failed, we render a basic valid QR.\n\n        // Generate QR Code content string (Swiss QR Standard)\n        // SPC\\r\\n0200\\r\\n1\\r\\n... (This needs strict formatting)\n        // For MVP, we'll generate a QR code that contains the IBAN and Ref for scanning ease.\n        // Note: This won't be a 100% banking compliant Swiss QR without the strict format library.\n\n        const qrString = `SPC\\r\\n0200\\r\\n1\\r\\n${this.data.creditor.account}\\r\\n...\\r\\n${this.data.amount}`;\n\n        this.renderExamples(doc, billY);\n    }\n\n    private async renderExamples(doc: PDFKit.PDFDocument, y: number) {\n        // Mockup of a QR bill bottom section\n        doc.fontSize(10).text('Account / Payable to', 60, y + 40);\n        doc.fontSize(8).text(this.data.creditor.account, 60, y + 55);\n        doc.text(this.data.creditor.name, 60, y + 65);\n        doc.text(`${this.data.creditor.address}, ${this.data.creditor.zip} ${this.data.creditor.city}`, 60, y + 75);\n\n        doc.fontSize(10).text('Reference', 200, y + 40);\n        doc.fontSize(8).text(this.data.reference, 200, y + 55);\n\n        doc.fontSize(10).text('Payable by', 60, y + 120);\n        doc.fontSize(8).text(this.data.debtor.name, 60, y + 135);\n        doc.text(`${this.data.debtor.address}, ${this.data.debtor.zip} ${this.data.debtor.city}`, 60, y + 145);\n\n        doc.fontSize(10).text('Currency', 60, y + 200);\n        doc.text(this.data.currency, 60, y + 215);\n\n        doc.text('Amount', 100, y + 200);\n        doc.text(this.data.amount.toFixed(2), 100, y + 215);\n\n        // Generate QR\n        try {\n            const qrDataUrl = await QRCode.toDataURL(this.data.creditor.account, { errorCorrectionLevel: 'M' });\n            doc.image(qrDataUrl, 200, y + 120, { width: 100, height: 100 });\n        } catch (e) {\n            doc.text('Error generating QR', 200, y + 150);\n        }\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/invoices/tax-rates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/mock-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Conversation' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":22,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Conversation"},"fix":{"range":[166,179],"text":""},"desc":"Remove unused variable \"Conversation\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Mock data seed for OrbitCRM demo\n\nimport { Contact } from '@/types/contact'\nimport { Project } from '@/types/project'\nimport { Task } from '@/types/task'\nimport { Conversation, Message } from '@/types/chat'\n\nexport const mockContacts: Omit<Contact, 'id' | 'createdAt' | 'updatedAt'>[] = [\n    {\n        firstName: 'Sarah',\n        lastName: 'Johnson',\n        isCompany: false,\n        email: 'sarah.johnson@techcorp.com',\n        phone: '+1 415 555 0101',\n        companyName: 'TechCorp Inc',\n        status: 'client',\n        tags: ['enterprise', 'tech'],\n        notes: [],\n    },\n    {\n        firstName: 'Michael',\n        lastName: 'Chen',\n        isCompany: false,\n        email: 'mchen@startuphub.io',\n        phone: '+1 628 555 0202',\n        companyName: 'StartupHub',\n        status: 'opportunity',\n        tags: ['startup', 'saas'],\n        notes: [],\n    },\n    {\n        firstName: 'Emma',\n        lastName: 'Williams',\n        isCompany: false,\n        email: 'emma.w@designstudio.co',\n        phone: '+1 510 555 0303',\n        companyName: 'Design Studio Co',\n        status: 'lead',\n        tags: ['design', 'agency'],\n        notes: [],\n    },\n    {\n        firstName: 'James',\n        lastName: 'Rodriguez',\n        isCompany: false,\n        email: 'james@globalventures.com',\n        phone: '+1 925 555 0404',\n        companyName: 'Global Ventures',\n        status: 'client',\n        tags: ['finance', 'investment'],\n        notes: [],\n    },\n    {\n        firstName: 'Lisa',\n        lastName: 'Park',\n        isCompany: false,\n        email: 'lpark@innovatelabs.dev',\n        phone: '+1 408 555 0505',\n        companyName: 'Innovate Labs',\n        status: 'opportunity',\n        tags: ['tech', 'ai'],\n        notes: [],\n    },\n    {\n        firstName: 'David',\n        lastName: 'Kim',\n        isCompany: false,\n        email: 'david.kim@retailplus.com',\n        phone: '+1 650 555 0606',\n        companyName: 'RetailPlus',\n        status: 'lead',\n        tags: ['retail', 'ecommerce'],\n        notes: [],\n    },\n    {\n        firstName: 'Anna',\n        lastName: 'Martinez',\n        isCompany: false,\n        email: 'anna@greentech.eco',\n        phone: '+1 831 555 0707',\n        companyName: 'GreenTech Solutions',\n        status: 'churned',\n        tags: ['sustainability', 'tech'],\n        notes: [],\n    },\n    {\n        firstName: 'Robert',\n        lastName: 'Thompson',\n        isCompany: false,\n        email: 'rthompson@lawfirm.legal',\n        phone: '+1 415 555 0808',\n        companyName: 'Thompson & Associates',\n        status: 'client',\n        tags: ['legal', 'professional'],\n        notes: [],\n    },\n]\n\nexport const mockProjects: Omit<Project, 'id' | 'createdAt' | 'updatedAt'>[] = [\n    {\n        name: 'TechCorp Website Redesign',\n        description: 'Complete overhaul of corporate website with new brand identity',\n        clientName: 'TechCorp Inc',\n        status: 'active',\n    },\n    {\n        name: 'StartupHub Mobile App',\n        description: 'iOS and Android app for community engagement',\n        clientName: 'StartupHub',\n        status: 'planning',\n    },\n    {\n        name: 'Global Ventures CRM Integration',\n        description: 'Custom CRM integration with existing systems',\n        clientName: 'Global Ventures',\n        status: 'active',\n    },\n    {\n        name: 'RetailPlus E-commerce Platform',\n        description: 'New e-commerce platform with AI recommendations',\n        clientName: 'RetailPlus',\n        status: 'planning',\n    },\n    {\n        name: 'Design Studio Brand Guidelines',\n        description: 'Creating comprehensive brand guidelines document',\n        clientName: 'Design Studio Co',\n        status: 'completed',\n    },\n]\n\nexport const mockTasks: Omit<Task, 'id' | 'createdAt' | 'updatedAt'>[] = [\n    {\n        title: 'Review TechCorp wireframes',\n        description: 'Review and approve wireframes for homepage redesign',\n        status: 'done',\n        priority: 'high',\n        subtasks: [],\n    },\n    {\n        title: 'Prepare proposal for StartupHub',\n        description: 'Draft mobile app development proposal with timeline',\n        status: 'in_progress',\n        priority: 'high',\n        subtasks: [],\n    },\n    {\n        title: 'Schedule meeting with Global Ventures',\n        description: 'Quarterly review meeting to discuss project progress',\n        status: 'todo',\n        priority: 'medium',\n        subtasks: [],\n    },\n    {\n        title: 'Send invoice to TechCorp',\n        description: 'Monthly invoice for website development work',\n        status: 'todo',\n        priority: 'urgent',\n        subtasks: [],\n    },\n    {\n        title: 'Update RetailPlus requirements doc',\n        description: 'Incorporate feedback from stakeholder meeting',\n        status: 'in_progress',\n        priority: 'medium',\n        subtasks: [],\n    },\n    {\n        title: 'Research AI recommendation engines',\n        description: 'Evaluate options for RetailPlus platform',\n        status: 'todo',\n        priority: 'low',\n        subtasks: [],\n    },\n    {\n        title: 'Follow up with Lisa Park',\n        description: 'Discuss partnership opportunity with Innovate Labs',\n        status: 'todo',\n        priority: 'medium',\n        subtasks: [],\n    },\n    {\n        title: 'Review brand guidelines deliverable',\n        description: 'Final review before sending to Design Studio',\n        status: 'done',\n        priority: 'high',\n        subtasks: [],\n    },\n]\n\nexport const mockConversations: { title: string; messages: Omit<Message, 'id' | 'createdAt'>[] }[] = [\n    {\n        title: 'Help me draft an email to Sarah...',\n        messages: [\n            { role: 'user', content: 'Help me draft an email to Sarah Johnson about the website redesign progress' },\n            { role: 'assistant', content: 'I\\'d be happy to help you draft that email! Here\\'s a professional update:\\n\\nSubject: TechCorp Website Redesign - Progress Update\\n\\nDear Sarah,\\n\\nI wanted to provide you with a quick update on the website redesign project. We\\'ve made excellent progress this week:\\n\\n Homepage wireframes are now approved\\n Development of the new navigation is 80% complete\\n Mobile responsive layouts are in testing\\n\\nWe\\'re on track for the milestone delivery next Friday. Would you like to schedule a demo call to review the progress?\\n\\nBest regards' },\n        ],\n    },\n    {\n        title: 'What tasks are due this week?',\n        messages: [\n            { role: 'user', content: 'What tasks are due this week?' },\n            { role: 'assistant', content: 'Based on your current task list, here are your priorities for this week:\\n\\n Urgent:\\n Send invoice to TechCorp (overdue)\\n\\n High Priority:\\n Prepare proposal for StartupHub (in progress)\\n\\n Medium Priority:\\n Schedule meeting with Global Ventures\\n Follow up with Lisa Park\\n Update RetailPlus requirements doc (in progress)\\n\\nWould you like me to help you with any of these tasks?' },\n        ],\n    },\n]\n\nexport function seedMockData() {\n    // This function should be called from client components\n    // It returns the data to be added via store functions\n    return {\n        contacts: mockContacts,\n        projects: mockProjects,\n        tasks: mockTasks,\n        conversations: mockConversations,\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/portal/session.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/pricing/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reason' is defined but never used.","line":215,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":215,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * OrbitCRM Pricing Configuration\n * \n * Defines subscription tiers, token allocations, and model access.\n */\n\nexport type SubscriptionTier = 'free' | 'pro' | 'business';\n\nexport interface TierConfig {\n  id: SubscriptionTier;\n  name: string;\n  price: number; // EUR per month\n  tokenAllocation: number;\n  maxUsers: number;\n  storageGb: number;\n  availableModels: AIModel[];\n  maxPacks: number;\n  features: string[];\n}\n\nexport type AIModel = \n  | 'gpt-4o-mini'\n  | 'gpt-4o'\n  | 'claude-3-5-sonnet'\n  | 'claude-3-opus'\n  | 'gemini-pro';\n\nexport interface ModelConfig {\n  id: AIModel;\n  name: string;\n  provider: 'openai' | 'anthropic' | 'google';\n  minimumTier: SubscriptionTier;\n  tokenMultiplier: number;\n  description: string;\n}\n\n// Tier configurations\nexport const tiers: Record<SubscriptionTier, TierConfig> = {\n  free: {\n    id: 'free',\n    name: 'Free',\n    price: 0,\n    tokenAllocation: 1000,\n    maxUsers: 1,\n    storageGb: 1,\n    availableModels: ['gpt-4o-mini'],\n    maxPacks: 0,\n    features: [\n      'Core modules (Contacts, Tasks, Invoicing)',\n      'AI Chat with GPT-4o Mini',\n      'RAG Knowledge Base',\n      'Swiss QR-Bill invoicing',\n      'EU IBAN invoicing',\n    ],\n  },\n  pro: {\n    id: 'pro',\n    name: 'Pro',\n    price: 29,\n    tokenAllocation: 50000,\n    maxUsers: 1,\n    storageGb: 10,\n    availableModels: ['gpt-4o-mini', 'gpt-4o', 'claude-3-5-sonnet', 'gemini-pro'],\n    maxPacks: 1,\n    features: [\n      'Everything in Free',\n      '50K AI tokens/month',\n      'All AI models',\n      '1 vertical pack of choice',\n      'Priority email support',\n    ],\n  },\n  business: {\n    id: 'business',\n    name: 'Business',\n    price: 79,\n    tokenAllocation: -1, // Unlimited\n    maxUsers: 10,\n    storageGb: 50,\n    availableModels: ['gpt-4o-mini', 'gpt-4o', 'claude-3-5-sonnet', 'claude-3-opus', 'gemini-pro'],\n    maxPacks: -1, // Unlimited\n    features: [\n      'Everything in Pro',\n      'Unlimited AI tokens',\n      'All vertical packs',\n      'Up to 10 users',\n      'Team collaboration',\n      'API access',\n      'SLA support',\n    ],\n  },\n};\n\n// Model configurations\nexport const models: Record<AIModel, ModelConfig> = {\n  'gpt-4o-mini': {\n    id: 'gpt-4o-mini',\n    name: 'GPT-4o Mini',\n    provider: 'openai',\n    minimumTier: 'free',\n    tokenMultiplier: 1,\n    description: 'Fast and efficient for everyday tasks',\n  },\n  'gpt-4o': {\n    id: 'gpt-4o',\n    name: 'GPT-4o',\n    provider: 'openai',\n    minimumTier: 'pro',\n    tokenMultiplier: 3,\n    description: 'Balanced quality and speed',\n  },\n  'claude-3-5-sonnet': {\n    id: 'claude-3-5-sonnet',\n    name: 'Claude 3.5 Sonnet',\n    provider: 'anthropic',\n    minimumTier: 'pro',\n    tokenMultiplier: 3,\n    description: 'Excellent for writing and analysis',\n  },\n  'claude-3-opus': {\n    id: 'claude-3-opus',\n    name: 'Claude 3 Opus',\n    provider: 'anthropic',\n    minimumTier: 'business',\n    tokenMultiplier: 5,\n    description: 'Premium quality for complex tasks',\n  },\n  'gemini-pro': {\n    id: 'gemini-pro',\n    name: 'Gemini Pro',\n    provider: 'google',\n    minimumTier: 'pro',\n    tokenMultiplier: 2,\n    description: 'Google AI with broad knowledge',\n  },\n};\n\n// Token pack configurations\nexport interface TokenPack {\n  id: string;\n  name: string;\n  tokens: number;\n  price: number;\n  pricePerThousand: number;\n}\n\nexport const tokenPacks: TokenPack[] = [\n  {\n    id: 'starter',\n    name: 'Starter Pack',\n    tokens: 25000,\n    price: 10,\n    pricePerThousand: 0.40,\n  },\n  {\n    id: 'plus',\n    name: 'Plus Pack',\n    tokens: 100000,\n    price: 35,\n    pricePerThousand: 0.35,\n  },\n  {\n    id: 'pro',\n    name: 'Pro Pack',\n    tokens: 500000,\n    price: 150,\n    pricePerThousand: 0.30,\n  },\n];\n\n// Utility functions\n\n/**\n * Check if a user can access a specific model\n */\nexport function canAccessModel(tier: SubscriptionTier, modelId: AIModel): boolean {\n  const model = models[modelId];\n  const tierOrder: SubscriptionTier[] = ['free', 'pro', 'business'];\n  return tierOrder.indexOf(tier) >= tierOrder.indexOf(model.minimumTier);\n}\n\n/**\n * Get available models for a tier\n */\nexport function getAvailableModels(tier: SubscriptionTier): ModelConfig[] {\n  return Object.values(models).filter(model => canAccessModel(tier, model.id));\n}\n\n/**\n * Calculate effective token cost\n */\nexport function calculateTokenCost(tokens: number, modelId: AIModel): number {\n  const model = models[modelId];\n  return Math.ceil(tokens * model.tokenMultiplier);\n}\n\n/**\n * Check if organization has sufficient tokens\n */\nexport function hasTokens(\n  monthlyBalance: number,\n  packBalance: number,\n  required: number,\n  tier: SubscriptionTier\n): boolean {\n  if (tier === 'business') return true; // Unlimited\n  return (monthlyBalance + packBalance) >= required;\n}\n\n/**\n * Get tier upgrade suggestion\n */\nexport function getSuggestedUpgrade(\n  currentTier: SubscriptionTier,\n  reason: 'tokens' | 'models' | 'packs' | 'users'\n): SubscriptionTier | null {\n  if (currentTier === 'business') return null;\n  if (currentTier === 'pro') return 'business';\n  return 'pro';\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/services/calendar-sync.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[836,839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[836,839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { createClient } from '@/lib/supabase/client';\nimport { type Booking } from '@/lib/types/schema';\n\nexport const BookingService = {\n    async getMyBookings(): Promise<Booking[]> {\n        const supabase = createClient();\n\n        // Get current user email to find contact_id\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return [];\n\n        const { data: contact } = await supabase.from('contacts').select('id').eq('email', user.email).single();\n        if (!contact) return []; // Or mock some if no contact found\n\n        const { data } = await supabase\n            .from('bookings')\n            .select('*')\n            .eq('contact_id', contact.id)\n            .gte('start_time', new Date().toISOString())\n            .order('start_time', { ascending: true });\n\n        return (data as any) || [];\n    },\n\n    async mockCreateBooking(title: string, date: Date) {\n        // Logic to sync with external calendar would go here\n        console.log(\"Creating booking in Google Calendar...\", title, date);\n        return true;\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/services/invoice-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/services/stripe-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[421,424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[421,424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":33,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3776,3779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3776,3779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4202,4205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4202,4205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Stripe Service\n * \n * Handles Stripe payment link creation for invoices.\n * \n * SETUP REQUIRED:\n * 1. Install stripe: npm install stripe\n * 2. Add to .env.local:\n *    - STRIPE_SECRET_KEY=sk_test_...\n *    - STRIPE_WEBHOOK_SECRET=whsec_...\n *    - NEXT_PUBLIC_APP_URL=http://localhost:3000\n */\n\nimport type { Invoice } from '@/lib/types/schema';\n\n// Lazy import Stripe to avoid errors if not installed\nlet stripe: any = null;\n\nasync function getStripe() {\n  if (!stripe) {\n    try {\n      const Stripe = (await import('stripe')).default;\n      const secretKey = process.env.STRIPE_SECRET_KEY;\n\n      if (!secretKey) {\n        throw new Error('STRIPE_SECRET_KEY is not configured');\n      }\n\n      stripe = new Stripe(secretKey, {\n        apiVersion: '2026-01-28.clover',\n        typescript: true,\n      });\n    } catch (error) {\n      throw new Error('Stripe is not available. Install with: npm install stripe');\n    }\n  }\n  return stripe;\n}\n\n// =====================================================\n// STRIPE SERVICE\n// =====================================================\n\nexport const StripeService = {\n  /**\n   * Check if Stripe is configured\n   */\n  isConfigured(): boolean {\n    return !!process.env.STRIPE_SECRET_KEY;\n  },\n\n  /**\n   * Create a payment link for an invoice\n   * Returns the Stripe payment link URL\n   */\n  async createPaymentLink(invoice: Invoice): Promise<string> {\n    const stripeClient = await getStripe();\n    const appUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';\n\n    // Create a checkout session with payment link\n    const session = await stripeClient.checkout.sessions.create({\n      mode: 'payment',\n      payment_method_types: ['card'],\n      line_items: [\n        {\n          price_data: {\n            currency: invoice.currency.toLowerCase(),\n            product_data: {\n              name: `Invoice ${invoice.invoice_number}`,\n              description: `Payment for invoice ${invoice.invoice_number}`,\n            },\n            unit_amount: Math.round(invoice.amount_total * 100), // Stripe uses cents\n          },\n          quantity: 1,\n        },\n      ],\n      metadata: {\n        invoice_id: invoice.id,\n        invoice_number: invoice.invoice_number,\n      },\n      success_url: `${appUrl}/portal/invoices/${invoice.id}?payment=success`,\n      cancel_url: `${appUrl}/portal/invoices/${invoice.id}?payment=cancelled`,\n    });\n\n    if (!session.url) {\n      throw new Error('Failed to create payment link');\n    }\n\n    return session.url;\n  },\n\n  /**\n   * Create a reusable payment link (alternative to checkout session)\n   * Payment links can be shared multiple times\n   */\n  async createReusablePaymentLink(invoice: Invoice): Promise<string> {\n    const stripeClient = await getStripe();\n    const appUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';\n\n    // First, create a price\n    const price = await stripeClient.prices.create({\n      currency: invoice.currency.toLowerCase(),\n      unit_amount: Math.round(invoice.amount_total * 100),\n      product_data: {\n        name: `Invoice ${invoice.invoice_number}`,\n      },\n    });\n\n    // Then create the payment link\n    const paymentLink = await stripeClient.paymentLinks.create({\n      line_items: [\n        {\n          price: price.id,\n          quantity: 1,\n        },\n      ],\n      metadata: {\n        invoice_id: invoice.id,\n        invoice_number: invoice.invoice_number,\n      },\n      after_completion: {\n        type: 'redirect',\n        redirect: {\n          url: `${appUrl}/portal/invoices/${invoice.id}?payment=success`,\n        },\n      },\n    });\n\n    return paymentLink.url;\n  },\n\n  /**\n   * Verify webhook signature\n   */\n  async verifyWebhookSignature(\n    payload: string | Buffer,\n    signature: string\n  ): Promise<any> {\n    const stripeClient = await getStripe();\n    const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;\n\n    if (!webhookSecret) {\n      throw new Error('STRIPE_WEBHOOK_SECRET is not configured');\n    }\n\n    return stripeClient.webhooks.constructEvent(\n      payload,\n      signature,\n      webhookSecret\n    );\n  },\n\n  /**\n   * Retrieve a checkout session\n   */\n  async getCheckoutSession(sessionId: string): Promise<any> {\n    const stripeClient = await getStripe();\n    return stripeClient.checkout.sessions.retrieve(sessionId);\n  },\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/services/zefix.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1052,1055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1052,1055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'uid' is defined but never used.","line":57,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nexport interface ZefixCompany {\n    name: string;\n    uid: string;\n    uidFormatted: string;\n    address: {\n        street?: string;\n        houseNumber?: string;\n        city: string;\n        postalCode: string;\n        country: string;\n    };\n}\n\nexport const ZefixService = {\n    async searchByName(name: string): Promise<ZefixCompany[]> {\n        try {\n            const response = await fetch(\n                `https://www.zefix.ch/ZefixREST/api/v1/company/search`,\n                {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({\n                        name,\n                        languageKey: 'en',\n                        maxEntries: 10,\n                    }),\n                }\n            );\n\n            if (!response.ok) {\n                throw new Error('Failed to fetch from Zefix');\n            }\n\n            const data = await response.json();\n\n            return data.list.map((item: any) => ({\n                name: item.name,\n                uid: item.uid,\n                uidFormatted: item.uidFormatted,\n                address: {\n                    street: item.address?.street,\n                    houseNumber: item.address?.houseNumber,\n                    city: item.address?.city,\n                    postalCode: item.address?.swissZipCode,\n                    country: 'CH'\n                }\n            }));\n        } catch (error) {\n            console.error('Zefix Search Error:', error);\n            return [];\n        }\n    },\n\n    async getByUID(uid: string): Promise<ZefixCompany | null> {\n        // TODO: Implement direct UID lookup if needed\n        return null;\n    }\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/supabase/client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/supabase/middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/supabase/server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/swiss/qr-invoice.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3031,3034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3031,3034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3955,3958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3955,3958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":321,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9564,9567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9564,9567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Swiss QR-Bill Invoice Generator\n * \n * Generates a Swiss invoice with QR-Bill payment slip.\n * The QR-Bill is automatically attached at the bottom of the page\n * following Swiss banking standards (ISO 20022).\n * \n * Structure:\n * - Invoice header with creditor info\n * - Debtor address\n * - Invoice details\n * - Line items table\n * - Totals breakdown\n * - QR-Bill slip (A6 format at bottom)\n */\n\nimport { SwissQRBill } from 'swissqrbill/pdf';\nimport { PassThrough } from 'stream';\nimport type { InvoiceLineItem } from '@/lib/types/schema';\n\n// =====================================================\n// TYPES\n// =====================================================\n\nexport interface CreditorInfo {\n  name: string;\n  address: string;\n  zip: string;\n  city: string;\n  country: string;\n  account: string; // IBAN\n  vat_number?: string;\n  email?: string;\n  phone?: string;\n}\n\nexport interface DebtorInfo {\n  name: string;\n  address: string;\n  zip: string;\n  city: string;\n  country: string;\n}\n\nexport interface SwissInvoiceData {\n  invoice_number: string;\n  invoice_date: string;\n  due_date: string;\n  amount: number;\n  currency: 'CHF' | 'EUR';\n  creditor: CreditorInfo;\n  debtor: DebtorInfo;\n  reference: string; // QR Reference (26 or 27 digits)\n  line_items?: InvoiceLineItem[];\n  subtotal?: number;\n  tax_total?: number;\n  notes?: string;\n}\n\n// =====================================================\n// LEGACY INTERFACE (backward compatibility)\n// =====================================================\n\ninterface LegacyInvoiceData {\n  amount: number;\n  currency: 'CHF' | 'EUR';\n  debtor: {\n    name: string;\n    address: string;\n    zip: string;\n    city: string;\n    country: string;\n  };\n  creditor: {\n    name: string;\n    address: string;\n    zip: string;\n    city: string;\n    country: string;\n    account: string;\n  };\n  reference: string;\n}\n\n// =====================================================\n// SWISS INVOICE SERVICE\n// =====================================================\n\nexport const SwissInvoiceService = {\n  /**\n   * Generate Swiss QR-Bill Invoice PDF\n   * Supports both legacy simple format and new line items format\n   */\n  generatePDF(data: SwissInvoiceData | LegacyInvoiceData): Promise<Buffer> {\n    return new Promise((resolve, reject) => {\n      // Prepare data for SwissQRBill\n      const qrBillData = {\n        amount: data.amount,\n        currency: data.currency,\n        creditor: {\n          name: data.creditor.name,\n          address: data.creditor.address,\n          zip: parseInt(data.creditor.zip) || 0,\n          city: data.creditor.city,\n          country: data.creditor.country,\n          account: data.creditor.account,\n        },\n        debtor: {\n          name: data.debtor.name,\n          address: data.debtor.address,\n          zip: parseInt(data.debtor.zip) || 0,\n          city: data.debtor.city,\n          country: data.debtor.country,\n        },\n        reference: data.reference.replace(/\\s/g, ''), // Remove spaces\n      };\n\n      const pdf = new SwissQRBill(qrBillData) as any;\n\n      const stream = new PassThrough();\n      const chunks: Buffer[] = [];\n\n      stream.on('data', (chunk) => chunks.push(chunk));\n      stream.on('end', () => resolve(Buffer.concat(chunks)));\n      stream.on('error', (err) => reject(err));\n\n      // Check if this is the new format with line items\n      const isDetailedInvoice = 'invoice_number' in data;\n\n      if (isDetailedInvoice) {\n        const invoiceData = data as SwissInvoiceData;\n        renderDetailedInvoice(pdf, invoiceData);\n      } else {\n        // Legacy simple format\n        renderSimpleInvoice(pdf, data as LegacyInvoiceData);\n      }\n\n      // Auto-attach QR Bill at the bottom (A6 format)\n      pdf.addQRBill();\n\n      pdf.pipe(stream);\n      pdf.end();\n    });\n  },\n};\n\n// =====================================================\n// RENDER FUNCTIONS\n// =====================================================\n\nfunction renderDetailedInvoice(pdf: any, data: SwissInvoiceData): void {\n  const pageWidth = 495; // A4 width minus margins\n  \n  // ===== CREDITOR HEADER =====\n  pdf.fontSize(16)\n    .font('Helvetica-Bold')\n    .text(data.creditor.name, 50, 50, { width: pageWidth });\n  \n  pdf.fontSize(9)\n    .font('Helvetica')\n    .text(data.creditor.address, 50, 70)\n    .text(`${data.creditor.zip} ${data.creditor.city}`, 50, 81)\n    .text(data.creditor.country, 50, 92);\n  \n  if (data.creditor.vat_number) {\n    pdf.text(`MWST: ${data.creditor.vat_number}`, 50, 103);\n  }\n\n  // ===== INVOICE TITLE =====\n  pdf.fontSize(20)\n    .font('Helvetica-Bold')\n    .text('RECHNUNG', 350, 50, { align: 'right', width: 195 });\n\n  // ===== INVOICE DETAILS =====\n  const detailsY = 85;\n  pdf.fontSize(9)\n    .font('Helvetica');\n  \n  pdf.text('Rechnungs-Nr:', 350, detailsY, { width: 90 });\n  pdf.text(data.invoice_number, 440, detailsY, { width: 105, align: 'right' });\n  \n  pdf.text('Datum:', 350, detailsY + 12, { width: 90 });\n  pdf.text(formatDate(data.invoice_date), 440, detailsY + 12, { width: 105, align: 'right' });\n  \n  pdf.text('Fllig am:', 350, detailsY + 24, { width: 90 });\n  pdf.text(formatDate(data.due_date), 440, detailsY + 24, { width: 105, align: 'right' });\n\n  // ===== DEBTOR INFO =====\n  const billToY = 150;\n  pdf.fontSize(10)\n    .font('Helvetica-Bold')\n    .text('Rechnungsadresse:', 50, billToY);\n  \n  pdf.fontSize(9)\n    .font('Helvetica')\n    .text(data.debtor.name, 50, billToY + 14)\n    .text(data.debtor.address, 50, billToY + 25)\n    .text(`${data.debtor.zip} ${data.debtor.city}`, 50, billToY + 36)\n    .text(data.debtor.country, 50, billToY + 47);\n\n  // ===== LINE ITEMS TABLE =====\n  if (data.line_items && data.line_items.length > 0) {\n    const tableTop = 230;\n    const tableLeft = 50;\n    const colWidths = {\n      description: 200,\n      qty: 50,\n      unitPrice: 70,\n      tax: 50,\n      total: 75,\n    };\n\n    // Table header background\n    pdf.rect(tableLeft, tableTop, pageWidth, 20)\n      .fill('#e8e8e8');\n    \n    pdf.fillColor('#000000')\n      .fontSize(8)\n      .font('Helvetica-Bold');\n    \n    let xPos = tableLeft + 5;\n    pdf.text('Beschreibung', xPos, tableTop + 6, { width: colWidths.description });\n    xPos += colWidths.description;\n    pdf.text('Menge', xPos, tableTop + 6, { width: colWidths.qty, align: 'right' });\n    xPos += colWidths.qty;\n    pdf.text('Preis', xPos, tableTop + 6, { width: colWidths.unitPrice, align: 'right' });\n    xPos += colWidths.unitPrice;\n    pdf.text('MWST', xPos, tableTop + 6, { width: colWidths.tax, align: 'right' });\n    xPos += colWidths.tax;\n    pdf.text('Total', xPos, tableTop + 6, { width: colWidths.total, align: 'right' });\n\n    // Table rows\n    pdf.font('Helvetica')\n      .fontSize(8);\n    \n    let rowY = tableTop + 25;\n    \n    for (const item of data.line_items) {\n      // Alternate row colors\n      if (data.line_items.indexOf(item) % 2 === 1) {\n        pdf.rect(tableLeft, rowY - 3, pageWidth, 16)\n          .fill('#f8f8f8');\n        pdf.fillColor('#000000');\n      }\n\n      xPos = tableLeft + 5;\n      pdf.text(item.description, xPos, rowY, { width: colWidths.description });\n      xPos += colWidths.description;\n      pdf.text(item.quantity.toString(), xPos, rowY, { width: colWidths.qty, align: 'right' });\n      xPos += colWidths.qty;\n      pdf.text(formatMoney(item.unit_price, data.currency), xPos, rowY, { width: colWidths.unitPrice, align: 'right' });\n      xPos += colWidths.unitPrice;\n      pdf.text(`${item.tax_rate}%`, xPos, rowY, { width: colWidths.tax, align: 'right' });\n      xPos += colWidths.tax;\n      pdf.text(formatMoney(item.line_total, data.currency), xPos, rowY, { width: colWidths.total, align: 'right' });\n      \n      rowY += 16;\n    }\n\n    // Table border\n    pdf.rect(tableLeft, tableTop, pageWidth, rowY - tableTop + 5)\n      .stroke('#cccccc');\n\n    // ===== TOTALS =====\n    const totalsY = rowY + 15;\n    const totalsLabelX = 350;\n    const totalsValueX = 450;\n    \n    pdf.fontSize(9)\n      .font('Helvetica');\n    \n    if (data.subtotal !== undefined) {\n      pdf.text('Zwischensumme:', totalsLabelX, totalsY, { width: 90 });\n      pdf.text(formatMoney(data.subtotal, data.currency), totalsValueX, totalsY, { width: 95, align: 'right' });\n    }\n    \n    if (data.tax_total !== undefined) {\n      pdf.text('MWST:', totalsLabelX, totalsY + 14, { width: 90 });\n      pdf.text(formatMoney(data.tax_total, data.currency), totalsValueX, totalsY + 14, { width: 95, align: 'right' });\n    }\n    \n    // Total line\n    pdf.moveTo(totalsLabelX, totalsY + 30)\n      .lineTo(545, totalsY + 30)\n      .stroke('#000000');\n    \n    pdf.fontSize(11)\n      .font('Helvetica-Bold')\n      .text('Total:', totalsLabelX, totalsY + 36, { width: 90 });\n    pdf.text(formatMoney(data.amount, data.currency), totalsValueX, totalsY + 36, { width: 95, align: 'right' });\n\n    // ===== NOTES =====\n    if (data.notes) {\n      const notesY = totalsY + 65;\n      pdf.fontSize(9)\n        .font('Helvetica-Bold')\n        .text('Bemerkungen:', 50, notesY);\n      \n      pdf.fontSize(8)\n        .font('Helvetica')\n        .text(data.notes, 50, notesY + 12, { width: pageWidth });\n    }\n  } else {\n    // No line items - just show total\n    pdf.fontSize(11)\n      .font('Helvetica')\n      .text(`Betrag: ${formatMoney(data.amount, data.currency)}`, 50, 230);\n  }\n\n  // Payment info - QR-Bill will be added at bottom automatically\n  pdf.fontSize(8)\n    .fillColor('#666666')\n    .text(\n      'Bitte verwenden Sie den untenstehenden Einzahlungsschein fr die Zahlung.',\n      50,\n      540,\n      { width: pageWidth }\n    );\n}\n\nfunction renderSimpleInvoice(pdf: any, data: LegacyInvoiceData): void {\n  // Legacy simple format\n  pdf.fontSize(20).text('Invoice', 50, 50);\n  pdf.fontSize(12).text(`Reference: ${data.reference}`, 50, 80);\n  pdf.text(`Amount: ${data.currency} ${data.amount.toFixed(2)}`, 50, 100);\n\n  pdf.text('Debtor:', 50, 150);\n  pdf.text(data.debtor.name);\n  pdf.text(data.debtor.address);\n  pdf.text(`${data.debtor.zip} ${data.debtor.city}`);\n}\n\n// =====================================================\n// HELPERS\n// =====================================================\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString('de-CH', {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric',\n  });\n}\n\nfunction formatMoney(amount: number, currency: string): string {\n  return new Intl.NumberFormat('de-CH', {\n    style: 'currency',\n    currency: currency,\n    minimumFractionDigits: 2,\n  }).format(amount);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/trpc/client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/trpc/provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/trpc/server.ts","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An empty interface declaration allows any non-nullish value, including literals like `0` and `\"\"`.\n- If that's what you want, disable this lint rule with an inline comment or configure the 'allowInterfaces' rule option.\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterface","endLine":5,"endColumn":25,"suggestions":[{"messageId":"replaceEmptyInterface","data":{"replacement":"object"},"fix":{"range":[115,183],"text":"type Context = object"},"desc":"Replace empty interface with `object`."},{"messageId":"replaceEmptyInterface","data":{"replacement":"unknown"},"fix":{"range":[115,183],"text":"type Context = unknown"},"desc":"Replace empty interface with `unknown`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { initTRPC } from '@trpc/server'\nimport { ZodError } from 'zod'\n\n// Context type for tRPC procedures\nexport interface Context {\n    // Add user session, database client, etc.\n}\n\n// Initialize tRPC\nconst t = initTRPC.context<Context>().create({\n    errorFormatter({ shape, error }) {\n        return {\n            ...shape,\n            data: {\n                ...shape.data,\n                zodError:\n                    error.cause instanceof ZodError ? error.cause.flatten() : null,\n            },\n        }\n    },\n})\n\n// Export reusable router and procedure helpers\nexport const router = t.router\nexport const publicProcedure = t.procedure\nexport const createCallerFactory = t.createCallerFactory\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/types/schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/validation/contact-import.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ContactStatus' is defined but never used.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":23,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"ContactStatus"},"fix":{"range":[24,71],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1658,1661],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1658,1661],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1859,1862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1859,1862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z } from 'zod'\nimport { ContactStatus } from '@/types/contact'\nimport { emailRegex, isValidPhone } from './contact'\n\n\n\n// Import contact schema\nexport const importContactSchema = z.object({\n  firstName: z.string()\n    .min(1, 'First Name is required')\n    .max(200, 'First Name must be less than 200 characters')\n    .trim(),\n\n  lastName: z.string()\n    .max(200, 'Last Name must be less than 200 characters')\n    .optional()\n    .nullable()\n    .transform(val => val || ''),\n\n  companyName: z.string()\n    .max(200, 'Company name must be less than 200 characters')\n    .optional()\n    .nullable()\n    .transform(val => val || null),\n\n  email: z.string()\n    .min(1, 'Email is required')\n    .max(255, 'Email must be less than 255 characters')\n    .regex(emailRegex, 'Invalid email format')\n    .toLowerCase()\n    .trim(),\n\n  phone: z.string()\n    .max(50, 'Phone must be less than 50 characters')\n    .optional()\n    .nullable()\n    .transform(val => (val && val.trim() !== '') ? val.trim() : null)\n    .refine(val => val === null || isValidPhone(val), 'Invalid phone format'),\n\n\n  status: z.enum(['lead', 'opportunity', 'client', 'churned'])\n    .default('lead')\n    .catch('lead'), // If invalid, default to 'lead'\n\n  tags: z.string()\n    .optional()\n    .nullable()\n    .transform(val => {\n      if (!val) return []\n      // Split by comma, semicolon, or pipe\n      return val.split(/[,;|]/).map(tag => tag.trim()).filter(Boolean)\n    }),\n})\n\nexport type ImportContactInput = z.infer<typeof importContactSchema>\n\n// Batch validation result\nexport interface ValidationResult {\n  valid: ImportContactInput[]\n  invalid: {\n    row: number\n    data: any\n    errors: z.ZodError\n  }[]\n  duplicates: {\n    row: number\n    email: string\n    existingContactId?: string\n  }[]\n}\n\n// Validate a batch of contacts\nexport function validateContacts(\n  contacts: any[],\n  existingEmails: Set<string> = new Set()\n): ValidationResult {\n  const result: ValidationResult = {\n    valid: [],\n    invalid: [],\n    duplicates: []\n  }\n\n  const seenEmails = new Set<string>()\n\n  contacts.forEach((contact, index) => {\n    try {\n      // Validate with Zod\n      const validContact = importContactSchema.parse(contact)\n\n      // Check for duplicates in the batch\n      const email = validContact.email.toLowerCase()\n      if (seenEmails.has(email)) {\n        result.duplicates.push({\n          row: index + 1,\n          email: validContact.email,\n        })\n      } else if (existingEmails.has(email)) {\n        // Check for duplicates in existing database\n        result.duplicates.push({\n          row: index + 1,\n          email: validContact.email,\n        })\n      } else {\n        seenEmails.add(email)\n        result.valid.push(validContact)\n      }\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        result.invalid.push({\n          row: index + 1,\n          data: contact,\n          errors: error\n        })\n      }\n    }\n  })\n\n  return result\n}\n\n// Format validation errors for display\nexport function formatValidationErrors(error: z.ZodError): string[] {\n  return error.issues.map(err => {\n    const field = err.path.join('.')\n    return `${field}: ${err.message}`\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/validation/contact.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":24,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":34,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":44,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z } from 'zod'\nimport { parsePhoneNumberWithError, isValidPhoneNumber, CountryCode } from 'libphonenumber-js'\n\n// Email validation regex (RFC 5322 simplified)\nexport const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n\n// Validation schemas for reuse\nexport const emailSchema = z.string()\n    .min(1, 'Email is required')\n    .max(255, 'Email must be less than 255 characters')\n    .regex(emailRegex, 'Invalid email format')\n    .toLowerCase()\n    .trim()\n\nexport function isValidEmail(email: string): boolean {\n    return emailRegex.test(email)\n}\n\n// Phone validation and formatting\nexport function isValidPhone(phone: string, country: CountryCode = 'CH'): boolean {\n    if (!phone) return true\n    try {\n        return isValidPhoneNumber(phone, country)\n    } catch (e) {\n        return false\n    }\n}\n\nexport function formatPhone(phone: string, country: CountryCode = 'CH'): string {\n    if (!phone) return ''\n    try {\n        const phoneNumber = parsePhoneNumberWithError(phone, country)\n        return phoneNumber.formatInternational()\n    } catch (e) {\n        return phone\n    }\n}\n\nexport function toE164(phone: string, country: CountryCode = 'CH'): string {\n    if (!phone) return ''\n    try {\n        const phoneNumber = parsePhoneNumberWithError(phone, country)\n        return phoneNumber.format('E.164')\n    } catch (e) {\n        return phone\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/lib/validation/validators.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'allowedTags' is assigned a value but never used.","line":82,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Comprehensive Validation Utilities\n *\n * RFC-compliant validators and formatters for production use\n */\n\nimport { z } from 'zod'\n\n/**\n * Email Validation (RFC 5322 compliant)\n * More robust than simple regex\n */\nexport const emailRegex = /^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])$/i\n\n/**\n * Phone number validation (international format)\n * Accepts: +41 79 123 45 67, (079) 123-4567, etc.\n */\nexport const phoneRegex = /^[+]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[0-9]{1,9}$/\n\n/**\n * Swiss phone number validation\n */\nexport const swissPhoneRegex = /^(\\+41|0041|0)[1-9][0-9]{1,2}\\s?[0-9]{3}\\s?[0-9]{2}\\s?[0-9]{2}$/\n\n/**\n * URL validation\n */\nexport const urlRegex = /^https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)$/\n\n/**\n * Swiss VAT number validation (CHE-123.456.789 MWST)\n */\nexport const swissVatRegex = /^CHE-\\d{3}\\.\\d{3}\\.\\d{3}\\s?(MWST|TVA|IVA)?$/i\n\n/**\n * IBAN validation (basic format check)\n */\nexport const ibanRegex = /^[A-Z]{2}\\d{2}[A-Z0-9]{1,30}$/\n\n/**\n * Swiss ZIP code validation (4 digits)\n */\nexport const swissZipRegex = /^\\d{4}$/\n\n/**\n * Zod schema builders\n */\n\nexport const emailSchema = z.string()\n    .email('Invalid email address')\n    .regex(emailRegex, 'Email format is invalid')\n    .toLowerCase()\n    .trim()\n\nexport const phoneSchema = z.string()\n    .regex(phoneRegex, 'Invalid phone number format')\n    .optional()\n    .nullable()\n\nexport const urlSchema = z.string()\n    .url('Invalid URL')\n    .regex(urlRegex, 'URL must start with http:// or https://')\n\nexport const swissVatSchema = z.string()\n    .regex(swissVatRegex, 'Invalid Swiss VAT number format (e.g., CHE-123.456.789 MWST)')\n\nexport const ibanSchema = z.string()\n    .regex(ibanRegex, 'Invalid IBAN format')\n    .toUpperCase()\n\n/**\n * Sanitization functions\n */\n\n/**\n * Sanitize HTML to prevent XSS attacks\n * Strips all HTML tags except safe ones\n */\nexport function sanitizeHtml(input: string): string {\n    // Remove all HTML tags except: b, i, em, strong, a, p, br\n    const allowedTags = /<\\/?([bi]|em|strong|a|p|br)(\\s+[^>]*)?>/gi\n\n    return input\n        .replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '') // Remove scripts\n        .replace(/<iframe\\b[^<]*(?:(?!<\\/iframe>)<[^<]*)*<\\/iframe>/gi, '') // Remove iframes\n        .replace(/<object\\b[^<]*(?:(?!<\\/object>)<[^<]*)*<\\/object>/gi, '') // Remove objects\n        .replace(/<embed\\b[^<]*(?:(?!<\\/embed>)<[^<]*)*<\\/embed>/gi, '') // Remove embeds\n        .replace(/on\\w+=\"[^\"]*\"/gi, '') // Remove event handlers\n        .replace(/on\\w+='[^']*'/gi, '') // Remove event handlers\n        .replace(/javascript:/gi, '') // Remove javascript: protocol\n        .trim()\n}\n\n/**\n * Sanitize string for SQL/NoSQL injection prevention\n * Use this for user input that goes into dynamic queries\n */\nexport function sanitizeInput(input: string): string {\n    return input\n        .replace(/['\"\\\\;`]/g, '') // Remove dangerous characters\n        .trim()\n}\n\n/**\n * Validate and format phone numbers\n */\n\n/**\n * Format phone number to international format\n * Example: 0791234567 -> +41 79 123 45 67\n */\nexport function formatPhoneNumber(phone: string, countryCode: string = '+41'): string | null {\n    if (!phone) return null\n\n    // Remove all non-digits\n    const digits = phone.replace(/\\D/g, '')\n\n    // Swiss number formatting\n    if (countryCode === '+41') {\n        // If starts with 0, remove it\n        const localNumber = digits.startsWith('0') ? digits.slice(1) : digits\n\n        // Format: +41 XX XXX XX XX\n        if (localNumber.length === 9) {\n            return `+41 ${localNumber.slice(0, 2)} ${localNumber.slice(2, 5)} ${localNumber.slice(5, 7)} ${localNumber.slice(7)}`\n        }\n    }\n\n    // Generic international format\n    if (digits.length >= 10) {\n        return `${countryCode} ${digits}`\n    }\n\n    return phone // Return as-is if can't format\n}\n\n/**\n * Parse phone number to E.164 format (+41791234567)\n */\nexport function parsePhoneToE164(phone: string, defaultCountryCode: string = '+41'): string | null {\n    if (!phone) return null\n\n    // Remove all non-digits\n    const digits = phone.replace(/\\D/g, '')\n\n    // If already starts with +, return as E.164\n    if (phone.startsWith('+')) {\n        return `+${digits}`\n    }\n\n    // If starts with 00, replace with +\n    if (phone.startsWith('00')) {\n        return `+${digits.slice(2)}`\n    }\n\n    // If starts with 0 (local number), add country code\n    if (digits.startsWith('0')) {\n        const localDigits = digits.slice(1)\n        const countryDigits = defaultCountryCode.replace(/\\D/g, '')\n        return `+${countryDigits}${localDigits}`\n    }\n\n    // Assume it's missing country code\n    const countryDigits = defaultCountryCode.replace(/\\D/g, '')\n    return `+${countryDigits}${digits}`\n}\n\n/**\n * Validate Swiss-specific formats\n */\n\nexport function validateSwissVAT(vat: string): boolean {\n    return swissVatRegex.test(vat)\n}\n\nexport function formatSwissVAT(vat: string): string | null {\n    // Remove all non-alphanumeric\n    const clean = vat.replace(/[^A-Z0-9]/gi, '').toUpperCase()\n\n    // Extract numbers\n    const numbers = clean.replace(/[^0-9]/g, '')\n\n    if (numbers.length === 9) {\n        // Format as CHE-XXX.XXX.XXX MWST\n        return `CHE-${numbers.slice(0, 3)}.${numbers.slice(3, 6)}.${numbers.slice(6)} MWST`\n    }\n\n    return null\n}\n\nexport function validateSwissIBAN(iban: string): boolean {\n    if (!ibanRegex.test(iban)) return false\n\n    // Swiss IBAN starts with CH and has 21 characters\n    return iban.startsWith('CH') && iban.length === 21\n}\n\nexport function formatSwissIBAN(iban: string): string | null {\n    // Remove spaces and make uppercase\n    const clean = iban.replace(/\\s/g, '').toUpperCase()\n\n    if (!validateSwissIBAN(clean)) return null\n\n    // Format as CH12 3456 7890 1234 5678 9\n    return clean.match(/.{1,4}/g)?.join(' ') || clean\n}\n\n/**\n * Password strength validation\n */\nexport function validatePasswordStrength(password: string): {\n    isStrong: boolean\n    score: number\n    feedback: string[]\n} {\n    const feedback: string[] = []\n    let score = 0\n\n    // Length\n    if (password.length >= 8) score += 1\n    else feedback.push('Password must be at least 8 characters')\n\n    if (password.length >= 12) score += 1\n\n    // Complexity\n    if (/[a-z]/.test(password)) score += 1\n    else feedback.push('Include lowercase letters')\n\n    if (/[A-Z]/.test(password)) score += 1\n    else feedback.push('Include uppercase letters')\n\n    if (/[0-9]/.test(password)) score += 1\n    else feedback.push('Include numbers')\n\n    if (/[^a-zA-Z0-9]/.test(password)) score += 1\n    else feedback.push('Include special characters')\n\n    // Common patterns\n    if (/^(123|abc|password)/i.test(password)) {\n        score -= 2\n        feedback.push('Avoid common patterns')\n    }\n\n    return {\n        isStrong: score >= 4,\n        score: Math.max(0, score),\n        feedback,\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/core/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/packs/accounting/config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/packs/accounting/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/packs/agency/config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/packs/agency/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/packs/consultant/config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/packs/consultant/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/packs/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/packs/insurance/config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/modules/packs/insurance/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/server/routers/_app.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/stores/chat-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[948,951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[948,951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1170,1173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1170,1173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2361,2364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2361,2364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4062,4065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4062,4065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4836,4839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4836,4839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7049,7052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7049,7052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":234,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7892,7895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7892,7895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":257,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8625,8628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8625,8628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand'\nimport { Conversation, Message, CreateConversationInput } from '@/types/chat'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface ChatStore {\n    conversations: Conversation[]\n    activeConversationId: string | null\n    isLoading: boolean\n    error: string | null\n\n    // Actions\n    fetchConversations: () => Promise<void>\n    createConversation: (input?: CreateConversationInput) => Promise<Conversation | null>\n    deleteConversation: (id: string) => Promise<void>\n    setActiveConversation: (id: string | null) => void\n    addMessage: (conversationId: string, message: Omit<Message, 'id' | 'createdAt'>) => Promise<Message | null>\n    getConversation: (id: string) => Conversation | undefined\n    updateConversationTitle: (id: string, title: string) => Promise<void>\n    updateConversationModel: (id: string, model: string) => Promise<void>\n}\n\n// Convert DB row to Message\nfunction dbToMessage(row: any): Message {\n    return {\n        id: row.id,\n        role: row.role,\n        content: row.content,\n        createdAt: new Date(row.created_at),\n    }\n}\n\n// Convert DB row to Conversation\nfunction dbToConversation(row: any): Conversation {\n    return {\n        id: row.id,\n        title: row.title || 'New Conversation',\n        messages: (row.ai_messages || []).map(dbToMessage),\n        model: row.model || 'gpt-4o-mini',\n        createdAt: new Date(row.created_at),\n        updatedAt: new Date(row.updated_at),\n    }\n}\n\nexport const useChatStore = create<ChatStore>()((set, get) => ({\n    conversations: [],\n    activeConversationId: null,\n    isLoading: false,\n    error: null,\n\n    fetchConversations: async () => {\n        set({ isLoading: true, error: null })\n        try {\n            const supabase = createClient()\n            const { data, error } = await supabase\n                .from('ai_conversations')\n                .select(`\n                    *,\n                    ai_messages (\n                        id,\n                        role,\n                        content,\n                        created_at\n                    )\n                `)\n                .order('updated_at', { ascending: false })\n\n            if (error) throw error\n\n            const conversations = (data || []).map(dbToConversation)\n            set({ conversations, isLoading: false })\n        } catch (error: any) {\n            console.error('Error fetching conversations:', error)\n            set({ error: error.message, isLoading: false })\n        }\n    },\n\n    createConversation: async (input) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Get current user\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) throw new Error('Not authenticated')\n\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (!profile?.tenant_id) throw new Error('No organization found')\n\n            const dbData = {\n                tenant_id: profile.tenant_id,\n                user_id: user.id,\n                title: input?.title || 'New Conversation',\n                model: input?.model || 'gpt-4o-mini',\n            }\n\n            const { data, error } = await supabase\n                .from('ai_conversations')\n                .insert(dbData)\n                .select()\n                .single()\n\n            if (error) throw error\n\n            const newConversation: Conversation = {\n                id: data.id,\n                title: data.title,\n                messages: [],\n                model: data.model,\n                createdAt: new Date(data.created_at),\n                updatedAt: new Date(data.updated_at),\n            }\n\n            set((state) => ({\n                conversations: [newConversation, ...state.conversations],\n                activeConversationId: newConversation.id,\n            }))\n            return newConversation\n        } catch (error: any) {\n            console.error('Error creating conversation:', error)\n            set({ error: error.message })\n            return null\n        }\n    },\n\n    deleteConversation: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Messages will be deleted via CASCADE\n            const { error } = await supabase\n                .from('ai_conversations')\n                .delete()\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                conversations: state.conversations.filter((c) => c.id !== id),\n                activeConversationId: state.activeConversationId === id ? null : state.activeConversationId,\n            }))\n        } catch (error: any) {\n            console.error('Error deleting conversation:', error)\n            set({ error: error.message })\n        }\n    },\n\n    setActiveConversation: (id) => {\n        set({ activeConversationId: id })\n    },\n\n    addMessage: async (conversationId, messageInput) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            const dbData = {\n                conversation_id: conversationId,\n                role: messageInput.role,\n                content: messageInput.content,\n            }\n\n            const { data, error } = await supabase\n                .from('ai_messages')\n                .insert(dbData)\n                .select()\n                .single()\n\n            if (error) throw error\n\n            const newMessage = dbToMessage(data)\n\n            // Update local state\n            set((state) => ({\n                conversations: state.conversations.map((c) =>\n                    c.id === conversationId\n                        ? {\n                            ...c,\n                            messages: [...c.messages, newMessage],\n                            updatedAt: new Date(),\n                            // Auto-title from first user message\n                            title: c.messages.length === 0 && messageInput.role === 'user'\n                                ? messageInput.content.slice(0, 30) + (messageInput.content.length > 30 ? '...' : '')\n                                : c.title,\n                        }\n                        : c\n                ),\n            }))\n\n            // Update title in DB if this was the first message\n            const conversation = get().conversations.find(c => c.id === conversationId)\n            if (conversation && conversation.messages.length === 1 && messageInput.role === 'user') {\n                const newTitle = messageInput.content.slice(0, 30) + (messageInput.content.length > 30 ? '...' : '')\n                await supabase\n                    .from('ai_conversations')\n                    .update({ title: newTitle, updated_at: new Date().toISOString() })\n                    .eq('id', conversationId)\n            }\n\n            return newMessage\n        } catch (error: any) {\n            console.error('Error adding message:', error)\n            set({ error: error.message })\n            return null\n        }\n    },\n\n    getConversation: (id) => {\n        return get().conversations.find((c) => c.id === id)\n    },\n\n    updateConversationTitle: async (id, title) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            const { error } = await supabase\n                .from('ai_conversations')\n                .update({ title, updated_at: new Date().toISOString() })\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                conversations: state.conversations.map((c) =>\n                    c.id === id ? { ...c, title, updatedAt: new Date() } : c\n                ),\n            }))\n        } catch (error: any) {\n            console.error('Error updating conversation title:', error)\n            set({ error: error.message })\n        }\n    },\n\n    updateConversationModel: async (id, model) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            const { error } = await supabase\n                .from('ai_conversations')\n                .update({ model, updated_at: new Date().toISOString() })\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                conversations: state.conversations.map((c) =>\n                    c.id === id ? { ...c, model, updatedAt: new Date() } : c\n                ),\n            }))\n        } catch (error: any) {\n            console.error('Error updating conversation model:', error)\n            set({ error: error.message })\n        }\n    },\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/stores/contact-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1948,1951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1948,1951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5819,5822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5819,5822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":282,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9525,9528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9525,9528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":345,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12311,12314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12311,12314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":389,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":389,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13774,13777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13774,13777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":402,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14119,14122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14119,14122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":426,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15331,15334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15331,15334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":452,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":452,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16178,16181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16178,16181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":483,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":483,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17198,17201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17198,17201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand'\nimport { Contact, CreateContactInput, ContactStatus } from '@/types/contact'\nimport { createClient } from '@/lib/supabase/client'\nimport { toE164 } from '@/lib/validation/contact'\n\nexport interface ContactFilters {\n    search: string\n    status: ContactStatus | 'all'\n    statuses: ContactStatus[]\n    tags: string[]\n}\n\ninterface ContactStore {\n    contacts: Contact[]\n    isLoading: boolean\n    error: string | null\n    currentPage: number\n    pageSize: number\n    totalCount: number\n    filters: ContactFilters\n    sortConfig: {\n        column: string\n        ascending: boolean\n    }\n    visibleColumns: string[]\n    selectedContactIds: string[]\n\n    // Actions\n    fetchContacts: () => Promise<void>\n    setPage: (page: number) => void\n    setPageSize: (size: number) => void\n    setFilters: (filters: Partial<ContactFilters>) => void\n    setSortConfig: (config: ContactStore['sortConfig']) => void\n    addContact: (input: CreateContactInput) => Promise<Contact | null>\n    updateContact: (id: string, updates: Partial<Contact>) => Promise<void>\n    deleteContact: (id: string) => Promise<void>\n    updateStatus: (id: string, status: ContactStatus) => Promise<void>\n    getContact: (id: string) => Contact | undefined\n    fetchContactById: (id: string) => Promise<Contact | null>\n    toggleColumn: (columnId: string) => void\n    toggleSelection: (id: string) => void\n    clearSelection: () => void\n    selectPage: (ids: string[]) => void\n    mergeContacts: (primaryId: string, secondaryId: string, mergedData: Partial<Contact>) => Promise<boolean>\n    bulkArchiveContacts: (ids: string[]) => Promise<void>\n    checkDuplicate: (email?: string, phone?: string, excludeId?: string) => Promise<Contact | null>\n    checkEmailDuplicate: (email: string, excludeId?: string) => Promise<boolean>\n    setVisibleColumns: (columns: string[]) => void\n}\n\n// Helper to convert DB row to Contact type\nfunction dbToContact(row: any): Contact {\n    return {\n        id: row.id,\n        firstName: row.first_name || '',\n        lastName: row.last_name || '',\n        isCompany: row.is_company || false,\n        companyName: row.company_name,\n        email: row.email || '',\n        phone: row.phone,\n        status: row.status || 'lead',\n        tags: row.tags || [],\n        notes: row.notes ? row.notes.split('\\n').filter(Boolean) : [],\n        createdAt: new Date(row.created_at),\n        updatedAt: new Date(row.updated_at),\n        portal_enabled: row.portal_enabled,\n        portal_token: row.portal_token,\n        portal_invited_at: row.portal_invited_at,\n        last_portal_login: row.last_portal_login,\n    }\n}\n\n// Helper to convert Contact to DB format\nfunction contactToDb(input: CreateContactInput) {\n    return {\n        first_name: input.firstName,\n        last_name: input.lastName,\n        is_company: input.isCompany,\n        company_name: input.companyName || null,\n        email: input.email,\n        phone: input.phone ? toE164(input.phone) : null,\n        status: input.status || 'lead',\n        tags: input.tags || [],\n        notes: null,\n    }\n}\n\nexport const useContactStore = create<ContactStore>()((set, get) => ({\n    contacts: [],\n    isLoading: false,\n    error: null,\n    currentPage: 1,\n    pageSize: 50,\n    totalCount: 0,\n    filters: {\n        search: '',\n        status: 'all',\n        statuses: [],\n        tags: [],\n    },\n    sortConfig: {\n        column: 'created_at',\n        ascending: false,\n    },\n    visibleColumns: ['name', 'email', 'company', 'status', 'actions'],\n    selectedContactIds: [],\n\n    fetchContacts: async () => {\n        set({ isLoading: true, error: null })\n        try {\n            const supabase = createClient()\n            const { currentPage, pageSize, filters, sortConfig } = get()\n\n            // Verify authentication and get tenant_id\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) throw new Error('Not authenticated')\n\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (!profile?.tenant_id) {\n                set({ error: 'Please complete your organization setup.', isLoading: false })\n                return\n            }\n\n            // Build base query\n            let query = supabase\n                .from('contacts')\n                .select('*', { count: 'exact' })\n                .eq('tenant_id', profile.tenant_id)\n                .is('archived_at', null)\n\n            // Dynamic Filtering\n            if (filters.status !== 'all') {\n                query = query.eq('status', filters.status)\n            }\n\n            if (filters.statuses.length > 0) {\n                query = query.in('status', filters.statuses)\n            }\n\n            if (filters.tags.length > 0) {\n                query = query.contains('tags', filters.tags)\n            }\n\n            if (filters.search) {\n                const searchTerm = `%${filters.search}%`\n                query = query.or(`first_name.ilike.${searchTerm},last_name.ilike.${searchTerm},email.ilike.${searchTerm},company_name.ilike.${searchTerm}`)\n            }\n\n            // Server-side Sorting\n            query = query.order(sortConfig.column, { ascending: sortConfig.ascending })\n\n            // Server-side Pagination\n            const from = (currentPage - 1) * pageSize\n            const to = from + pageSize - 1\n            query = query.range(from, to)\n\n            const { data, error, count } = await query\n\n            if (error) throw error\n\n            const contacts = (data || []).map(dbToContact)\n            set({\n                contacts,\n                totalCount: count || 0,\n                isLoading: false\n            })\n        } catch (error: any) {\n            console.error('Error fetching contacts:', error)\n            set({ error: error.message, isLoading: false })\n        }\n    },\n\n    setPage: (page) => {\n        set({ currentPage: page })\n        get().fetchContacts()\n    },\n\n    setPageSize: (size) => {\n        set({ pageSize: size, currentPage: 1 })\n        get().fetchContacts()\n    },\n\n    setFilters: (newFilters) => {\n        set((state) => ({\n            filters: { ...state.filters, ...newFilters },\n            currentPage: 1 // Reset to first page\n        }))\n        get().fetchContacts()\n    },\n\n    setSortConfig: (config) => {\n        set({ sortConfig: config })\n        get().fetchContacts()\n    },\n\n    checkDuplicate: async (email?: string, phone?: string, excludeId?: string) => {\n        if (!email && !phone) return null\n\n        try {\n            const supabase = createClient()\n            let query = supabase\n                .from('contacts')\n                .select('*')\n                .is('archived_at', null)\n\n            if (excludeId) {\n                query = query.neq('id', excludeId)\n            }\n\n            const orConditions = []\n            if (email) orConditions.push(`email.eq.${email}`)\n            if (phone) orConditions.push(`phone.eq.${toE164(phone)}`)\n\n            if (orConditions.length > 0) {\n                query = query.or(orConditions.join(','))\n            } else {\n                return null\n            }\n\n            const { data, error } = await query.limit(1).maybeSingle()\n            if (error) throw error\n            return data ? dbToContact(data) : null\n        } catch (error) {\n            console.error('Error checking duplicate:', error)\n            return null\n        }\n    },\n\n    toggleColumn: (columnId: string) => {\n        set((state) => {\n            const newColumns = state.visibleColumns.includes(columnId)\n                ? state.visibleColumns.filter((id) => id !== columnId)\n                : [...state.visibleColumns, columnId]\n\n            if (typeof window !== 'undefined') {\n                localStorage.setItem('orbit_contact_columns', JSON.stringify(newColumns))\n            }\n\n            return { visibleColumns: newColumns }\n        })\n    },\n\n    toggleSelection: (id: string) => {\n        set((state) => ({\n            selectedContactIds: state.selectedContactIds.includes(id)\n                ? state.selectedContactIds.filter((selectedId) => selectedId !== id)\n                : [...state.selectedContactIds, id],\n        }))\n    },\n\n    clearSelection: () => set({ selectedContactIds: [] }),\n\n    selectPage: (ids: string[]) => {\n        set((state) => {\n            const allSelected = ids.every(id => state.selectedContactIds.includes(id))\n            if (allSelected) {\n                return {\n                    selectedContactIds: state.selectedContactIds.filter(id => !ids.includes(id))\n                }\n            } else {\n                const newSelection = new Set([...state.selectedContactIds, ...ids])\n                return { selectedContactIds: Array.from(newSelection) }\n            }\n        })\n    },\n\n    mergeContacts: async (primaryId: string, secondaryId: string, mergedData: Partial<Contact>) => {\n        set({ isLoading: true, error: null })\n        try {\n            const supabase = createClient()\n            const primary = get().contacts.find(c => c.id === primaryId) || await get().fetchContactById(primaryId)\n            const secondary = get().contacts.find(c => c.id === secondaryId) || await get().fetchContactById(secondaryId)\n\n            if (!primary || !secondary) throw new Error('Contacts not found')\n\n            // 1. Prepare merged fields for DB\n            const dbUpdates: Record<string, any> = {\n                first_name: mergedData.firstName,\n                last_name: mergedData.lastName,\n                is_company: mergedData.isCompany,\n                company_name: mergedData.companyName || null,\n                email: mergedData.email,\n                phone: mergedData.phone || null,\n                status: mergedData.status,\n                tags: Array.from(new Set([...primary.tags, ...secondary.tags])),\n                // Merge notes - simple concatenation for now\n                notes: [...primary.notes, ...secondary.notes].filter(Boolean).join('\\n'),\n                updated_at: new Date().toISOString()\n            }\n\n            // 2. Update Primary\n            const { error: updateError } = await supabase\n                .from('contacts')\n                .update(dbUpdates)\n                .eq('id', primaryId)\n\n            if (updateError) throw updateError\n\n            // 3. Archive Secondary\n            const { error: archiveError } = await supabase\n                .from('contacts')\n                .update({\n                    archived_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString(),\n                    notes: `Merged into ${primary.firstName} ${primary.lastName} (${primaryId})`\n                })\n                .eq('id', secondaryId)\n\n            if (archiveError) throw archiveError\n\n            // 4. Migrate related data (Invoices, Tasks, Projects)\n            try {\n                await Promise.all([\n                    supabase.from('invoices').update({ contact_id: primaryId }).eq('contact_id', secondaryId),\n                    supabase.from('tasks').update({ contact_id: primaryId }).eq('contact_id', secondaryId),\n                    supabase.from('projects').update({ contact_id: primaryId }).eq('contact_id', secondaryId),\n                ])\n            } catch (migrationError) {\n                console.error('Error migrating related data during merge:', migrationError)\n                // We don't throw here to avoid failing the whole merge if one related update fails\n                // but we might want to log this for debugging\n            }\n\n            // 5. Update local state\n            set((state) => ({\n                contacts: state.contacts\n                    .filter(c => c.id !== secondaryId)\n                    .map(c => c.id === primaryId ? {\n                        ...c,\n                        ...mergedData,\n                        tags: dbUpdates.tags,\n                        notes: [...primary.notes, ...secondary.notes].filter(Boolean),\n                        updatedAt: new Date()\n                    } : c),\n                selectedContactIds: [],\n                isLoading: false\n            }))\n\n            return true\n        } catch (error: any) {\n            console.error('Error merging contacts:', error)\n            set({ error: error.message, isLoading: false })\n            return false\n        }\n    },\n\n    addContact: async (input) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Get current user's tenant_id\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) throw new Error('Not authenticated')\n\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (!profile?.tenant_id) throw new Error('No organization found')\n\n            // Check for duplicates before adding\n            const isDuplicate = await get().checkEmailDuplicate(input.email)\n            if (isDuplicate) throw new Error('A contact with this email already exists')\n\n            const dbData = {\n                ...contactToDb(input),\n                tenant_id: profile.tenant_id,\n            }\n\n            const { data, error } = await supabase\n                .from('contacts')\n                .insert(dbData)\n                .select()\n                .single()\n\n            if (error) throw error\n\n            const newContact = dbToContact(data)\n            set((state) => ({ contacts: [newContact, ...state.contacts] }))\n            return newContact\n        } catch (error: any) {\n            console.error('Error adding contact:', error)\n            set({ error: error.message })\n            return null\n        }\n    },\n\n    updateContact: async (id, updates) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Build update object\n            const dbUpdates: any = { updated_at: new Date().toISOString() }\n\n            if (updates.firstName !== undefined) dbUpdates.first_name = updates.firstName\n            if (updates.lastName !== undefined) dbUpdates.last_name = updates.lastName\n            if (updates.isCompany !== undefined) dbUpdates.is_company = updates.isCompany\n            if (updates.companyName !== undefined) dbUpdates.company_name = updates.companyName\n            if (updates.email !== undefined) dbUpdates.email = updates.email\n            if (updates.phone !== undefined) dbUpdates.phone = updates.phone\n            if (updates.status !== undefined) dbUpdates.status = updates.status\n            if (updates.tags !== undefined) dbUpdates.tags = updates.tags\n            if (updates.notes !== undefined) dbUpdates.notes = updates.notes.join('\\n')\n\n            const { error } = await supabase\n                .from('contacts')\n                .update(dbUpdates)\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                contacts: state.contacts.map((c) =>\n                    c.id === id ? { ...c, ...updates, updatedAt: new Date() } : c\n                ),\n            }))\n        } catch (error: any) {\n            console.error('Error updating contact:', error)\n            set({ error: error.message })\n        }\n    },\n\n    deleteContact: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Standard CRM Industry practice: Archiving (Soft Delete)\n            // instead of hard delete which would break invoice/project history\n            const { error } = await supabase\n                .from('contacts')\n                .update({\n                    archived_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                })\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                contacts: state.contacts.filter((c) => c.id !== id),\n            }))\n        } catch (error: any) {\n            console.error('Error archiving contact:', error)\n            set({ error: error.message })\n        }\n    },\n\n    updateStatus: async (id: string, status: ContactStatus) => {\n        await get().updateContact(id, { status })\n    },\n\n    bulkArchiveContacts: async (ids: string[]) => {\n        if (!ids.length) return\n\n        set({ isLoading: true, error: null })\n        try {\n            const supabase = createClient()\n            const { error } = await supabase\n                .from('contacts')\n                .update({\n                    archived_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                })\n                .in('id', ids)\n\n            if (error) throw error\n\n            set((state) => ({\n                contacts: state.contacts.filter(c => !ids.includes(c.id)),\n                selectedContactIds: state.selectedContactIds.filter(id => !ids.includes(id)),\n                isLoading: false\n            }))\n        } catch (error: any) {\n            console.error('Error bulk archiving contacts:', error)\n            set({ error: error.message, isLoading: false })\n            throw error\n        }\n    },\n\n    getContact: (id) => {\n        return get().contacts.find((c) => c.id === id)\n    },\n\n    fetchContactById: async (id) => {\n        try {\n            const supabase = createClient()\n            const { data, error } = await supabase\n                .from('contacts')\n                .select('*')\n                .eq('id', id)\n                .single()\n\n            if (error) throw error\n            if (!data) return null\n\n            const contact = dbToContact(data)\n            // Optionally update the store if the contact is already there or to cache it\n            // For now just return it\n            return contact\n        } catch (error) {\n            console.error('Error fetching individual contact:', error)\n            return null\n        }\n    },\n\n    checkEmailDuplicate: async (email, excludeId) => {\n        if (!email) return false\n\n        const supabase = createClient()\n        const { data: { user } } = await supabase.auth.getUser()\n        if (!user) return false\n\n        const { data: profile } = await supabase\n            .from('profiles')\n            .select('tenant_id')\n            .eq('id', user.id)\n            .single()\n\n        if (!profile?.tenant_id) return false\n\n        let query = supabase\n            .from('contacts')\n            .select('id')\n            .eq('tenant_id', profile.tenant_id)\n            .eq('email', email.toLowerCase().trim())\n            .is('archived_at', null)\n\n        if (excludeId) {\n            query = query.neq('id', excludeId)\n        }\n\n        const { data, error } = await query\n\n        if (error) {\n            console.error('Error checking duplicate email:', error)\n            return false\n        }\n\n        return data.length > 0\n    },\n\n    setVisibleColumns: (columns: string[]) => {\n        set({ visibleColumns: columns })\n    },\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/stores/document-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[516,519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[516,519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'get' is defined but never used.","line":33,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":66},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1752,1755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1752,1755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3829,3832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3829,3832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4840,4843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4840,4843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand'\nimport { createClient } from '@/lib/supabase/client'\nimport { ProjectDocument, CreateDocumentInput } from '@/types/document'\n\ninterface DocumentStore {\n    documents: ProjectDocument[]\n    isLoading: boolean\n    error: string | null\n\n    // Actions\n    fetchDocuments: (projectId?: string) => Promise<void>\n    uploadDocument: (file: File, input: CreateDocumentInput) => Promise<ProjectDocument | null>\n    deleteDocument: (id: string) => Promise<void>\n}\n\nfunction dbToDocument(row: any): ProjectDocument {\n    return {\n        id: row.id,\n        name: row.name,\n        filePath: row.file_path,\n        fileType: row.file_type,\n        sizeBytes: row.size_bytes,\n        visibility: row.visibility,\n        embeddingStatus: row.embedding_status,\n        contentSummary: row.content_summary,\n        projectId: row.project_id,\n        contactId: row.contact_id,\n        createdAt: new Date(row.created_at),\n        updatedAt: new Date(row.updated_at),\n    }\n}\n\nexport const useDocumentStore = create<DocumentStore>()((set, get) => ({\n    documents: [],\n    isLoading: false,\n    error: null,\n\n    fetchDocuments: async (projectId) => {\n        set({ isLoading: true, error: null })\n        try {\n            const supabase = createClient()\n            let query = supabase\n                .from('documents')\n                .select('*')\n                .order('created_at', { ascending: false })\n\n            if (projectId) {\n                query = query.eq('project_id', projectId)\n            }\n\n            const { data, error } = await query\n\n            if (error) throw error\n\n            const documents = (data || []).map(dbToDocument)\n            set({ documents, isLoading: false })\n        } catch (error: any) {\n            console.error('Error fetching documents:', error)\n            set({ error: error.message, isLoading: false })\n        }\n    },\n\n    uploadDocument: async (file, input) => {\n        set({ error: null, isLoading: true })\n        try {\n            const supabase = createClient()\n\n            // 1. Get current user & tenant\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) throw new Error('Not authenticated')\n\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (!profile?.tenant_id) throw new Error('No organization found')\n\n            // 2. Upload file to Storage\n            const fileExt = file.name.split('.').pop()\n            const filePath = `${profile.tenant_id}/${Math.random().toString(36).substring(2)}.${fileExt}`\n\n            const { error: uploadError } = await supabase.storage\n                .from('documents')\n                .upload(filePath, file)\n\n            if (uploadError) throw uploadError\n\n            // 3. Create DB record\n            const dbData = {\n                tenant_id: profile.tenant_id,\n                project_id: input.projectId || null,\n                contact_id: input.contactId || null,\n                name: input.name || file.name,\n                file_path: filePath,\n                file_type: file.type,\n                size_bytes: file.size,\n                visibility: input.visibility || 'internal',\n                embedding_status: 'pending'\n            }\n\n            const { data, error: dbError } = await supabase\n                .from('documents')\n                .insert(dbData)\n                .select()\n                .single()\n\n            if (dbError) throw dbError\n\n            const newDoc = dbToDocument(data)\n            set((state) => ({\n                documents: [newDoc, ...state.documents],\n                isLoading: false\n            }))\n            return newDoc\n        } catch (error: any) {\n            console.error('Error uploading document:', error)\n            set({ error: error.message, isLoading: false })\n            return null\n        }\n    },\n\n    deleteDocument: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Get doc info first for file deletion\n            const { data: doc } = await supabase\n                .from('documents')\n                .select('file_path')\n                .eq('id', id)\n                .single()\n\n            if (doc?.file_path) {\n                await supabase.storage\n                    .from('documents')\n                    .remove([doc.file_path])\n            }\n\n            const { error } = await supabase\n                .from('documents')\n                .delete()\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                documents: state.documents.filter((d) => d.id !== id),\n            }))\n        } catch (error: any) {\n            console.error('Error deleting document:', error)\n            set({ error: error.message })\n        }\n    },\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/stores/invoice-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2688,2691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2688,2691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5842,5845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5842,5845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":290,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9809,9812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9809,9812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":303,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10165,10168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10165,10168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":353,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12253,12256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12253,12256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":373,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":373,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12813,12816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12813,12816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":400,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13645,13648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13645,13648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":422,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14309,14312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14309,14312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":450,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":450,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15197,15200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15197,15200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand'\nimport { createClient } from '@/lib/supabase/client'\nimport type {\n    Invoice,\n    InvoiceLineItem,\n    InvoiceStatus,\n    InvoiceType\n} from '@/lib/types/schema'\n\n// =====================================================\n// TYPES\n// =====================================================\n\nexport interface LineItemInput {\n    description: string\n    quantity: number\n    unit_price: number\n    tax_rate: number\n    sort_order?: number\n}\n\nexport interface CreateInvoiceInput {\n    contact_id: string | null\n    project_id?: string | null\n    currency: string\n    invoice_type: InvoiceType\n    due_date?: string | null\n    notes?: string | null\n    line_items: LineItemInput[]\n}\n\nexport interface InvoiceWithLineItems extends Invoice {\n    line_items: InvoiceLineItem[]\n    contact?: {\n        id: string\n        first_name: string | null\n        last_name: string | null\n        company_name: string | null\n        is_company: boolean\n        email: string | null\n    } | null\n}\n\ninterface InvoiceStore {\n    invoices: InvoiceWithLineItems[]\n    isLoading: boolean\n    error: string | null\n\n    // Actions\n    fetchInvoices: (projectId?: string) => Promise<void>\n    addInvoice: (input: CreateInvoiceInput) => Promise<InvoiceWithLineItems | null>\n    updateInvoice: (id: string, updates: Partial<Invoice>, lineItems?: LineItemInput[]) => Promise<void>\n    deleteInvoice: (id: string) => Promise<void>\n    markAsPaid: (id: string) => Promise<void>\n    markAsSent: (id: string) => Promise<void>\n    createPaymentLink: (id: string) => Promise<string | null>\n    getInvoice: (id: string) => InvoiceWithLineItems | undefined\n}\n\n// =====================================================\n// HELPERS\n// =====================================================\n\nfunction calculateTotals(lineItems: LineItemInput[]): {\n    subtotal: number\n    tax_total: number\n    amount_total: number\n} {\n    let subtotal = 0\n    let tax_total = 0\n\n    for (const item of lineItems) {\n        const lineTotal = item.quantity * item.unit_price\n        const lineTax = lineTotal * (item.tax_rate / 100)\n        subtotal += lineTotal\n        tax_total += lineTax\n    }\n\n    return {\n        subtotal: Math.round(subtotal * 100) / 100,\n        tax_total: Math.round(tax_total * 100) / 100,\n        amount_total: Math.round((subtotal + tax_total) * 100) / 100,\n    }\n}\n\nfunction generateQRReference(): string {\n    // Generate a random 21-digit number for QR reference\n    const randomDigits = Array.from({ length: 21 }, () =>\n        Math.floor(Math.random() * 10)\n    ).join('')\n\n    return randomDigits.replace(/(.{5})/g, '$1 ').trim()\n}\n\nasync function generateInvoiceNumber(supabase: any, tenantId: string): Promise<string> {\n    const year = new Date().getFullYear()\n\n    // Get organization settings for prefix\n    const { data: org } = await supabase\n        .from('organizations')\n        .select('settings')\n        .eq('id', tenantId)\n        .single()\n\n    const settings = (org?.settings as Record<string, unknown>) || {}\n    const billing = (settings.billing as Record<string, unknown>) || {}\n    const prefix = (billing.invoice_prefix as string) || 'INV'\n\n    // Count existing invoices this year for this tenant\n    const startOfYear = `${year}-01-01`\n    const { count } = await supabase\n        .from('invoices')\n        .select('*', { count: 'exact', head: true })\n        .eq('tenant_id', tenantId)\n        .gte('created_at', startOfYear)\n\n    const nextNumber = (count || 0) + 1\n    const paddedNumber = nextNumber.toString().padStart(4, '0')\n\n    return `${prefix}-${year}-${paddedNumber}`\n}\n\n// =====================================================\n// STORE\n// =====================================================\n\nexport const useInvoiceStore = create<InvoiceStore>()((set, get) => ({\n    invoices: [],\n    isLoading: false,\n    error: null,\n\n    fetchInvoices: async (projectId) => {\n        set({ isLoading: true, error: null })\n        try {\n            const supabase = createClient()\n\n            // Fetch invoices with contacts\n            let query = supabase\n                .from('invoices')\n                .select(`\n                    *,\n                    contacts (\n                        id,\n                        first_name,\n                        last_name,\n                        company_name,\n                        is_company,\n                        email\n                    )\n                `)\n\n            if (projectId) {\n                query = query.eq('project_id', projectId)\n            }\n\n            const { data: invoices, error } = await query.order('created_at', { ascending: false })\n\n            if (error) throw error\n\n            // Fetch line items for all invoices\n            const invoiceIds = (invoices || []).map(i => i.id)\n            const { data: allLineItems } = await supabase\n                .from('invoice_line_items')\n                .select('*')\n                .in('invoice_id', invoiceIds)\n                .order('sort_order', { ascending: true })\n\n            // Group line items by invoice\n            const lineItemsByInvoice = new Map<string, InvoiceLineItem[]>()\n            for (const item of allLineItems || []) {\n                const existing = lineItemsByInvoice.get(item.invoice_id) || []\n                existing.push(item)\n                lineItemsByInvoice.set(item.invoice_id, existing)\n            }\n\n            // Combine invoices with line items\n            const invoicesWithLineItems: InvoiceWithLineItems[] = (invoices || []).map(invoice => ({\n                ...invoice,\n                contact: invoice.contacts as InvoiceWithLineItems['contact'],\n                line_items: lineItemsByInvoice.get(invoice.id) || [],\n            }))\n\n            set({ invoices: invoicesWithLineItems, isLoading: false })\n        } catch (error: any) {\n            console.error('Error fetching invoices:', error)\n            set({ error: error.message, isLoading: false })\n        }\n    },\n\n    addInvoice: async (input) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Get current user's tenant_id and IBAN\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) throw new Error('Not authenticated')\n\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (!profile?.tenant_id) throw new Error('No organization found')\n\n            // Get organization settings for IBAN\n            const { data: org } = await supabase\n                .from('organizations')\n                .select('settings')\n                .eq('id', profile.tenant_id)\n                .single()\n\n            const settings = (org?.settings as Record<string, unknown>) || {}\n            const billing = (settings.billing as Record<string, unknown>) || {}\n            const iban = (billing.iban as string) || null\n\n            // Calculate totals\n            const totals = calculateTotals(input.line_items)\n\n            // Generate invoice number\n            const invoiceNumber = await generateInvoiceNumber(supabase, profile.tenant_id)\n\n            // Create invoice record\n            const invoiceData = {\n                tenant_id: profile.tenant_id,\n                contact_id: input.contact_id,\n                project_id: input.project_id || null,\n                invoice_number: invoiceNumber,\n                currency: input.currency,\n                invoice_type: input.invoice_type,\n                status: 'draft' as InvoiceStatus,\n                subtotal: totals.subtotal,\n                tax_total: totals.tax_total,\n                amount_total: totals.amount_total,\n                due_date: input.due_date || null,\n                notes: input.notes || null,\n                qr_reference: input.invoice_type === 'swiss_qr' ? generateQRReference() : null,\n                iban_used: iban,\n                invoice_date: new Date().toISOString().split('T')[0],\n            }\n\n            const { data: invoice, error: invoiceError } = await supabase\n                .from('invoices')\n                .insert(invoiceData)\n                .select(`\n                    *,\n                    contacts (\n                        id,\n                        first_name,\n                        last_name,\n                        company_name,\n                        is_company,\n                        email\n                    )\n                `)\n                .single()\n\n            if (invoiceError) throw invoiceError\n\n            // Create line items\n            const lineItemsData = input.line_items.map((item, index) => ({\n                invoice_id: invoice.id,\n                description: item.description,\n                quantity: item.quantity,\n                unit_price: item.unit_price,\n                tax_rate: item.tax_rate,\n                sort_order: item.sort_order ?? index,\n            }))\n\n            const { data: lineItems, error: lineItemsError } = await supabase\n                .from('invoice_line_items')\n                .insert(lineItemsData)\n                .select()\n\n            if (lineItemsError) {\n                // Rollback: delete the invoice if line items fail\n                await supabase.from('invoices').delete().eq('id', invoice.id)\n                throw lineItemsError\n            }\n\n            const newInvoice: InvoiceWithLineItems = {\n                ...invoice,\n                contact: invoice.contacts as InvoiceWithLineItems['contact'],\n                line_items: lineItems || [],\n            }\n\n            set((state) => ({ invoices: [newInvoice, ...state.invoices] }))\n            return newInvoice\n        } catch (error: any) {\n            console.error('Error adding invoice:', error)\n            set({ error: error.message })\n            return null\n        }\n    },\n\n    updateInvoice: async (id, updates, lineItems) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Build update object\n            const dbUpdates: any = {}\n\n            if (updates.contact_id !== undefined) dbUpdates.contact_id = updates.contact_id\n            if (updates.project_id !== undefined) dbUpdates.project_id = updates.project_id\n            if (updates.currency !== undefined) dbUpdates.currency = updates.currency\n            if (updates.invoice_type !== undefined) dbUpdates.invoice_type = updates.invoice_type\n            if (updates.status !== undefined) dbUpdates.status = updates.status\n            if (updates.due_date !== undefined) dbUpdates.due_date = updates.due_date\n            if (updates.notes !== undefined) dbUpdates.notes = updates.notes\n\n            // If line items are provided, recalculate totals\n            if (lineItems) {\n                const totals = calculateTotals(lineItems)\n                dbUpdates.subtotal = totals.subtotal\n                dbUpdates.tax_total = totals.tax_total\n                dbUpdates.amount_total = totals.amount_total\n\n                // Delete existing line items\n                await supabase\n                    .from('invoice_line_items')\n                    .delete()\n                    .eq('invoice_id', id)\n\n                // Insert new line items\n                const lineItemsData = lineItems.map((item, index) => ({\n                    invoice_id: id,\n                    description: item.description,\n                    quantity: item.quantity,\n                    unit_price: item.unit_price,\n                    tax_rate: item.tax_rate,\n                    sort_order: item.sort_order ?? index,\n                }))\n\n                await supabase\n                    .from('invoice_line_items')\n                    .insert(lineItemsData)\n            }\n\n            // Update invoice\n            if (Object.keys(dbUpdates).length > 0) {\n                const { error } = await supabase\n                    .from('invoices')\n                    .update(dbUpdates)\n                    .eq('id', id)\n\n                if (error) throw error\n            }\n\n            // Refresh invoices\n            await get().fetchInvoices()\n        } catch (error: any) {\n            console.error('Error updating invoice:', error)\n            set({ error: error.message })\n        }\n    },\n\n    deleteInvoice: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n            const { error } = await supabase\n                .from('invoices')\n                .delete()\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                invoices: state.invoices.filter((i) => i.id !== id),\n            }))\n        } catch (error: any) {\n            console.error('Error deleting invoice:', error)\n            set({ error: error.message })\n        }\n    },\n\n    markAsPaid: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n            const { error } = await supabase\n                .from('invoices')\n                .update({\n                    status: 'paid',\n                    paid_at: new Date().toISOString(),\n                })\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                invoices: state.invoices.map((i) =>\n                    i.id === id\n                        ? { ...i, status: 'paid' as InvoiceStatus, paid_at: new Date().toISOString() }\n                        : i\n                ),\n            }))\n        } catch (error: any) {\n            console.error('Error marking invoice as paid:', error)\n            set({ error: error.message })\n        }\n    },\n\n    markAsSent: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n            const { error } = await supabase\n                .from('invoices')\n                .update({ status: 'sent' })\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                invoices: state.invoices.map((i) =>\n                    i.id === id ? { ...i, status: 'sent' as InvoiceStatus } : i\n                ),\n            }))\n        } catch (error: any) {\n            console.error('Error marking invoice as sent:', error)\n            set({ error: error.message })\n        }\n    },\n\n    createPaymentLink: async (id) => {\n        set({ error: null })\n        try {\n            const response = await fetch(`/api/invoices/${id}/payment-link`, {\n                method: 'POST',\n            })\n\n            if (!response.ok) {\n                const data = await response.json()\n                throw new Error(data.error || 'Failed to create payment link')\n            }\n\n            const { payment_link } = await response.json()\n\n            // Update local state with payment link\n            set((state) => ({\n                invoices: state.invoices.map((i) =>\n                    i.id === id ? { ...i, stripe_payment_link: payment_link } : i\n                ),\n            }))\n\n            return payment_link\n        } catch (error: any) {\n            console.error('Error creating payment link:', error)\n            set({ error: error.message })\n            return null\n        }\n    },\n\n    getInvoice: (id) => {\n        return get().invoices.find((i) => i.id === id)\n    },\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/stores/notification-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[589,592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[589,592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1113,1116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1113,1116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'get' is defined but never used.","line":66,"column":71,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2602,2605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2602,2605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3394,3397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3394,3397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4310,4313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4310,4313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5105,5108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5105,5108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":195,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5776,5779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5776,5779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6473,6476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6473,6476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand'\nimport { createClient } from '@/lib/supabase/client'\n\nexport type NotificationType =\n    | 'task_due'\n    | 'task_overdue'\n    | 'invoice_due'\n    | 'invoice_overdue'\n    | 'mention'\n    | 'comment'\n    | 'assignment'\n    | 'status_change'\n    | 'reminder'\n    | 'system'\n    | 'welcome'\n    | 'update'\n\nexport interface Notification {\n    id: string\n    type: NotificationType\n    title: string\n    message?: string\n    entityType?: string\n    entityId?: string\n    entityUrl?: string\n    read: boolean\n    archived: boolean\n    metadata?: Record<string, any>\n    createdAt: Date\n    readAt?: Date\n}\n\ninterface NotificationStore {\n    notifications: Notification[]\n    unreadCount: number\n    isLoading: boolean\n    error: string | null\n\n    // Actions\n    fetchNotifications: () => Promise<void>\n    markAsRead: (id: string) => Promise<void>\n    markAllAsRead: () => Promise<void>\n    archiveNotification: (id: string) => Promise<void>\n    clearAll: () => Promise<void>\n    getUnreadCount: () => Promise<void>\n}\n\n// Convert DB row to Notification\nfunction dbToNotification(row: any): Notification {\n    return {\n        id: row.id,\n        type: row.type,\n        title: row.title,\n        message: row.message,\n        entityType: row.entity_type,\n        entityId: row.entity_id,\n        entityUrl: row.entity_url,\n        read: row.read,\n        archived: row.archived,\n        metadata: row.metadata || {},\n        createdAt: new Date(row.created_at),\n        readAt: row.read_at ? new Date(row.read_at) : undefined,\n    }\n}\n\nexport const useNotificationStore = create<NotificationStore>()((set, get) => ({\n    notifications: [],\n    unreadCount: 0,\n    isLoading: false,\n    error: null,\n\n    fetchNotifications: async () => {\n        set({ isLoading: true, error: null })\n        try {\n            const supabase = createClient()\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) {\n                set({ isLoading: false })\n                return\n            }\n\n            const { data, error } = await supabase\n                .from('notifications')\n                .select('*')\n                .eq('user_id', user.id)\n                .eq('archived', false)\n                .order('created_at', { ascending: false })\n                .limit(50)\n\n            if (error) throw error\n\n            const notifications = (data || []).map(dbToNotification)\n            const unreadCount = notifications.filter((n) => !n.read).length\n\n            set({ notifications, unreadCount, isLoading: false })\n        } catch (error: any) {\n            console.error('Error fetching notifications:', error)\n            set({ error: error.message, isLoading: false })\n        }\n    },\n\n    markAsRead: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            const { error } = await supabase\n                .from('notifications')\n                .update({ read: true, read_at: new Date().toISOString() })\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                notifications: state.notifications.map((n) =>\n                    n.id === id ? { ...n, read: true, readAt: new Date() } : n\n                ),\n                unreadCount: Math.max(0, state.unreadCount - 1),\n            }))\n        } catch (error: any) {\n            console.error('Error marking notification as read:', error)\n            set({ error: error.message })\n        }\n    },\n\n    markAllAsRead: async () => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) return\n\n            const { error } = await supabase\n                .from('notifications')\n                .update({ read: true, read_at: new Date().toISOString() })\n                .eq('user_id', user.id)\n                .eq('read', false)\n\n            if (error) throw error\n\n            set((state) => ({\n                notifications: state.notifications.map((n) => ({\n                    ...n,\n                    read: true,\n                    readAt: new Date(),\n                })),\n                unreadCount: 0,\n            }))\n        } catch (error: any) {\n            console.error('Error marking all notifications as read:', error)\n            set({ error: error.message })\n        }\n    },\n\n    archiveNotification: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            const { error } = await supabase\n                .from('notifications')\n                .update({ archived: true })\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                notifications: state.notifications.filter((n) => n.id !== id),\n                unreadCount: state.notifications.find((n) => n.id === id)?.read\n                    ? state.unreadCount\n                    : Math.max(0, state.unreadCount - 1),\n            }))\n        } catch (error: any) {\n            console.error('Error archiving notification:', error)\n            set({ error: error.message })\n        }\n    },\n\n    clearAll: async () => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) return\n\n            const { error } = await supabase\n                .from('notifications')\n                .update({ archived: true })\n                .eq('user_id', user.id)\n                .eq('archived', false)\n\n            if (error) throw error\n\n            set({ notifications: [], unreadCount: 0 })\n        } catch (error: any) {\n            console.error('Error clearing notifications:', error)\n            set({ error: error.message })\n        }\n    },\n\n    getUnreadCount: async () => {\n        try {\n            const supabase = createClient()\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) return\n\n            const { count, error } = await supabase\n                .from('notifications')\n                .select('*', { count: 'exact', head: true })\n                .eq('user_id', user.id)\n                .eq('read', false)\n                .eq('archived', false)\n\n            if (error) throw error\n\n            set({ unreadCount: count || 0 })\n        } catch (error: any) {\n            console.error('Error getting unread count:', error)\n        }\n    },\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/stores/project-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1064,1067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1064,1067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3551,3554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3551,3554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6026,6029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6026,6029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6336,6339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6336,6339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":226,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7267,7270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7267,7270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":253,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8045,8048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8045,8048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8704,8707],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8704,8707],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand'\nimport { Project, CreateProjectInput, ProjectStatus, ProjectFilters, ProjectSort } from '@/types/project'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface ProjectStore {\n    projects: Project[]\n    isLoading: boolean\n    error: string | null\n    currentPage: number\n    pageSize: number\n    totalCount: number\n    filters: ProjectFilters\n    sortConfig: ProjectSort\n\n    // Actions\n    fetchProjects: () => Promise<void>\n    setFilters: (filters: Partial<ProjectFilters>) => void\n    setSort: (column: ProjectSort['column']) => void\n    setPage: (page: number) => void\n    setPageSize: (size: number) => void\n    addProject: (input: CreateProjectInput) => Promise<Project | null>\n    updateProject: (id: string, updates: Partial<Project>) => Promise<void>\n    deleteProject: (id: string) => Promise<void>\n    archiveProject: (id: string) => Promise<void>\n    restoreProject: (id: string) => Promise<void>\n    getProject: (id: string) => Project | undefined\n}\n\n\n// Convert DB row to Project\nfunction dbToProject(row: any): Project {\n    return {\n        id: row.id,\n        name: row.name,\n        description: row.description,\n        clientId: row.contact_id,\n        clientName: row.contacts?.company_name ||\n            [row.contacts?.first_name, row.contacts?.last_name].filter(Boolean).join(' '),\n        status: row.status as ProjectStatus,\n        deadline: row.deadline ? new Date(row.deadline) : undefined,\n        archivedAt: row.archived_at ? new Date(row.archived_at) : undefined,\n        createdAt: new Date(row.created_at),\n        updatedAt: new Date(row.updated_at),\n    }\n}\n\nexport const useProjectStore = create<ProjectStore>()((set, get) => ({\n    projects: [],\n    isLoading: false,\n    error: null,\n    currentPage: 1,\n    pageSize: 12,\n    totalCount: 0,\n    filters: {\n        search: '',\n        status: 'all',\n        clientId: 'all',\n    },\n    sortConfig: {\n        column: 'created_at',\n        direction: 'desc',\n    },\n\n    fetchProjects: async () => {\n        set({ isLoading: true, error: null })\n        try {\n            const { filters, sortConfig, currentPage, pageSize } = get()\n            const supabase = createClient()\n\n            let query = supabase\n                .from('projects')\n                .select(`\n                    *,\n                    contacts (\n                        first_name,\n                        last_name,\n                        company_name\n                    )\n                `, { count: 'exact' })\n\n            // Apply filters\n            query = query.is('archived_at', null)\n\n            if (filters.search) {\n                query = query.or(`name.ilike.%${filters.search}%,description.ilike.%${filters.search}%`)\n            }\n\n            if (filters.status !== 'all') {\n                query = query.eq('status', filters.status)\n            }\n\n            if (filters.clientId !== 'all') {\n                query = query.eq('contact_id', filters.clientId)\n            }\n\n            // Apply sorting\n            query = query.order(sortConfig.column, { ascending: sortConfig.direction === 'asc' })\n\n            // Apply pagination\n            const from = (currentPage - 1) * pageSize\n            const to = from + pageSize - 1\n            query = query.range(from, to)\n\n            const { data, error, count } = await query\n\n            if (error) throw error\n\n            const projects = (data || []).map(dbToProject)\n            set({ projects, totalCount: count || 0, isLoading: false })\n        } catch (error: any) {\n            console.error('Error fetching projects:', error)\n            set({ error: error.message, isLoading: false })\n        }\n    },\n\n    setFilters: (newFilters) => {\n        set((state) => ({\n            filters: { ...state.filters, ...newFilters },\n            currentPage: 1, // Reset to first page on filter change\n        }))\n        get().fetchProjects()\n    },\n\n    setSort: (column) => {\n        set((state) => ({\n            sortConfig: {\n                column,\n                direction:\n                    state.sortConfig.column === column && state.sortConfig.direction === 'desc'\n                        ? 'asc'\n                        : 'desc',\n            },\n            currentPage: 1,\n        }))\n        get().fetchProjects()\n    },\n\n    setPage: (page) => {\n        set({ currentPage: page })\n        get().fetchProjects()\n    },\n\n    setPageSize: (size) => {\n        set({ pageSize: size, currentPage: 1 })\n        get().fetchProjects()\n    },\n\n    addProject: async (input) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Get current user's tenant_id\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) throw new Error('Not authenticated')\n\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (!profile?.tenant_id) throw new Error('No organization found')\n\n            const dbData = {\n                tenant_id: profile.tenant_id,\n                name: input.name,\n                description: input.description || null,\n                contact_id: input.clientId || null,\n                status: input.status || 'lead',\n                deadline: input.deadline?.toISOString() || null,\n            }\n\n            const { data, error } = await supabase\n                .from('projects')\n                .insert(dbData)\n                .select(`\n                    *,\n                    contacts (\n                        first_name,\n                        last_name,\n                        company_name\n                    )\n                `)\n                .single()\n\n            if (error) throw error\n\n            const newProject = dbToProject(data)\n            set((state) => ({ projects: [newProject, ...state.projects] }))\n            return newProject\n        } catch (error: any) {\n            console.error('Error adding project:', error)\n            set({ error: error.message })\n            return null\n        }\n    },\n\n    updateProject: async (id, updates) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            const dbUpdates: any = { updated_at: new Date().toISOString() }\n\n            if (updates.name !== undefined) dbUpdates.name = updates.name\n            if (updates.description !== undefined) dbUpdates.description = updates.description\n            if (updates.clientId !== undefined) dbUpdates.contact_id = updates.clientId\n            if (updates.status !== undefined) dbUpdates.status = updates.status\n            if (updates.deadline !== undefined) {\n                dbUpdates.deadline = updates.deadline?.toISOString() || null\n            }\n\n            const { error } = await supabase\n                .from('projects')\n                .update(dbUpdates)\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                projects: state.projects.map((p) =>\n                    p.id === id ? { ...p, ...updates, updatedAt: new Date() } : p\n                ),\n            }))\n        } catch (error: any) {\n            console.error('Error updating project:', error)\n            set({ error: error.message })\n        }\n    },\n\n    deleteProject: async (id) => {\n        await get().archiveProject(id)\n    },\n\n    archiveProject: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n            const { error } = await supabase\n                .from('projects')\n                .update({\n                    archived_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                })\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                projects: state.projects.filter((p) => p.id !== id),\n            }))\n        } catch (error: any) {\n            console.error('Error archiving project:', error)\n            set({ error: error.message })\n        }\n    },\n\n    restoreProject: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n            const { error } = await supabase\n                .from('projects')\n                .update({\n                    archived_at: null,\n                    updated_at: new Date().toISOString()\n                })\n                .eq('id', id)\n\n            if (error) throw error\n\n            // Refresh projects to show the restored one\n            await get().fetchProjects()\n        } catch (error: any) {\n            console.error('Error restoring project:', error)\n            set({ error: error.message })\n        }\n    },\n\n    getProject: (id) => {\n        return get().projects.find((p) => p.id === id)\n    },\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/stores/task-store.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TaskPriority' is defined but never used.","line":2,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TaskPriority"},"fix":{"range":[75,89],"text":""},"desc":"Remove unused variable \"TaskPriority\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[731,734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[731,734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1940,1943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1940,1943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3511,3514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3511,3514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3815,3818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3815,3818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4930,4933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4930,4933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5475,5478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5475,5478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand'\nimport { Task, CreateTaskInput, TaskStatus, TaskPriority } from '@/types/task'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface TaskStore {\n    tasks: Task[]\n    isLoading: boolean\n    error: string | null\n\n    // Actions\n    fetchTasks: (projectId?: string) => Promise<void>\n    addTask: (input: CreateTaskInput) => Promise<Task | null>\n    updateTask: (id: string, updates: Partial<Task>) => Promise<void>\n    deleteTask: (id: string) => Promise<void>\n    updateStatus: (id: string, status: TaskStatus) => Promise<void>\n    toggleSubtask: (taskId: string, subtaskId: string) => void\n    getTask: (id: string) => Task | undefined\n}\n\n// Convert DB row to Task\nfunction dbToTask(row: any): Task {\n    return {\n        id: row.id,\n        title: row.title,\n        description: row.description,\n        status: row.status || 'todo',\n        priority: row.priority || 'medium',\n        dueDate: row.due_date ? new Date(row.due_date) : undefined,\n        projectId: row.project_id,\n        contactId: row.contact_id,\n        subtasks: [], // Subtasks not stored in DB yet\n        createdAt: new Date(row.created_at),\n        updatedAt: new Date(row.updated_at),\n    }\n}\n\nexport const useTaskStore = create<TaskStore>()((set, get) => ({\n    tasks: [],\n    isLoading: false,\n    error: null,\n\n    fetchTasks: async (projectId) => {\n        set({ isLoading: true, error: null })\n        try {\n            const supabase = createClient()\n            let query = supabase\n                .from('tasks')\n                .select('*')\n                .order('created_at', { ascending: false })\n\n            if (projectId) {\n                query = query.eq('project_id', projectId)\n            }\n\n            const { data, error } = await query\n\n            if (error) throw error\n\n            const tasks = (data || []).map(dbToTask)\n            set({ tasks, isLoading: false })\n        } catch (error: any) {\n            console.error('Error fetching tasks:', error)\n            set({ error: error.message, isLoading: false })\n        }\n    },\n\n    addTask: async (input) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            // Get current user's tenant_id\n            const { data: { user } } = await supabase.auth.getUser()\n            if (!user) throw new Error('Not authenticated')\n\n            const { data: profile } = await supabase\n                .from('profiles')\n                .select('tenant_id')\n                .eq('id', user.id)\n                .single()\n\n            if (!profile?.tenant_id) throw new Error('No organization found')\n\n            const dbData = {\n                tenant_id: profile.tenant_id,\n                created_by: user.id,\n                title: input.title,\n                description: input.description || null,\n                status: input.status || 'todo',\n                priority: input.priority || 'medium',\n                due_date: input.dueDate?.toISOString().split('T')[0] || null,\n                project_id: input.projectId || null,\n                contact_id: input.contactId || null,\n            }\n\n            const { data, error } = await supabase\n                .from('tasks')\n                .insert(dbData)\n                .select()\n                .single()\n\n            if (error) throw error\n\n            const newTask = dbToTask(data)\n            set((state) => ({ tasks: [newTask, ...state.tasks] }))\n            return newTask\n        } catch (error: any) {\n            console.error('Error adding task:', error)\n            set({ error: error.message })\n            return null\n        }\n    },\n\n    updateTask: async (id, updates) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n\n            const dbUpdates: any = { updated_at: new Date().toISOString() }\n\n            if (updates.title !== undefined) dbUpdates.title = updates.title\n            if (updates.description !== undefined) dbUpdates.description = updates.description\n            if (updates.status !== undefined) dbUpdates.status = updates.status\n            if (updates.priority !== undefined) dbUpdates.priority = updates.priority\n            if (updates.dueDate !== undefined) {\n                dbUpdates.due_date = updates.dueDate?.toISOString().split('T')[0] || null\n            }\n            if (updates.projectId !== undefined) dbUpdates.project_id = updates.projectId\n            if (updates.contactId !== undefined) dbUpdates.contact_id = updates.contactId\n\n            const { error } = await supabase\n                .from('tasks')\n                .update(dbUpdates)\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                tasks: state.tasks.map((t) =>\n                    t.id === id ? { ...t, ...updates, updatedAt: new Date() } : t\n                ),\n            }))\n        } catch (error: any) {\n            console.error('Error updating task:', error)\n            set({ error: error.message })\n        }\n    },\n\n    deleteTask: async (id) => {\n        set({ error: null })\n        try {\n            const supabase = createClient()\n            const { error } = await supabase\n                .from('tasks')\n                .delete()\n                .eq('id', id)\n\n            if (error) throw error\n\n            set((state) => ({\n                tasks: state.tasks.filter((t) => t.id !== id),\n            }))\n        } catch (error: any) {\n            console.error('Error deleting task:', error)\n            set({ error: error.message })\n        }\n    },\n\n    updateStatus: async (id, status) => {\n        await get().updateTask(id, { status })\n    },\n\n    // Subtasks are client-side only for now\n    toggleSubtask: (taskId, subtaskId) => {\n        set((state) => ({\n            tasks: state.tasks.map((t) =>\n                t.id === taskId\n                    ? {\n                        ...t,\n                        subtasks: t.subtasks.map((s) =>\n                            s.id === subtaskId ? { ...s, completed: !s.completed } : s\n                        ),\n                        updatedAt: new Date(),\n                    }\n                    : t\n            ),\n        }))\n    },\n\n    getTask: (id) => {\n        return get().tasks.find((t) => t.id === id)\n    },\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/types/chat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/types/contact.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/types/document.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/types/project.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/types/swissqrbill.d.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[88,91],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[88,91],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[116,119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[116,119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[149,152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[149,152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"declare module 'swissqrbill' {\n    export class SwissQRBill {\n        constructor(data: any);\n        attachTo(doc: any): void;\n        getStream(): any;\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/paulolopes/Desktop/lopes2tech/projects/OrbitCRM/orbitcrm_app/src/types/task.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
